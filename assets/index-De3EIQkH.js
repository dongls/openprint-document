const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/component-B2NTzUlK.js","assets/vue-C4hvfNT6.js","assets/component-L55ah7FP.css","assets/component-C2cM7-Wl.js","assets/utils-BI6Y8M4J.js","assets/utils-BaImnbvp.css","assets/component-DVhZYvzc.css"])))=>i.map(i=>d[i]);
var $s=Object.defineProperty;var al=n=>{throw TypeError(n)};var xs=(n,e,t)=>e in n?$s(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var F=(n,e,t)=>xs(n,typeof e!="symbol"?e+"":e,t),Ln=(n,e,t)=>e.has(n)||al("Cannot "+t);var ke=(n,e,t)=>(Ln(n,e,"read from private field"),t?t.call(n):e.get(n)),Be=(n,e,t)=>e.has(n)?al("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ut=(n,e,t,l)=>(Ln(n,e,"write to private field"),l?l.call(n,t):e.set(n,t),t),we=(n,e,t)=>(Ln(n,e,"access private method"),t);import{D as ye,E as yt,N as Ht,a as ft,b as X,c as xe,P as Un,d as Yt,e as cl,f as un,g as dn,O as Xt,h as ne,i as en,j as pn,L as Le,I as D,_ as P,k as $l,s as hn,l as As,m as ae,n as Ds,B as le,o as qs,S as Hn,p as Gn,F as oe,V as Ye,q as Wn,r as Ke,U as Dn,t as Yn,u as Je,v as fn,w as Qe,A as Pe,x as Xn,y as xl,z as Al,C as Dl,G as ge,H as ql,T as Os,J as ve,K as Ve,M as Tt,Q as qe,R as Zt,W as et,X as Ms,Y as Ps,Z as Vs,$ as jn,a0 as Zn,a1 as Fs,a2 as ln,a3 as Ct,a4 as qn,a5 as ht,a6 as be,a7 as zs,a8 as sn,a9 as Rt,aa as gt,ab as tt,ac as Bs,ad as kt,ae as It,af as Us,ag as Hs,ah as Gs,ai as Ws,aj as Ce,ak as Se,al as _t,am as ul,an as Ys,ao as dl,ap as Nn,aq as In,ar as Xs,as as js,at as on,au as Zs,av as Ks,aw as Js,ax as Qs,ay as pl,az as eo,aA as to}from"./utils-BI6Y8M4J.js";import{r as Q,o as Kn,d as x,c as L,a as w,n as h,b as d,e as f,f as Me,u as Ie,s as ue,g as De,h as N,w as ie,i as _,j as K,k as U,T as Ol,l as Z,m as wt,p as Kt,q as Ml,F as W,t as te,v as z,x as Pt,y as fl,z as Pl,A as Vl,B as _e,C as Ne,D as se,E as he,G as Vt,H as no,I as Fl,J as Jt,K as Jn,L as $n,M as Ge,N as st,O as lo,P as so,Q as oo,R as io}from"./vue-C4hvfNT6.js";const zl="@quickprint_drag_mode",Bl="@quickprint_drop_data",gn="@quickprint_operate",Xe="@quickprint_element",Qn="@quickprint_element_type",Ul="@quickprint_resize_flag",Et=160,vn=32,Ut=[50,75,100,125,150,200,300,400];var Gt=(n=>(n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n))(Gt||{}),Lt=(n=>(n[n.NONE=0]="NONE",n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n[n.BOTTOM_RIGHT=10]="BOTTOM_RIGHT",n))(Lt||{});const ot={SINGLE:0,MULTIPLE:1},Re=Object.freeze({INSERT:0,MOVE:1}),el=Object.freeze({DRAG_ELEMENT:0,SELECTION:1}),G=Object.freeze({CANVAS:"quickprint-is-canvas",DRAGGABLE:"quickprint-is-draggable",DRAGGING:"quickprint-is-dragging",RESIZEABLE:"quickprint-is-resizeable",RESIZEABLE_INDICATOR:"quickprint-is-resizeable-indicator",RESIZING:"quickprint-is-resizing",DROPPABLE:"quickprint-is-droppable",ELEMENT:"quickprint-is-element",ELEMENT_EDITOR:"quickprint-is-element-editor",PAGE:"quickprint-is-page",PAPER:"quickprint-is-paper",SCROLLABLE:"quickprint-is-scrollable",SELECTABLE:"quickprint-is-selectable",SELECTED:"quickprint-is-selected",GUIDE_LINE:"quickprint-is-guideline"}),me=Object.freeze({NONE:0,ELEMENT:1,PAGE:2}),Hl=[{label:"固定值",value:ye.CONST},{label:"变量",value:ye.VARIABLE},{label:"公式",value:ye.FORMULA,detail:"使用内置的公式生成数据"},{label:"自定义",value:ye.CODE,detail:"使用Javascript代码生成数据"}],ro=[{label:"显示",value:yt.VISIBLE,detail:"元素总是可见"},{label:"隐藏",value:yt.HIDDEN,detail:"元素在打印时隐藏"},{label:"满足条件时显示",value:yt.CONDITION,detail:"元素只在满足指定条件后显示"}],ao=[{label:"四舍五入",value:Ht.ROUND},{label:"向下舍入",value:Ht.FLOOR},{label:"向上舍入",value:Ht.CEIL},{label:"四舍六入",value:Ht.BANKER_ROUND}],co=[{label:"原始值",value:ft.NONE},{label:"固定位数",value:ft.FIXED},{label:"金额千位",value:ft.THOUSAND},{label:"金额万位",value:ft.TEN_THOUSAND},{label:"金额大写",value:ft.DAXIE},{label:"百分比",value:ft.PERCENTAGE}],uo=[{label:"显示",value:!0},{label:"隐藏",value:!1}],po=[{label:"默认",value:void 0},{label:"文本",value:X.TEXT},{label:"数字",value:X.NUMBER},{label:"日期",value:X.DATE}],re={LAYOUT:0,COORD:1,SIZE:2,POSITION:3,VISIBILITY:5,OVERFLOW:6,PRINT_MODE:7,BASIC:100,PREFIX:101,SUFFIX:102,DISPLAY:103,ATTRIBUTES:200,DATASOURCE:300},Gl=[{label:"年-月",value:xe.YEAR_MONTH,detail:"示例：2024-12"},{label:"年月",value:xe.YEAR_MONTH_CHS,detail:"示例：2024年12月"},{label:"年-月-日",value:xe.YEAR_MONTH_DAY,detail:"示例：2024-12-01"},{label:"年月日",value:xe.YEAR_MONTH_DAY_CHS,detail:"示例：2024年12月01日"},{label:"年-月-日 时:分",value:xe.DATETIME_SHORT,detail:"示例：2024-12-01 12:00"},{label:"年-月-日 时:分:秒",value:xe.DATETIME,detail:"示例：2024-12-01 12:00:00"},{label:"时:分:秒",value:xe.TIME,detail:"示例：12:00:00"},{label:"时:分",value:xe.TIME_SHORT,detail:"示例：12:00"},{label:"年",value:xe.YEAR,detail:"示例：2024"},{label:"月",value:xe.MONTH,detail:"示例：12"},{label:"日",value:xe.DAY,detail:"示例：01"}];Gl.forEach(n=>n.detail=`模板：${n.value}
${n.detail}`);const fo=[{label:"元素值",value:Un.ELEMENT_VALUR}],mo=[{label:"基于纸张",value:Yt.PAPER},{label:"基于内容",value:Yt.CONTENT}],Wl=[{label:"纵向",value:cl.PORTRAIT},{label:"横向",value:cl.LANDSCAPE}],ho=[{label:"当前位置",value:un.DEFAULT,detail:"元素按当前位置进行定位，参与分页。如果之前的元素尺寸变化，会进行相应调整"},{label:"固定位置",value:un.FIXED,detail:"元素会在固定位置显示，不参与分页"}],go=[{label:"单次打印",value:dn.ONCE,detail:"元素只打印一次"},{label:"每页打印",value:dn.EACH,detail:"元素将每页打印一次"}],vo=[{label:"按内容调整高度",value:Xt.AUTO,detail:"元素内容溢出时，将会根据内容自动调整元素高度"},{label:"隐藏溢出内容",value:Xt.HIDDEN,detail:"元素内容溢出时，内容将会被隐藏"},{label:"缩放内容",value:Xt.SCALE,detail:"元素内容溢出时，会对内容进行缩放，确保内容全部显示",disabled:!0}],On=[{label:"页码",value:en.PAGE_NUMBER,type:ne.NUMBER},{label:"总页数",value:en.PAGE_TOTAL,type:ne.NUMBER},{label:"行序号",value:en.ROW_INDEX,type:ne.NUMBER},{label:"当前时间",value:en.CURRENT_DATE,type:ne.DATE}],bo=["[0.3.pageNumber]","'[0.3.pageNumber]/[0.3.pageTotal]'","'第[0.3.pageNumber]页/共[0.3.pageTotal]页'"];function Yl(n,e){return e=="body"?document.body:e=="parent"?n.parentElement:n.closest("."+e)}function yo(n,e){const t=n.getBoundingClientRect(),l=e.getBoundingClientRect();return!(t.top>l.bottom||t.right<l.left||t.bottom<l.top||t.left>l.right)}function Xl(n){return n.isSelected?n.type===X.PARAGRAPH?52:n.type===X.TABLE?32:20:20}function _o(){const n=Q(window.devicePixelRatio),e=()=>n.value=window.devicePixelRatio,t=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return t.addEventListener("change",e),window.addEventListener("resize",e),Kn(()=>{t.removeEventListener("change",e),window.removeEventListener("resize",e)}),n}class Eo{constructor(e,t,l){F(this,"originalEvent");F(this,"target");F(this,"ghost");F(this,"container");F(this,"paths",[]);F(this,"dropTarget");F(this,"top",0);F(this,"left",0);F(this,"deltaX");F(this,"deltaY");F(this,"moved",!1);this.originalEvent=e,this.ghost=t,this.target=t,this.container=l;const o=t.getBoundingClientRect();this.deltaX=o.left-e.clientX,this.deltaY=o.top-e.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.ghost.setPointerCapture(this.originalEvent.pointerId)}}var Dt,qt,rt,jl,Zl,Kl;const bt=class bt extends pn{constructor(t={}){var l,o,s;super();Be(this,rt);F(this,"context",null);F(this,"selector");F(this,"scale");F(this,"onDragStart");Be(this,Dt);Be(this,qt);this.selector={container:((l=t.selector)==null?void 0:l.container)??G.PAGE,element:((o=t.selector)==null?void 0:o.element)??G.DRAGGABLE,droppable:((s=t.selector)==null?void 0:s.droppable)??G.DROPPABLE},this.onDragStart=we(this,rt,jl).bind(this),this.scale=t.scale,ut(this,Dt,we(this,rt,Zl).bind(this)),ut(this,qt,we(this,rt,Kl).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){this.context!=null&&(window.removeEventListener("pointermove",ke(this,Dt)),window.removeEventListener("pointerup",ke(this,qt)),this.context=null)}};Dt=new WeakMap,qt=new WeakMap,rt=new WeakSet,jl=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.element);if(l==null)return Le.warn(bt.TAG_NAME,"未找到的可拖拽元素");const o=this.selector.container,s=Yl(l,o);this.context=new Eo(t,l,s);const c=this.createEvent("before-dragstart",this.context);if(this.dispatch(c).defaultPrevented)return Le.warn(bt.TAG_NAME,"已取消拖拽");if(this.context.container==null)return Le.warn(bt.TAG_NAME,"未找到的拖拽元素的容器");this.context.init(this.normalizeScale());const r=this.createEvent("dragstart",this.context);if(this.dispatch(r).defaultPrevented)return Le.warn(bt.TAG_NAME,"已取消拖拽");t.stopPropagation(),t.preventDefault(),window.addEventListener("pointermove",ke(this,Dt)),window.addEventListener("pointerup",ke(this,qt))},Zl=function(t){const l=this.context;if(l==null)return;const o=l.container.getBoundingClientRect(),s=document.elementsFromPoint(t.clientX,t.clientY),c=Array.from(s).filter(i=>!(i===l.ghost||i===l.target||l.ghost.contains(i))),r=this.normalizeScale();l.originalEvent=t,l.paths=c,l.dropTarget=c.find(i=>i.matches("."+G.DROPPABLE)),l.top=(t.clientY+l.deltaY-o.top)/r,l.left=(t.clientX+l.deltaX-o.left)/r,!this.dispatch(this.createEvent("dragging",l)).defaultPrevented&&(l.ghost.style.top=l.top+"px",l.ghost.style.left=l.left+"px")},Kl=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const o=this.createEvent("dragend",l);this.dispatch(o).defaultPrevented||this.reset()},F(bt,"TAG_NAME","quickprint-draggable");let Mn=bt;const To=["title"],ko=x({__name:"HelpTitle",props:{title:{type:String,required:!0}},setup(n){return(e,t)=>(w(),L("span",{title:n.title,class:h(e.classes.help)},[d("span",null,[Me(e.$slots,"default")]),f(D,{icon:"icon-question-circle"})],10,To))}}),wo="_help_1l6l8_2",So={help:wo},Co={classes:So},Ro=P(ko,[["__cssModules",Co]]),Lo=x({__name:"Popover",props:{width:{type:Number,default:null}},emits:["show","close"],setup(n,{expose:e,emit:t}){const l=n,o=t,s=Ie("classes"),c=Q(!1),r=ue(),i=ue(),u=De({minWidth:0,top:0,left:0,visible:!1}),p=N(()=>({minWidth:l.width==null?u.minWidth+"px":l.width+"px",top:u.top+"px",left:u.left+"px",visibility:u.visible?"visible":"hidden",zIndex:$l()}));async function m(){if(c.value)return g();c.value=!0,o("show"),await hn(),R()}function g(){A(),c.value=!1,o("close")}function E(k){if(!(k.target instanceof Node))return;const S=r.value;if(S&&S.contains(k.target))return k.preventDefault();const v=i.value;if(v&&v.contains(k.target))return k.preventDefault();g()}function b(){const k=r.value,S=i.value;if(S==null||k==null)return;const v=k.getBoundingClientRect(),T=S.getBoundingClientRect(),C=l.width==null?v.width:l.width;let I=v.bottom+1;I+T.height>window.innerHeight&&v.top>T.height&&(I=v.top-T.height-1);let O=v.left;O+T.width>window.innerWidth&&(O=window.innerWidth-T.width-2),u.minWidth=C,u.top=I,u.left=O,u.visible=!0}function a(k){const S=k.target;if(!(S instanceof HTMLElement))return;const v=r.value;v==null||!S.contains(v)||g()}function y(k){if(k.key!=="Escape")return;const S=i.value;if(S!=null){const v=S.style.zIndex;if(Number(v)<As())return}k.preventDefault(),g()}function R(){window.addEventListener("click",E,{capture:!0}),window.addEventListener("contextmenu",g,{capture:!0}),window.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",b),window.addEventListener("keydown",y)}function A(){window.removeEventListener("click",E,!0),window.removeEventListener("contextmenu",g,!0),window.removeEventListener("scroll",a,!0),window.removeEventListener("resize",b),window.removeEventListener("keydown",y)}return e({close:g}),(k,S)=>(w(),L("div",{class:h(_(s).reference),onClick:ie(m,["stop"]),ref_key:"referenceRef",ref:r,tabindex:"0"},[Me(k.$slots,"default"),c.value?(w(),K(Ol,{key:0,to:"body"},[d("div",{class:h(_(s).popover),onVnodeMounted:b,onMousedown:S[0]||(S[0]=ie(()=>{},["prevent"])),style:Z(p.value),ref_key:"popoverRef",ref:i},[Me(k.$slots,"popover")],38)])):U("",!0)],2))}}),No="_reference_1arli_2",Io="_popover_1arli_7",$o={reference:No,popover:Io},xo={classes:$o},Jl=P(Lo,[["__cssModules",xo]]),Ao=["title","onKeydown"],Do=["onMouseover","onClick"],qo=x({__name:"Select",props:wt({modelValue:{type:[String,Number,Array]},options:{type:Array,default(){return[]}},size:{type:String,default:"default"},button:{type:Boolean,default:!1},width:{type:String,default:"100%"},popoverWidth:{type:Number,default:null},placeholder:{type:String,default:"请选择"},title:{type:String,default:null},border:{type:String,default:"auto"},appearance:{type:String,default:"auto"},clearable:{type:Boolean,default:!1},teleport:{type:String,default:"body"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:wt(["select","update:modelValue"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=n,o=Ie("classes"),s=ue(),c=ue(),r=Kt(n,"modelValue"),i=Q(),u=Q(!1),p=De({width:0,top:0,left:0,visible:!1,scrollable:!1}),m=N(()=>l.teleport==="none"),g=N(()=>l.teleport=="none"?"body":l.teleport),E=N(()=>{const $={label:"",options:[]},V=[$];for(const B of l.options){if(Array.isArray(B.options)){V.push({label:B.label,options:B.options});continue}$.options.push(B)}return V}),b=N(()=>E.value.reduce(($,V)=>$.concat(V.options),[])),a=N(()=>{if(l.multiple!==!0){const V=Cn();return V?V.label:l.button?l.title:ae(l.modelValue)?l.placeholder:l.modelValue}const $=Rn();return $.length>0?$.map(V=>V.label).join(","):l.button?l.title:l.placeholder}),y=N(()=>l.clearable!==!0?!1:l.modelValue!=null),R=N(()=>({"quickprint-form-control":!0,"quickprint-form-control-small":l.size==="small"||l.button,"quickprint-form-hidden-border":l.button||l.border==="none","quickprint-form-disabled":l.disabled,[o.mini]:l.size==="mini",[o.select]:!0,[o.appearance]:l.appearance!=="none"&&!y.value,[o.button]:l.button,[o.showClearIcon]:y.value,[o.text]:l.size==="text"})),A=N(()=>({width:l.width})),k=N(()=>p.visible?{width:l.popoverWidth==null?p.width+"px":l.popoverWidth+"px",top:p.top+"px",left:p.left+"px",visibility:"visible",zIndex:$l()}:{minWidth:l.popoverWidth==null?p.width+"px":l.popoverWidth+"px",visibility:"hidden"}),S=N(()=>({[o.content]:!0,[o.placeholder]:Ds(l.modelValue)}));async function v(){if(l.disabled)return;const $=b.value;if($.length===0)return;if(u.value)return T();const V=s.value;V!=null&&(p.width=V.getBoundingClientRect().width,p.visible=!1,i.value=$.find(B=>B.value===l.modelValue),u.value=!0,await hn(),Ns())}function T(){Is(),u.value=!1}function C($){H(),ct()}function I($){$.disabled!==!0&&(i.value=$)}function O($){if(l.disabled==!0||$.disabled===!0)return;if(l.multiple!==!0){r.value=$.value,t("select",$),T();return}const V=Array.isArray(r.value)?r.value:[],B=V.findIndex(de=>de===$.value);B>=0?V.splice(B,1):V.push($.value),r.value=V,t("select",V)}function Y($){if(!($.target instanceof Node))return;const V=s.value;if(V&&V.contains($.target))return $.preventDefault();const B=c.value;if(B&&B.contains($.target))return $.preventDefault();T()}async function H(){const $=s.value,V=c.value;if(V==null||$==null)return;await Pt();const B=$.getBoundingClientRect(),de=V.getBoundingClientRect();let fe=B.bottom+1;fe+de.height>window.innerHeight&&B.top>de.height&&(fe=B.top-de.height-1);let St=B.left;St+de.width>window.innerWidth&&(St=window.innerWidth-de.width-2),p.width=de.width,p.top=fe,p.left=St,p.visible=!0;const Bt=V.querySelector("."+o.list);p.scrollable=Bt?Bt.scrollHeight>Bt.clientHeight:!1}function q($){const V=$.target;if(!(V instanceof HTMLElement))return;const B=s.value;B==null||!V.contains(B)||T()}function j(){const $=b.value,V=fl(i.value);if(V==null){i.value=zt(0),ct();return}const B=$.indexOf(V);if(B==0)return pe();const de=zt(B-1);de!=null&&(i.value=de,ct())}function ee(){const $=b.value,V=fl(i.value);if(V==null){i.value=ze(0),ct();return}const B=$.indexOf(V);if(B>=$.length-1){M();return}const de=zt(B+1);de!=null&&(i.value=de,ct())}function M(){i.value=ze(0),ct()}function pe(){const $=b.value;i.value=zt($.length-1),ct()}function ce(){r.value=void 0,T()}function ze($){const B=b.value[$];return B==null?null:B.disabled===!0?ze($+1):B}function zt($){const B=b.value[$];return B==null?null:B.disabled===!0?zt($-1):B}function rl($){switch($.key){case"Enter":$.preventDefault(),i.value&&O(i.value);return;case"Escape":$.preventDefault(),T();return;case"ArrowUp":$.preventDefault(),j();return;case"ArrowDown":$.preventDefault(),ee();return;case"Home":$.preventDefault(),M();return;case"End":$.preventDefault(),pe();return}}function Rs($){if(l.disabled)return;const V=s.value;V!=null&&document.activeElement===V&&(u.value||($.stopPropagation(),v()))}function Ls($){if(l.multiple!==!0)return l.modelValue===$.value;const V=l.modelValue;return Array.isArray(V)?V.includes($.value):!1}async function ct(){if(i.value==null)return;await Pt();const $=c.value;if($==null)return;const V=$.querySelector("."+o.hover);V&&V.scrollIntoView({block:"nearest"})}function Cn(){const $=b.value,V=Array.isArray(l.modelValue)?l.modelValue[0]:l.modelValue;return $.find(B=>B.value===V)}function Rn(){const $=b.value;return(Array.isArray(l.modelValue)?l.modelValue:[l.modelValue]).filter(B=>B).map(B=>{const de=$.find(fe=>fe.value===B);return de||{value:B,label:B}})}function Ns(){window.addEventListener("mousedown",Y,{capture:!0}),window.addEventListener("pointerdown",Y,{capture:!0}),window.addEventListener("contextmenu",T,{capture:!0}),window.addEventListener("scroll",q,{capture:!0,passive:!0}),window.addEventListener("resize",H),window.addEventListener("keydown",rl)}function Is(){window.removeEventListener("mousedown",Y,!0),window.removeEventListener("pointerdown",Y,!0),window.removeEventListener("contextmenu",T,!0),window.removeEventListener("scroll",q,!0),window.removeEventListener("resize",H),window.removeEventListener("keydown",rl)}return($,V)=>{var B;return w(),L("div",{class:h(R.value),title:n.title,style:Z(A.value),onClick:ie(v,["stop"]),onKeydown:Ml(ie(Rs,["prevent"]),["enter"]),ref_key:"selectRef",ref:s,tabindex:"0"},[$.$slots.selected?Me($.$slots,"selected",{key:0,option:Cn(),options:Rn()}):Me($.$slots,"option",{key:1,option:Cn(),options:Rn()},()=>[d("div",{class:h(S.value)},[d("span",null,z(a.value),1),y.value?(w(),K(D,{key:0,icon:"icon-close",onClick:ie(ce,["stop"]),size:"12px",class:h(_(o).clearIcon)},null,8,["class"])):U("",!0)],2)]),u.value?(w(),K(Ol,{key:2,to:g.value,disabled:m.value},[d("div",{class:h(_(o).popover),onClick:V[0]||(V[0]=ie(()=>{},["stop"])),onVnodeMounted:C,onMousedown:V[1]||(V[1]=ie(()=>{},["prevent"])),style:Z(k.value),ref_key:"popoverRef",ref:c},[d("div",{class:h(_(o).list)},[(w(!0),L(W,null,te(E.value,de=>(w(),L(W,null,[de.label?(w(),L("div",{key:0,class:h(_(o).groupLabel)},z(de.label),3)):U("",!0),(w(!0),L(W,null,te(de.options,fe=>{var St;return w(),L("div",{key:fe.value,class:h({[_(o).option]:!0,[_(o).disabled]:fe.disabled===!0,[_(o).selected]:Ls(fe),[_(o).hover]:((St=i.value)==null?void 0:St.value)==fe.value}),style:Z(fe.style),onMouseover:Bt=>I(fe),onClick:Bt=>O(fe)},[Me($.$slots,"option",{option:fe},()=>[d("div",{class:h(_(o).label)},[fe.icon?(w(),K(D,{key:0,icon:fe.icon,class:h(_(o).icon)},null,8,["icon","class"])):U("",!0),d("span",null,z(fe.label),1)],2),fe.short?(w(),L("div",{key:0,class:h(_(o).short)},z(fe.short),3)):U("",!0)])],46,Do)}),128))],64))),256))],2),(B=i.value)!=null&&B.detail&&p.visible?(w(),L("div",{key:0,class:h(_(o).detail)},z(i.value.detail),3)):U("",!0)],38)],8,["to","disabled"])):U("",!0)],46,Ao)}}}),Oo="_button_1h82x_2",Mo="_select_1h82x_7",Po="_appearance_1h82x_16",Vo="_content_1h82x_31",Fo="_placeholder_1h82x_37",zo="_popover_1h82x_41",Bo="_list_1h82x_51",Uo="_option_1h82x_80",Ho="_label_1h82x_95",Go="_icon_1h82x_100",Wo="_hover_1h82x_104",Yo="_detail_1h82x_115",Xo="_short_1h82x_125",jo="_selected_1h82x_131",Zo="_disabled_1h82x_135",Ko="_showClearIcon_1h82x_140",Jo="_clearIcon_1h82x_144",Qo="_text_1h82x_157",ei="_mini_1h82x_169",ti="_groupLabel_1h82x_181",ni={button:Oo,select:Mo,appearance:Po,content:Vo,placeholder:Fo,popover:zo,list:Bo,option:Uo,label:Ho,icon:Go,hover:Wo,detail:Yo,short:Xo,selected:jo,disabled:Zo,showClearIcon:Ko,clearIcon:Jo,text:Qo,mini:ei,groupLabel:ti},li={classes:ni},J=P(qo,[["__cssModules",li]]),si="_tree_1p28f_1",oi="_node_1p28f_5",ii="_content_1p28f_11",ri="_space_1p28f_27",ai="_expand_1p28f_28",ci="_active_1p28f_47",ui="_children_1p28f_55",je={tree:si,node:oi,content:ii,space:ri,expand:ai,active:ci,children:ui},Ql=Symbol(),es=x({emits:["nodeClick","nodeHover"],props:{node:{type:Object,required:!0}},setup(n,{emit:e}){const t=Pl(Ql),l=N(()=>Array.isArray(n.node.children)&&n.node.children.length>0),o=N({get(){const a=t==null?void 0:t.state[n.node.value];return a==null?!1:a.expand},set(a){const y=t==null?void 0:t.state[n.node.value];y!=null&&(y.expand=a)}});function s(a){a.preventDefault(),o.value=!o.value}function c(){if(!l.value)return f("div",{class:je.space},null);const a={[je.expand]:!0,[je.active]:o.value};return f("div",{onMousedown:b,onClick:s,class:a},[f(D,{icon:"icon-right",size:"12px"},null)])}function r(){return typeof(t==null?void 0:t.content)=="function"?t.content({node:n.node}):f("span",null,[n.node.label])}function i(){return f("div",{class:je.content,onClick:p,onMouseenter:g},[r()])}function u(){if(!l.value||!o.value)return;const a=n.node.children.map(y=>f(es,{node:y,onNodeClick:m,onNodeHover:E},null));return f("div",{class:je.children},[a])}function p(){e("nodeClick",n.node)}function m(a){e("nodeClick",a)}function g(){e("nodeHover",n.node)}function E(a){e("nodeHover",a)}function b(a){a.preventDefault()}return function(){return f("div",{class:je.subTree},[f("div",{class:je.node},[c(),i()]),u()])}}}),di=x({props:{data:{type:Array,required:!0}},emits:["nodeClick","nodeHover"],setup(n,{slots:e,emit:t}){const l=c();function o(i){t("nodeClick",i)}function s(i){t("nodeHover",i)}function c(){const i=De({}),u=function(p,m){for(const g of p)m[g.value]={expand:g.expand!==!1},g.children&&u(g.children,m)};return u(n.data,i),i}function r(i){return typeof e.default=="function"?e.default(i):null}return Vl(Ql,{state:l,content:r}),function(){const i=n.data.map(u=>f(es,{node:u,onNodeClick:o,onNodeHover:s},null));return f("div",{class:je.tree},[i])}}});function pi(n,e=0){let t=null;return function(...l){t&&clearTimeout(t),t=window.setTimeout(()=>{n.apply(this,l),t=null},e)}}function fi(n,e=0){let t=0,l=null;return function(...o){const s=Date.now();if(s-t<e){l&&clearTimeout(l),l=window.setTimeout(()=>{l=null,n.apply(this,o),t=Date.now()},e);return}l&&clearTimeout(l),n.apply(this,o),t=s}}function tl(n,e){const t=[];if(e&&e!=oe.DEFAULT&&t.push(`"${e}"`),n&&n!==oe.DEFAULT&&t.push(`"${n}"`),t.length!=0)return t.join(",")}function ts(n){if(n.underline===!0)return{textDecorationLine:"underline",textDecorationStyle:n.underlineStyle,textDecorationColor:n.underlineColor}}function mi(n,e={}){const t={},l=n.style??{},o=tl(l.fontFamily,l.enFontFamily);o&&(t.fontFamily=o);const s=ts(l);return s&&Ke(t,s),l.fontSize&&(t.fontSize=l.fontSize),l.fontWeight&&(t.fontWeight=l.fontWeight),l.color&&(t.color=l.color),hi("border",e)&&l.border&&Ke(t,Pn(n)),l.lineHeight&&(t.lineHeight=l.lineHeight),l.highlightColor&&(t["--quickprint-variable-highlight-color"]=l.highlightColor),l.backgroundColor&&(t.backgroundColor=l.backgroundColor),l.fontStyle&&(t.fontStyle=l.fontStyle),l.textIndent&&(t.textIndent=l.textIndent),l.padding&&Ke(t,vi(n)),Ke(t,gi(n)),Ke(t,ns(l.verticalAlign)),t}function hi(n,e){return e.exclude==null?!0:!e.exclude.includes(n)}function gi(n){if(n==null)return{};const e=n.style??{},t={};return e.textAlign&&(t.textAlign=e.textAlign),e.textAlignLast&&(t.textAlignLast=e.textAlignLast),t}function ns(n){return n==null||n==Ye.MIDDLE?{display:"flex",alignItems:"center"}:n==Ye.BOTTOM?{display:"flex",alignItems:"end"}:{}}function vi(n){if(n==null)return{};const e=n.style??{};if(e.padding==null)return{};const t={};return e.padding.top&&(t.paddingTop=e.padding.top),e.padding.right&&(t.paddingRight=e.padding.right),e.padding.bottom&&(t.paddingBottom=e.padding.bottom),e.padding.left&&(t.paddingLeft=e.padding.left),t}function Pn(n){if(n==null)return{};const e=n.style??{};if(e.border==null||e.border===le.NONE)return{};const t={},l=e.borderWidth??1,o=e.borderStyle??qs.SOLID,s=e.borderColor??Hn.BLACK;return e.border==le.ALL?{borderTop:`${l}px ${o} ${s}`,borderRight:`${l}px ${o} ${s}`,borderBottom:`${l}px ${o} ${s}`,borderLeft:`${l}px ${o} ${s}`}:(e.border&le.TOP&&(t.borderTop=`${l}px ${o} ${s}`),e.border&le.RIGHT&&(t.borderRight=`${l}px ${o} ${s}`),e.border&le.BOTTOM&&(t.borderBottom=`${l}px ${o} ${s}`),e.border&le.LEFT&&(t.borderLeft=`${l}px ${o} ${s}`),t)}const vt={SPACE:" ",has(n,e){return typeof n!="string"?!1:n.split(vt.SPACE).includes(e)},push(n,e){if(typeof n!="string")return e;const t=n.split(vt.SPACE).filter(o=>Gn(o));return t.indexOf(e)>=0?n:(t.push(e),t.join(vt.SPACE))},remove(n,e){if(typeof n!="string"||n=="")return n;const t=n.split(vt.SPACE),l=t.indexOf(e);return l<0?n:(t.splice(l,1),t.join(vt.SPACE))}};function We(n){if(ae(n))return{num:null,unit:null};const e=n.match(/^(-?\d+(?:\.\d+)?)(px|pt|mm|em)?$/);if(e==null)return{num:null,unit:null};const t=Number(e[1]),l=Wn(t)?t:null,o=ae(e[2])?null:e[2];return{num:l,unit:o}}function ml(n){if(n==null)return null;if(typeof n=="number")return n;if(typeof n!="string")return null;const e=We(n);if(e.num==null)return null;switch(e.unit){case"px":return e.num;case"pt":return Dn.pt_to_px(e.num);case"mm":return Dn.mm_to_px(e.num);default:return null}}function nl(n,e){const t=n.ds;if(t!=null)return t.type===ye.FORMULA?{type:t.type,content:ll(t.value,n.doc)}:t.type===ye.VARIABLE?{type:t.type,content:it(t.value,e)}:{type:t.type,content:t.value}}function it(n,e){var g,E,b;if(ae(n))return n;const t=Yn(n),l=t.path;if(l==null||l=="")return;const o=l.split(".");if(o.length==0)return l;const s=o[0];if(t.varType===Je.BUILTIN)return((g=On.find(a=>a.value===s))==null?void 0:g.label)??s;if(t.varType===Je.SPECIAL)return((E=fo.find(a=>a.value===s))==null?void 0:E.label)??s;if(e==null)return l;const r=(e.fields??[]).find(a=>a.name===s);if(r==null)return l;const i=o[1],u=ae(r.title)?r.name:r.title;if(i==null)return u;const p=(b=r.children)==null?void 0:b.find(a=>a.name===i);if(p==null)return`${u}.${i}`;const m=ae(p.title)?p.name:p.title;return`${u}.${m}`}function ll(n,e){return ae(n)?void 0:fn.tokenize(n).map(o=>o.type===Qe.VARIABLE?`[${it(o.value,e==null?void 0:e.ds)}]`:o.type===Qe.REFERENCE?`[${ls(o.value,e)}]`:o.type===Qe.TEMPLATE?(Array.isArray(o.value)?o.value:[o.value]).map(c=>c.type===Qe.VARIABLE?`[${it(c.value,e==null?void 0:e.ds)}]`:c.value).join(""):fn.formatTokenValue(o)).join("")}function ls(n,e){if(e){const t=e.findElement(n);if(t&&t.title)return"="+t.title}return"="+n}function bi(n){switch(Yn(n).dataType){case ne.OBJECT:return"对象";case ne.ARRAY:return"数组";case ne.STRING:return"文本";case ne.NUMBER:return"数字";case ne.DATE:return"日期";case ne.BOOLEAN:return"布尔";default:return"未知类型"}}function yi(n){var e;return((e=Hl.find(t=>t.value===n))==null?void 0:e.label)??n}const _i=["onClick"],Ei=x({__name:"WindowHeader",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=Pe(),l=e;function o(s){l("update:modelValue",s.value)}return(s,c)=>(w(),L("div",{class:h(s.classes.header)},[d("div",{class:h(s.classes.headerLeft)},[Me(s.$slots,"prefix"),d("div",{class:h(s.classes.tabs)},[(w(!0),L(W,null,te(n.tabs,r=>(w(),L("div",{key:r.value,class:h({[s.classes.tab]:!0,[s.classes.active]:n.modelValue===r.value}),onClick:i=>o(r),onPointerdown:c[0]||(c[0]=ie(()=>{},["stop","prevent"]))},[d("span",null,z(r.label),1)],42,_i))),128))],2)],2),_(t)?(w(),K(_(Xn),{key:0,instance:_(t)},null,8,["instance"])):U("",!0)],2))}}),Ti="_header_1o09p_2",ki="_headerLeft_1o09p_14",wi="_tabs_1o09p_27",Si="_tab_1o09p_27",Ci="_active_1o09p_69",Ri={header:Ti,headerLeft:ki,tabs:wi,tab:Si,active:Ci},Li={classes:Ri},ss=P(Ei,[["__cssModules",Li]]),Qt=xl(()=>Al(()=>import("./component-B2NTzUlK.js"),__vite__mapDeps([0,1,2]))),Ni=["onClick","onMouseenter"],Ii=x({__name:"Builtin",emits:["select"],setup(n,{emit:e}){const t=e,l=Q(On[0].value),o=N(()=>`builtin_${Dl(l.value,"_").toLowerCase()}`);function s(r){t("select",r)}function c(r){l.value=r.value}return(r,i)=>(w(),L("div",{class:h(r.classes.builtin)},[d("div",{class:h(["quickprint-is-scrollable",r.classes.panel])},[(w(!0),L(W,null,te(_(On),u=>(w(),L("div",{class:h({[r.classes.param]:!0,[r.classes.active]:u.value===l.value}),onClick:p=>s(u),onMouseenter:p=>c(u)},[d("strong",null,z(u.label),1),d("span",null,z(u.value),1)],42,Ni))),256))],2),d("div",{class:h(["quickprint-is-scrollable",r.classes.desc])},[f(_(Qt),{name:o.value},null,8,["name"])],2)],2))}}),$i="_builtin_m1n0z_2",xi="_panel_m1n0z_11",Ai="_desc_m1n0z_17",Di="_param_m1n0z_24",qi="_active_m1n0z_34",Oi={builtin:$i,panel:xi,desc:Ai,param:Di,active:qi},Mi={classes:Oi},Pi=P(Ii,[["__cssModules",Mi]]),hl=[{label:"文本",value:ne.STRING},{label:"数字",value:ne.NUMBER},{label:"日期",value:ne.DATE},{label:"对象",value:ne.OBJECT},{label:"数组",value:ne.ARRAY}],Vi=x({emit:["select"],props:{doc:{type:ge,required:!0},readonly:{type:Boolean,default:!1}},setup(n,{expose:e,emit:t}){const l=Ie("classes"),o=Pe(),s=i(),c=r();function r(){const y=[{name:"$index"},{name:"$expand"},{name:"type",title:"类型",width:110,render(R,A,k){var S;if(n.readonly){const v=R[A.name],T=((S=hl.find(C=>C.value===v))==null?void 0:S.label)??v;return f("div",{class:k.classes.cell},[T])}return f("div",{class:k.classes.cell},[f(J,{options:hl,modelValue:R.type,"onUpdate:modelValue":E.bind(null,R),size:"small"},null)])}},{name:"name",title:"名称",width:180,render(R,A,k){return n.readonly?f("div",{class:k.classes.cell},[R[A.name]]):f("div",{class:k.classes.cell},[_e(f("input",{"onUpdate:modelValue":S=>R.name=S,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[必填] 请输入"},null),[[Ne,R.name]])])}},{name:"title",title:"标题",width:180,render(R,A,k){return n.readonly?f("div",{class:k.classes.cell},[R[A.name]]):f("div",{class:k.classes.cell},[_e(f("input",{"onUpdate:modelValue":S=>R.title=S,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[可选] 请输入"},null),[[Ne,R.title]])])}}];return n.readonly!==!0&&y.push({name:"operate",title:"操作",width:200,render(R,A,k){const S=[f("button",{type:"button",class:"quickprint-text-btn",onClick:p.bind(null,R,k.parent)},[f(D,{icon:"icon-subnode"},null),f("span",null,[se("插入行")])])];return(R.type===ne.ARRAY||R.type===ne.OBJECT)&&S.push(f("button",{type:"button",class:"quickprint-text-btn",onClick:g.bind(null,R)},[f(D,{icon:"icon-sisternode"},null),f("span",null,[se("插入子级")])])),S.push(f("button",{type:"button",class:"quickprint-text-btn",onClick:m.bind(null,R,k.parent)},[f(D,{icon:"icon-delete"},null),f("span",null,[se("删除")])])),S}}),y}function i(){const y=ql(n.doc.ds.fields??[]).map(A=>{const k=A.type;return{...A,$expand:k===ne.ARRAY||k===ne.OBJECT}}),R=Q(y);return R.value.length==0&&R.value.push(u()),R}function u(){return{type:ne.STRING,name:"",title:""}}function p(y,R){if(R){const k=R.children??[],S=k.indexOf(y);S>=0&&k.splice(S+1,0,u());return}const A=s.value.indexOf(y);A>=0&&s.value.splice(A+1,0,u())}function m(y,R){if(R){const k=R.children??[],S=k.indexOf(y);S>=0&&k.splice(S,1);return}const A=s.value.indexOf(y);A>=0&&s.value.splice(A,1),s.value.length==0&&s.value.push(u())}function g(y){y.type!==ne.ARRAY&&y.type!==ne.OBJECT||(y.children==null&&(y.children=[]),y.children.push(u()))}function E(y,R){y.type=R,R===ne.ARRAY||R===ne.OBJECT?y.$expand=!0:y.children=void 0}function b(){return{fields:s.value.map(R=>ae(R.name)?null:R.type!==ne.ARRAY&&R.type!==ne.OBJECT?{type:R.type,name:R.name,title:R.title}:{type:R.type,name:R.name,title:R.title,children:(R.children??[]).map(A=>ae(R.name)?null:{type:A.type,name:A.name,title:A.title}).filter(A=>A!=null)}).filter(R=>R!=null)}}function a(y,R){n.readonly===!0&&t("select",y,R)}return o==null||o.useHandle("confirm",b),e({submit:b}),function(){return f("div",{class:l.datasource},[f(Os,{columns:c,data:s.value,onSelect:a},null)])}}}),Fi="_datasource_xlc8o_2",zi={datasource:Fi},Bi={classes:zi},os=P(Vi,[["__cssModules",Bi]]),Ui={class:"quickprint-config-group"},Hi={class:"quickprint-config-section quickprint-config-inline"},Gi={class:"quickprint-config-content"},Wi={class:"quickprint-config-section quickprint-config-inline"},Yi={class:"quickprint-config-content"},Xi={class:"quickprint-config-id"},ji={class:"quickprint-config-section quickprint-config-inline"},Zi={class:"quickprint-config-content"},Ki={class:"quickprint-config-group"},Ji={class:"quickprint-config-group-title"},Qi=x({__name:"Detail",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=N(()=>{var l,o;return(o=nl(e.element,(l=e.element.doc)==null?void 0:l.ds))==null?void 0:o.content});return(l,o)=>(w(),L("div",{class:h(l.classes.detail)},[d("div",Ui,[d("section",Hi,[o[0]||(o[0]=d("header",{class:"quickprint-config-header"},"类型",-1)),d("div",Gi,z(_(jt)(n.element.type)),1)]),d("section",Wi,[o[1]||(o[1]=d("header",{class:"quickprint-config-header"},"标识",-1)),d("div",Yi,[d("span",Xi,z(n.element.id),1)])]),d("section",ji,[o[2]||(o[2]=d("header",{class:"quickprint-config-header"},"标题",-1)),d("div",Zi,z(n.element.title),1)])]),d("div",Ki,[d("div",Ji,[o[3]||(o[3]=d("span",null,"数据",-1)),d("span",{class:h(l.classes.type)},z(_(yi)(n.element.ds.type)),3)]),d("div",null,z(t.value),1)])],2))}}),er="_detail_11ox4_2",tr="_type_11ox4_10",nr={detail:er,type:tr},lr={classes:nr},sr=P(Qi,[["__cssModules",lr]]),or=x({__name:"index",props:{doc:{type:ge,required:!0}},emits:["select"],setup(n,{emit:e}){const t=e,l=n,o=r(),s=Q();function c(g){return g.reduce((E,b)=>{const a=Array.isArray(b.children)?c(b.children):[];if(Gn(b.ds.value)||a.length>0){const y={value:b.id,label:b.title??b.id,data:b,children:a};return E.push(y),E}return E},[])}function r(){const g=l.doc.pages.reduce((b,a)=>b.concat(a.children),[]),E=c(g);return Q(E)}function i(g){s.value=g}function u(g){return g.title?g.title:jt(g.type)}function p(g){return cd(g.type)??"icon-zhanweifu"}function m(g){t("select",g.data)}return(g,E)=>(w(),L("div",{class:h(g.classes.reference)},[d("div",{class:h([g.classes.panel,"quickprint-is-scrollable"])},[f(_(di),{data:_(o),onNodeHover:i,onNodeClick:m},{default:he(({node:b})=>[f(_(D),{icon:p(b.data)},null,8,["icon"]),d("span",{class:h(g.classes.title)},z(u(b.data)),3),d("span",{class:h(g.classes.id)},"<"+z(b.value)+">",3)]),_:1},8,["data"])],2),d("div",{class:h([g.classes.detail,"quickprint-is-scrollable"])},[s.value?(w(),K(sr,{element:s.value.data,key:s.value.value},null,8,["element"])):U("",!0)],2)],2))}}),ir="_reference_1ekkx_2",rr="_panel_1ekkx_12",ar="_detail_1ekkx_20",cr="_title_1ekkx_25",ur="_id_1ekkx_29",dr={reference:ir,panel:rr,detail:ar,title:cr,id:ur},pr={classes:dr},fr=P(or,[["__cssModules",pr]]),mr=x({__name:"index",props:{doc:{type:ge,required:!0},value:{type:String,default:null},include:{type:Array,default(){return["ds","builtin"]}}},setup(n){const e=n,t=[{label:"数据源",value:"ds"},{label:"内置变量",value:"builtin"},{label:"引用组件",value:"reference"}],l=Pe(),o=Q(p()),s=N(()=>t.filter(m=>e.include.includes(m.value)));function c(m,g){return m==null?null:g==null?`${Je.DS}.${m.type}.${m.name}`:`${Je.DS}.${m.type}.${g.name}.${m.name}`}function r(m,g){l==null||l.confirm({type:"ds",value:c(m,g),parent:g})}function i(m){l==null||l.confirm({type:"builtin",value:`${Je.BUILTIN}.${m.type}.${m.value}`})}function u(m){l==null||l.confirm({type:"reference",value:m.id})}function p(){const m=e.value;return m==null||m==""?"ds":Yn(m).varType===Je.BUILTIN?"builtin":"ds"}return(m,g)=>(w(),L("div",{class:h(m.classes.var)},[f(ss,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=E=>o.value=E),tabs:s.value},{prefix:he(()=>[f(_(D),{icon:"icon-var",size:"16px"}),d("span",{class:h(m.classes.title)},"变量",2)]),_:1},8,["modelValue","tabs"]),o.value==="ds"?(w(),K(os,{key:0,doc:n.doc,onSelect:r,readonly:""},null,8,["doc"])):U("",!0),o.value==="builtin"?(w(),K(Pi,{key:1,onSelect:i})):U("",!0),o.value==="reference"?(w(),K(fr,{key:2,doc:n.doc,onSelect:u},null,8,["doc"])):U("",!0)],2))}}),hr="_title_xcig2_10",gr={var:"_var_xcig2_2",title:hr},vr={classes:gr},is=P(mr,[["__cssModules",vr]]),br=["onClick","onMouseenter"],yr=x({__name:"String",emits:["select"],setup(n,{emit:e}){const t=[{label:"STRING",value:"STRING"},{label:"LENGTH",value:"LENGTH"},{label:"LOWER",value:"LOWER"},{label:"UPPER",value:"UPPER"},{label:"UPPER_FIRST",value:"UPPER_FIRST"},{label:"TRIM",value:"TRIM"},{label:"REPLACE",value:"REPLACE"},{label:"REPLACE_ALL",value:"REPLACE_ALL"},{label:"SLICE",value:"SLICE"},{label:"INCLUDES",value:"INCLUDES"},{label:"INDEX_OF",value:"INDEX_OF"},{label:"LAST_INDEX_OF",value:"LAST_INDEX_OF"},{label:"STARTS_WITH",value:"STARTS_WITH"},{label:"ENDS_WITH",value:"ENDS_WITH"}],l=e,o=Q(t[0].value),s=N(()=>`function_${o.value.toLowerCase()}`);function c(i){l("select",i.value)}function r(i){o.value=i.value}return(i,u)=>(w(),L("div",{class:h(i.classes.string)},[d("div",{class:h(["quickprint-is-scrollable",i.classes.panel])},[(w(),L(W,null,te(t,p=>d("div",{key:p.value,class:h({[i.classes.option]:!0,[i.classes.active]:p.value===o.value}),onClick:m=>c(p),onMouseenter:m=>r(p)},[d("strong",null,z(p.label),1)],42,br)),64))],2),d("div",{class:h(["quickprint-is-scrollable",i.classes.desc])},[f(_(Qt),{name:s.value},null,8,["name"])],2)],2))}}),_r="_string_shs83_2",Er="_panel_shs83_10",Tr="_desc_shs83_16",kr="_option_shs83_23",wr="_active_shs83_33",Sr={string:_r,panel:Er,desc:Tr,option:kr,active:wr},Cr={classes:Sr},Rr=P(yr,[["__cssModules",Cr]]),Lr=["onClick","onMouseenter"],Nr=x({__name:"Number",emits:["select"],setup(n,{emit:e}){const t=[{label:"NUMBER",value:"NUMBER"},{label:"ABS",value:"ABS"},{label:"TRUNC",value:"TRUNC"},{label:"MIN",value:"MIN"},{label:"MAX",value:"MAX"},{label:"CEIL",value:"CEIL"},{label:"FLOOR",value:"FLOOR"},{label:"ROUND",value:"ROUND"}],l=e,o=Q(t[0].value),s=N(()=>`function_${o.value.toLowerCase()}`);function c(i){l("select",i.value)}function r(i){o.value=i.value}return(i,u)=>(w(),L("div",{class:h(i.classes.string)},[d("div",{class:h(["quickprint-is-scrollable",i.classes.panel])},[(w(),L(W,null,te(t,p=>d("div",{key:p.value,class:h({[i.classes.option]:!0,[i.classes.active]:p.value===o.value}),onClick:m=>c(p),onMouseenter:m=>r(p)},[d("strong",null,z(p.label),1)],42,Lr)),64))],2),d("div",{class:h(["quickprint-is-scrollable",i.classes.desc])},[f(_(Qt),{name:s.value},null,8,["name"])],2)],2))}}),Ir="_string_shs83_2",$r="_panel_shs83_10",xr="_desc_shs83_16",Ar="_option_shs83_23",Dr="_active_shs83_33",qr={string:Ir,panel:$r,desc:xr,option:Ar,active:Dr},Or={classes:qr},Mr=P(Nr,[["__cssModules",Or]]),Pr=["onClick","onMouseenter"],Vr=x({__name:"Logical",emits:["select"],setup(n,{emit:e}){const t=[{label:"IF",value:"IF"},{label:"IFNA",value:"IFNA"},{label:"IFERROR",value:"IFERROR"},{label:"SWITCH",value:"SWITCH"},{label:"IS_NAN",value:"IS_NAN"},{label:"IS_NUMBER",value:"IS_NUMBER"},{label:"IS_INTEGER",value:"IS_INTEGER"},{label:"IS_STRING",value:"IS_STRING"},{label:"IS_BOOLEAN",value:"IS_BOOLEAN"},{label:"IS_NULL",value:"IS_NULL"},{label:"IS_UNDEFINED",value:"IS_UNDEFINED"},{label:"IS_NULLISH",value:"IS_NULLISH"},{label:"IS_EMPTY",value:"IS_EMPTY"}],l=e,o=Q(t[0].value),s=N(()=>`function_${o.value.toLowerCase()}`);function c(i){l("select",i.value)}function r(i){o.value=i.value}return(i,u)=>(w(),L("div",{class:h(i.classes.string)},[d("div",{class:h(["quickprint-is-scrollable",i.classes.panel])},[(w(),L(W,null,te(t,p=>d("div",{key:p.value,class:h({[i.classes.option]:!0,[i.classes.active]:p.value===o.value}),onClick:m=>c(p),onMouseenter:m=>r(p)},[d("strong",null,z(p.label),1)],42,Pr)),64))],2),d("div",{class:h(["quickprint-is-scrollable",i.classes.desc])},[f(_(Qt),{name:s.value},null,8,["name"])],2)],2))}}),Fr="_string_shs83_2",zr="_panel_shs83_10",Br="_desc_shs83_16",Ur="_option_shs83_23",Hr="_active_shs83_33",Gr={string:Fr,panel:zr,desc:Br,option:Ur,active:Hr},Wr={classes:Gr},Yr=P(Vr,[["__cssModules",Wr]]),Xr=["onClick","onMouseenter"],jr=x({__name:"Document",props:{options:{type:Array,required:!0},type:{type:String,default:"function"}},emits:["select"],setup(n,{emit:e}){var i;const t=n,l=e,o=Q((i=t.options[0])==null?void 0:i.value),s=N(()=>`${t.type}_${o.value.toLowerCase()}`);function c(u){l("select",u.value)}function r(u){o.value=u.value}return(u,p)=>(w(),L("div",{class:h(u.classes.doc)},[d("div",{class:h(["quickprint-is-scrollable",u.classes.panel])},[(w(!0),L(W,null,te(n.options,m=>(w(),L("div",{key:m.value,class:h({[u.classes.option]:!0,[u.classes.active]:m.value===o.value}),onClick:g=>c(m),onMouseenter:g=>r(m)},[d("strong",null,z(m.label),1)],42,Xr))),128))],2),d("div",{class:h(["quickprint-is-scrollable",u.classes.desc])},[f(_(Qt),{name:s.value},null,8,["name"])],2)],2))}}),Zr="_doc_1pdoc_2",Kr="_panel_1pdoc_10",Jr="_desc_1pdoc_16",Qr="_option_1pdoc_23",ea="_active_1pdoc_33",ta={doc:Zr,panel:Kr,desc:Jr,option:Qr,active:ea},na={classes:ta},la=P(jr,[["__cssModules",na]]),sa=x({__name:"index",setup(n){const e=Pe(),t=Q("string"),l=[{label:"文本",value:"string"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"逻辑",value:"logical"}],o=[{label:"DATE",value:"DATE"},{label:"NOW",value:"NOW"},{label:"YEAR",value:"YEAR"},{label:"MONTH",value:"MONTH"},{label:"DAY",value:"DAY"},{label:"HOUR",value:"HOUR"},{label:"MINUTE",value:"MINUTE"},{label:"SECOND",value:"SECOND"}];function s(c){return e==null?void 0:e.confirm({type:"function",value:`${c}()`})}return(c,r)=>(w(),L("div",{class:h(c.classes.function)},[f(ss,{modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=i=>t.value=i),tabs:l},{prefix:he(()=>[f(_(D),{icon:"icon-function",size:"16px"}),d("span",{class:h(c.classes.title)},"函数",2)]),_:1},8,["modelValue"]),t.value==="string"?(w(),K(Rr,{key:0,onSelect:s})):U("",!0),t.value==="number"?(w(),K(Mr,{key:1,onSelect:s})):U("",!0),t.value==="logical"?(w(),K(Yr,{key:2,onSelect:s})):U("",!0),t.value==="date"?(w(),K(la,{key:3,options:o,onSelect:s})):U("",!0)],2))}}),oa="_title_1bezq_11",ia={function:"_function_1bezq_2",title:oa},ra={classes:ia},aa=P(sa,[["__cssModules",ra]]),ca=["onMouseenter"],ua=["onClick"],da={key:1},pa=x({__name:"Formula",props:{doc:{type:ge,default:null}},setup(n){const e=n,t=Pe(),l=[{id:"pageNumber",name:"页码",options:i(bo)}],o=Q(l[0]);function s(u){o.value=u}function c(u){return t==null?void 0:t.confirm({type:"formula",value:u})}function r(u){const p=fn.tokenize(u),m=e.doc;return p.reduce((g,E)=>{if(E.type===Qe.VARIABLE)return g.push({type:"highlight",value:it(E.value,m==null?void 0:m.ds)}),g;if(E.type===Qe.REFERENCE)return g.push({type:"highlight",value:ls(E.value,m)}),g;if(E.type===Qe.TEMPLATE){const a=(Array.isArray(E.value)?E.value:[E.value]).map(y=>y.type===Qe.VARIABLE?{type:"highlight",value:it(y.value,m.ds)}:{type:"text",value:y.value});return g.concat(a)}return g.push({type:"text",value:fn.formatTokenValue(E)}),g},[])}function i(u){return u.map(p=>({nodes:r(p),value:p}))}return(u,p)=>(w(),L("div",{class:h(u.classes.formula)},[d("div",{class:h([u.classes.left,"quickprint-is-scrollable"])},[(w(),L(W,null,te(l,m=>d("div",{key:m.name,onMouseenter:g=>s(m),class:h({[u.classes.group]:!0,[u.classes.active]:m.id===o.value.id})},z(m.name),43,ca)),64))],2),d("div",{class:h(u.classes.right)},[(w(!0),L(W,null,te(o.value.options,(m,g)=>(w(),L("div",{key:g,class:h(u.classes.code),onClick:E=>c(m.value)},[(w(!0),L(W,null,te(m.nodes,E=>(w(),L(W,null,[E.type==="highlight"?(w(),L("span",{key:0,class:h(u.classes.highlight)},"["+z(E.value)+"]",3)):(w(),L("span",da,z(E.value),1))],64))),256)),d("span",{class:h(u.classes.badge)},"插入",2)],10,ua))),128))],2)],2))}}),fa="_formula_ms7c3_2",ma="_left_ms7c3_12",ha="_right_ms7c3_17",ga="_group_ms7c3_24",va="_active_ms7c3_34",ba="_highlight_ms7c3_39",ya="_code_ms7c3_43",_a="_badge_ms7c3_65",Ea={formula:fa,left:ma,right:ha,group:ga,active:va,highlight:ba,code:ya,badge:_a},Ta={classes:Ea},ka=P(pa,[["__cssModules",Ta]]),sl=Ve(function(n){return Zt("变量",f(is,{doc:n.doc,value:n.value},null),{preset:"variable"}).promisify().catch(qe)}),wa=Ve(function(n){return Tt("数据源",f(os,{doc:n},null),{preset:"variable",icon:f(D,{icon:"icon-datasource",class:"quickprint-ds-icon",size:"16px"},null),menus:[{label:"保存",handler:e=>e.dispatchConfirm()}]}).promisify().catch(qe)}),Sa=Ve(function(n){const e=["ds","builtin","reference"];return Zt("变量",f(is,{doc:n.doc,value:n.value,include:e},null),{preset:"variable"}).promisify().catch(qe)}),Ca=Ve(function(){return Zt("函数",f(aa,null,null),{preset:"variable"}).promisify().catch(qe)}),Ra=Ve(function(n){return Tt("公式",f(ka,{doc:n.doc},null),{preset:"variable"}).promisify().catch(qe)}),La={key:1},Na=x({__name:"Content",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=Ee(),l=Vt("editorRef"),o=Vt("contentRef"),s=Q(!1),c=N(()=>{const p=mi(e.element);return p.color&&(p["--quickprint-element-var-color"]=p.color),s.value&&(p.alignItems="flex-start"),p}),r=N(()=>{const p=nl(e.element,t.doc.ds);return p==null||p.content==null?null:[{tag:"span",content:e.element.attributes.prefix},{tag:p.type===ye.CONST?"span":"strong",content:p.content},{tag:"span",content:e.element.attributes.suffix}]});async function i(){var E;const p=await sl({doc:t.doc,value:e.element.ds.value}).catch(et);if(p==null||(e.element.setDataSource(ye.VARIABLE,p.value),e.element.type!=X.TABLE_CELL||p.type!=="ds"))return;const m=e.element.parent;if(m==null||m.isBindVariable||((E=p.parent)==null?void 0:E.type)!==ne.ARRAY)return;const g=p.parent;m.setDataSource(ye.VARIABLE,`${Je.DS}.${g.type}.${g.name}`)}function u(){const p=l.value,m=o.value;p==null||m==null||(s.value=m.offsetHeight>p.offsetHeight)}return(p,m)=>(w(),L("div",{class:"quickprint-is-element-editor",style:Z(c.value),onVnodeMounted:u,ref_key:"editorRef",ref:l},[d("div",{class:"quickprint-is-content",ref_key:"contentRef",ref:o},[d("span",{class:h({[p.classes.lineThrough]:n.element.style.lineThrough})},[(w(!0),L(W,null,te(r.value,(g,E)=>(w(),L(W,{key:E},[g.tag=="strong"?(w(),L("strong",{key:0,class:h(p.classes.highlight)},"["+z(g.content)+"]",3)):(w(),L("span",La,z(g.content),1))],64))),128))],2)],512),n.element.isBindVariable||n.element.isBindTemplate?(w(),K(_(D),{key:0,icon:"icon-ds",size:"11px",color:"#da7f00",class:h(p.classes.dsIcon),onClick:i,onPointerdown:m[0]||(m[0]=ie(()=>{},["stop"]))},null,8,["class"])):U("",!0)],4))}}),Ia="_dsIcon_ss96n_2",$a="_lineThrough_ss96n_10",xa="_highlight_ss96n_14",Aa={dsIcon:Ia,lineThrough:$a,highlight:xa},Da={classes:Aa},bn=P(Na,[["__cssModules",Da]]),qa=x({__name:"TextEditor",props:{element:{type:Ms,required:!0}},setup(n){return(e,t)=>(w(),K(bn,{element:n.element},null,8,["element"]))}}),yn=Object.freeze({title:"文本",icon:"icon-text",type:X.TEXT,editor:qa,onCreate(){return ve.create({type:X.TEXT,width:Et,height:vn})}}),Oa=x({__name:"NumberEditor",props:{element:{type:Ps,required:!0}},setup(n){return(e,t)=>(w(),K(bn,{element:n.element},null,8,["element"]))}}),Ma=["value","disabled"],Pa=x({__name:"RadioButton",props:wt({modelValue:{},options:{type:Array,default(){return[]}},compacted:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=Kt(n,"modelValue");return(t,l)=>(w(),L("div",{class:h({[t.classes.radioGroup]:!0,[t.classes.compacted]:n.compacted,[t.classes.disabled]:n.disabled})},[(w(!0),L(W,null,te(n.options,o=>(w(),L("label",{class:h({[t.classes.radio]:!0,[t.classes.selected]:o.value===n.modelValue})},[_e(d("input",{type:"radio",value:o.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e.value=s),disabled:n.disabled},null,8,Ma),[[no,e.value]]),d("span",null,z(o.label),1)],2))),256))],2))}}),Va="_radioGroup_67myk_2",Fa="_compacted_67myk_10",za="_radio_67myk_2",Ba="_selected_67myk_50",Ua="_disabled_67myk_56",Ha={radioGroup:Va,compacted:Fa,radio:za,selected:Ba,disabled:Ua},Ga={classes:Ha},$t=P(Pa,[["__cssModules",Ga]]),Wa={class:"quickprint-config-section quickprint-config-inline"},Ya={class:"quickprint-config-content"},Xa={class:"quickprint-config-section quickprint-config-inline"},ja={class:"quickprint-config-content"},Za={class:"quickprint-config-section quickprint-config-inline"},Ka={class:"quickprint-config-content"},Ja={class:"quickprint-config-section quickprint-config-inline"},Qa={class:"quickprint-config-content"},ec=x({__name:"NumberConfig",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=N({get(){return e.element.attributes.showZero??!0},set(s){const c=e.element.attributes;c.showZero=s}}),l=N({get(){return e.element.attributes.round??Ht.ROUND},set(s){const c=e.element.attributes;c.round=s}}),o=N({get(){return e.element.attributes.format??ft.NONE},set(s){const c=e.element.attributes;c.format=s}});return(s,c)=>(w(),L(W,null,[d("section",Wa,[c[4]||(c[4]=d("header",{class:"quickprint-config-header"},"小数位数",-1)),d("div",Ya,[_e(d("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>n.element.attributes.precision=r),type:"number",min:0,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ne,n.element.attributes.precision]])])]),d("section",Xa,[c[5]||(c[5]=d("header",{class:"quickprint-config-header"},"舍入规则",-1)),d("div",ja,[f(_(J),{options:_(ao),modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=r=>l.value=r),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),d("section",Za,[c[6]||(c[6]=d("header",{class:"quickprint-config-header"},"显示类型",-1)),d("div",Ka,[f(_(J),{options:_(co),modelValue:o.value,"onUpdate:modelValue":c[2]||(c[2]=r=>o.value=r),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),d("section",Ja,[c[7]||(c[7]=d("header",{class:"quickprint-config-header"},"值为0时",-1)),d("div",Qa,[f($t,{modelValue:t.value,"onUpdate:modelValue":c[3]||(c[3]=r=>t.value=r),options:_(uo),class:"quickprint-w-full"},null,8,["modelValue","options"])])])],64))}}),_n=Object.freeze({title:"数字",type:X.NUMBER,icon:"icon-number",editor:Oa,config:{display:ec},onCreate(){return ve.create({type:X.NUMBER,width:Et,height:vn})}}),tc=x({__name:"DateEditor",props:{element:{type:Vs,required:!0}},setup(n){return(e,t)=>(w(),K(bn,{element:n.element},null,8,["element"]))}}),nc={class:"quickprint-config-section"},lc={class:"quickprint-config-content"},sc=x({__name:"DateConfig",props:{element:{type:ve,required:!0}},setup(n){const e=n,t={NONE:"NONE"},l=N(()=>[{label:"原始值",value:t.NONE},...Gl]);function o(s){if(s.value==t.NONE){e.element.attributes.format=void 0;return}e.element.attributes.format=s.value}return(s,c)=>(w(),L("section",nc,[d("header",{class:h(["quickprint-config-header",s.classes.header])},[c[1]||(c[1]=d("span",null,"格式",-1)),f(_(J),{options:l.value,onSelect:o,class:h(s.classes.picker),appearance:"none",size:"mini",border:"none",popoverWidth:200},{selected:he(()=>[d("span",{class:h(s.classes.placeholder)},"预设模板",2)]),_:1},8,["options","class"])],2),d("div",lc,[_e(d("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=r=>n.element.attributes.format=r),class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ne,n.element.attributes.format]])])]))}}),oc="_header_79607_2",ic="_picker_79607_8",rc="_placeholder_79607_15",ac={header:oc,picker:ic,placeholder:rc},cc={classes:ac},uc=P(sc,[["__cssModules",cc]]),En=Object.freeze({title:"日期",type:X.DATE,icon:"icon-date",editor:tc,config:{display:uc},onCreate(){return ve.create({type:X.DATE,width:Et,height:vn})}}),dc=["colspan","rowspan"],pc=x({__name:"TableCellEditor",props:{element:{type:jn,required:!0}},setup(n){const e=n,t=N(()=>e.element.attributes.colspan===0||e.element.attributes.rowspan===0),l=Ee(),o=Ie("classes"),s=N(()=>{var i;return{[o.cell]:!0,[G.SELECTED]:(i=e.element.state)==null?void 0:i.selected}}),c=N(()=>{var p;const i=Pn((p=e.element.parent)==null?void 0:p.parent),u=Pn(e.element);return{"--quickprint-cell-editor-width":e.element.offsetWidth+"px","--quickprint-cell-editor-height":e.element.offsetHeight+"px",...Ke(i,u)}});function r(i){i.button==0&&l.selectElement(e.element)}return(i,u)=>t.value?U("",!0):(w(),L("td",Fl({key:0,[`.${_(Xe)||""}`]:n.element,class:s.value,style:c.value,colspan:n.element.attributes.colspan,rowspan:n.element.attributes.rowspan,onClick:ie(r,["stop"])}),[f(bn,{element:n.element,class:h(_(o).content)},null,8,["element","class"])],48,dc))}}),fc="_cell_rp1x6_2",mc="_content_rp1x6_31",hc={cell:fc,content:mc},gc={classes:hc},rs=P(pc,[["__cssModules",gc]]);function vc(n,e){const t=e.getSelected(),l={menus:[{type:"menu",label:"选中表格",icon:"icon-aim",handler:e.selectTable}]};return t.length>=2&&l.menus.push({type:"menu",label:"合并",icon:"icon-merge-cells",handler:e.mergeCells}),t.some(o=>o.hasColSpan||o.hasRowSpan)&&l.menus.push({type:"menu",label:"拆分",icon:"icon-solit-cells",handler:e.splitCells}),l.menus.push({type:"menu",label:"插入",icon:"icon-plus-square",submenu:[{type:"menu",label:"左侧插入列",handler:e.insertColumnLeft},{type:"menu",label:"右侧插入列",handler:e.insertColumnRight},{type:"menu",label:"上侧插入行",handler:e.insertRowTop},{type:"menu",label:"下侧插入行",handler:e.inserRowBottom}]}),l.menus.push({type:"menu",label:"自动调整",icon:"icon-auto-resize",submenu:[{type:"menu",label:"根据纸张调整列宽",handler:e.autoReiszeColumnByPaper},{type:"menu",label:"均分表格宽度",handler:e.avgTableWidth},{type:"menu",label:"均分表格高度",handler:e.avgTableHeight},{type:"menu",label:"将其他行设为相同高度",handler:e.setOtherRowSameHeight,disabled(){return e.toArea(t).rowSpan!==1}},{type:"menu",label:"将其他列设为相同宽度",handler:e.setOtherColSameWidth,disabled(){return e.toArea(t).colSpan!==1}}]}),l.menus.push({type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"删除列",icon:"icon-deletecolumn",handler:e.deleteColumns},{type:"menu",label:"删除行",icon:"icon-deleterow",handler:e.deleteRows},{type:"menu",label:"数据源",icon:"icon-datasource",handler:e.deleteDataSource}]}),Zn.open(n.clientX,n.clientY,l)}function bc(n,e){function t(){return n.element}function l(){const S=t();return e.getSelectedElements().filter(T=>{var I;if(T.type!==X.TABLE_CELL)return!1;const C=(I=T.parent)==null?void 0:I.parent;return C==null?!1:C.id==S.id}).sort(jn.sort)}function o(S){var H,q,j;const[v,...T]=S;let C=v.index,I=v.index,O=((H=v.parent)==null?void 0:H.index)??-1,Y=((q=v.parent)==null?void 0:q.index)??-1;for(const ee of T){const M=((j=ee.parent)==null?void 0:j.index)??-1,pe=ee.index;pe>=0&&pe<C&&(C=pe),pe>=0&&pe>I&&(I=pe),M>=0&&M<O&&(O=M),M>=0&&M>Y&&(Y=M)}return{colStart:C,colEnd:I,rowStart:O,rowEnd:Y,colSpan:I-C+1,rowSpan:Y-O+1}}function s(){var T;const S=l()[0];if(S==null)return!1;const v=(T=S.parent)==null?void 0:T.parent;return v==null?!1:e.selectElement(v)}function c(){const S=l();if(S.length===0)return!1;const v=o(S);return t().insertColumn(v.colStart,0),e.createSnapshot(),!0}function r(){const S=l();if(S.length===0)return!1;const v=o(S);return t().insertColumn(v.colEnd,1),e.createSnapshot(),!0}function i(){const S=l();if(S.length===0)return!1;const v=o(S);return t().inserRow(v.rowStart,0),e.createSnapshot(),!0}function u(){const S=l();if(S.length===0)return!1;const v=o(S);return t().inserRow(v.rowEnd,1),e.createSnapshot(),!0}function p(){var M,pe;const S=t(),v=S.page;if(v==null)return;const T=S.doc,C=ml((M=T==null?void 0:T.margins)==null?void 0:M.left)??38,I=ml((pe=T==null?void 0:T.margins)==null?void 0:pe.right)??38,O=S.columns,Y=O.reduce((ce,ze)=>ce+ze,0),H=Dn.mm_to_px(v.width)-C-I,q=[];for(const ce of O){const ze=Math.round(ce/Y*H);q.push(ze)}const j=q.reduce((ce,ze)=>ce+ze,0),ee=H-j;q[q.length-1]+=ee,S.setColumns(q),S.updateBoxSize(),e.createSnapshot()}function m(){const S=t(),v=S.columns,T=v.reduce((Y,H)=>Y+H,0),C=Math.floor(T/v.length),I=new Array(v.length).fill(C),O=T-I.reduce((Y,H)=>Y+H,0);I[I.length-1]+=O,S.setColumns(I),S.updateBoxSize(),e.createSnapshot()}function g(){const S=t(),v=Math.round(S.height/S.children.length);S.children.forEach((T,C)=>S.setRowHeight(C,v)),S.updateBoxSize(),e.createSnapshot()}function E(){const S=e.getSelectedElements()[0];if(S==null)return;const v=S.parent;if(v==null||v.type!="TableRow")return;const T=t(),C=v.height;T.children.forEach(I=>I.setRowHeight(C)),T.updateBoxSize(),e.createSnapshot()}function b(){const S=e.getSelectedElements()[0];if(S==null)return;const v=t(),T=S.width,C=v.attributes.colgroup.map(I=>T);v.setColumns(C),v.updateBoxSize(),e.createSnapshot()}function a(){const S=l();if(S.length<2)return;const[v,...T]=S,C=o(S);for(const I of T)I.attributes.colspan=0,I.attributes.rowspan=0;v.attributes.colspan=C.colSpan,v.attributes.rowspan=C.rowSpan,v.attributes.range=T.map(I=>I.id),e.selectElement(v),e.createSnapshot()}function y(){const S=l();if(S.length!=0){for(const v of S)!v.hasColSpan&&!v.hasRowSpan||v.resetSpan();e.createSnapshot()}}function R(){const S=l()[0];if(S==null)return;t().removeColumn(S.index),e.createSnapshot()}function A(){const S=l()[0];if(S==null)return;const v=S.parent;if(v==null)return;t().removeRow(v.index),e.createSnapshot()}function k(){e.getSelectedElements().forEach(v=>v.resetDS()),e.createSnapshot()}return{getTable:t,getSelected:l,selectTable:s,toArea:o,insertColumnLeft:c,insertColumnRight:r,insertRowTop:i,inserRowBottom:u,autoReiszeColumnByPaper:p,avgTableWidth:m,avgTableHeight:g,setOtherRowSameHeight:E,setOtherColSameWidth:b,mergeCells:a,splitCells:y,deleteColumns:R,deleteRows:A,deleteDataSource:k}}function yc(n,e,t){const o={moved:!1,left:0,colIndex:0,target:null,container:null};function s(p){return p<=0?null:n.getTable().getColumnLeft(p-1)}function c(p){const m=n.getTable(),g=m.attributes.colgroup.length;return p>=g?null:m.getColumnLeft(p+1)}function r(p,m){if(!(p.target instanceof Element))return;const g=p.target.closest("."+e.colResize);if(g==null)return;const E=g.closest("."+e.layer);E!=null&&(p.stopPropagation(),p.preventDefault(),o.left=g.offsetLeft,o.colIndex=m,o.target=g,o.container=E,o.target.setPointerCapture(p.pointerId),window.addEventListener("pointermove",i),window.addEventListener("pointerup",u))}function i(p){if(o.target==null||o.container==null)return;const m=o.container.getBoundingClientRect(),g=s(o.colIndex),E=c(o.colIndex);let b=p.clientX-m.left;g!=null&&b<=g+4&&(b=g+4),E!=null&&b>=E-4&&(b=E-4),o.left=b,o.target.style.left=b+"px",o.moved=!0}function u(p){o.moved&&t.onResizeEnd(o.colIndex,Math.round(o.left)),o.left=0,o.target=null,o.container=null,window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",u)}return r}function _c(n,e,t){const o={moved:!1,top:0,rowIndex:0,target:null,container:null};function s(p){return p<=0?null:n.getTable().getRowTop(p-1)}function c(p){const m=n.getTable(),g=m.children.length;return p>=g?null:m.getRowTop(p+1)}function r(p,m){if(!(p.target instanceof Element))return;const g=p.target.closest("."+e.rowResize);if(g==null)return;const E=g.closest("."+e.layer);E!=null&&(p.stopPropagation(),p.preventDefault(),o.top=g.offsetTop,o.rowIndex=m,o.target=g,o.container=E,o.target.setPointerCapture(p.pointerId),window.addEventListener("pointermove",i),window.addEventListener("pointerup",u))}function i(p){if(o.target==null||o.container==null)return;const m=o.container.getBoundingClientRect(),g=s(o.rowIndex),E=c(o.rowIndex);let b=p.clientY-m.top;g!=null&&b<=g+4&&(b=g+4),E!=null&&b>=E-4&&(b=E-4),o.moved=!0,o.top=b,o.target.style.top=b+"px"}function u(p){o.moved&&t.onResizeEnd(o.rowIndex,Math.round(o.top)),o.top=0,o.target=null,o.container=null,window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",u)}return r}const Ec=["width"],Tc=["onClick"],kc=["onClick"],wc=x({__name:"TableEditor",props:{element:{type:Fs,required:!0}},setup(n){const e=n,t=Ee(),l=Ie("classes"),o=bc(e,t),s=De({colIndex:-1,rowIndex:-1,silence:!1}),c=N(()=>e.element.attributes.colgroup??[]),r=yc(o,l,{onResizeEnd:R,onResizeStart:y}),i=_c(o,l,{onResizeEnd:A,onResizeStart:y});function u(v){return{left:(e.element.attributes.colgroup??[]).slice(0,v).reduce((C,I)=>C+I,0)+"px"}}function p(v){return{top:(e.element.children??[]).slice(0,v).reduce((I,O)=>I+O.height,0)-1+"px"}}function m(v){const T=e.element.attributes.colgroup??[],C=T.slice(0,v).reduce((Y,H)=>Y+H,0),I=v===0?0:1,O=v>0&&v<T.length?-1:0;return{left:C+I+"px",width:T[v]+O+"px"}}function g(v){const T=e.element.children??[],C=T.slice(0,v).reduce((Y,H)=>Y+H.height,0),I=v===0?0:1,O=v>0&&v<T.length?-1:0;return{top:C+I+"px",height:T[v].height+O+"px"}}function E(v){t.selectElement(v)}function b(v){const T=[];for(const C of e.element.children){const I=C.children[v];I.isColCollapse||T.push(I)}t.multiSelectElements(T)}async function a(v){const T=v.target.closest("td");if(T==null)return;const C=Reflect.get(T,Xe);C!=null&&(t.state.selectMode==ot.SINGLE&&(t.selectElement(C),await Pt()),vc(v,o))}function y(){s.silence=!0}function R(v,T){s.silence=!1;const C=e.element.attributes.colgroup??[];if(v==0){const q=e.element.left,j=e.element.calculateCoord(q+T),ee=C[0]-(j-q);e.element.setLeft(j),e.element.setColWidth(0,ee),e.element.updateBoxSize(),t.createSnapshot();return}if(v==C.length){const q=v-1,j=C.slice(0,q).reduce((M,pe)=>M+pe,0),ee=T-j;e.element.setColWidth(v-1,ee),e.element.updateBoxSize(),t.createSnapshot();return}const I=v-1,O=C[I]+C[v],Y=T-C.slice(0,I).reduce((q,j)=>q+j,0),H=O-Y;e.element.setColWidth(I,Y),e.element.setColWidth(v,H),e.element.updateBoxSize(),t.createSnapshot()}function A(v,T){s.silence=!1;const C=e.element.children;if(v==0){const q=e.element.top,j=e.element.calculateCoord(q+T),ee=C[0].height-(j-q);e.element.setTop(j),e.element.setRowHeight(v,ee),e.element.updateBoxSize(),t.createSnapshot();return}if(v==C.length){const q=v-1,j=C.slice(0,q).reduce((M,pe)=>M+pe.height,0),ee=T-j;e.element.setRowHeight(v-1,ee),e.element.updateBoxSize(),t.createSnapshot();return}const I=v-1,O=C[I].height+C[v].height,Y=T-C.slice(0,I).reduce((q,j)=>q+j.height,0),H=O-Y;e.element.setRowHeight(I,Y),e.element.setRowHeight(v,H),e.element.updateBoxSize(),t.createSnapshot()}function k(){s.rowIndex=-1,s.colIndex=-1}function S(v){if(s.silence)return;const T=v.target.closest("td");if(T==null)return;const C=Reflect.get(T,Xe);if(C==null||!(C instanceof jn))return;const I=C.parent;if(I==null)return;const O=T.getBoundingClientRect(),Y=v.clientY-O.top,q=v.clientX-O.left<O.width/2,j=Y<O.height/2;s.colIndex=q?C.index:C.getNextColIndex(),s.rowIndex=j?I.index:C.getNextRowIndex()}return(v,T)=>(w(),L("div",{class:h(_(l).tableEditor),onContextmenu:ie(a,["stop","prevent"]),onClick:T[3]||(T[3]=ie(()=>{},["stop"])),onMouseleave:k},[d("table",{class:h(_(l).table),onMousemove:S},[d("colgroup",null,[(w(!0),L(W,null,te(c.value,(C,I)=>(w(),L("col",{key:I,width:C},null,8,Ec))),128))]),d("tbody",null,[(w(!0),L(W,null,te(n.element.children,C=>(w(),L("tr",{key:C.id,class:h({[_(G).SELECTED]:C.isSelected})},[(w(!0),L(W,null,te(C.children,I=>(w(),K(rs,{key:I.id,element:I},null,8,["element"]))),128))],2))),128))])],34),d("div",{class:h(_(l).layer)},[s.colIndex>=0?(w(),L("div",{key:0,title:"调整列宽",class:h(_(l).colResize),style:Z(u(s.colIndex)),onPointerdown:T[0]||(T[0]=ie(C=>_(r)(C,s.colIndex),["stop","prevent"]))},null,38)):U("",!0),s.rowIndex>=0?(w(),L("div",{key:1,title:"调整行高",class:h(_(l).rowResize),style:Z(p(s.rowIndex)),onPointerdown:T[1]||(T[1]=ie(C=>_(i)(C,s.rowIndex),["stop","prevent"]))},null,38)):U("",!0),(w(!0),L(W,null,te(c.value,(C,I)=>(w(),L("div",{title:"选中此列",key:I,style:Z(m(I)),class:h(_(l).colIndicator),onClick:ie(O=>b(I),["stop"])},null,14,Tc))),128)),(w(!0),L(W,null,te(n.element.children,(C,I)=>(w(),L("div",{title:"选中此行",key:I,style:Z(g(I)),class:h(_(l).rowIndicator),onClick:ie(O=>E(C),["stop"])},null,14,kc))),128))],2),d("div",{class:h(_(l).indicator),onPointerdown:T[2]||(T[2]=(...C)=>_(t).onDragStart&&_(t).onDragStart(...C)),title:"选中/拖动表格"},null,34)],34))}}),Sc="_tableEditor_8j9wo_2",Cc="_table_8j9wo_2",Rc="_layer_8j9wo_33",Lc="_colResize_8j9wo_43",Nc="_rowResize_8j9wo_66",Ic="_colIndicator_8j9wo_89",$c="_rowIndicator_8j9wo_95",xc="_indicator_8j9wo_114",Ac={tableEditor:Sc,table:Cc,layer:Rc,colResize:Lc,rowResize:Nc,colIndicator:Ic,rowIndicator:$c,indicator:xc},Dc={classes:Ac},qc=P(wc,[["__cssModules",Dc]]),Oc={class:"quickprint-config-section quickprint-config-inline"},Mc={class:"quickprint-config-content"},Pc=x({__name:"TableRowConfig",props:{element:{type:ln,required:!0}},setup(n){const e=n,t=[{label:"表头",value:Ct.HEADER},{label:"表体",value:Ct.BODY},{label:"表尾",value:Ct.FOOTER}],l=N({get(){return e.element.attributes.type??Ct.BODY},set(o){switch(o){case Ct.HEADER:e.element.asHeader();break;case Ct.FOOTER:e.element.asFooter();break;default:e.element.asBody()}}});return(o,s)=>(w(),L("section",Oc,[s[1]||(s[1]=d("header",{class:"quickprint-config-header"},"行模式",-1)),d("div",Mc,[f(_(J),{options:t,modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=c=>l.value=c),class:"quickprint-w-full"},null,8,["modelValue"])])]))}}),Tn=Object.freeze({title:"表格",type:X.TABLE,icon:"icon-table",editor:qc,config:{exclude:[re.PREFIX,re.SUFFIX,re.DISPLAY,re.OVERFLOW]},features:{draggable:!1,resizable:!1,contextMenu:!1},onCreate(){const n=[Et,Et,Et],e=ve.create({type:X.TABLE});return e.setColgroup(n),e.append(ln.createDefault(n)),e.append(ln.createDefault(n)),e.append(ln.createDefault(n)),e.updateBoxSize(),e}}),as=Object.freeze({title:"表格行",type:X.TABLE_ROW,icon:"icon-table-row",exposed:!1,editor:null,config:{exclude:[re.POSITION,re.COORD,re.OVERFLOW],attributes:Pc}}),ol=Object.freeze({title:"单元格",type:X.TABLE_CELL,icon:"icon-table-cell",exposed:!1,editor:rs,config:{exclude:[re.POSITION,re.COORD]}});function tn(n,e){const t=Math.pow(10,Math.max(0,e));return Math.round(n*t)/t}const xn={A:10,B:11,C:12,D:13,E:14,F:15},gl={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};function Vc(n){return typeof n=="string"&&n.includes(".")&&Number.parseFloat(n)===1}function Fc(n){return typeof n=="string"&&n.includes("%")}function At(n,e){Vc(n)&&(n="100%");const t=Fc(n);return n=Math.min(e,Math.max(0,Number.parseFloat(`${n}`))),t&&(n=Number.parseInt(`${n*e}`,10)/100),Math.abs(n-e)<1e-6?1:n%e/Number.parseFloat(e)}function dt(n){return n.length===2?(xn[n[0].toUpperCase()]||+n[0])*16+(xn[n[1].toUpperCase()]||+n[1]):xn[n[1].toUpperCase()]||+n[1]}function vl(n,e,t){n=At(n,255),e=At(e,255),t=At(t,255);const l=Math.max(n,e,t),o=Math.min(n,e,t);let s;const c=l,r=l-o,i=l===0?0:r/l;if(l===o)s=0;else{switch(l){case n:{s=(e-t)/r+(e<t?6:0);break}case e:{s=(t-n)/r+2;break}case t:{s=(n-e)/r+4;break}}s/=6}return{h:s*360,s:i*100,v:c*100}}const zc=function(n,e,t){e=e/100,t=t/100;let l=e;const o=Math.max(t,.01);t*=2,e*=t<=1?t:2-t,l*=o<=1?o:2-o;const s=(t+e)/2,c=t===0?2*l/(o+l):2*e/(t+e);return{h:n,s:c*100,v:s*100}},Bc=function(n,e,t){return[n,e*t/((n=(2-e)*t)<1?n:2-n)||0,n/2]};function An(n,e,t){n=At(n,360)*6,e=At(e,100),t=At(t,100);const l=Math.floor(n),o=n-l,s=t*(1-e),c=t*(1-o*e),r=t*(1-(1-o)*e),i=l%6,u=[t,c,s,s,r,t][i],p=[r,t,t,c,s,s][i],m=[s,s,r,t,t,c][i];return{r:Math.round(u*255),g:Math.round(p*255),b:Math.round(m*255)}}function rn(n){n=Math.min(Math.round(n),255);const e=Math.floor(n/16),t=n%16;return`${gl[e]||e}${gl[t]||t}`}function Uc({r:n,g:e,b:t}){return Number.isNaN(+n)||Number.isNaN(+e)||Number.isNaN(+t)?"":`#${rn(n)}${rn(e)}${rn(t)}`}class kn{constructor(e){F(this,"h",0);F(this,"s",100);F(this,"v",100);F(this,"a",100);e&&this.setColor(e)}setColor(e){const t=this.processColor(e);t!=null&&(this.setHue(t.h),this.setSaturation(t.s),this.setValue(t.v),this.setAlpha(t.a))}setHue(e){this.h=tn(e,2)}setSaturation(e){this.s=tn(e,2)}setValue(e){this.v=tn(e,2)}setAlpha(e){this.a=tn(e,2)}processColor(e){return e==null||e==""?null:e.startsWith("#")?this.processHEX(e):e.startsWith("rgb")?this.processRGB(e):e.startsWith("hsl")?this.processHSL(e):this.processHSV(e)}processHSV(e){const t=e.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(o=>o!=="").map((o,s)=>s>2?Number.parseFloat(o):Number.parseInt(o,10)),l=t.length===4?t[3]*100:100;return{h:t[0],s:t[1],v:t[2],a:l}}processHEX(e){const t=e.replace("#","").trim();if(!/^[0-9a-fA-F]{3}$|^[0-9a-fA-F]{6}$|^[0-9a-fA-F]{8}$/.test(t))return null;let l,o,s,c=100;t.length===3?(l=dt(t[0]+t[0]),o=dt(t[1]+t[1]),s=dt(t[2]+t[2])):(t.length===6||t.length===8)&&(l=dt(t.slice(0,2)),o=dt(t.slice(2,4)),s=dt(t.slice(4,6))),t.length===8&&(c=dt(t.slice(6))/255*100);const{h:r,s:i,v:u}=vl(l,o,s);return{h:r,s:i,v:u,a:c}}processRGB(e){const t=e.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,o)=>o>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:o,s,v:c}=vl(t[0],t[1],t[2]);return{h:o,s,v:c,a:l}}return null}processHSL(e){const t=e.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,o)=>o>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:o,s,v:c}=zc(t[0],t[1],t[2]);return{h:o,s,v:c,a:l}}return null}toString(e){switch(e){case"hsl":{const t=Bc(this.h,this.s/100,this.v/100);return`hsla(${this.h},${Math.round(t[1]*100)}%,${Math.round(t[2]*100)}%,${this.a/100})`}case"hex":return`${Uc(An(this.h,this.s,this.v))}${rn(this.a*255/100)}`;case"rgb":{const{r:t,g:l,b:o}=An(this.h,this.s,this.v);return`rgba(${t},${l},${o},${this.a/100})`}default:return`hsva(${this.h},${Math.round(this.s)}%,${Math.round(this.v)}%,${this.a/100})`}}toRGB(){return this.toString("rgb")}toHSL(){return this.toString("hsl")}toHEX(){return this.toString("hex")}rgb(){return An(this.h,this.s,this.v)}}function cs(n){const e={init:!1,target:null,container:null,offsetX:0};function t(c){const r=e.container.getBoundingClientRect(),u=e.target.getBoundingClientRect().width/2;let p=c.clientX-r.left-e.offsetX;return p<-u&&(p=-u),p>r.width-u&&(p=r.width-u),p}function l(c){c.stopPropagation(),c.preventDefault();const r=c.target,i=c.currentTarget;origin==null||r==null||(e.container=i,e.target=r===i?r.firstElementChild:r,e.offsetX=r===i?e.target.offsetWidth/2:c.clientX-r.getBoundingClientRect().left,window.addEventListener("pointermove",o),window.addEventListener("pointerup",s))}function o(c){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(c.pointerId),e.init=!0);const r=t(c);e.target.style.left=r+"px",n("move",r)}function s(c){if(c.preventDefault(),c.stopPropagation(),e.container&&e.target){const r=t(c);n("end",r)}e.target&&e.target.releasePointerCapture(c.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",s)}return l}function Hc(n){const e={init:!1,target:null,container:null,offsetX:0,offsetY:0};function t(r){const i=e.container.getBoundingClientRect(),p=e.target.getBoundingClientRect().width/2;let m=r.clientX-i.left-e.offsetX;return m<-p&&(m=-p),m>i.width-p&&(m=i.width-p),m}function l(r){const i=e.container.getBoundingClientRect(),p=e.target.getBoundingClientRect().height/2;let m=r.clientY-i.top-e.offsetY;return m<-p&&(m=-p),m>i.height-p&&(m=i.height-p),m}function o(r){r.stopPropagation(),r.preventDefault();const i=r.target,u=r.currentTarget;origin==null||i==null||(e.container=u,e.target=i===u?i.firstElementChild:i,e.offsetX=i===u?e.target.offsetWidth/2:r.clientX-i.getBoundingClientRect().left,e.offsetY=i===u?e.target.offsetHeight/2:r.clientY-i.getBoundingClientRect().top,window.addEventListener("pointermove",s),window.addEventListener("pointerup",c))}function s(r){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(r.pointerId),e.init=!0);const i=t(r),u=l(r);e.target.style.left=i+"px",e.target.style.top=u+"px",n("move",{left:i,top:u})}function c(r){if(r.preventDefault(),r.stopPropagation(),e.container&&e.target){const i=t(r),u=l(r);n("end",{top:u,left:i})}e.target&&e.target.releasePointerCapture(r.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",c)}return o}const Gc=x({__name:"SvPanel",props:{modelValue:{type:kn,required:!0}},setup(n){const e=n,t=ue(),l=ue(),o=De(r()),s=N(()=>({left:o.left+"px",top:o.top+"px"})),c=Hc((i,u)=>{i=="end"&&(o.top=u.top,o.left=u.left);const p=t.value,m=l.value,g=(u.left+m.offsetWidth/2)/p.offsetWidth*100,E=100-(u.top+m.offsetHeight)/p.offsetHeight*100;e.modelValue.setSaturation(g),e.modelValue.setValue(E)});function r(){const i=t.value,u=l.value;if(i==null||u==null)return{top:-6,left:-6};const p=e.modelValue.s,g=(100-e.modelValue.v)/100*i.offsetHeight,E=p/100*i.offsetWidth;return{top:g-u.offsetHeight/2,left:E-u.offsetWidth/2}}return Jt(()=>{const i=r();o.top=i.top,o.left=i.left}),(i,u)=>(w(),L("div",{class:h(i.classes.svPanel),onPointerdown:u[0]||(u[0]=(...p)=>_(c)&&_(c)(...p)),ref_key:"svPanelRef",ref:t},[d("div",{class:h(i.classes.thumb),style:Z(s.value),ref_key:"thumbRef",ref:l},null,6)],34))}}),Wc="_svPanel_1sv6o_2",Yc="_thumb_1sv6o_10",Xc={svPanel:Wc,thumb:Yc},jc={classes:Xc},Zc=P(Gc,[["__cssModules",jc]]),Kc=x({__name:"HueSlider",props:{modelValue:{type:kn,required:!0}},setup(n){const e=n,t=Q(-6),l=ue(),o=ue(),s=cs((r,i)=>{r=="end"&&(t.value=i);const u=l.value,p=o.value,m=Math.round((i+p.offsetWidth/2)/u.offsetWidth*360);e.modelValue.setHue(m)});function c(){const r=l.value,i=o.value;if(r==null||i==null)return-6;const u=e.modelValue.h;return Math.round(u/360*r.offsetWidth)-i.offsetWidth/2}return Jt(()=>{t.value=c()}),(r,i)=>(w(),L("div",{class:h(r.classes.hue),onPointerdown:i[0]||(i[0]=(...u)=>_(s)&&_(s)(...u)),ref_key:"hueRef",ref:l},[d("div",{class:h(r.classes.thumb),style:Z({left:t.value+"px"}),ref_key:"thumbRef",ref:o},null,6)],34))}}),Jc="_hue_1ozoc_2",Qc="_thumb_1ozoc_10",eu={hue:Jc,thumb:Qc},tu={classes:eu},nu=P(Kc,[["__cssModules",tu]]),lu=x({__name:"AlphaSlider",props:{modelValue:{type:kn,required:!0}},setup(n){const e=n,t=Q(-6),l=ue(),o=ue(),s=cs((r,i)=>{r=="end"&&(t.value=i);const u=l.value,p=o.value,m=Math.round((i+p.offsetWidth/2)/u.offsetWidth*100);e.modelValue.setAlpha(m)});function c(){const r=l.value,i=o.value;if(r==null||i==null)return-6;const u=e.modelValue.a;return Math.round(u/100*r.offsetWidth)-i.offsetWidth/2}return Jt(()=>{t.value=c()}),(r,i)=>(w(),L("div",{class:h(r.classes.alpha),onPointerdown:i[0]||(i[0]=(...u)=>_(s)&&_(s)(...u)),ref_key:"alphaRef",ref:l},[d("div",{class:h(r.classes.thumb),style:Z({left:t.value+"px"}),ref_key:"thumbRef",ref:o},null,6)],34))}}),su="_alpha_1x8jd_2",ou="_thumb_1x8jd_26",iu={alpha:su,thumb:ou},ru={classes:iu},au=P(lu,[["__cssModules",ru]]),cu=["#FFFFFF","#000000","#485368","#2972F4","#00A3F5","#319B62","#DE3C36","#F88825","#F5C400","#9A38D7","#F2F2F2","#7F7F7F","#F3F5F7","#E5EFFF","#E5F6FF","#EAFAF1","#FFE9E8","#FFF3EB","#FFF9E3","#FDEBFF","#D8D8D8","#595959","#C5CAD3","#C7DCFF","#C7ECFF","#C3EAD5","#FFC9C7","#FFDCC4","#FFEEAD","#F2C7FF","#BFBFBF","#3F3F3F","#808B9E","#99BEFF","#99DDFF","#98D7B6","#FF9C99","#FFBA84","#FFE270","#D58EFF","#A5A5A5","#262626","#353B45","#1450B8","#1274A5","#277C4F","#9E1E1A","#B86014","#A38200","#5E2281","#939393","#0D0D0D","#24272E","#0C306E","#0A415C","#184E32","#58110E","#5C300A","#665200","#3B1551"];function uu(){try{return typeof window.EyeDropper=="function"}catch(n){return console.log(n),!1}}async function du(){try{return(await new EyeDropper().open()).sRGBHex}catch(n){return console.error(n),null}}const bl={isSupport:uu,open:du},pu=["title","onClick"],fu=["title","onClick"],yl="quickprint-recent-use-colors",mu=x({__name:"index",props:{modelValue:{type:String,default:null},showText:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(n,{emit:e}){const t=e,l=n,o=[{value:"hex",label:"HEX"},{value:"rgb",label:"RGB"},{value:"hsl",label:"HSL"}],s=Q(new kn(l.modelValue)),c=ue(),r=ue(),i=Q(A()),u=bl.isSupport(),p=Q("hex"),m=N(()=>{const v=l.modelValue;return v?{backgroundColor:v}:null}),g=N(()=>{const v=s.value,{r:T,g:C,b:I}=v.rgb();return{"--hue-channel-color":`hsl(${v.h}, 100%, 50%)`,"--alpha-channel-color-a":`rgba(${T}, ${C}, ${I}, 0)`,"--alpha-channel-color-b":`rgba(${T}, ${C}, ${I}, 1)`}}),E=N({get(){return s.value.toString(p.value)},set(v){s.value.setColor(v)}});function b(){var v;(v=c.value)==null||v.close()}function a(v){v!=null&&(t("update:modelValue",v),t("select",v),k(v),b())}function y(){t("update:modelValue",void 0),t("select",void 0),b()}function R(){bl.open().then(v=>a(v))}function A(){const v=localStorage.getItem(yl);if(v==null||v=="")return[];const T=qn(v);return T==null?[]:Array.isArray(T)?T:[]}function k(v){const T=i.value,C=T.indexOf(v);C>=0&&T.splice(C,1),T.length>10&&T.pop(),T.unshift(v),localStorage.setItem(yl,JSON.stringify(T))}function S(){t("update:modelValue",s.value.toString(p.value)),t("select",s.value.toString(p.value)),b()}return Jn(()=>l.modelValue,()=>s.value.setColor(l.modelValue)),(v,T)=>(w(),K(_(Jl),{class:h(v.classes.colorPicker),onMousedown:T[7]||(T[7]=ie(()=>{},["prevent"])),ref_key:"popoverRef",ref:c},{popover:he(()=>[d("div",{class:h(v.classes.colorPickerPanel)},[d("div",{class:h(v.classes.presetPanel)},[d("div",{class:h(v.classes.presetTools)},[d("button",{type:"button",class:h(v.classes.clearBtn),onClick:y},[d("span",{class:h(v.classes.none)},null,2),T[8]||(T[8]=d("span",null,"无颜色",-1))],2),_(u)?(w(),L("button",{key:0,type:"button",class:h(v.classes.indicator),onClick:R},[f(_(D),{icon:"icon-eye-dropper"}),T[9]||(T[9]=d("span",null,"拾色器",-1))],2)):U("",!0)],2),d("div",{class:h(v.classes.colourAtla)},[(w(!0),L(W,null,te(_(cu),C=>(w(),L("div",{style:Z({backgroundColor:C}),title:C,class:h(v.classes.color),onClick:I=>a(C)},null,14,pu))),256))],2),d("div",{class:h(v.classes.recentColors)},"最近使用",2),d("div",{class:h(v.classes.colourAtla)},[(w(),L(W,null,te(10,C=>d("div",{key:C,title:i.value[C-1],style:Z({backgroundColor:i.value[C-1]}),class:h(v.classes.color),onClick:I=>a(i.value[C-1])},null,14,fu)),64))],2)],2),d("div",{class:h(v.pacls.panel),style:Z(g.value)},[f(Zc,{class:h(v.pacls.sv),modelValue:s.value,"onUpdate:modelValue":T[1]||(T[1]=C=>s.value=C)},null,8,["class","modelValue"]),d("div",{class:h(v.pacls.sliders)},[f(nu,{class:h(v.pacls.hua),modelValue:s.value,"onUpdate:modelValue":T[2]||(T[2]=C=>s.value=C)},null,8,["class","modelValue"]),f(au,{modelValue:s.value,"onUpdate:modelValue":T[3]||(T[3]=C=>s.value=C)},null,8,["modelValue"]),d("div",{class:h(v.pacls.preview)},[d("div",{class:h(v.pacls.previewColor),style:Z({backgroundColor:s.value.toRGB()})},null,6)],2)],2),d("div",{class:h(v.pacls.tools)},[f(_(J),{options:o,teleport:"none",modelValue:p.value,"onUpdate:modelValue":T[4]||(T[4]=C=>p.value=C),width:"42px",border:"none",size:"text"},null,8,["modelValue"]),_e(d("input",{type:"text","onUpdate:modelValue":T[5]||(T[5]=C=>E.value=C),onMousedown:T[6]||(T[6]=ie(()=>{},["stop"])),class:"quickprint-form-control",style:{width:"120px"}},null,544),[[Ne,E.value]]),d("button",{type:"button",class:h(v.pacls.confirm),onClick:S},"确定",2)],2)],6)],2)]),default:he(()=>[d("div",{class:h(v.classes.colorPickerInput),ref_key:"inputRef",ref:r},[Me(v.$slots,"default",{},()=>[d("span",{class:h(v.classes.colorBlock),style:Z(m.value)},null,6)]),n.showText?(w(),L("div",{key:0,class:h(v.classes.colorValue),onClick:T[0]||(T[0]=ie(()=>{},["stop"]))},z(n.modelValue),3)):U("",!0)],2)]),_:3},8,["class"]))}}),hu="_colorPicker_qpnrm_2",gu="_colorPickerInput_qpnrm_6",vu="_colorBlock_qpnrm_13",bu="_colorValue_qpnrm_22",yu="_colorPickerPanel_qpnrm_27",_u="_presetPanel_qpnrm_42",Eu="_colourAtla_qpnrm_46",Tu="_color_qpnrm_2",ku="_presetTools_qpnrm_73",wu="_clearBtn_qpnrm_79",Su="_indicator_qpnrm_80",Cu="_none_qpnrm_98",Ru="_recentColors_qpnrm_129",Lu={colorPicker:hu,colorPickerInput:gu,colorBlock:vu,colorValue:bu,colorPickerPanel:yu,presetPanel:_u,colourAtla:Eu,color:Tu,presetTools:ku,clearBtn:wu,indicator:Su,none:Cu,recentColors:Ru},Nu="_panel_911zv_2",Iu="_sv_911zv_7",$u="_hua_911zv_11",xu="_sliders_911zv_15",Au="_tools_911zv_20",Du="_confirm_911zv_37 quickprint-text-btn",qu="_preview_911zv_44",Ou="_previewColor_911zv_59",Mu={panel:Nu,sv:Iu,hua:$u,sliders:xu,tools:Au,confirm:Du,preview:qu,previewColor:Ou},Pu={classes:Lu,pacls:Mu},lt=P(mu,[["__cssModules",Pu]]);class Vu{constructor(e){F(this,"__v_skip",!0);F(this,"observer");F(this,"callbacks",[]);F(this,"handler");this.handler=pi((t,l)=>{for(const o of this.callbacks)o(t,l)},500),this.observer=new MutationObserver((t,l)=>this.handler(t,l)),this.observer.observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}addListener(e){return typeof e!="function"||this.callbacks.findIndex(l=>l===e)>=0?!1:(this.callbacks.push(e),!0)}removeListener(e){const t=this.callbacks.findIndex(l=>l===e);return t<0?!1:(this.callbacks.splice(t,1),!0)}cleanup(){this.observer.disconnect(),this.callbacks=[]}}function Fu(n,e){switch(n){case"fontSize":return e===be.DEFAULT?void 0:e;case"fontFamily":return e===oe.DEFAULT?void 0:e;case"lineHeight":return e===ht.DEFAULT?void 0:e;default:return e}}const _l="texteditor-const-node",zu=Object.freeze({CONST:0});class Bu{constructor(e,t={}){F(this,"__v_skip",!0);F(this,"emitter",new pn);F(this,"container");F(this,"options");F(this,"observer");F(this,"handleClick");this.container=e,this.container.contentEditable="plaintext-only",this.container.classList.add("quickprint-text-editor"),this.options=t,this.observer=new Vu(e),this.handleClick=this.onClick.bind(this),Reflect.defineProperty(this,"emitter",{configurable:!1,enumerable:!1,writable:!1,value:new pn}),e.addEventListener("click",this.handleClick)}on(e,t){return this.emitter.on(e,t)}once(e,t){return this.emitter.once(e,t)}off(e,t){return this.emitter.off(e,t)}dispatch(e){return this.emitter.dispatch(e)}createEvent(e,t){return new zs(e,t)}watch(e){return this.observer.addListener(e),()=>{this.observer!=null&&this.observer.removeListener(e)}}cleanup(){this.container.removeEventListener("click",this.handleClick),this.observer.cleanup(),this.emitter.cleanup()}getHTML(){return this.container.innerHTML}setHTML(e){return console.log("TODO: 光标"),this.container.innerHTML=e,!0}clear(){return this.container.innerHTML="",!0}focus(){this.container.focus()}blur(){this.container.blur()}getSelection(){const e=this.container,t=window.getSelection();if(t==null||!e.contains(t.anchorNode)||!e.contains(t.focusNode))return null;const l=t.getRangeAt(0);return l==null?null:{selection:t,range:l}}hasSelection(){const e=this.getSelection();return e==null?!1:!e.selection.isCollapsed}normalize(){const e=this.container;for(let t=e.childNodes.length-1;t>=0;t--){const l=e.childNodes[t];if(ae(l.textContent)){e.removeChild(l);continue}if(l instanceof HTMLElement){if(l.contentEditable==="false")continue;l.style.length===0&&l.replaceWith(l.textContent)}}return e.normalize(),e}updateHeight(){const e=this.container.scrollHeight;return this.dispatch(this.createEvent("resize",{height:e})),e}async autosize(){this.container.style.height="auto";const e=this.updateHeight();return await hn(),this.container.style.removeProperty("height"),e}checkHeight(){const e=this.container;e.scrollHeight>e.clientHeight&&this.updateHeight()}createConstNode(e){const t=document.createElement("span");return t.contentEditable="false",t.innerText=`${e.label??e.value}`,t.className=_l,t.dataset.value=e.value,t.dataset.type=e.type+"",t}focusAfterNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),t.collapseToEnd(),!0}focusNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),!0}focusNodes(e){if(e.length==0)return!1;if(e.length==1)return this.focusNode(e[0]);const t=window.getSelection();if(t==null)return!1;const l=new Range,o=e[0],s=e[e.length-1];return!this.container.contains(o)||!this.container.contains(s)?!1:(t.removeAllRanges(),l.setStartBefore(o),l.setEndAfter(s),t.addRange(l),!0)}insertNode(e,t){var g;const l=this.getSelection();if(l==null)return!1;const{selection:o,range:s}=l;if(o.isCollapsed!=!0&&o.deleteFromDocument(),o.isCollapsed!=!0)return!1;const c=o.anchorNode;if(c==null)return!1;const r=this.container,i=this.createConstNode(e);if(typeof(t==null?void 0:t.onCreateNode)=="function"&&t.onCreateNode(i),c.parentNode===r||(g=c.parentNode)!=null&&g.contains(r))return s.insertNode(i),this.normalize(),this.focusAfterNode(i),!0;const u=c.parentNode;if(u==null)return!1;const p=u.textContent;if(p==null)return!1;if(o.anchorOffset==p.length)return r.insertBefore(i,u.nextSibling),this.normalize(),this.focusAfterNode(i),!0;const m=document.createElement("span");return m.textContent=p.slice(0,o.anchorOffset),u instanceof HTMLElement&&(m.style.cssText=u.style.cssText),u.textContent=p.slice(o.anchorOffset),r.insertBefore(i,u),r.insertBefore(m,i),this.normalize(),this.focusAfterNode(i),!0}insertText(e){const t=this.getSelection();if(t==null)return!1;const{selection:l,range:o}=t;return l.isCollapsed||l.deleteFromDocument(),o.insertNode(document.createTextNode(e)),l.collapseToEnd(),this.normalize(),!0}normalizeRange(e){const t=this.container,l=e.startContainer,o=e.endContainer,s={};return l===t?(s.startNode=t.childNodes[e.startOffset],s.startOffset=-1):(s.startNode=l.parentNode==t?l:l.parentNode,s.startOffset=e.startOffset),o===t?(s.endNode=t.childNodes[e.endOffset],s.endOffset=-1):(s.endNode=o.parentNode==t?o:o.parentNode,s.endOffset=e.endOffset),s}findNodesBetween(e,t){const l=[];let o=e.nextSibling;for(;o!=null&&o!==t;)l.push(o),o=o.nextSibling;return l}inheritStyle(e,t){if(!(t instanceof HTMLElement))return!1;const l=t.style.cssText;return ae(l)?!1:(e.style.cssText=l,!0)}extractNodesFromRange(){var p;const e=this.container,t=this.getSelection();if(t==null||t.selection.isCollapsed)return null;const o=t.range,{startNode:s,startOffset:c,endNode:r,endOffset:i}=this.normalizeRange(o);if(s===r){const m=s.textContent??"";if(s instanceof CharacterData){const b=document.createElement("span");return b.textContent=m.slice(c,i),o.deleteContents(),o.insertNode(b),[b]}const g=document.createElement("span");g.textContent=m.slice(0,c),this.inheritStyle(g,r);const E=document.createElement("span");return E.textContent=m.slice(c,i),this.inheritStyle(E,r),r.textContent=m.slice(i),e.insertBefore(E,r),e.insertBefore(g,E),[E]}const u=this.findNodesBetween(s,r);if(c>0){const m=s.textContent??"",g=document.createElement("span");g.textContent=m.slice(0,c),this.inheritStyle(g,s),s.textContent=m.slice(c),e.insertBefore(g,s)}if(i>=0&&i<=(((p=r.textContent)==null?void 0:p.length)??0)){const m=r.textContent??"";if(r instanceof HTMLElement){r.textContent=m.slice(0,i);const g=document.createElement("span");g.textContent=m.slice(i),this.inheritStyle(g,r),e.insertBefore(g,r.nextSibling),u.push(r)}else{const g=document.createElement("span");g.textContent=m.slice(0,i),e.replaceChild(g,r);const E=document.createTextNode(m.slice(i));e.insertBefore(E,r.nextSibling),u.push(g)}}return u.unshift(s),u}setStyle(e,t){const l=this.extractNodesFromRange();if(l==null||l.length==0)return!1;let o=!0;const s=Dl(e),c=Fu(e,t);for(let r=0;r<l.length;r++){const i=l[r];if(i instanceof HTMLElement){this.matchElementStyle(i,s,c)||(o=!1);continue}const u=document.createElement("span");u.textContent=i.textContent,this.container.replaceChild(u,i),l[r]=u,o=!1}for(const r of l){if(o||c==null){this.removeElementStyle(r,s,c);continue}this.setElementStyle(r,s,c)}return this.focusNodes(l),!0}matchElementStyle(e,t,l){const o=e.style.getPropertyValue(t);return t==="text-decoration-line"?o.includes(l):o==l}setElementStyle(e,t,l){if(t==="text-decoration-line"){const o=e.style.getPropertyValue("text-decoration-line"),s=vt.push(o,l);e.style.setProperty("text-decoration-line",s);return}e.style.setProperty(t,l)}removeElementStyle(e,t,l){if(t==="text-decoration-line"){const o=e.style.getPropertyValue("text-decoration-line"),s=vt.remove(o,l);ae(s)?e.style.removeProperty("text-decoration-line"):e.style.setProperty("text-decoration-line",s);return}e.style.removeProperty(t)}onClick(e){const t=e.target;if(t instanceof HTMLElement&&t.matches("."+_l)){e.preventDefault(),e.stopPropagation(),this.focusNode(t);return}}}const Uu=[{label:"微软雅黑",value:"Microsoft YaHei"},{label:"宋体",value:oe.SONG},{label:"黑体",value:"黑体"},{label:"仿宋",value:"仿宋"},{label:"楷体",value:"楷体"}],us=[{label:"Arial",value:"Arial"},{label:"Consolas",value:"Consolas"},{label:"Times",value:"Times"},{label:"Times New Roman",value:"Times New Roman"}],ds=[{label:"默认",value:oe.DEFAULT},...us],wn=[{label:"默认",value:oe.DEFAULT},...Uu,...us],il=[{label:"默认",value:be.DEFAULT},{label:"初号",value:be.SIZE_0+"pt",short:"56px"},{label:"小初",value:be.SIZE_0_S+"pt",short:"≈49.33px"},{label:"一号",value:be.SIZE_1+"pt",short:"≈34.67px"},{label:"小一",value:be.SIZE_1_S+"pt",short:"32px"},{label:"二号",value:be.SIZE_2+"pt",short:"≈29.33px"},{label:"小二",value:be.SIZE_2_S+"pt",short:"24px"},{label:"三号",value:be.SIZE_3+"pt",short:"≈21.33px"},{label:"小三",value:be.SIZE_3_S+"pt",short:"20px"},{label:"四号",value:be.SIZE_4+"pt",short:"≈18.67px"},{label:"小四",value:be.SIZE_4_S+"pt",short:"16px"},{label:"五号",value:be.SIZE_5+"pt",short:"14px"},{label:"小五",value:be.SIZE_5_S+"pt",short:"12px"},{label:"12px",value:"12px"},{label:"13px",value:"13px"},{label:"14px",value:"14px"},{label:"15px",value:"15px"},{label:"16px",value:"16px"},{label:"18px",value:"18px"},{label:"20px",value:"20px"},{label:"22px",value:"22px"},{label:"24px",value:"24px"},{label:"28px",value:"28px"},{label:"32px",value:"32px"},{label:"36px",value:"36px"},{label:"42px",value:"42px"},{label:"48px",value:"48px"},{label:"56px",value:"56px"},{label:"72px",value:"72px"}],ps=[{label:"默认",value:ht.DEFAULT},{label:"1.0",value:ht.TIMES_1,short:"单倍行距"},{label:"1.1",value:ht.TIMES_1_1},{label:"1.5",value:ht.TIMES_1_5},{label:"2.0",value:ht.TIMES_2,short:"两倍行距"}],Hu=[{label:"无",value:sn.NONE},{label:"实线",value:Rt.SOLID},{label:"虚线",value:Rt.DASHED},{label:"点划线",value:Rt.DOTTED},{label:"双实线",value:Rt.DOUBLE},{label:"波浪线",value:Rt.WAVY}],Gu=[{label:"默认",value:gt.AUTO},{label:"左对齐",value:gt.LEFT},{label:"居中对齐",value:gt.CENTER},{label:"右对齐",value:gt.RIGHT},{label:"两端对齐",value:gt.JUSTIFY}],Vn=[{label:"顶部对齐",value:Ye.TOP,icon:"icon-vertical-align-top"},{label:"垂直居中",value:Ye.MIDDLE,icon:"icon-vertical-align-middl"},{label:"底部对齐",value:Ye.BOTTOM,icon:"icon-vertical-align-bottom"}],Fn=[{label:"左对齐",value:tt.LEFT,icon:"icon-align-left"},{label:"居中对齐",value:tt.CENTER,icon:"icon-align-center"},{label:"右对齐",value:tt.RIGHT,icon:"icon-align-right"},{label:"两端对齐",value:tt.JUSTIFY,icon:"icon-menu"}],Wu=x({__name:"ParagraphEditor",props:{element:{type:Bs,required:!0}},setup(n){const e=n,t=Ee(),l=ue(),o=N(()=>e.element.isSelected!==!0?!1:t.state.selectMode===ot.SINGLE);let s=null;const c=N(()=>wn.map(v=>(v.style={fontFamily:v.value==oe.DEFAULT?oe.SONG:v.value},v)));function r(){}async function i(){if(s==null)return;const v=await sl({doc:t.doc}).catch(et);if(v==null)return;const T=it(v.value,t.doc.ds)??v.value,C={type:zu.CONST,value:v.value,label:T};s.insertNode(C)}function u(){s==null||s.blur()}function p(){s==null||s.autosize()}function m(v){const T=e.element.ds.value,C=new Bu(v);return C.on("resize",I=>{var Y;const O=(Y=I.detail)==null?void 0:Y.height;O!=null&&e.element.setHeight(O+2)}),C.watch(()=>{const I=C.getHTML(),O=e.element.ds.value;I!==O&&(e.element.ds.value=I,C.checkHeight())}),ae(T)||C.setHTML(T),C}function g(v){s==null||s.setStyle("fontFamily",v.value)}function E(v){s==null||s.setStyle("fontSize",v.value)}function b(v){s==null||s.setStyle("lineHeight",v.value)}function a(v){s==null||s.setStyle("backgroundColor",v)}function y(v){s==null||s.setStyle("color",v)}function R(){s==null||s.setStyle("fontWeight","700")}function A(){s==null||s.setStyle("fontStyle","italic")}function k(){s==null||s.setStyle("textDecorationLine","underline")}function S(){s==null||s.setStyle("textDecorationLine","line-through")}return Jn(()=>e.element.ds.value,v=>{s==null||s.getHTML()==v||s.setHTML(v)}),Jt(()=>{e.element.on("blur",u),s=m(l.value)}),Kn(()=>{e.element.off("blur",u),s&&s.cleanup()}),(v,T)=>(w(),L("div",{class:h(v.classes.paragraph),onPointerdown:T[2]||(T[2]=ie(()=>{},["stop"])),onContextmenu:ie(r,["stop","prevent"])},[d("div",{class:h(v.classes.indicator),onPointerdown:T[0]||(T[0]=(...C)=>_(t).onDragStart&&_(t).onDragStart(...C)),title:"选中/拖动段落"},null,34),o.value?(w(),L("div",{key:0,class:h(v.classes.toolbar),onMousedown:T[1]||(T[1]=ie(()=>{},["prevent"]))},[f(_(J),{onSelect:g,title:"字体",width:"60px",options:c.value,class:h(v.classes.tool),button:""},null,8,["options","class"]),f(_(J),{onSelect:E,title:"字号",width:"60px",options:_(il),class:h(v.classes.tool),button:""},null,8,["options","class"]),f(_(J),{onSelect:b,title:"行高",width:"60px",options:_(ps),class:h(v.classes.tool),popoverWidth:120,button:""},null,8,["options","class"]),d("div",{class:h(v.classes.divider)},null,2),f(lt,{class:h(v.classes.tool),onSelect:a},{default:he(()=>[d("div",{class:h(v.classes.colorIcon),title:"突出显示"},[f(_(D),{icon:"icon-bg-color-b",size:"15px"}),d("div",{class:h(v.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),f(lt,{class:h(v.classes.tool),onSelect:y},{default:he(()=>[d("div",{class:h(v.classes.colorIcon),title:"字体颜色"},[f(_(D),{icon:"icon-font",size:"15px"}),d("div",{class:h(v.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),d("button",{onClick:R,type:"button",title:"加粗",class:h(["quickprint-text-btn",v.classes.tool])},[f(_(D),{icon:"icon-font-bold",size:"16px"})],2),d("button",{onClick:A,type:"button",title:"斜体",class:h(["quickprint-text-btn",v.classes.tool])},[f(_(D),{icon:"icon-italic",size:"16px"})],2),d("button",{onClick:k,type:"button",title:"下划线",class:h(["quickprint-text-btn",v.classes.tool])},[f(_(D),{icon:"icon-underline",size:"16px"})],2),d("button",{onClick:S,type:"button",title:"删除线",class:h(["quickprint-text-btn",v.classes.tool])},[f(_(D),{icon:"icon-through-line",size:"16px"})],2),d("div",{class:h(v.classes.divider)},null,2),d("button",{class:"quickprint-text-btn",type:"button",onClick:i},[f(_(D),{icon:"icon-insert-var",size:"16px"}),T[3]||(T[3]=d("span",null,"插入变量",-1))]),d("button",{class:"quickprint-text-btn",type:"button",onClick:p},[f(_(D),{icon:"icon-colum-height",size:"16px"}),T[4]||(T[4]=d("span",null,"调整高度",-1))])],34)):U("",!0),d("div",{ref_key:"editorRef",ref:l,class:h(v.classes.editor)},null,2)],34))}}),Yu="_paragraph_1v2pj_2",Xu="_indicator_1v2pj_6",ju="_editor_1v2pj_18",Zu="_toolbar_1v2pj_44",Ku="_tool_1v2pj_44",Ju="_colorIcon_1v2pj_66",Qu="_colorIndicator_1v2pj_86",ed="_divider_1v2pj_95",td={paragraph:Yu,indicator:Xu,editor:ju,toolbar:Zu,tool:Ku,colorIcon:Ju,colorIndicator:Qu,divider:ed},nd={classes:td},ld=P(Wu,[["__cssModules",nd]]),Sn=Object.freeze({title:"段落",type:X.PARAGRAPH,icon:"icon-paragraph",features:{draggable:!1,contextMenu:!1},editor:ld,config:{exclude:[re.DATASOURCE,re.BASIC,re.OVERFLOW]},onCreate(){return ve.create({type:X.PARAGRAPH,width:Et*4,height:vn*6})}}),fs=[yn,_n,En,Tn,ol,as,Sn],sd=[yn,_n,En,Tn,Sn],od={[X.TEXT]:yn.editor,[X.NUMBER]:_n.editor,[X.DATE]:En.editor,[X.TABLE]:Tn.editor,[X.TABLE_CELL]:ol.editor,[X.PARAGRAPH]:Sn.editor},id={[X.TEXT]:yn.config,[X.NUMBER]:_n.config,[X.DATE]:En.config,[X.TABLE]:Tn.config,[X.TABLE_CELL]:ol.config,[X.TABLE_ROW]:as.config,[X.PARAGRAPH]:Sn.config},Ft=fs.reduce((n,e)=>(n[e.type]=e,n),{});function rd(n){const e=fs.find(t=>t.type===n);if(e==null||typeof e.onCreate!="function")throw new Error("未知的打印元素");return e.onCreate()}function ad(n){return Reflect.get(od,n)}function Nt(n){return Reflect.get(id,n)}function jt(n){var e;return((e=Ft[n])==null?void 0:e.title)??n}function cd(n){var e;return(e=Ft[n])==null?void 0:e.icon}function ud(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.selection)!==!1}function dd(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.contextMenu)!==!1}function pd(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.resizable)!==!1}function fd(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.draggable)!==!1}function El(n,e,t,l){const[o,s]=e.top>t.top?[t,e]:[e,t],c=o.top-l.top,r=s.bottom-o.top;return{top:c,left:n,height:r}}function Tl(n,e,t,l){const[o,s]=e.left>t.left?[t,e]:[e,t],c=o.left-l.left,r=s.right-o.left;return{top:n,left:c,width:r}}function kl(n,e){const t=n.find(i=>i.left===e.left);if(t==null||t.height==null)return n.push(e);const l=e.top+e.height,o=t.top+t.height,s=Math.min(t.top,e.top),r=Math.max(l,o)-s;t.top=s,t.height=r}function wl(n,e){const t=n.find(i=>i.top===e.top);if(t==null||t.width==null)return n.push(e);const l=e.left+e.width,o=t.left+t.width,s=Math.min(t.left,e.left),r=Math.max(l,o)-s;t.left=s,t.width=r}function md(n){const e=document.createElement("div");return n.appendChild(e),e}function hd(n,e){const t=[...e.querySelectorAll(":scope ."+G.GUIDE_LINE)];for(const l of n){const o=t.shift()??md(e);o.className=G.GUIDE_LINE,o.style.top=l.top+"px",o.style.left=l.left+"px",o.style.height=(l.height??1)+"px",o.style.width=(l.width??1)+"px"}for(const l of t)l.remove()}function gd(n,e){const l=e.querySelectorAll(":scope ."+G.ELEMENT),o=e.getBoundingClientRect(),s=n.getBoundingClientRect(),c=[];for(const r of l){if(n==r)continue;const i=r.getBoundingClientRect();if(Math.abs(s.left-i.left)<=1||Math.abs(s.right-i.left)<=1){const u=i.left-o.left;kl(c,El(u,s,i,o))}if(Math.abs(s.left-i.right)<=1||Math.abs(s.right-i.right)<=1){const u=i.right-o.left;kl(c,El(u,s,i,o))}if(Math.abs(s.top-i.top)<=1||Math.abs(s.bottom-i.top)<=1){const u=i.top-o.top;wl(c,Tl(u,s,i,o))}if(Math.abs(s.bottom-i.bottom)<=1||Math.abs(s.top-i.bottom)<=1){const u=i.bottom-o.top;wl(c,Tl(u,s,i,o))}}hd(c,e)}function vd(){const n=document.querySelectorAll("."+G.GUIDE_LINE);for(const e of n)e.remove()}const mn={create:fi(gd,50),clean:vd};async function bd(n){await hn(),n&&Reflect.deleteProperty(n,gn)}async function yd(n,e){if(await Promise.resolve(),e.dropTarget==null){e.indicatorElement&&(e.indicatorElement.style.display="none");return}if(e.indicatorElement==null){const s=document.createElement("div");s.className="quickprint-is-indicator",e.indicatorElement=s,document.body.appendChild(s)}const t=_d(n,e);if(t==null){e.indicatorElement.style.display="none";return}const l=e.indicatorElement,o=e.ghost.getBoundingClientRect();l.style.display="block",l.style.left=o.left+"px",l.style.top=o.top-Xl(e.element)+"px",l.textContent=`x:${t.x},y:${t.y},w:${t.w},h:${t.h}`}function _d(n,e){const t=e.dropTarget;if(t==null)return null;const l=n.doc.useGrid;if(e.mode===Re.INSERT){const o=t.closest("."+G.PAGE);if(o==null)return null;const s=o.getBoundingClientRect();return{x:l?It(e.left-s.left):Math.round(e.left-s.left),y:l?It(e.top-s.top):Math.round(e.top-s.top),w:e.element.width,h:e.element.height}}return{x:l?It(e.left):Math.round(e.left),y:l?It(e.top):Math.round(e.top),w:e.element.width,h:e.element.height}}function Ed(n){return!(n.style.rotate&&!n.isSelected)}function Td(n){const e=new Mn({selector:{container:G.DROPPABLE},scale(t){return t.mode===Re.INSERT?100:n.state.scale}});return e.on("before-dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const o=Reflect.get(l.target,zl),s=Reflect.get(l.target,Qn);o===Re.INSERT&&(l.container=n.component.queryElement("root"),l.ghost=n.component.queryElement("ghost")),l.mode=o===Re.INSERT?o:Re.MOVE,l.elementType=s,l.initDragElement=!1}),e.on("dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();if(l.mode===Re.INSERT){const s=rd(l.elementType);l.element=s,l.ghost.style.width=s.width+"px",l.ghost.style.height=s.height+"px";return}const o=Reflect.get(l.target,Xe);if(o==null||!Ed(o))return t.preventDefault();l.element=o}),e.on("dragging",t=>{const l=t.detail;l!=null&&(l.initDragElement!==!0&&(l.mode===Re.INSERT&&(l.ghost.style.display="block"),l.mode===Re.MOVE&&Reflect.set(l.target,gn,el.DRAG_ELEMENT),l.ghost.classList.add(G.DRAGGING),l.initDragElement=!0),yd(n,l),l.dropTarget&&mn.create(l.ghost,l.dropTarget))}),e.on("dragend",t=>{const l=t.detail;if(l==null||l.initDragElement!==!0)return;mn.clean(),l.ghost.classList.remove(G.DRAGGING),l.indicatorElement&&document.body.removeChild(l.indicatorElement),l.mode===Re.INSERT&&(l.ghost.style.display="none"),l.mode==Re.MOVE&&bd(l.target);const o=l.element;if(l.mode==Re.MOVE){o.setTop(l.top),o.setLeft(l.left),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),n.selectElement(o),n.createSnapshot();return}if(l.dropTarget==null)return;const s=Reflect.get(l.dropTarget,Bl);if(s==null)return;const c=s instanceof kt||s instanceof ve?s:null;if(c==null)return;const r=l.dropTarget.getBoundingClientRect(),i=n.state.scale/100;o.setTop((l.top-r.top)/i),o.setLeft((l.left-r.left)/i),o.setWidth(o.width/i),o.setHeight(o.height/i),c.append(l.element),n.selectElement(o),n.createSnapshot()}),n.onDragStart=e.onDragStart,e}const Sl="quickprint-history-0000",kd=1,Ze="snapshot",an="health",Cl="owner",Ue="INDEX_OWNER",wd=15*60*1e3,Sd=10*60*1e3;function Cd(){const n={db:null,timer:null,promise:null};async function e(){const p=await i(an,"readwrite");if(p==null)return n.timer=s(),!1;const m=[],g=p.openCursor();g.onsuccess=async function(E){const b=E.target.result;if(b==null){t(m),n.timer=s(),Le.debug("History","已检查无效快照");return}const a=b.value;a!=null&&Date.now()-a.timestamp>wd&&m.push(a),b.continue()},g.onerror=function(E){console.error(E),n.timer=s()}}async function t(p){const m=await Promise.allSettled(p.map(g=>l(g.owner)));for(let g=0;g<m.length;g++){const E=m[g];E.status==="rejected"||E.value!==!0||o(p[g].id)}}async function l(p){const m=await i(Ze,"readwrite");return m==null?!1:new Promise(g=>{const E=m.index(Ue).openCursor(IDBKeyRange.only(p));E.onsuccess=function(b){const a=b.target.result;if(a==null)return g(!0);a.delete(),a.continue()},E.onerror=function(b){console.error(b),g(!1)}})}async function o(p){const m=await i(an,"readwrite");return m==null?!1:Wt(m.delete(p)).then(()=>!0).catch(g=>(console.log(g),!1))}function s(){return n.timer&&clearTimeout(n.timer),setTimeout(()=>e(),Sd)}function c(){return new Promise(p=>{const m=indexedDB.open(Sl,kd);m.onupgradeneeded=g=>{const b=g.target.result,a=b.createObjectStore(an,{keyPath:"id",autoIncrement:!0}),y=b.createObjectStore(Ze,{keyPath:"id",autoIncrement:!0});a.createIndex(Ue,Cl),y.createIndex(Ue,Cl)},m.onsuccess=g=>{const E=g.target;n.db=E.result,Le.debug("History",`已连接数据库【${Sl}】`),p(n.db)},m.onerror=function(g){console.error(g),n.db=null,p(null)}})}function r(){return n.promise==null?Promise.resolve(n.db):n.promise}async function i(p,m="readonly"){const g=await r();if(g==null)return null;try{return g.transaction(p,m).objectStore(p)}catch(E){return console.error(E),null}}function u(){n.promise=null,n.db&&(n.db.close(),n.db=null),n.timer&&(clearTimeout(n.timer),n.timer=null)}return n.promise=c(),n.timer=s(),e(),{ready:r,findStore:i,cleanup:u}}function Wt(n){return new Promise((e,t)=>{n.onsuccess=function(l){const o=l.target;e(o.result)},n.onerror=function(l){console.error(l),t()}})}const Rd=5*60*1e3,pt=Cd();var He,Ae,cn,zn,ms;class Ld{constructor(e,t={}){Be(this,Ae);F(this,"state");F(this,"owner");Be(this,He);this.state=e,this.owner=t.owner??Us(Hs.HISTORY_OWNER),we(this,Ae,zn).call(this)}get index(){return this.state.index}get count(){return this.state.count}async createSnapshot(e,t){const l=await pt.findStore(Ze,"readwrite");if(l==null)return!1;await we(this,Ae,ms).call(this,l);const o=this.state.index+1,s={index:o,data:JSON.stringify(e),timestamp:Date.now(),owner:this.owner,action:t==null?void 0:t.action};return await Wt(l.put(s)).catch(et)==null?!1:(this.state.index=o,this.state.count=o+1,!0)}async replaceSnapshot(e,t){const l=await this.getCurrentSnapshot();if(l==null||l.action!==t.action)return this.createSnapshot(e,t);const o=await pt.findStore(Ze,"readwrite");return!(o==null||(l.data=JSON.stringify(e),await Wt(o.put(l)).catch(et)==null))}async getCurrentSnapshot(){const e=await pt.findStore(Ze);if(e==null)return null;const t=this.index;if(t<0)return null;const l=this.owner;return new Promise(o=>{const s=e.index(Ue).openCursor(IDBKeyRange.only(l),"prev");s.onsuccess=c=>{const r=c.target.result;if(r==null)return o(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return o(i);r.continue()},s.onerror=function(c){console.error(c),o(null)}})}async getPrevSnapshot(){const e=await pt.findStore(Ze);if(e==null)return null;const t=this.state.index-1;if(t<0)return null;const l=this.owner;return new Promise(o=>{const s=e.index(Ue).openCursor(IDBKeyRange.only(l),"prev");s.onsuccess=c=>{const r=c.target.result;if(r==null)return o(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return this.state.index=t,o(r.value);r.continue()},s.onerror=function(c){console.error(c),o(null)}})}async getNextSnapshot(){const e=await pt.findStore(Ze);if(e==null)return null;const t=this.state.index+1;if(t>this.state.count-1)return null;const l=this.owner;return new Promise(o=>{const s=e.index(Ue).openCursor(IDBKeyRange.only(l),"next");s.onsuccess=c=>{const r=c.target.result;if(r==null)return o(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return this.state.index=t,o(r.value);r.continue()},s.onerror=function(c){console.error(c),o(null)}})}async getUsageSpace(){const e=await navigator.storage.estimate(),t=e.usage;return t==null?null:{usage:t/1024/1024,percent:e.quota?t/e.quota*100:-1}}async list(){const e=await pt.findStore(Ze);if(e==null)return[];const t=this.owner;return new Promise(l=>{const o=e.index(Ue).openCursor(IDBKeyRange.only(t),"prev"),s=[];o.onsuccess=c=>{const r=c.target.result;if(r==null)return l(s);const i=r.value;if(i.owner!=t)return r.continue();s.push(i),r.continue()},o.onerror=function(c){console.error(c),l([])}})}cleanup(){ke(this,He)&&(clearTimeout(ke(this,He)),ut(this,He,null))}}He=new WeakMap,Ae=new WeakSet,cn=function(){ut(this,He,setTimeout(()=>we(this,Ae,zn).call(this),Rd))},zn=async function(){ke(this,He)&&clearTimeout(ke(this,He));const e=await pt.findStore(an,"readwrite");if(e==null)return we(this,Ae,cn).call(this);const t=await Wt(e.index(Ue).get(this.owner)).catch(et);if(t==null){const l={owner:this.owner,timestamp:Date.now()};return e.add(l),we(this,Ae,cn).call(this)}t.timestamp=Date.now(),await Wt(e.put(t)).catch(et),we(this,Ae,cn).call(this)},ms=function(e){const t=this.state.index,l=this.state.count;if(t<0||t==l-1)return Promise.resolve(!0);const o=this.owner;return new Promise(s=>{const c=e.index(Ue).openCursor(IDBKeyRange.only(o),"prev");c.onsuccess=function(r){const i=r.target.result;if(i==null)return s(!0);const u=i.value;if(u.owner!=o)return i.continue();if(u.index>t){i.delete(),i.continue();return}s(!0)},c.onerror=function(r){console.error(r),s(!1)}})};function Nd(n){const e=new Ld(De({index:-1,count:0}));function t(){return e.index>0}function l(){return e.index>=0&&e.index<e.count-1}function o(p){return e.createSnapshot(n.value,p)}function s(p){return e.replaceSnapshot(n.value,p)}async function c(){const p=await e.getPrevSnapshot();if(p==null)return!1;const m=qn(p.data);return m==null?!1:(n.value=ge.create(m),!0)}async function r(){const p=await e.getNextSnapshot();if(p==null)return!1;const m=qn(p.data);return m==null?!1:(n.value=ge.create(m),!0)}function i(){return e.list()}function u(){e.cleanup()}return o(),{allowRedo:l,allowUndo:t,createSnapshot:o,undo:c,redo:r,list:i,cleanup:u,replaceSnapshot:s}}class Id{constructor(e){F(this,"moved",!1);F(this,"position");F(this,"top",0);F(this,"left",0);F(this,"width",0);F(this,"height",0);F(this,"initX",0);F(this,"initY",0);F(this,"indicator");F(this,"container");F(this,"originalEvent");F(this,"target");this.indicator=e.indicator,this.container=e.container,this.target=e.target,this.originalEvent=e.event,this.position=e.position,this.initX=e.event.clientX,this.initY=e.event.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.width=t.width/e,this.height=t.height/e,this.indicator.setPointerCapture(this.originalEvent.pointerId)}}var Ot,Mt,at,hs,gs,vs;const Te=class Te extends pn{constructor(t={}){var l,o,s;super();Be(this,at);F(this,"context",null);F(this,"selector");F(this,"scale");F(this,"onResizeStart");Be(this,Ot);Be(this,Mt);this.scale=t.scale,this.selector={container:((l=t.selector)==null?void 0:l.container)??G.PAGE,element:((o=t.selector)==null?void 0:o.element)??G.RESIZEABLE,indicator:((s=t.selector)==null?void 0:s.indicator)??G.RESIZEABLE_INDICATOR},this.onResizeStart=we(this,at,hs).bind(this),ut(this,Ot,we(this,at,gs).bind(this)),ut(this,Mt,we(this,at,vs).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){if(this.context==null)return;const t=this.context.indicator;t&&t.releasePointerCapture(this.context.originalEvent.pointerId),window.removeEventListener("pointermove",ke(this,Ot)),window.removeEventListener("pointerup",ke(this,Mt)),this.context=null}};Ot=new WeakMap,Mt=new WeakMap,at=new WeakSet,hs=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.indicator);if(l==null)return Le.warn(Te.TAG_NAME,"未找到的可调整元素");const o=Reflect.get(l,Ul);if(o==null)return Le.warn(Te.TAG_NAME,"未找到的可调整元素");const s=l.closest("."+this.selector.element);if(s==null)return Le.warn(Te.TAG_NAME,"未找到的可调整元素");const c=Yl(s,this.selector.container);this.context=new Id({event:t,indicator:l,target:s,container:c,position:o});const r=this.createEvent("before-resizestart",this.context);if(this.dispatch(r).defaultPrevented)return Le.warn(Te.TAG_NAME,"已取消调整");if(this.context.container==null)return Le.warn(Te.TAG_NAME,"未找到的调整元素的容器");this.context.init(this.normalizeScale()),t.stopPropagation(),t.preventDefault();const i=this.createEvent("resizestart",this.context);if(this.dispatch(i).defaultPrevented)return Le.warn(Te.TAG_NAME,"已取消调整");window.addEventListener("pointermove",ke(this,Ot)),window.addEventListener("pointerup",ke(this,Mt))},gs=function(t){const l=this.context;if(l==null)return;const o=l.position,s=this.normalizeScale(),c=l.container.getBoundingClientRect(),r=l.target.getBoundingClientRect();if(o&Gt.TOP){const u=Math.max((r.bottom-t.clientY)/s,Te.MIN_LENGTH);l.top=(r.bottom-c.top)/s-u,l.height=u}if(o&Gt.BOTTOM&&(l.height=Math.max((t.clientY-r.top)/s,Te.MIN_LENGTH)),o&Gt.LEFT){const u=Math.max((r.right-t.clientX)/s,Te.MIN_LENGTH);l.left=(r.right-c.left)/s-u,l.width=u}o&Gt.RIGHT&&(l.width=Math.max((t.clientX-r.left)/s,Te.MIN_LENGTH));const i=this.createEvent("resizing",l);this.dispatch(i).defaultPrevented||(l.target.style.top=l.top+"px",l.target.style.left=l.left+"px",l.target.style.width=l.width+"px",l.target.style.height=l.height+"px")},vs=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const o=this.createEvent("resizeend",l);this.dispatch(o).defaultPrevented||this.reset()},F(Te,"TAG_NAME","quickprint-resizeable"),F(Te,"MIN_LENGTH",12);let Bn=Te;async function $d(n,e){if(await Promise.resolve(),e.indicatorElement==null){const r=document.createElement("div");r.className="quickprint-is-indicator",e.indicatorElement=r,document.body.appendChild(r)}const t=n.doc.useGrid,l=t?It(e.width):Math.round(e.width),o=t?It(e.height):Math.round(e.height),s=e.indicatorElement,c=e.target.getBoundingClientRect();s.style.display="block",s.style.left=c.left+"px",s.style.top=c.top-Xl(e.element)+"px",s.textContent=`x:${e.top},y:${e.left},w:${l},h:${o}`}function xd(n){const e=new Bn({scale:()=>n.state.scale});return e.on("resizestart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const o=Reflect.get(l.target,Xe);if(o==null)return t.preventDefault();l.element=o}),e.on("resizing",t=>{const l=t.detail;l!=null&&($d(n,l),mn.create(l.target,l.container))}),e.on("resizeend",t=>{const l=t.detail;if(l==null)return;l.indicatorElement&&document.body.removeChild(l.indicatorElement);const o=l.element;o.setTop(l.top),o.setLeft(l.left),o.setWidth(l.width),o.setHeight(l.height),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),l.target.style.removeProperty("width"),l.target.style.removeProperty("height"),n.createSnapshot(),mn.clean()}),n.onResizeStart=e.onResizeStart,e}function Ad(n){function e(s){const c=document.activeElement,r=s.target;return c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c.isContentEditable===!0||r.closest(".quickprint-text-editor")!=null}function t(s){if(!(e(s)||Gs()))switch(s.key){case"Delete":case"Backspace":return s.preventDefault(),n.deleteSelectedElement();case"Y":case"y":if(s.ctrlKey)return s.preventDefault(),n.history.redo();case"Z":case"z":if(s.ctrlKey)return s.preventDefault(),n.history.undo();case"ArrowUp":case"ArrowDown":{const c=n.getSelectedElements();if(c.length==0)return;s.preventDefault(),s.stopPropagation();const r=s.key==="ArrowUp"?-1:1,i=c.map(u=>u.setTop(u.top+r,!0)?u:null).filter(u=>u!=null);i.length>0&&n.replaceSnapshot("top",i);return}case"ArrowLeft":case"ArrowRight":{const c=n.getSelectedElements();if(c.length==0)return;s.preventDefault(),s.stopPropagation();const r=s.key==="ArrowLeft"?-1:1,i=c.map(u=>u.setLeft(u.left+r,!0)?u:null).filter(u=>u!=null);i.length>0&&n.replaceSnapshot("left",i);return}case"P":case"p":if(s.ctrlKey)return s.preventDefault(),n.component.dispatchEvent("preview");case"S":case"s":if(s.ctrlKey)return s.preventDefault(),n.component.dispatchEvent("save");case"A":case"a":if(s.ctrlKey){s.preventDefault();const r=n.doc.pages.reduce((i,u)=>i.concat(u.children),[]);return n.multiSelectElements(r)}}}function l(){window.addEventListener("keydown",t)}function o(){window.removeEventListener("keydown",t)}return{enable:l,disable:o}}const bs=Symbol();function Dd(){return{panel:{left:!0,right:!0},scale:100,selectedType:me.NONE,selectedPage:void 0,selectMode:ot.SINGLE,selected:[]}}function qd(n,e){const t=De(Dd()),l=Nd(n),s={get doc(){return n.value},history:l,document:n,state:t,component:e,setDocument:i,selectPage:m,selectElement:g,resetSelectedElement:E,deleteSelectedElement:b,multiSelectElements:a,zoomIn:R,zoomOut:y,toggleBackground:A,toggleElementPanel:k,toggleConfigPanel:S,getSelectedElements:u,getSelectedPage:p,cleanup:T,replaceSnapshot:v},c=Td(s),r=xd(s);s.shortcut=Ad(s),s.createSnapshot=l.createSnapshot;function i(C){s.document.value=C,s.history.createSnapshot()}function u(){const C=t.selected;return C.length==0?[]:C.map(I=>s.doc.findElement(I)).filter(I=>I!=null)}function p(){var I;const C=t.selectedPage;if(C!=null)return(I=n.value)==null?void 0:I.findPage(C)}function m(C){return E(),t.selectedPage=C.id,t.selectedType=me.PAGE,!0}function g(C){t.selectMode=ot.SINGLE,t.selectedType=me.ELEMENT,t.selectedPage=void 0;const I=u();for(const O of I)O.id!==C.id&&O.blur();return C.focus(),t.selected=[C.id],!0}function E(){const C=u();for(const I of C)I.blur();return t.selected=[],t.selectedType=me.NONE,!0}function b(){if(t.selectedType!=me.ELEMENT||t.selected.length==0)return!1;let C=!1;const I=u();for(const O of I)O.remove()&&(C=!0);return C&&s.history.createSnapshot(),!0}function a(C){t.selectMode=ot.MULTIPLE,t.selectedType=me.ELEMENT,t.selectedPage=void 0;const I=u();for(const O of I)O.blur();for(const O of C)O.focus();return t.selected=C.map(O=>O.id),!0}function y(){const C=t.scale??100,I=Ut.indexOf(C);return I<0?(t.scale=100,!1):I>=Ut.length-1?!1:(t.scale=Ut[I+1],!0)}function R(){const C=t.scale??100,I=Ut.indexOf(C);return I<0?(t.scale=100,!1):I==0?!1:(t.scale=Ut[I-1],!0)}function A(){const I=s.doc.attributes.grid==null?!0:void 0;s.doc.attributes.grid=I}function k(){s.state.panel.left=!s.state.panel.left}function S(){s.state.panel.right=!s.state.panel.right}function v(C,I){const O=I??s.doc,Y=Array.isArray(O)?"element":O instanceof ge?"document":O instanceof kt?"page":"element",H=Array.isArray(O)?O.map(j=>j.id).join(","):O.id,q=`${Y}:${H}:${C}`;return console.log(q),l.replaceSnapshot({action:q})}function T(){c.cleanup(),r.cleanup(),l.cleanup(),s.shortcut.disable(),s.doc.cleanup()}return s.shortcut.enable(),s.selectPage(n.value.firstPage),Vl(bs,s),Kn(T),s}function Ee(){return Pl(bs)}const Od=x({__name:"Ruler",props:{direction:{type:String,default:"horizontal"},canvas:{type:Object,required:!0},page:{type:Object,required:!0},scale:{type:Number,default:100}},setup(n){const e=n,t=Ie("classes"),l=Ee(),o=N(()=>({[t.horizontalRuler]:e.direction==="horizontal",[t.verticalRuler]:e.direction==="vertical"})),s=N(()=>{const a=e.page.id,y=l.doc.pages.find(R=>R.id===a);return y==null?0:e.direction=="horizontal"?y.width:y.height}),c=N(()=>{const a=s.value,y=[];for(let R=0;R<=a;R+=10)y.push(R/10);return y}),r=N(()=>{const a=s.value,y=[];for(let R=0;R<=a;R+=2.5)y.push(R);return y}),i=N(()=>{const a=l.getSelectedElements();return a.length==1?a[0]:null}),u=N(()=>e.direction==="horizontal"?{height:"100%",width:s.value*e.scale/100+"mm",left:e.page.left+"px",transform:`translateX(${-e.canvas.scrollLeft}px)`}:{width:"100%",height:s.value*e.scale/100+"mm",top:e.page.top+"px",transform:`translateY(${-e.canvas.scrollTop}px)`}),p=N(()=>{const a=i.value;if(a==null)return 0;if(a.type==="TableCell"){const y=a.parent;if(y==null)return 0;const R=y.parent;return y==null?0:R.top+y.offsetTop}if(a.type==="TableRow"){const y=a.parent;return y==null?0:y.top+a.offsetTop}return a.top}),m=N(()=>{const a=i.value;if(a==null)return 0;if(a.type==="TableCell"){const y=a.parent;if(y==null)return 0;const R=y.parent;return y==null?0:R.left+a.offsetLeft}if(a.type==="TableRow"){const y=a.parent;return y==null?0:y.left}return a.left});function g(a,y){return e.direction==="horizontal"?{left:a*(e.scale/100)+"mm",height:(y-2)%4==0?"8px":"4px"}:{top:a*(e.scale/100)+"mm",width:(y-2)%4==0?"8px":"4px"}}function E(a){return e.direction==="horizontal"?{left:a*(e.scale/100)+"cm"}:{top:a*(e.scale/100)+"cm"}}function b(a){return e.direction==="horizontal"?{left:m.value*(e.scale/100)+"px",width:a.width*(e.scale/100)+"px",height:"100%"}:{top:p.value*(e.scale/100)+"px",height:a.height*(e.scale/100)+"px",width:"100%"}}return(a,y)=>(w(),L("div",{class:h(o.value)},[d("div",{class:h(_(t).ruler),style:Z(u.value)},[i.value?(w(),L("div",{key:0,class:h(_(t).selected),style:Z(b(i.value))},null,6)):U("",!0),(w(!0),L(W,null,te(r.value,(R,A)=>(w(),L("div",{key:R,class:h(_(t).scale),style:Z(g(R,A))},null,6))),128)),(w(!0),L(W,null,te(c.value,R=>(w(),L("div",{class:h(_(t).number),style:Z(E(R))},z(R),7))),256))],6)],2))}}),Md="_horizontalRuler_170u5_2",Pd="_verticalRuler_170u5_15",Vd="_ruler_170u5_27",Fd="_scale_170u5_32",zd="_number_170u5_46",Bd="_selected_170u5_71",Ud={horizontalRuler:Md,verticalRuler:Pd,ruler:Vd,scale:Fd,number:zd,selected:Bd},Hd={classes:Ud},Rl=P(Od,[["__cssModules",Hd]]),Gd=["title"],nn=8,Wd=x({__name:"DragLine",props:{top:{type:Number,default:0},zoom:{type:Number,default:1},title:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:null},max:{type:Number,default:null}},emits:["move"],setup(n,{emit:e}){const t=n,l=e,o=Ie("classes"),s={},c=Ee(),r=N(()=>({top:Math.round(t.top*t.zoom)+"px"}));function i(g){if(g.button!=0||t.disabled===!0)return;const E=g.target.closest("."+o.dragLine);E!=null&&(g.stopPropagation(),s.init=!1,s.target=E,s.parent=E.offsetParent,s.target.setPointerCapture(g.pointerId),window.addEventListener("pointermove",u),window.addEventListener("pointerup",p))}function u(g){g.preventDefault();const E=m(s.parent);let b=g.clientY-E.top;b<0&&(b=0),b>E.height&&(b=E.height),t.min>0&&b<t.min+nn&&(b=t.min+nn),t.max>0&&b>t.max-nn&&(b=t.max-nn),s.target.style.top=b/(c.state.scale/100)+"px",s.top=b,s.init=!0}function p(g){s.init===!0&&l("move",{top:s.top/(c.state.scale/100)}),s.target.releasePointerCapture(g.pointerId),window.removeEventListener("pointermove",u),window.removeEventListener("pointerup",p)}function m(g){return g instanceof HTMLElement?g.getBoundingClientRect():new DOMRect(0,0,window.innerWidth,window.innerHeight)}return(g,E)=>(w(),L("div",{class:h({[_(o).dragLine]:!0,[_(o).disabled]:n.disabled}),style:Z(r.value),onPointerdown:ie(i,["stop"]),title:n.title},null,46,Gd))}}),Yd="_dragLine_1m7rt_2",Xd="_disabled_1m7rt_26",jd={dragLine:Yd,disabled:Xd},Zd={classes:jd},Ll=P(Wd,[["__cssModules",Zd]]),Kd=x({__name:"Selection",setup(n,{expose:e}){const t=ue(),l=ue(),o=Vt("selectionRef"),s=ue(),c=Ee();let r=[];function i(){return{init:!1,initialX:0,initialY:0,top:0,left:0}}function u(){const b=[],a=l.value;if(a==null)return b;const y=p(a);if(y.length==0)return b;const R=o.value;return y.forEach(A=>{if(!yo(A,R)){A.classList.remove(G.SELECTED);return}const k=Reflect.get(A,Xe);k instanceof ve&&(A.classList.add(G.SELECTED),b.push(k))}),b}function p(b){if(b.matches("."+G.ELEMENT)){const a=Reflect.get(b,Xe);if(a&&a.type===X.TABLE)return b.querySelectorAll(":scope td")}return b.querySelectorAll(`:scope .${G.PAGE} > .${G.SELECTABLE}`)}function m(b,a){const y=a.closest("."+G.PAPER);if(y==null)return;b.stopPropagation(),b.preventDefault();const R=i(),A=y.getBoundingClientRect();R.initialX=b.clientX,R.initialY=b.clientY,R.top=b.clientY-A.top,R.left=b.clientX-A.left,l.value=a,s.value=R,t.value=y,r=[],window.addEventListener("pointermove",g),window.addEventListener("pointerup",E)}function g(b){const a=s.value;if(a==null)return;b.stopPropagation(),b.preventDefault();const y=o.value;if(a.init!==!0){if(Math.abs(b.clientX-a.initialX)<4&&Math.abs(b.clientY-a.initialY)<4)return;y.setPointerCapture(b.pointerId),y.style.display="block",a.init=!0}const R=Math.abs(b.clientX-a.initialX),A=Math.abs(b.clientY-a.initialY),k=b.clientX<a.initialX?-R:0,S=b.clientY<a.initialY?-A:0;y.style.top=a.top+S+"px",y.style.left=a.left+k+"px",y.style.width=R+"px",y.style.height=A+"px",r=u()}function E(b){const a=s.value;if(a==null)return;a.init&&(b.stopPropagation(),b.preventDefault()),r.length>0&&c.multiSelectElements(r);const y=o.value;y.releasePointerCapture(b.pointerId),y.style.display="none",s.value=void 0,window.removeEventListener("pointermove",g),window.removeEventListener("pointerup",E)}return e({onSelectStart:m}),(b,a)=>(w(),L("div",{ref_key:"selectionRef",ref:o,class:h(b.classes.selection),onClick:a[0]||(a[0]=ie(()=>{},["stop"]))},null,2))}}),Jd="_selection_10jfe_2",Qd={selection:Jd},ep={classes:Qd},tp=P(Kd,[["__cssModules",ep]]),np={class:"quickprint-is-row"},lp=["onClick"],sp=x({__name:"FontSize",props:{modelValue:{type:String,default:null},height:{type:String,default:"100%"}},emits:["update:modelValue","update:unit"],setup(n,{emit:e}){const t=[{value:"px",label:"像素"},{value:"pt",label:"磅"}],l=Ie("classes"),o=e,s=n,c=ue(),r=N(()=>({height:s.height})),i=N({get(){return We(s.modelValue).num??void 0},set(b){if(b==""||Ws(b)||b<0){m(void 0);return}const a=We(s.modelValue);m(`${b}${a.unit}`)}}),u=N({get(){return We(s.modelValue).unit??Ce.PX},set(b){const a=We(s.modelValue);m(`${a.num}${b}`)}});function p(b){const a=b===be.DEFAULT?void 0:b;o("update:modelValue",a)}function m(b){o("update:modelValue",b),E()}function g(b){const a=s.modelValue;return a==null&&b.value===be.DEFAULT?!0:a===b.value}async function E(){await Pt();const b=document.querySelector("."+l.fontSelected);b&&b.scrollIntoView({block:"nearest"})}return(b,a)=>(w(),L("div",{class:h(_(l).fontSize),style:Z(r.value)},[d("div",np,[_e(d("input",{type:"number",placeholder:"请输入",class:h(["quickprint-form-control",_(l).input]),min:0,"onUpdate:modelValue":a[0]||(a[0]=y=>i.value=y)},null,2),[[Ne,i.value]]),f(_(J),{width:"54px",options:t,modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=y=>u.value=y)},null,8,["modelValue"])]),d("div",{class:h(["quickprint-is-fill-h quickprint-is-scrollable",_(l).fonts]),ref_key:"scrollRef",ref:c},[(w(!0),L(W,null,te(_(il),y=>(w(),L("div",{key:y.value,class:h({[_(l).option]:!0,[_(l).fontSelected]:g(y)}),onClick:R=>p(y.value)},[d("span",null,z(y.label),1)],10,lp))),128))],2)],6))}}),op="_input_9oh9n_2",ip="_fontSize_9oh9n_8",rp="_fonts_9oh9n_13",ap="_option_9oh9n_25",cp="_fontSelected_9oh9n_34",up={input:op,fontSize:ip,fonts:rp,option:ap,fontSelected:cp},dp={classes:up},ys=P(sp,[["__cssModules",dp]]),pp=["title"],fp={key:0},mp="中文字体 AbBbCc",hp=x({__name:"Font",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=N(()=>wn.map(a=>(a.style={fontFamily:a.value==oe.DEFAULT?oe.SONG:a.value},a))),l=N(()=>ds.map(a=>(a.style={fontFamily:a.value==oe.DEFAULT?oe.SONG:a.value},a))),o=N({get(){const a=e.options.style.fontFamily;return ae(a)?oe.DEFAULT:a},set(a){e.options.style.fontFamily=a==oe.DEFAULT?void 0:a}}),s=N({get(){const a=e.options.style.enFontFamily;return ae(a)?oe.DEFAULT:a},set(a){e.options.style.enFontFamily=a==oe.DEFAULT?void 0:a}}),c=N({get(){const a=e.options.style.color;return ae(a)?Se.DEFAULT:a},set(a){e.options.style.color=a==Se.DEFAULT?void 0:a}}),r=N({get(){const a=e.options.style.highlightColor;return ae(a)?Se.DEFAULT:a},set(a){e.options.style.highlightColor=a==Se.DEFAULT?void 0:a}}),i=N({get(){return e.options.style.fontSize},set(a){const y=ae(a)?void 0:a;e.options.style.fontSize=y}}),u=N({get(){return e.options.style.fontWeight===700},set(a){e.options.style.fontWeight=a?700:void 0}}),p=N({get(){return e.options.style.fontStyle==="italic"},set(a){e.options.style.fontStyle=a?"italic":void 0}}),m=N({get(){return e.options.style.lineThrough===!0},set(a){e.options.style.lineThrough=a?!0:void 0}}),g=N({get(){const a=e.options.style.underline;if(a==null||a===!1)return sn.NONE;const y=e.options.style.underlineStyle;return ae(y)?Rt.SOLID:y},set(a){if(a===sn.NONE){e.options.style.underline=void 0,e.options.style.underlineStyle=void 0;return}e.options.style.underline=!0,e.options.style.underlineStyle=a}}),E=N({get(){const a=e.options.style.underlineColor;return ae(a)?Se.DEFAULT:a},set(a){e.options.style.underlineColor=a==Se.DEFAULT?void 0:a}}),b=N(()=>{const a=e.options.style,y={},R=tl(a.fontFamily,a.enFontFamily);R&&(y.fontFamily=R);const A=ts(a);return A&&Ke(y,A),a.fontSize&&(y.fontSize=a.fontSize),a.fontWeight&&(y.fontWeight=a.fontWeight),a.color&&(y.color=a.color),a.fontStyle&&(y.fontStyle=a.fontStyle),a.highlightColor&&(y["--quickprint-variable-highlight-color"]=a.highlightColor),y});return(a,y)=>(w(),L("div",{class:h(["quickprint-is-scrollable quickprint-is-fill-h",a.classes.font])},[d("div",{class:h(a.classes.fontFamily)},[d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"中文字体",2),d("div",{class:h(a.classes.content)},[f(_(J),{options:t.value,modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=R=>o.value=R)},null,8,["options","modelValue"])],2)],2),d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"颜色",2),f(lt,{modelValue:c.value,"onUpdate:modelValue":y[1]||(y[1]=R=>c.value=R)},{default:he(()=>[d("div",{class:h(a.classes.indicator)},[d("div",{class:h({[a.classes.colorBlock]:!0,[a.classes.colorNone]:c.value===_(Se).DEFAULT}),style:Z({backgroundColor:c.value})},null,6),d("div",{class:h(a.classes.colorValue)},z(c.value==_(Se).DEFAULT?"默认":c.value),3)],2)]),_:1},8,["modelValue"])],2),d("div",{class:h([a.classes.config,a.classes.fontSize])},[d("div",{class:h(a.classes.title)},"字号",2),f(ys,{modelValue:i.value,"onUpdate:modelValue":y[2]||(y[2]=R=>i.value=R),height:"144px"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"西文字体",2),d("div",{class:h(a.classes.content)},[f(_(J),{options:l.value,modelValue:s.value,"onUpdate:modelValue":y[3]||(y[3]=R=>s.value=R)},null,8,["options","modelValue"])],2)],2),d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"前景色",2),f(lt,{modelValue:r.value,"onUpdate:modelValue":y[4]||(y[4]=R=>r.value=R)},{default:he(()=>[d("div",{class:h(a.classes.indicator)},[d("div",{class:h({[a.classes.colorBlock]:!0,[a.classes.colorNone]:r.value===_(Se).DEFAULT}),style:Z({backgroundColor:r.value})},null,6),d("div",{class:h(a.classes.colorValue)},z(r.value==_(Se).DEFAULT?"默认":r.value),3)],2)]),_:1},8,["modelValue"])],2),d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"下划线",2),d("div",{class:h(a.classes.content)},[f(_(J),{modelValue:g.value,"onUpdate:modelValue":y[5]||(y[5]=R=>g.value=R),options:_(Hu),width:"138px"},{option:he(({option:R})=>[d("div",{title:R.label,class:h(a.classes.option)},[R.value==_(sn).NONE?(w(),L("div",fp,z(R.label),1)):(w(),L("div",{key:1,class:h(a.classes.line),style:Z({textDecorationStyle:R.value})},"--",6))],10,pp)]),_:1},8,["modelValue","options"])],2)],2),d("div",{class:h(a.classes.config)},[d("div",{class:h(a.classes.title)},"线条颜色",2),d("div",{class:h(a.classes.content)},[f(lt,{modelValue:E.value,"onUpdate:modelValue":y[6]||(y[6]=R=>E.value=R),class:"quickprint-w-full"},{default:he(()=>[d("div",{class:h(a.classes.indicator)},[d("div",{class:h({[a.classes.colorBlock]:!0,[a.classes.colorNone]:E.value===_(Se).DEFAULT}),style:Z({backgroundColor:E.value})},null,6),d("div",{class:h(a.classes.colorValue)},z(E.value==_(Se).DEFAULT?"默认":E.value),3)],2)]),_:1},8,["modelValue"])],2)],2)],2),d("div",{class:h(a.classes.fieldset)},[y[13]||(y[13]=d("header",null,"效果",-1)),d("div",{class:h(a.classes.configs)},[d("label",{class:h(a.classes.checkbox)},[_e(d("input",{type:"checkbox","onUpdate:modelValue":y[7]||(y[7]=R=>u.value=R)},null,512),[[$n,u.value]]),y[10]||(y[10]=d("span",null,"粗体",-1))],2),d("label",{class:h(a.classes.checkbox)},[_e(d("input",{type:"checkbox","onUpdate:modelValue":y[8]||(y[8]=R=>p.value=R)},null,512),[[$n,p.value]]),y[11]||(y[11]=d("span",null,"斜体",-1))],2),d("label",{class:h(a.classes.checkbox)},[_e(d("input",{type:"checkbox","onUpdate:modelValue":y[9]||(y[9]=R=>m.value=R)},null,512),[[$n,m.value]]),y[12]||(y[12]=d("span",null,"删除线",-1))],2)],2)],2),d("div",{class:h(a.classes.fieldset)},[y[14]||(y[14]=d("header",null,"预览",-1)),d("div",{class:h(a.classes.preview)},[d("span",{style:Z(b.value)},[d("span",{class:h({[a.classes.lineThrough]:n.options.style.lineThrough})},z(mp),2)],4)],2)],2)],2))}}),gp="_font_16792_2",vp="_fontFamily_16792_7",bp="_config_16792_14",yp="_fontSize_16792_19",_p="_fieldset_16792_23",Ep="_title_16792_39",Tp="_content_16792_44",kp="_indicator_16792_49",wp="_colorBlock_16792_69",Sp="_colorValue_16792_80",Cp="_colorNone_16792_87",Rp="_configs_16792_98",Lp="_checkbox_16792_104",Np="_option_16792_119",Ip="_line_16792_127",$p="_preview_16792_138",xp="_lineThrough_16792_153",Ap={font:gp,fontFamily:vp,config:bp,fontSize:yp,fieldset:_p,title:Ep,content:Tp,indicator:kp,colorBlock:wp,colorValue:Sp,colorNone:Cp,configs:Rp,checkbox:Lp,option:Np,line:Ip,preview:$p,lineThrough:xp},Dp={classes:Ap},qp=P(hp,[["__cssModules",Dp]]),Op=["placeholder","min"],Mp=x({__name:"InputWithUnit",props:{modelValue:{type:String,default:void 0},options:{type:Array,required:!0},placeholder:{type:String,default:"请输入"},defaultUnit:{type:String,default:null},min:{type:Number,default:0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=e,l=n,o=N(()=>{const i=l.defaultUnit;return l.options.some(u=>u.value===i)?i:l.options[0].value}),s=N({get(){return We(l.modelValue).num},set(i){if(Wn(i)){const p=We(l.modelValue).unit??o.value;return r(`${i}${p}`)}r()}}),c=N({get(){return We(l.modelValue).unit??o.value},set(i){const p=We(l.modelValue).num??l.min;r(`${p}${i}`)}});function r(i=void 0){t("update:modelValue",i)}return(i,u)=>(w(),L("div",{class:h(i.classes.input)},[_e(d("input",{type:"number","onUpdate:modelValue":u[0]||(u[0]=p=>s.value=p),class:"quickprint-form-control",placeholder:n.placeholder,min:n.min},null,8,Op),[[Ne,s.value]]),f(_(J),{modelValue:c.value,"onUpdate:modelValue":u[1]||(u[1]=p=>c.value=p),class:h(i.classes.unit),options:n.options,width:"auto",border:"none"},null,8,["modelValue","class","options"])],2))}}),Pp="_input_gtdaq_2",Vp="_unit_gtdaq_14",Fp={input:Pp,unit:Vp},zp={classes:Fp},mt=P(Mp,[["__cssModules",zp]]),Bp="永和九年，岁在癸丑，暮春之初，会于会稽山阴之兰亭，修禊事也。群贤毕至，少长咸集。此地有崇山峻岭，茂林修竹；又有清流激湍，映带左右，引以为流觞曲水，列坐其次。虽无丝竹管弦之盛，一觞一咏，亦足以畅叙幽情。是日也，天朗气清，惠风和畅，仰观宇宙之大，俯察品类之盛，所以游目骋怀，足以极视听之娱，信可乐也。",Up=x({__name:"Paragraph",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:Ce.NONE},{label:"磅",value:Ce.PT},{label:"像素",value:Ce.PX}],l=[{label:"字符",value:Ce.EM},{label:"磅",value:Ce.PT},{label:"像素",value:Ce.PX}],o=[{label:"毫米",value:Ce.MM},{label:"磅",value:Ce.PT},{label:"像素",value:Ce.PX}],s=N({get(){return e.options.style.textAlign??tt.LEFT},set(a){const y=a===tt.LEFT?void 0:a;e.options.style.textAlign=y}}),c=N({get(){return e.options.style.textAlignLast??gt.AUTO},set(a){const y=a===gt.AUTO?void 0:a;e.options.style.textAlignLast=y}}),r=N({get(){return e.options.style.verticalAlign??Ye.MIDDLE},set(a){const y=a===Ye.MIDDLE?void 0:a;e.options.style.verticalAlign=y}}),i=b("top"),u=b("bottom"),p=b("left"),m=b("right"),g=N(()=>{const a=e.options.style,y={};return a.textAlign&&(y.textAlign=a.textAlign),a.textAlignLast&&(y.textAlignLast=a.textAlignLast),a.textIndent&&(y.textIndent=a.textIndent),a.lineHeight&&(y.lineHeight=a.lineHeight),Ke(y,ns(a.verticalAlign)),y}),E=N(()=>{var R,A,k,S;const a=e.options.style,y={};return y["--openprint-paragraph-preview-padding-top"]=((R=a.padding)==null?void 0:R.top)??"2px",y["--openprint-paragraph-preview-padding-right"]=((A=a.padding)==null?void 0:A.right)??"2px",y["--openprint-paragraph-preview-padding-bottom"]=((k=a.padding)==null?void 0:k.bottom)??"2px",y["--openprint-paragraph-preview-padding-left"]=((S=a.padding)==null?void 0:S.left)??"2px",y});function b(a){return N({get(){var y;return(y=e.options.style.padding)==null?void 0:y[a]},set(y){e.options.style.padding==null&&(e.options.style.padding={});const R=ae(y)?void 0:y;e.options.style.padding[a]=R}})}return(a,y)=>(w(),L("div",{class:h(["quickprint-is-scrollable quickprint-is-fill-h",a.classes.paragraph])},[d("div",{class:h(a.classes.textAlign)},[d("div",{class:h(a.classes.configItem)},[d("div",{class:h(a.classes.configItemLabel)},"文本对齐",2),f(_(J),{options:_(Fn),modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=R=>s.value=R)},null,8,["options","modelValue"])],2),d("div",{class:h(a.classes.alignLast)},[d("div",{class:h(a.classes.configItemLabel)},"最后一行",2),f(_(J),{options:_(Gu),modelValue:c.value,"onUpdate:modelValue":y[1]||(y[1]=R=>c.value=R)},null,8,["options","modelValue"])],2)],2),d("div",{class:h(a.classes.configItem)},[d("div",{class:h(a.classes.configItemLabel)},"垂直对齐",2),f(_(J),{options:_(Vn),modelValue:r.value,"onUpdate:modelValue":y[2]||(y[2]=R=>r.value=R)},null,8,["options","modelValue"])],2),d("div",{class:h(a.classes.configItem)},[d("div",{class:h(a.classes.configItemLabel)},"首行缩进",2),f(mt,{modelValue:n.options.style.textIndent,"onUpdate:modelValue":y[3]||(y[3]=R=>n.options.style.textIndent=R),options:l,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.configItem)},[d("div",{class:h(a.classes.configItemLabel)},"行高",2),f(mt,{modelValue:n.options.style.lineHeight,"onUpdate:modelValue":y[4]||(y[4]=R=>n.options.style.lineHeight=R),options:t,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.fieldset)},[y[9]||(y[9]=d("header",null,"内边距",-1)),d("div",{class:h(a.classes.padding)},[d("div",{class:h(a.classes.paddingItem)},[d("label",{class:h(a.classes.paddingItemLabel)},"上边距",2),f(mt,{modelValue:_(i),"onUpdate:modelValue":y[5]||(y[5]=R=>Ge(i)?i.value=R:null),options:o,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.paddingItem)},[d("label",{class:h(a.classes.paddingItemLabel)},"下边距",2),f(mt,{modelValue:_(u),"onUpdate:modelValue":y[6]||(y[6]=R=>Ge(u)?u.value=R:null),options:o,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.paddingItem)},[d("label",{class:h(a.classes.paddingItemLabel)},"左边距",2),f(mt,{modelValue:_(p),"onUpdate:modelValue":y[7]||(y[7]=R=>Ge(p)?p.value=R:null),options:o,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),d("div",{class:h(a.classes.paddingItem)},[d("label",{class:h(a.classes.paddingItemLabel)},"右边距",2),f(mt,{modelValue:_(m),"onUpdate:modelValue":y[8]||(y[8]=R=>Ge(m)?m.value=R:null),options:o,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2)],2)],2),d("div",{class:h(a.classes.fieldset)},[y[10]||(y[10]=d("header",null,"预览",-1)),d("div",{class:h(a.classes.preview),style:Z(g.value)},[d("div",{style:Z(E.value),class:h(a.classes.previewText)},[se(z(Bp)+" "),d("div",{class:h(a.classes.paddingPreview)},null,2)],6)],6)],2)],2))}}),Hp="_paragraph_1ex97_2",Gp="_fieldset_1ex97_7",Wp="_preview_1ex97_23",Yp="_textAlign_1ex97_34 quickprint-is-row",Xp="_configItem_1ex97_39 quickprint-is-row",jp="_alignLast_1ex97_44 quickprint-is-row",Zp="_configItemLabel_1ex97_54",Kp="_padding_1ex97_59",Jp="_paddingItem_1ex97_66",Qp="_paddingItemLabel_1ex97_72",ef="_previewText_1ex97_77",tf="_paddingPreview_1ex97_86",nf={paragraph:Hp,fieldset:Gp,preview:Wp,textAlign:Yp,configItem:Xp,alignLast:jp,configItemLabel:Zp,padding:Kp,paddingItem:Jp,paddingItemLabel:Qp,previewText:ef,paddingPreview:tf},lf={classes:nf},sf=P(Up,[["__cssModules",lf]]),of=["onClick"],rf=x({__name:"Tabs",props:{active:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["switch"],setup(n,{emit:e}){const t=e;function l(o){t("switch",o)}return(o,s)=>(w(),L("div",{class:h(o.classes.tabs)},[(w(!0),L(W,null,te(n.tabs,c=>(w(),L("div",{key:c.value,class:h({[o.classes.tab]:!0,[o.classes.active]:n.active===c.value}),onClick:r=>l(c),onPointerdown:s[0]||(s[0]=ie(()=>{},["stop","prevent"]))},[d("span",null,z(c.label),1)],42,of))),128))],2))}}),af="_tabs_109u2_2",cf="_tab_109u2_2",uf="_active_109u2_41",df={tabs:af,tab:cf,active:uf},pf={classes:df},_s=P(rf,[["__cssModules",pf]]),ff=x({__name:"index",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=Pe(),l=Q("font"),o=[{label:"字体",value:"font"},{label:"段落",value:"paragraph"}];function s(i){l.value=i.value}function c(){t==null||t.confirm(e.options)}function r(){t==null||t.cancel()}return(i,u)=>(w(),L("div",{class:h(i.classes.setting)},[d("div",{class:h(i.classes.header)},[d("div",{class:h(i.classes.headerLeft)},[f(_(D),{icon:"icon-setting",size:"14px"}),d("span",{class:h(i.classes.title)},"元素",2),f(_s,{tabs:o,active:l.value,onSwitch:s},null,8,["active"])],2),_(t)?(w(),K(_(Xn),{key:0,instance:_(t)},null,8,["instance"])):U("",!0)],2),l.value==="font"?(w(),K(qp,{key:0,options:e.options},null,8,["options"])):U("",!0),l.value==="paragraph"?(w(),K(sf,{key:1,options:e.options},null,8,["options"])):U("",!0),d("div",{class:h(i.classes.footer)},[d("button",{type:"button",class:"quickprint-text-btn",onClick:r},"取消"),d("button",{type:"button",class:"quickprint-text-btn",onClick:c},"确定")],2)],2))}}),mf="_setting_16zk2_2",hf="_header_16zk2_10",gf="_headerLeft_16zk2_22",vf="_title_16zk2_35",bf="_tabs_16zk2_42",yf="_footer_16zk2_47",_f={setting:mf,header:hf,headerLeft:gf,title:vf,tabs:bf,footer:yf},Ef={classes:_f},Tf=P(ff,[["__cssModules",Ef]]);function kf(n){return De({style:ql(n.style??{})})}function wf(n,e){n.style=Object.assign({},n.style,e.style)}const Sf=Ve(function(n){return Zt("元素设置",f(Tf,{options:kf(n)},null),{preset:"setting"}).promisify().then(e=>wf(n,e)).catch(qe)});function Cf(n,e,t){Zn.open(n.clientX,n.clientY,{menus:[{type:"menu",label:"设置",icon:"icon-setting",handler(){Sf(e.element)}},{type:"divider"},{type:"menu",label:"复制",icon:"icon-copy",submenu:[{type:"menu",label:"元素",icon:"icon-pintu",detail:"Ctrl+C",handler(){console.log("TODO: 复制元素")}},{type:"menu",label:"样式",icon:"icon-shuazi",disabled:!0,handler(){console.log("TODO: 复制样式")}}]},{type:"menu",label:"合并",icon:"icon-hebing",submenu:[{type:"menu",label:"样式",icon:"icon-shuazi",disabled:!0,handler(){console.log("TODO: 合并样式")}}]},{type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"元素",icon:"icon-pintu",detail:"Delete",handler(){e.element.remove(),t.createSnapshot()}},{type:"menu",label:"数据源",icon:"icon-datasource",handler(){e.element.resetDS(),t.createSnapshot()}}]},{type:"divider"},{type:"menu",label:"层级",icon:"icon-cengji",submenu:[{type:"menu",icon:"icon-vertical-align-top",label:"移至顶层",handler(){const l=e.element.page;if(l==null)return;const o=l.topZIndex;e.element.setZIndex(o+1),t.createSnapshot()}},{type:"menu",label:"上移一层",icon:"icon-arrowup",handler(){const l=e.element.zIndex;e.element.setZIndex(l+1),t.createSnapshot()}},{type:"menu",icon:"icon-arrowdown",label:"下移一层",handler(){const l=e.element.zIndex;l<=0||(e.element.setZIndex(l-1),t.createSnapshot())}},{type:"menu",icon:"icon-vertical-align-bottom",label:"移至底层",handler(){e.element.setZIndex(0),t.createSnapshot()}}]}]})}const Rf=x({props:{element:{type:ve,required:!0}},setup(n){const e=Ie("classes"),t=Ee(),l=N(()=>{const m=n.element;m.state.key;const g={"--quickprint-element-top":m.top+"px","--quickprint-element-left":m.left+"px","--quickprint-element-width":m.width+"px","--quickprint-element-height":m.height+"px","z-index":m.zIndex};return c()&&(g.transform=`rotate(${m.style.rotate}deg)`),g}),o={TOP:[e.resizeTop,Lt.TOP],BOTTOM:[e.resizeBottom,Lt.BOTTOM],LEFT:[e.resizeLeft,Lt.LEFT],RIGHT:[e.resizeRight,Lt.RIGHT],BOTTOM_RIGHT:[e.resizeBottomRight,Lt.BOTTOM_RIGHT]},s=[o.TOP,o.BOTTOM,o.LEFT,o.RIGHT,o.BOTTOM_RIGHT];function c(){const m=n.element;return m.style.rotate==0||m.style.rotate==null?!1:t.state.selectMode===ot.SINGLE?!m.isSelected:!0}function r(m){const g=ad(m.type);if(g==null)return f("div",{class:e.unknown},[f("span",null,[se("未知的打印元素")])]);const E={element:m,key:m.id+"_"+m.state.key};return dd(m.type)?(E.onContextmenu=u,st(g,E)):st(g,E)}function i(m,g){g.stopPropagation();const E=g.target.closest("."+G.ELEMENT);E&&Reflect.get(E,gn)===el.DRAG_ELEMENT||t.selectElement(m)}function u(m){m.stopPropagation(),m.preventDefault(),Cf(m,n,t)}function p(){return!pd(n.element.type)||c()?null:s.map(m=>{const g={class:[G.RESIZEABLE_INDICATOR,m[0]],["."+Ul]:m[1]};return f("div",lo(g,{onPointerdown:t.onResizeStart}),null)})}return function(){const m=n.element,g={["."+Xe]:m,["."+Qn]:m.type,key:m.id,class:{[G.ELEMENT]:!0,[G.DRAGGABLE]:!0,[G.RESIZEABLE]:!0,[G.SELECTED]:m.state.selected,[G.SELECTABLE]:ud(m.type),["quickprint-is-"+m.type.toLowerCase()]:!0},style:l.value,onClick:i.bind(null,m)};return f("div",g,[r(m),p()])}}}),Lf="_unknown_za8zh_2",Nf="_resizeTop_za8zh_12",If="_resizeBottom_za8zh_20",$f="_resizeLeft_za8zh_28",xf="_resizeRight_za8zh_36",Af="_resizeBottomRight_za8zh_44",Df={unknown:Lf,resizeTop:Nf,resizeBottom:If,resizeLeft:$f,resizeRight:xf,resizeBottomRight:Af},qf={classes:Df},Of=P(Rf,[["__cssModules",qf]]),Es=xl(()=>Al(()=>import("./component-C2cM7-Wl.js"),__vite__mapDeps([3,4,1,5,6]))),Mf=x({__name:"DocJson",props:{doc:{type:ge,required:!0}},setup(n){const e=n,t=Pe(),l=Q(JSON.stringify(e.doc,null,"  "));return t==null||t.useHandle("confirm",()=>l.value),(o,s)=>(w(),K(_(Es),{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=c=>l.value=c),language:"json",class:h(o.classes.json)},null,8,["modelValue","class"]))}}),Pf="_json_9crpe_2",Vf={json:Pf},Ff={classes:Vf},zf=P(Mf,[["__cssModules",Ff]]),Bf=Ve(function(n){return Tt("调试",f(zf,{doc:n.document.value},null),{preset:"docDebug"}).promisify().catch(et)}),Uf=x({props:{doc:{type:ge,required:!0},page:{type:kt,required:!0}},emits:["save","preview"],setup(n,{emit:e}){const t=Ie("classes"),l=Ee(),o=Vt("selectionRef"),s=Vt("paperRef"),c=Q(0),r=N(()=>n.page.width),i=N(()=>n.page.height);function u(k){k.stopPropagation();const S=k.target.closest("."+G.PAPER);S&&Reflect.get(S,gn)===el.SELECTION||(l.resetSelectedElement(),l.selectPage(n.page))}function p(){if(n.page.header.display===!1)return null;const k=n.page.header.height,S="page_header_"+c.value,v=n.page.footer.display?_t(i.value)-n.page.footer.height:0;return f(Ll,{title:"页眉",top:k,onMove:g,key:S,max:v},null)}function m(){if(n.page.footer.display===!1)return null;const k=_t(i.value)-n.page.footer.height,S="page_footer_"+c.value,v=n.page.header.display?n.page.header.height:0;return f(Ll,{title:"页脚",top:k,onMove:E,key:S,min:v},null)}function g(k){n.page.setHeaderHeight(k.top),c.value++}function E(k){n.page.setFooterHeight(_t(i.value)-k.top),c.value++}function b(k){k.stopPropagation(),k.preventDefault(),Zn.open(k.clientX,k.clientY,{menus:[{type:"menu",label:"重新加载",icon:"icon-reload",detail:"Ctrl+R",handler(){window.location.reload()}},{type:"menu",label:"全部选中",icon:"icon-select-all",detail:"Ctrl+A",handler:()=>{const v=l.doc.pages.reduce((T,C)=>T.concat(C.children),[]);l.multiSelectElements(v)}},{type:"menu",label:"粘贴",icon:"icon-paste",detail:"Ctrl+V",disabled:!0,handler(){console.log("TODO: 黏贴")}},{type:"divider"},{type:"menu",label:"调试",icon:"icon-bug",handler(){Bf(l).then(S=>{if(S==null)return;const v=ge.create(S);l.setDocument(v)})}},{type:"menu",label:"预览",icon:"icon-run",detail:"Ctrl+P",handler(){e("preview")}},{type:"menu",label:"保存",icon:"icon-save",detail:"Ctrl+S",handler(){e("save")}}]})}function a(){const k=n.doc.margins;if(k==null)return null;const S=[];return k.top&&S.push(f("div",{title:"上边距参考线",class:t.marginHorizontalGuide,style:{top:k.top+"px"}},null)),k.bottom&&S.push(f("div",{title:"下边距参考线",class:t.marginHorizontalGuide,style:{bottom:k.bottom+"px"}},null)),k.left&&S.push(f("div",{title:"左边距参考线",class:t.marginVerticalGuide,style:{left:k.left+"px"}},null)),k.right&&S.push(f("div",{title:"右边距参考线",class:t.marginVerticalGuide,style:{right:k.right+"px"}},null)),S.length>0?S:null}function y(){const k={["."+Bl]:n.page,key:n.page.id,style:{width:r.value+"mm",height:i.value+"mm"},class:{[G.PAGE]:!0,[G.DROPPABLE]:!0,[t.grid]:n.doc.useGrid},onContextmenu:b},S=n.page.children.map(v=>f(Of,{element:v},null));return f("div",k,[p(),S,m(),a()])}function R(k){if(k.button!==0)return;k.stopPropagation(),k.preventDefault();const v=k.target.closest("."+G.ELEMENT);if(v==null)return A(k,s.value);const T=Reflect.get(v,Xe);return T==null?A(k,s.value):T.type===X.TABLE?A(k,v):fd(T.type)?l.onDragStart(k):A(k,s.value)}function A(k,S){var v;(v=o.value)==null||v.onSelectStart(k,S)}return function(){const k=l.state.scale/100,S={id:"@"+n.page.id,ref:"paperRef",class:{[G.PAPER]:!0,[G.SELECTED]:l.state.selectedPage===n.page.id},style:{width:r.value*k+"mm",height:i.value*k+"mm"},onPointerdown:R,onClick:u};return f("div",S,[y(),f(tp,{ref:"selectionRef"},null)])}}}),Hf="_paper_fdphx_2",Gf="_grid_fdphx_12",Wf="_marginHorizontalGuide_fdphx_21",Yf="_marginVerticalGuide_fdphx_29",Xf={paper:Hf,grid:Gf,marginHorizontalGuide:Wf,marginVerticalGuide:Yf},jf={classes:Xf},Zf=P(Uf,[["__cssModules",jf]]),Kf={class:"quickprint-is-fill-h quickprint-is-scrollable"},Jf="icon-zhanweifu",Qf=x({__name:"Element",setup(n){const e=Ee();return(t,l)=>(w(),L("div",{class:h(t.classes.panel)},[d("div",{class:h(t.classes.header)},"可打印元素",2),d("div",Kf,[d("div",{class:h(t.classes.grid)},[(w(!0),L(W,null,te(_(sd),o=>(w(),L("div",Fl({key:o.type,class:[_(G).DRAGGABLE,t.classes.element],[`.${_(zl)||""}`]:_(Re).INSERT,[`.${_(Qn)||""}`]:o.type,onPointerdown:l[0]||(l[0]=(...s)=>_(e).onDragStart&&_(e).onDragStart(...s))}),[f(_(D),{icon:o.icon??Jf,size:"16px",class:h(t.classes.icon)},null,8,["icon","class"]),d("span",null,z(o.title),1)],48))),128))],2)])],2))}}),em="_panel_1p36j_2",tm="_header_1p36j_8",nm="_grid_1p36j_18",lm="_element_1p36j_30",sm="_icon_1p36j_45",om={panel:em,header:tm,grid:nm,element:lm,icon:sm},im={classes:om},rm=P(Qf,[["__cssModules",im]]),am=["onClick"],cm=x({__name:"SelectPath",setup(n){const e=Ee(),t=N(()=>{const s=e.state,c=[{id:e.doc.id,title:"文档",type:"document"}];if(s.selectedType===me.PAGE){const r=e.getSelectedPage();if(r!=null){const i="页面"+(r.index+1);c.push({id:r.id,title:i,type:"page",data:r})}return c}if(s.selectedType===me.ELEMENT){if(s.selectMode===ot.MULTIPLE){const u=e.getSelectedElements();if(u.length===0)return c;let p=u[0];for(;p.parent;){const m=p.parent;if(m instanceof kt){const g="页面"+(m.index+1);return c.push({id:m.id,title:g,type:"page",data:m}),c}p=m}return c}let r=e.getSelectedElements()[0];if(r==null)return c;const i=[{id:r.id,title:jt(r.type),type:"element",data:r}];for(;r.parent;){const u=r.parent;if(u instanceof kt){const p="页面"+(u.index+1);return i.unshift({id:u.id,title:p,type:"page",data:u}),c.concat(i)}i.unshift({id:u.id,title:jt(u.type),type:"element",data:u}),r=u}}return c}),l=N(()=>{if(e.state.selectedType!=me.ELEMENT)return;const c=e.getSelectedElements();if(c.length!=1)return;const r=c[0],i=nl(r,e.doc.ds);if(!(i==null||!i.content))return i.type===ye.VARIABLE||i.type===ye.FORMULA?`[${i.content}]`:i.content});function o(s){if(s.type==="element")return e.selectElement(s.data);if(s.type==="page")return e.selectPage(s.data)}return(s,c)=>(w(),L("div",{class:h(s.classes.paths)},[(w(!0),L(W,null,te(t.value,(r,i)=>(w(),L(W,{key:r.id},[i>0?(w(),K(_(D),{key:0,class:h(s.classes.icon),icon:"icon-right",size:"12px"},null,8,["class"])):U("",!0),d("div",{class:h(s.classes.path),onClick:u=>o(r)},z(r.title),11,am)],64))),128)),l.value?(w(),L(W,{key:0},[f(_(D),{class:h(s.classes.ion),icon:"icon-right",size:"12px"},null,8,["class"]),d("div",{class:h(s.classes.content)},z(l.value),3)],64)):U("",!0)],2))}}),um="_paths_fuk62_2",dm="_path_fuk62_2",pm="_icon_fuk62_28",fm="_content_fuk62_33",mm={paths:um,path:dm,icon:pm,content:fm},hm={classes:mm},gm=P(cm,[["__cssModules",hm]]),vm=["min","readonly","placeholder"],bm=x({__name:"LabelNumber",props:wt({modelValue:{type:Number,default:null},label:{type:String,default:null},min:{type:Number,default:null},defaultValue:{type:Number,default:0},precision:{type:Number,default:null},readonly:{type:Boolean,default:!1},placeholder:{type:String,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=n,t=Kt(n,"modelValue");function l(o){const c=o.target.value;if(t==null||c===""){const i=e.min?e.min:e.defaultValue;t.value=i;return}const r=Number(c);if(!Number.isNaN(r)&&(e.min!=null&&r<e.min&&(t.value=e.min),e.precision!=null)){const i=Math.pow(10,e.precision);t.value=Math.round(r*i)/i}}return(o,s)=>(w(),L("label",{class:h({[o.classes.labelNumber]:!0,[o.classes.readonly]:n.readonly})},[_e(d("input",{class:"quickprint-form-control",type:"number","onUpdate:modelValue":s[0]||(s[0]=c=>t.value=c),min:n.min,readonly:n.readonly,placeholder:n.placeholder,onBlur:l},null,40,vm),[[Ne,t.value]]),d("span",{class:h(o.classes.label)},z(n.label),3)],2))}}),ym="_labelNumber_1aifb_2",_m="_label_1aifb_2",Em="_readonly_1aifb_25",Tm={labelNumber:ym,label:_m,readonly:Em},km={classes:Tm},xt=P(bm,[["__cssModules",km]]),wm={class:"quickprint-config"},Sm={class:"quickprint-config-body quickprint-is-scrollable quickprint-is-fill-h"},Cm={class:"quickprint-config-group"},Rm={class:"quickprint-config-section quickprint-config-inline"},Lm={class:"quickprint-config-content quickprint-config-inline"},Nm={class:"quickprint-config-section quickprint-config-inline"},Im={class:"quickprint-config-content quickprint-config-inline"},$m={class:"quickprint-config-section quickprint-config-inline"},xm={class:"quickprint-config-content quickprint-form-inline"},Am={key:0,class:"quickprint-config-section quickprint-config-inline"},Dm={class:"quickprint-config-content quickprint-form-inline"},qm={class:"quickprint-config-section quickprint-config-inline"},Om={class:"quickprint-config-content quickprint-form-inline"},Mm=x({__name:"PageConfig",props:{page:{type:kt,required:!0}},setup(n){const e=n,t=[{label:"显示",value:!0},{label:"隐藏",value:!1}],l=N({get(){return e.page.size.type},set(r){e.page.size.type=r,r===Yt.CONTENT&&(e.page.size.orientation=void 0)}}),o=N({get(){return e.page.orientation},set(r){e.page.size.orientation=r}}),s=N(()=>e.page.width),c=N({get(){return e.page.height},set(r){const i=Number(r);!Wn(i)||i<0||(e.page.size.height=i)}});return(r,i)=>(w(),L("div",wm,[i[11]||(i[11]=d("div",{class:"quickprint-config-title"},"页面配置",-1)),d("div",Sm,[d("div",Cm,[i[10]||(i[10]=d("div",{class:"quickprint-config-group-title"},"布局",-1)),d("section",Rm,[i[5]||(i[5]=d("header",{class:"quickprint-config-header"},"页眉",-1)),d("div",Lm,[f(xt,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.header.height,readonly:""},null,8,["modelValue"]),f($t,{modelValue:n.page.header.display,"onUpdate:modelValue":i[0]||(i[0]=u=>n.page.header.display=u),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])]),d("section",Nm,[i[6]||(i[6]=d("header",{class:"quickprint-config-header"},"页脚",-1)),d("div",Im,[f(xt,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.footer.height,readonly:""},null,8,["modelValue"]),f($t,{modelValue:n.page.footer.display,"onUpdate:modelValue":i[1]||(i[1]=u=>n.page.footer.display=u),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])]),d("section",$m,[i[7]||(i[7]=d("header",{class:"quickprint-config-header"},"尺寸",-1)),d("div",xm,[f($t,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=u=>l.value=u),options:_(mo),class:"quickprint-w-full"},null,8,["modelValue","options"])])]),n.page.size.type===_(Yt).CONTENT?(w(),L("section",Am,[i[8]||(i[8]=d("header",{class:"quickprint-config-header"},"内容",-1)),d("div",Dm,[f(xt,{class:"quickprint-form-inline-item",label:"宽",modelValue:s.value,readonly:""},null,8,["modelValue"]),f(xt,{class:"quickprint-form-inline-item",label:"高",modelValue:c.value,"onUpdate:modelValue":i[3]||(i[3]=u=>c.value=u)},null,8,["modelValue"])])])):U("",!0),d("section",qm,[i[9]||(i[9]=d("header",{class:"quickprint-config-header"},"方向",-1)),d("div",Om,[f($t,{modelValue:o.value,"onUpdate:modelValue":i[4]||(i[4]=u=>o.value=u),options:_(Wl),class:"quickprint-w-full",disabled:n.page.size.type===_(Yt).CONTENT},null,8,["modelValue","options","disabled"])])])])])]))}}),Pm={},Vm={class:"quickprint-config"};function Fm(n,e){return w(),L("div",Vm,e[0]||(e[0]=[d("div",{class:"quickprint-config-title"},"多选配置",-1),d("div",{class:"quickprint-config-body quickprint-is-scrollable quickprint-is-fill-h"},"TODO:",-1)]))}const zm=P(Pm,[["render",Fm]]),Bm=["value","placeholder"],Um=x({__name:"InputUnit",props:{label:{type:String,default:null},modelValue:{type:Number,default:null},standard:{type:String,default:"px"},target:{type:String,default:"px"},placeholder:{type:String,default:"请输入"},min:{type:Number,default:1},defaultValue:{type:Number,default:0},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,l=e,o=Vt("inputRef"),s=N({get(){return t.standard===t.target?t.modelValue:t.standard==="px"&&t.target==="mm"?ul(t.modelValue):t.standard==="mm"&&t.target==="px"?_t(t.modelValue):0},set(p){if(t.standard===t.target)return l("update:modelValue",p);if(t.standard==="px"&&t.target==="mm")return l("update:modelValue",_t(p));if(t.standard==="mm"&&t.target==="px")return l("update:modelValue",ul(p))}}),c=N(()=>t.clearable&&s.value!=null);function r(p){const g=p.target.value;if(s==null||g===""){if(t.clearable)return;const b=t.min?t.min:t.defaultValue;s.value=b;return}const E=Number(g);if(!Number.isNaN(E)){if(t.min!=null&&E<t.min){s.value=t.min;return}if(t.standard==="px"){s.value=Math.round(E);return}s.value=E}}function i(){l("update:modelValue",void 0)}function u(){var p;(p=o.value)==null||p.blur(),setTimeout(()=>{var m;return(m=o.value)==null?void 0:m.focus()},50)}return(p,m)=>(w(),L("label",{class:h({[p.classes.inputUnit]:!0,[p.classes.withClear]:n.clearable})},[d("span",{class:h(p.classes.label)},z(n.label),3),d("input",{ref_key:"inputRef",ref:o,class:"quickprint-form-control",type:"number",value:s.value,placeholder:n.placeholder,onBlur:r,onKeydown:Ml(u,["enter"])},null,40,Bm),c.value?(w(),L("span",{key:0,class:h(p.classes.clearBtn),onClick:ie(i,["stop"])},[f(_(D),{icon:"icon-close",size:"11px"})],2)):U("",!0)],2))}}),Hm="_inputUnit_2ymft_2",Gm="_clearBtn_2ymft_7",Wm="_label_2ymft_11",Ym="_withClear_2ymft_31",Xm={inputUnit:Hm,clearBtn:Gm,label:Wm,withClear:Ym},jm={classes:Xm},nt=P(Um,[["__cssModules",jm]]),Zm=x({__name:"UnitSelect",props:wt({modelValue:{type:String,default:"px"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=[{label:"像素(px)",value:"px"},{label:"毫米(mm)",value:"mm"}],t=n,l=Kt(n,"modelValue"),o=N(()=>{var s;return((s=e.find(c=>c.value===t.modelValue))==null?void 0:s.label)??t.modelValue});return(s,c)=>(w(),L("span",{class:h(s.classes.unit),title:"1毫米≈3.778像素，1像素≈0.265毫米"},[f(_(J),{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=r=>l.value=r),options:e,class:h(s.classes.select),appearance:"none",border:"none"},{selected:he(()=>[d("span",{class:h(s.classes.text)},z(o.value),3)]),_:1},8,["modelValue","class"])],2))}}),Km="_unit_135mn_2",Jm="_text_135mn_8",Qm="_select_135mn_25",eh={unit:Km,text:Jm,select:Qm},th={classes:eh},Ts=P(Zm,[["__cssModules",th]]),nh=x({__name:"CopyBtn",emits:["copy"],setup(n,{emit:e}){const t=e,l=Q(!1);function o(){t("copy",async function(c){await navigator.clipboard.writeText(c).catch(Ys)!==!1&&(l.value=!0,setTimeout(()=>l.value=!1,500))})}return(s,c)=>(w(),L("button",{type:"button",class:h(["quickprint-text-btn",s.classes.btn]),title:"复制",onClick:o},[f(_(D),{icon:"icon-copy"}),f(so,{name:"quickprint-fade"},{default:he(()=>[l.value?(w(),L("span",{key:0,class:h(s.classes.message)},"已复制",2)):U("",!0)]),_:1})],2))}}),lh="_btn_v9scw_2",sh="_message_v9scw_6",oh={btn:lh,message:sh},ih={classes:oh},rh=P(nh,[["__cssModules",ih]]),ah=x({__name:"window",props:{code:{type:String,default:""},doc:{type:ge,default:null},mode:{type:String,default:"code"}},setup(n){const e=n,t=Pe(),l=Q(e.code),o=ue();function s(){return l.value}function c(){e.doc!=null&&Sa({doc:e.doc}).then(m=>{var E;if(m==null)return;const g=m.type=="reference"?`[=${m.value}]`:`[${m.value}]`;(E=o.value)==null||E.insert(g)})}function r(m){var g;return it(m,(g=e.doc)==null?void 0:g.ds)}function i(){var m;(m=o.value)==null||m.insert(`[2.6.${Un.ELEMENT_VALUR}]`)}function u(){Ca().then(m=>{var g;m!=null&&((g=o.value)==null||g.insert(m.value))})}function p(){Ra({doc:e.doc}).then(m=>{var g;m!=null&&((g=o.value)==null||g.insert(m.value))})}return t==null||t.useHandle("confirm",s),(m,g)=>(w(),L("div",{class:h(m.classes.window)},[n.mode!=="code"?(w(),L("div",{key:0,class:h(m.classes.toolbar)},[n.mode=="condition"?(w(),L(W,{key:0},[d("button",{type:"button",class:"quickprint-text-btn",onClick:i},[f(_(D),{icon:"icon-number-sign"}),g[1]||(g[1]=d("span",null,"插入元素值",-1))]),d("div",{class:h(m.classes.divider)},null,2)],64)):U("",!0),d("button",{type:"button",onClick:c,class:"quickprint-text-btn"},[f(_(D),{icon:"icon-insert-var"}),g[2]||(g[2]=d("span",null,"插入变量",-1))]),d("button",{type:"button",class:"quickprint-text-btn",onClick:u},[f(_(D),{icon:"icon-function"}),g[3]||(g[3]=d("span",null,"插入函数",-1))]),d("button",{type:"button",class:"quickprint-text-btn",onClick:p},[f(_(D),{icon:"icon-formula"}),g[4]||(g[4]=d("span",null,"插入公式",-1))])],2)):U("",!0),f(_(Es),{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=E=>l.value=E),language:"javascript",class:h(m.classes.code),formatVariable:r,autofocus:"",ref_key:"codeRef",ref:o},null,8,["modelValue","class"])],2))}}),ch="_window_n935p_2",uh="_toolbar_n935p_11",dh="_code_n935p_22",ph="_divider_n935p_27",fh={window:ch,toolbar:uh,code:dh,divider:ph},mh={classes:fh},ks=P(ah,[["__cssModules",mh]]),ws=Ve(function(n){return Tt("公式",f(ks,{code:n==null?void 0:n.code,doc:n==null?void 0:n.doc,mode:n==null?void 0:n.mode},null),{preset:"editor"}).promisify().catch(qe)}),hh=Ve(function(n,e){return Tt(n,f(ks,{code:e},null),{preset:"editor"}).promisify().catch(qe)}),gh={class:"quickprint-config-section quickprint-config-inline"},vh={class:"quickprint-config-content"},bh=["value"],yh=x({__name:"Visibility",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=N({get(){var r;return((r=e.element.visibility)==null?void 0:r.type)??yt.VISIBLE},set(r){e.element.visibility==null&&(e.element.visibility={}),r!==yt.CONDITION&&(e.element.visibility.condition=void 0),e.element.visibility.type=r}}),l=N({get(){var r;return((r=e.element.visibility)==null?void 0:r.condition)??""},set(r){e.element.visibility==null&&(e.element.visibility={}),e.element.visibility.condition=r}}),o=N(()=>{var r;return ll((r=e.element.visibility)==null?void 0:r.condition,e.element.doc)}),s=N(()=>{var r;return t.value!==yt.CONDITION?!1:!((r=e.element.visibility)!=null&&r.condition)});function c(){const r=l.value||`[2.6.${Un.ELEMENT_VALUR}]`;ws({code:r,doc:e.element.doc,mode:"condition"}).then(i=>{i!=null&&(l.value=i)})}return(r,i)=>(w(),L(W,null,[d("section",gh,[i[1]||(i[1]=d("header",{class:"quickprint-config-header"},"可见性",-1)),d("div",vh,[f(_(J),{class:"quickprint-w-full",options:_(ro),modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=u=>t.value=u)},null,8,["options","modelValue"])])]),t.value===_(yt).CONDITION?(w(),L("div",{key:0,class:h([r.classes.condition,"quickprint-config-section"]),onClick:c},[d("textarea",{value:o.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,bh),s.value?(w(),K(_(D),{key:0,icon:"icon-open-new",size:"14px"})):U("",!0)],2)):U("",!0)],64))}}),_h="_condition_siopf_2",Eh={condition:_h},Th={classes:Eh},kh=P(yh,[["__cssModules",Th]]);function wh(n){return N({get(){return n.element.attributes.position??un.DEFAULT},set(e){const t=e===un.DEFAULT?void 0:e;n.element.attributes.position=t}})}function Sh(n){return N({get(){return n.element.attributes.printMode??dn.ONCE},set(e){const t=e===dn.ONCE?void 0:e;n.element.attributes.printMode=t}})}function Ch(n){return N({get(){return n.element.attributes.overflow??Xt.HIDDEN},set(e){const t=e===Xt.HIDDEN?void 0:e;n.element.attributes.overflow=t}})}function Rh(n){return N({get(){return n.element.width},set(e){n.element.setWidth(e,!0)}})}function Lh(n){return N({get(){return n.element.height},set(e){n.element.setHeight(e,!0)}})}function Nh(n){return N({get(){return n.element.attributes.display},set(e){if(e==null){n.element.attributes.display=void 0;return}n.element.attributes.display=e}})}function Ih(n){return N({get(){return n.element.ds.type},set(e){const t=n.element.ds.type;n.element.ds.type=e,t!=e&&(n.element.ds.value=void 0)}})}const $h=x({__name:"Const",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=N({get(){return e.element.ds.value},set(l){e.element.ds.value=l}});return(l,o)=>_e((w(),L("textarea",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.value=s),class:"quickprint-form-control quickprint-form-control-block quickprint-config-space",rows:"3",placeholder:"请输入"},null,512)),[[Ne,t.value]])}}),xh={class:"quickprint-config-ds-var-type"},Ah=["title"],Dh=x({__name:"Variable",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=Ee(),l=N(()=>ae(e.element.ds.value)),o=N(()=>it(e.element.ds.value,t.doc.ds));function s(r){r.stopPropagation(),e.element.ds.value=void 0}async function c(){var p;const r=await sl({doc:t.doc,value:e.element.ds.value}).catch(et);if(r==null||(e.element.setDataSource(ye.VARIABLE,r.value),e.element.type!=X.TABLE_CELL||r.type!=="ds"))return;const i=e.element.parent;if(i==null||i.isBindVariable||((p=r.parent)==null?void 0:p.type)!==ne.ARRAY)return;const u=r.parent;i.setDataSource(ye.VARIABLE,`${Je.DS}.${u.type}.${u.name}`)}return(r,i)=>(w(),L("div",{class:"quickprint-config-ds-variable",onClick:c},[l.value?(w(),L(W,{key:0},[i[0]||(i[0]=d("span",{class:"quickprint-config-ds-placeholder"},"请选择",-1)),f(_(D),{icon:"icon-open-new",size:"14px"})],64)):(w(),L(W,{key:1},[d("span",xh,"<"+z(_(bi)(e.element.ds.value))+">",1),d("span",{class:"quickprint-is-fill-w quickprint-is-truncate",title:o.value},z(o.value),9,Ah),d("button",{type:"button",class:"quickprint-text-btn quickprint-config-ds-remove-var",onClick:s},[f(_(D),{icon:"icon-close",size:"12px"})])],64))]))}}),qh=["value"],Oh=x({__name:"Code",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=N(()=>ae(e.element.ds.value));function l(){return Gn(e.element.ds.value)?e.element.ds.value:`function data(element){
  // 在此处自定义返回值
  // 支持返回Promise
  return
}`}function o(){hh("自定义",l()).then(s=>{s!=null&&(e.element.ds.value=s)})}return(s,c)=>(w(),L("div",{onClick:o,class:h(s.classes.code)},[d("textarea",{value:e.element.ds.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,qh),t.value?(w(),K(_(D),{key:0,icon:"icon-open-new",size:"14px"})):U("",!0)],2))}}),Mh="_code_1az68_2",Ph={code:Mh},Vh={classes:Ph},Fh=P(Oh,[["__cssModules",Vh]]),zh=["value"],Bh=x({__name:"Formula",props:{element:{type:ve,required:!0}},setup(n){const e=n,t=Ee(),l=N(()=>ae(e.element.ds.value)),o=N(()=>ll(e.element.ds.value,e.element.doc));function s(){const c=e.element.ds.value;ws({code:c,doc:t.doc,mode:"formula"}).then(r=>{r!=null&&(e.element.ds.value=r)})}return(c,r)=>(w(),L("div",{onClick:s,class:h(c.classes.code)},[d("textarea",{value:o.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,zh),l.value?(w(),K(_(D),{key:0,icon:"icon-open-new",size:"14px"})):U("",!0)],2))}}),Uh="_code_ipm2q_2",Hh={code:Uh},Gh={classes:Hh},Wh=P(Bh,[["__cssModules",Gh]]);function Yh(n){switch(n.ds.type){case ye.CONST:return f($h,{element:n},null);case ye.VARIABLE:return f(Dh,{element:n},null);case ye.CODE:return f(Fh,{element:n},null);case ye.FORMULA:return f(Wh,{element:n},null);default:return null}}const Nl=x({props:{element:{type:ve,required:!0}},setup(n){const e=N(()=>jt(n.element.type)),t=N(()=>po.filter(k=>k.value!=n.element.type)),l=Q("px"),o=Rh(n),s=Lh(n),c=Ch(n),r=wh(n),i=Sh(n),u=Nh(n),p=Ih(n),m=N(()=>{const k=n.element,S=k.parent;if(S===null||!(S instanceof kt))return!1;const v=S.header;if(v.display&&k.bottom<=(v.height??0))return!1;const T=S.parent;if(T==null)return!1;const C=S.footer;return!(C.display&&k.top>=Math.floor(_t(T.paper.height))-(C.height??0))});function g(k,S){return S==null?!1:!!S.includes(k)}function E(){const k=Nt(n.element.type);if(g(re.LAYOUT,k==null?void 0:k.exclude))return null;const S=n.element,v=g(re.COORD,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("位置")]),f("div",{class:"quickprint-config-content quickprint-form-inline"},[f(nt,{class:"quickprint-form-inline-item",label:"左",modelValue:S.left,"onUpdate:modelValue":H=>S.left=H,target:l.value},null),f(nt,{class:"quickprint-form-inline-item",label:"上",modelValue:S.top,"onUpdate:modelValue":H=>S.top=H,target:l.value},null)])]),T=g(re.SIZE)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[f("span",null,[se("尺寸")])]),f("div",{class:"quickprint-config-content quickprint-form-inline"},[f(nt,{class:"quickprint-form-inline-item",label:"宽",modelValue:o.value,"onUpdate:modelValue":H=>o.value=H,target:l.value},null),f(nt,{class:"quickprint-form-inline-item",label:"高",modelValue:s.value,"onUpdate:modelValue":H=>s.value=H,target:l.value},null)])]),C=g(re.VISIBILITY,k==null?void 0:k.exclude)?null:f(kh,{element:S},null),I=g(re.OVERFLOW,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("溢出时")]),f("div",{class:"quickprint-config-content"},[f(J,{modelValue:c.value,"onUpdate:modelValue":H=>c.value=H,options:vo,class:"quickprint-w-full"},null)])]),O=g(re.PRINT_MODE,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header "},[se("打印模式")]),f("div",{class:"quickprint-config-content"},[f(J,{modelValue:i.value,"onUpdate:modelValue":H=>i.value=H,options:go,class:"quickprint-w-full"},null)])]),Y=g(re.POSITION,k==null?void 0:k.exclude)||!m.value?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("定位模式")]),f("div",{class:"quickprint-config-content"},[f(J,{modelValue:r.value,"onUpdate:modelValue":H=>r.value=H,options:ho,class:"quickprint-w-full"},null)])]);return f("div",{class:"quickprint-config-group"},[f("div",{class:"quickprint-config-group-title quickprint-is-row"},[f("span",{class:"quickprint-is-fill-w"},[se("布局")]),f("span",null,[se("单位：")]),f(Ts,{modelValue:l.value,"onUpdate:modelValue":H=>l.value=H},null)]),v,T,C,I,O,Y])}function b(){const k=Nt(n.element.type);if(g(re.BASIC,k==null?void 0:k.exclude))return null;const S=n.element,v=g(re.PREFIX,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("前缀")]),f("div",{class:"quickprint-config-content"},[_e(f("input",{"onUpdate:modelValue":I=>S.attributes.prefix=I,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ne,S.attributes.prefix]])])]),T=g(re.SUFFIX,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("后缀")]),f("div",{class:"quickprint-config-content"},[_e(f("input",{"onUpdate:modelValue":I=>S.attributes.suffix=I,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ne,S.attributes.suffix]])])]),C=g(re.DISPLAY,k==null?void 0:k.exclude)?null:f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("数据类型")]),f("div",{class:"quickprint-config-content"},[f(J,{options:t.value,modelValue:u.value,"onUpdate:modelValue":I=>u.value=I,class:"quickprint-w-full"},null)])]);return f("div",{class:"quickprint-config-group"},[f("div",{class:"quickprint-config-group-title"},[se("基础")]),v,T,C])}function a(){const k=Nt(n.element.display);return(k==null?void 0:k.display)==null?null:st(k.display,{element:n.element})}function y(){const k=Nt(n.element.type);if(g(re.ATTRIBUTES,k==null?void 0:k.exclude))return null;const S=k!=null&&k.attributes?st(k.attributes,{element:n.element}):null,v=a();if(S==null&&v==null)return null;const T=v!=null&&S!=null?f("div",{class:"quickprint-config-divider"},null):null;return f("div",{class:"quickprint-config-group"},[f("div",{class:"quickprint-config-group-title"},[se("属性")]),v,T,S])}function R(){const k=Nt(n.element.type);return g(re.DATASOURCE,k==null?void 0:k.exclude)?null:f("div",{class:"quickprint-config-group"},[f("div",{class:"quickprint-config-group-title"},[se("数据")]),f(J,{options:Hl,modelValue:p.value,"onUpdate:modelValue":S=>p.value=S},null),Yh(n.element)])}function A(k){k(n.element.id)}return function(){const S=n.element;return f("div",{class:"quickprint-config"},[f("div",{class:"quickprint-config-title"},[f("span",null,[e.value,se("配置")]),null]),f("div",{class:"quickprint-config-body quickprint-is-fill-h quickprint-is-scrollable"},[f("div",{class:"quickprint-config-group"},[f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("标识")]),f("div",{class:"quickprint-config-content"},[f("span",{class:"quickprint-config-id"},[S.id]),f(rh,{onCopy:A},null)])]),f("section",{class:"quickprint-config-section quickprint-config-inline"},[f("header",{class:"quickprint-config-header"},[se("标题")]),f("div",{class:"quickprint-config-content"},[_e(f("input",{type:"text","onUpdate:modelValue":v=>S.title=v,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ne,S.title]])])])]),E(),b(),y(),R()])])}}}),Xh=x({setup(){const n=Ee();function e(){return f("div",null,[se("未知的打印元素")])}function t(){return f("div",null,[se("请先选择元素")])}function l(){return f("div",null,[se("请先选择页面")])}return function(){const o=n.state;if(o.selectedType===me.PAGE){const s=n.getSelectedPage();return s==null?l():f(Mm,{page:s},null)}if(o.selectMode===ot.SINGLE){const s=n.getSelectedElements()[0];return s==null?t():st(Nl,{element:s,key:s.id})}if(o.selected.length==1){const s=n.getSelectedElements()[0];return Nt(s.type)==null?e():st(Nl,{element:s,key:s.id})}return f(zm,null,null)}}});function Fe(n,e){if(n.state.selectedType!==me.ELEMENT)return;const l=n.getSelectedElements();if(l.length===1)return l[0].getStyle(e)}function $e(n,e,t){if(n.state.selectedType!==me.ELEMENT)return;const o=n.getSelectedElements();if(o.length!=0){for(const s of o)s.setStyle(e,t);n.createSnapshot()}}function Oe(n,e){if(n.state.selectedType!==me.ELEMENT)return;const l=n.getSelectedElements();if(l.length!=0){for(const o of l)o.removeStyle(e);n.createSnapshot()}}function jh(n){const e="underline";return N({get(){if(n.state.selectedType!==me.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?$e(n,e,t):Oe(n,e)}})}function Zh(n){const e="lineThrough";return N({get(){if(n.state.selectedType!==me.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?$e(n,e,t):Oe(n,e)}})}function Kh(n){const e="lineHeight";return N({get(){return Fe(n,e)},set(t){t===ht.DEFAULT?Oe(n,e):$e(n,e,t)}})}function Jh(n){const e="highlightColor";return N({get(){return Fe(n,e)??Hn.BLACK},set(t){t===""?Oe(n,e):$e(n,e,t)}})}function Qh(n){const e="backgroundColor";return N({get(){return Fe(n,e)??Hn.BLACK},set(t){t===""?Oe(n,e):$e(n,e,t)}})}function eg(n){const e="fontStyle";return N({get(){return Fe(n,e)===dl.ITALIC},set(t){t?$e(n,e,dl.ITALIC):Oe(n,e)}})}function tg(n){const e="textAlign";return N({get(){return Fe(n,e)??tt.LEFT},set(t){t===tt.LEFT?Oe(n,e):$e(n,e,t)}})}function ng(n){const e="verticalAlign";return N({get(){return Fe(n,e)??Ye.MIDDLE},set(t){t===Ye.MIDDLE?Oe(n,e):$e(n,e,t)}})}function lg(n){const e="fontFamily";return N({get(){return Fe(n,e)},set(t){t===oe.DEFAULT?Oe(n,e):$e(n,e,t)}})}function sg(n){const e="fontSize";return N({get(){return Fe(n,e)},set(t){t===be.DEFAULT?Oe(n,e):$e(n,e,t)}})}function og(n){const e="color";return N({get(){return Fe(n,e)??Se.REGULAR},set(t){$e(n,e,t)}})}function ig(n){const e="fontWeight";return N({get(){return Fe(n,e)===700},set(t){t?$e(n,e,700):Oe(n,e)}})}const rg=["title","onClick"],ag=x({__name:"BorderSelect",setup(n){const e=[le.ALL,le.NONE,le.INSIDE,le.OUTSIDE],t=Ee(),l=N(()=>{if(t.state.selectedType!==me.ELEMENT)return null;const u=t.getSelectedElements();if(u.length!==1)return null;const m=u[0].getStyle("border");if(m==null||m===le.NONE)return null;if(m===le.ALL)return{borderStyle:"solid"};const g={};return m&le.TOP&&(g.borderTopStyle="solid"),m&le.RIGHT&&(g.borderRightStyle="solid"),m&le.BOTTOM&&(g.borderBottomStyle="solid"),m&le.LEFT&&(g.borderLeftStyle="solid"),g}),o=[{label:"上框线",value:le.TOP,icon:"icon-border-top"},{label:"下框线",value:le.BOTTOM,icon:"icon-border-bottom"},{label:"左框线",value:le.LEFT,icon:"icon-border-left"},{label:"右框线",value:le.RIGHT,icon:"icon-border-right"}];function s(i){if(t.state.selectedType!==me.ELEMENT)return!1;const p=t.getSelectedElements();if(p.length!==1)return!1;const g=p[0].getStyle("border");return g==null?!1:e.includes(i)?g==i:g&i}function c(i){if(t.state.selectedType!==me.ELEMENT)return;const p=t.getSelectedElements();if(p.length!=0){for(const m of p){const g=m.getStyle("border");if(g==null){m.setStyle("border",i);continue}if(g===le.ALL){m.setStyle("border",i===le.ALL?le.NONE:i);continue}if(e.includes(i)){m.setStyle("border",i);continue}if(e.includes(g)){m.setStyle("border",i);continue}m.setStyle("border",g^i)}t.createSnapshot()}}function r(){if(t.state.selectedType!==me.ELEMENT)return;const u=t.getSelectedElements();if(u.length!=0){for(const p of u)p.setStyle("border",void 0);t.createSnapshot()}}return(i,u)=>(w(),K(_(Jl),null,{popover:he(()=>[d("div",{class:h(i.classes.popover)},[d("div",null,[(w(),L("button",{type:"button",title:"全部框线",key:_(le).ALL,class:h({"quickprint-text-btn":!0,[i.classes.tool]:!0,"quickprint-is-selected":s(_(le).ALL)}),onClick:u[0]||(u[0]=p=>c(_(le).ALL))},[f(_(D),{icon:"icon-border",size:"16px"})],2)),(w(),L("button",{type:"button",title:"无框线",key:_(le).ALL,class:h({"quickprint-text-btn":!0,[i.classes.tool]:!0}),onClick:r},[f(_(D),{icon:"icon-border-none",size:"16px"})],2))]),d("div",{class:h(i.classes.divider)},[(w(),L(W,null,te(o,p=>d("button",{type:"button",title:p.label,key:p.value,class:h({"quickprint-text-btn":!0,[i.classes.tool]:!0,"quickprint-is-selected":s(p.value)}),onClick:m=>c(p.value)},[f(_(D),{icon:p.icon,size:"16px"},null,8,["icon"])],10,rg)),64))],2)],2)]),default:he(()=>[d("div",{class:h(["quickprint-text-btn",i.classes.borderSelect]),title:"边框"},[d("div",{class:h({[i.classes.border]:!0}),style:Z(l.value)},null,6)],2)]),_:1}))}}),cg="_border_rprfx_2",ug="_borderSelect_rprfx_10",dg="_popover_rprfx_14",pg="_divider_rprfx_18",fg={border:cg,borderSelect:ug,popover:dg,divider:pg},mg={classes:fg},hg=P(ag,[["__cssModules",mg]]),gg={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},vg={class:"quickprint-config-section"},bg={class:"quickprint-form-inline"},yg={class:"quickprint-config-section quickprint-config-inline"},_g={class:"quickprint-config-section"},Eg={class:"quickprint-config-header quickprint-is-row"},Tg={class:"quickprint-is-fill-w"},kg={class:"quickprint-config-content quickprint-form-inline quickprint-form-bottom-gap"},wg={class:"quickprint-config-content quickprint-form-inline"},Sg=x({__name:"Paper",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=Q("px"),l=g("top"),o=g("bottom"),s=g("left"),c=g("right"),r=N(()=>Nn.map(E=>({label:E.size===In.CUSTOM?"自定义":`${E.size}(${E.width}mm ✕ ${E.height}mm)`,value:E.size})));function i(E){e.config.width=E,m()}function u(E){e.config.height=E,m()}function p(E){const b=Nn.find(a=>a.size===E);b!=null&&(e.config.width=b.width,e.config.height=b.height,e.config.orientation=b.orientation,e.config.margins=b.margins,e.config.size=b.size)}function m(){const E=e.config,b=Nn.find(a=>a.size===In.CUSTOM?!1:a.orientation===E.orientation&&a.width===E.width&&a.height===E.height);if(b==null){E.size=In.CUSTOM;return}E.size=b.size}function g(E){return N({get(){var b;return(b=e.config.margins)==null?void 0:b[E]},set(b){e.config.margins==null&&(e.config.margins={}),e.config.margins[E]=b}})}return(E,b)=>(w(),L("div",gg,[d("section",vg,[b[6]||(b[6]=d("header",{class:"quickprint-config-header"},[d("span",null,"尺寸")],-1)),f(_(J),{options:r.value,modelValue:n.config.size,"onUpdate:modelValue":p,class:"quickprint-form-control-block quickprint-form-bottom-gap"},null,8,["options","modelValue"]),d("div",bg,[f(xt,{class:"quickprint-form-inline-item",label:"宽",modelValue:n.config.width,min:1,"onUpdate:modelValue":i},null,8,["modelValue"]),f(xt,{class:"quickprint-form-inline-item",label:"高",modelValue:n.config.height,min:1,"onUpdate:modelValue":u},null,8,["modelValue"])])]),d("section",yg,[b[7]||(b[7]=d("header",{class:"quickprint-config-header"},"方向",-1)),f($t,{modelValue:n.config.orientation,"onUpdate:modelValue":b[0]||(b[0]=a=>n.config.orientation=a),options:_(Wl)},null,8,["modelValue","options"])]),d("section",_g,[d("header",Eg,[d("span",Tg,[f(_(Ro),{title:"纸张的打印边距，可用于标记可打印区域。请确保设打印元素在可打印区域内，避免内容被裁剪。"},{default:he(()=>b[8]||(b[8]=[se("参考边距")])),_:1})]),b[9]||(b[9]=d("span",null,"单位：",-1)),f(Ts,{modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=a=>t.value=a)},null,8,["modelValue"])]),d("div",kg,[f(nt,{class:"quickprint-form-inline-item",label:"上",modelValue:_(l),"onUpdate:modelValue":b[2]||(b[2]=a=>Ge(l)?l.value=a:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),f(nt,{class:"quickprint-form-inline-item",label:"下",modelValue:_(o),"onUpdate:modelValue":b[3]||(b[3]=a=>Ge(o)?o.value=a:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])]),d("div",wg,[f(nt,{class:"quickprint-form-inline-item",label:"左",modelValue:_(s),"onUpdate:modelValue":b[4]||(b[4]=a=>Ge(s)?s.value=a:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),f(nt,{class:"quickprint-form-inline-item",label:"右",modelValue:_(c),"onUpdate:modelValue":b[5]||(b[5]=a=>Ge(c)?c.value=a:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])])])]))}}),Cg={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},Rg={class:"quickprint-is-fill-h"},Lg={class:"quickprint-is-fill-h"},Ng=x({__name:"Font",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:Ce.NONE},{label:"磅",value:Ce.PT},{label:"像素",value:Ce.PX}],l=N(()=>wn.map(u=>(u.style={fontFamily:u.value==oe.DEFAULT?oe.SONG:u.value},u))),o=N(()=>ds.map(u=>(u.style={fontFamily:u.value==oe.DEFAULT?oe.SONG:u.value},u))),s=N({get(){return e.config.style.fontFamily??oe.DEFAULT},set(u){const p=u===oe.DEFAULT?void 0:u;e.config.style.fontFamily=p}}),c=N({get(){return e.config.style.enFontFamily??oe.DEFAULT},set(u){const p=u===oe.DEFAULT?void 0:u;e.config.style.enFontFamily=p}}),r=N({get(){return e.config.style.fontSize},set(u){const p=ae(u)?void 0:u;e.config.style.fontSize=p}}),i=N({get(){return e.config.style.lineHeight},set(u){e.config.style.lineHeight=u}});return(u,p)=>(w(),L("div",Cg,[d("section",{class:h(u.classes.font)},[d("div",{class:h(u.classes.zhFont)},[d("div",{class:h(u.classes.title)},"中文字体",2),d("div",Rg,[f(_(J),{options:l.value,modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=m=>s.value=m)},null,8,["options","modelValue"])])],2),d("div",{class:h(u.classes.enFont)},[d("div",{class:h(u.classes.title)},"西文字体",2),d("div",Lg,[f(_(J),{options:o.value,modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=m=>c.value=m)},null,8,["options","modelValue"])])],2),d("div",{class:h(u.classes.lineHeight)},[d("div",{class:h(u.classes.title)},"行高",2),f(mt,{modelValue:i.value,"onUpdate:modelValue":p[2]||(p[2]=m=>i.value=m),options:t},null,8,["modelValue"])],2),d("div",{class:h(u.classes.fontSize)},[d("div",{class:h(u.classes.title)},"字号",2),f(ys,{modelValue:r.value,"onUpdate:modelValue":p[3]||(p[3]=m=>r.value=m),height:"144px"},null,8,["modelValue"])],2)],2)]))}}),Ig="_font_145qf_2",$g="_zhFont_145qf_9",xg="_enFont_145qf_16",Ag="_lineHeight_145qf_23",Dg="_fontSize_145qf_30",qg="_title_145qf_45",Og={font:Ig,zhFont:$g,enFont:xg,lineHeight:Ag,fontSize:Dg,title:qg},Mg={classes:Og},Pg=P(Ng,[["__cssModules",Mg]]),Vg=x({__name:"index",props:{doc:{type:ge,required:!0}},setup(n){const e=n,t=Pe(),l=De(c()),o=Q("paper"),s=[{label:"纸张",value:"paper"},{label:"字体",value:"font"}];function c(){const p=e.doc;return{size:p.paper.size,width:p.paper.width,height:p.paper.height,orientation:p.paper.orientation,margins:p.margins?{...p.margins}:void 0,style:{...p.style}}}function r(p){o.value=p.value}function i(){t==null||t.confirm(l)}function u(){t==null||t.cancel()}return(p,m)=>(w(),L("div",{class:h(p.classes.setting)},[d("div",{class:h(p.classes.header)},[d("div",{class:h(p.classes.headerLeft)},[f(_(D),{icon:"icon-setting",size:"14px"}),d("span",{class:h(p.classes.title)},"文档",2),f(_s,{tabs:s,active:o.value,onSwitch:r},null,8,["active"])],2),_(t)?(w(),K(_(Xn),{key:0,instance:_(t)},null,8,["instance"])):U("",!0)],2),o.value=="paper"?(w(),K(Sg,{key:0,config:l},null,8,["config"])):U("",!0),o.value=="font"?(w(),K(Pg,{key:1,config:l},null,8,["config"])):U("",!0),d("div",{class:h(p.classes.footer)},[d("button",{type:"button",class:"quickprint-text-btn",onClick:u},"取消"),d("button",{type:"button",class:"quickprint-text-btn",onClick:i},"确定")],2)],2))}}),Fg="_setting_nhkf0_2",zg="_header_nhkf0_11",Bg="_headerLeft_nhkf0_23",Ug="_title_nhkf0_36",Hg="_tabs_nhkf0_43",Gg="_footer_nhkf0_48",Wg={setting:Fg,header:zg,headerLeft:Bg,title:Ug,tabs:Hg,footer:Gg},Yg={classes:Wg},Xg=P(Vg,[["__cssModules",Yg]]),jg=Ve(function(n){return Zt("文档设置",f(Xg,{doc:n},null),{preset:"setting"}).promisify().then(e=>(n.paper.size=e.size,n.paper.width=e.width,n.paper.height=e.height,n.paper.orientation=e.orientation,n.margins=e.margins,n.style=e.style,e)).catch(qe)}),Zg=x({props:{toolbar:{type:Array,required:!0}},setup(n){const e=Ee(),t=Ie("classes"),l=lg(e),o=sg(e),s=Kh(e),c=Qh(e),r=Jh(e),i=og(e),u=ig(e),p=eg(e),m=jh(e),g=Zh(e),E=tg(e),b=ng(e),a=N(()=>wn.map(q=>(q.style={fontFamily:q.value==oe.DEFAULT?oe.SONG:q.value},q)));function y(q){return f("button",{type:"button",class:"quickprint-text-btn",onClick:()=>q.handler(e)},[q.icon&&f(D,{icon:q.icon},null),f("span",null,[q.label])])}function R(q){q.preventDefault()}function A(){u.value=!u.value}function k(){p.value=!p.value}function S(){m.value=!m.value}function v(){g.value=!g.value}function T(){const q=e.getSelectedElements();if(q.length==0)return;const j=Math.min(...q.map(ee=>ee.left));for(const ee of q)ee.setLeft(j,!0);e.createSnapshot()}function C(){const q=e.getSelectedElements();if(q.length==0)return;const j=q[0].page;if(j==null)return;const ee=_t(j.width);for(const M of q)M.setLeft((ee-M.width)/2);e.createSnapshot()}function I(){const q=e.getSelectedElements();if(q.length==0)return;const j=Math.max(...q.map(ee=>ee.left+ee.width));for(const ee of q)ee.setLeft(j-ee.width,!0);e.createSnapshot()}async function O(){const q=await wa(e.doc);q!=null&&(e.doc.ds=e.doc.createDS(q))}function Y(){jg(e.doc)}function H(q){var j,ee;if(typeof q=="function")return q(e,t);if(typeof q=="object")return y(q);if(typeof q!="string")return null;switch(q){case"divider":case"---":return f("div",{class:t.divider},null);case"space":return f("div",{class:"quickprint-is-fill-w"},null);case"undo":{const M=!e.history.allowUndo();return f("button",{type:"button",title:"撤销 Ctrl + Z",class:"quickprint-text-btn",disabled:M,onClick:e.history.undo},[f(D,{icon:"icon-undo"},null)])}case"redo":{const M=!e.history.allowRedo();return f("button",{type:"button",title:"重做 Ctrl + Y",class:"quickprint-text-btn",disabled:M,onClick:e.history.redo},[f(D,{icon:"icon-redo"},null)])}case"delete":return f("button",{type:"button",class:["quickprint-text-btn",t.tool],title:"删除",onClick:e.deleteSelectedElement},[f(D,{icon:"icon-delete",size:"16px"},null)]);case"fontFamily":return f(J,{title:"字体",width:"80px",modelValue:l.value,"onUpdate:modelValue":M=>l.value=M,options:a.value,class:t.tool,button:!0},null);case"fontSize":return f(J,{title:"字号",width:"60px",modelValue:o.value,"onUpdate:modelValue":M=>o.value=M,options:il,class:t.tool,button:!0},null);case"lineHeight":return f(J,{title:"行高",width:"60px",modelValue:s.value,"onUpdate:modelValue":M=>s.value=M,options:ps,class:t.tool,popoverWidth:120,button:!0},null);case"backgroundColor":return f(lt,{modelValue:c.value,"onUpdate:modelValue":M=>c.value=M,class:t.tool},{default:()=>[f("div",{class:t.colorIcon,title:"背景色"},[f(D,{icon:"icon-bg-color-a",size:"15px"},null),f("div",{class:t.colorIndicator,style:{backgroundColor:c.value}},null)])]});case"highlightColor":return f(lt,{modelValue:r.value,"onUpdate:modelValue":M=>r.value=M,class:t.tool},{default:()=>[f("div",{class:t.colorIcon,title:"突出显示"},[f(D,{icon:"icon-bg-color-b",size:"15px"},null),f("div",{class:t.colorIndicator,style:{backgroundColor:r.value}},null)])]});case"fontColor":return f(lt,{modelValue:i.value,"onUpdate:modelValue":M=>i.value=M,class:t.tool},{default:()=>[f("div",{class:t.colorIcon,title:"字体颜色"},[f(D,{icon:"icon-font",size:"15px"},null),f("div",{class:t.colorIndicator,style:{backgroundColor:i.value}},null)])]});case"fontWeight":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":u.value};return f("button",{type:"button",title:"加粗",class:M,onClick:A},[f(D,{icon:"icon-font-bold",size:"16px"},null)])}case"fontStyle":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":p.value};return f("button",{type:"button",title:"斜体",class:M,onClick:k},[f(D,{icon:"icon-italic",size:"16px"},null)])}case"underline":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":m.value};return f("button",{type:"button",title:"下划线",class:M,onClick:S},[f(D,{icon:"icon-underline",size:"16px"},null)])}case"throughLine":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":g.value};return f("button",{type:"button",title:"删除线",class:M,onClick:v},[f(D,{icon:"icon-through-line",size:"16px"},null)])}case"border":return f(hg,null,null);case"textAlign":{const M=((j=Fn.find(ce=>ce.value===E.value))==null?void 0:j.label)??"水平对齐",pe={selected({option:ce}){return f(D,{icon:ce==null?void 0:ce.icon,class:"quickprint-is-self-center"},null)}};return f(J,{modelValue:E.value,"onUpdate:modelValue":ce=>E.value=ce,options:Fn,title:M,class:t.tool,width:"36px",size:"mini",button:!0},pe)}case"verticalAlign":{const M=((ee=Vn.find(ce=>ce.value===b.value))==null?void 0:ee.label)??"垂直对齐",pe={selected({option:ce}){return f(D,{icon:ce==null?void 0:ce.icon,class:"quickprint-is-self-center"},null)}};return f(J,{modelValue:b.value,"onUpdate:modelValue":ce=>b.value=ce,options:Vn,title:M,class:t.tool,width:"36px",size:"mini",button:!0},pe)}case"alignLeft":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return f("button",{type:"button",title:"左侧对齐",class:M,onClick:T},[f(D,{icon:"icon-layout-align-left",size:"16px"},null)])}case"alignCenter":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return f("button",{type:"button",title:"水平居中",class:M,onClick:C},[f(D,{icon:"icon-layout-align-center",size:"16px"},null)])}case"alignRight":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return f("button",{type:"button",title:"右侧对齐",class:M,onClick:I},[f(D,{icon:"icon-layout-align-right",size:"16px"},null)])}case"useGrid":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.doc.useGrid};return f("button",{type:"button",title:"网格",class:M,onClick:e.toggleBackground},[f(D,{icon:"icon-beijing",size:"16px"},null)])}case"elementPanel":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.state.panel.left};return f("button",{type:"button",title:"元素面板",class:M,onClick:e.toggleElementPanel},[f(D,{icon:"icon-pintu",size:"16px"},null)])}case"configPanel":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.state.panel.right};return f("button",{type:"button",title:"配置面板",class:M,onClick:e.toggleConfigPanel},[f(D,{icon:"icon-config",size:"16px"},null)])}case"datasource":return f("button",{type:"button",class:"quickprint-text-btn",onClick:O},[f(D,{icon:"icon-datasource"},null),f("span",null,[se("数据源")])]);case"document":return f("button",{type:"button",class:"quickprint-text-btn",onClick:Y},[f(D,{icon:"icon-file-text"},null),f("span",null,[se("文档配置")])]);default:return null}}return function(){return f("div",{class:t.toolbar,onMousedown:R},[n.toolbar.map(H)])}}}),Kg="_toolbar_1bhq2_2",Jg="_divider_1bhq2_8",Qg="_tool_1bhq2_2",ev="_colorIcon_1bhq2_18",tv="_colorIndicator_1bhq2_38",nv={toolbar:Kg,divider:Jg,tool:Qg,colorIcon:ev,colorIndicator:tv},lv={classes:nv},sv=P(Zg,[["__cssModules",lv]]);function ov(n){let e=null;const t=ue(),l=De({width:0,height:0,scrollTop:0,scrollLeft:0}),o=ue(),s=De({id:"",top:0,left:0,width:0,height:0});async function c(){await Pt();const E=t.value;E!=null&&(l.width=E.offsetWidth,l.height=E.offsetHeight)}function r(E){const b=E.target;l.scrollLeft=b.scrollLeft,l.scrollTop=b.scrollTop}function i(E){const a=E.target.closest("."+G.PAPER);a!=null&&(o.value=a,p(a),u())}async function u(){await Pt();const E=o.value;E!=null&&(s.id=E.id.slice(1),s.width=E.offsetWidth,s.height=E.offsetHeight,s.top=E.offsetTop,s.left=E.offsetLeft)}function p(E){E!=null&&(o.value&&(e==null||e.unobserve(o.value)),e==null||e.observe(E))}function m(){const E=n.doc.firstPage;if(E==null)return;const b=document.querySelector("#\\@"+E.id);o.value=b,e&&b&&e.observe(b),u()}function g(E){E.some(b=>b.target.matches("."+G.CANVAS))&&(c(),u()),E.some(b=>b.target.matches("."+G.PAPER))&&(c(),u())}return Jn(()=>n.state.scale,()=>u()),Jt(()=>{e=new ResizeObserver(g),e.observe(t.value),m(),c()}),oo(()=>{e==null||e.disconnect(),e=null}),{canvasRef:t,canvasRect:l,pageRect:s,onScroll:r,onSelectPage:i}}const Ss=Object.freeze(["undo","redo","delete","---","fontFamily","fontSize","lineHeight","---","backgroundColor","highlightColor","fontColor","fontWeight","fontStyle","underline","throughLine","---","border","textAlign","verticalAlign","---","alignLeft","alignCenter","alignRight","---","useGrid","elementPanel","configPanel","---","datasource","document"]),iv=x({__name:"index",props:wt({modelValue:{type:ge,required:!0},toolbar:{type:Array,default(){return Ss}}},{modelValue:{required:!0},modelModifiers:{}}),emits:wt(["save","preview"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=ue(),o=ue(),s=_o(),c=Kt(n,"modelValue"),r=qd(c,{queryElement:R,dispatchEvent:A}),{canvasRef:i,canvasRect:u,pageRect:p,onScroll:m,onSelectPage:g}=ov(r),E=N(()=>({"--quickprint-page-scale":r.state.scale/100,"--quickprint-dpr":s.value})),b=N(()=>{const T=r.doc.style;return{fontFamily:tl(T==null?void 0:T.fontFamily,T==null?void 0:T.enFontFamily),fontSize:T==null?void 0:T.fontSize,lineHeight:T==null?void 0:T.lineHeight}});function a(){r.state.panel.left=!1}function y(){r.state.panel.right=!1}function R(T){switch(T){case"ghost":return o.value;case"root":return l.value;default:return}}function A(T,...C){t(T,...C)}function k(T){T.deltaY>0?r.zoomIn():r.zoomOut()}function S(){t("preview",c.value)}function v(){t("save",c.value)}return(T,C)=>(w(),L("div",{class:h(T.classes.designer),ref_key:"rootRef",ref:l,style:Z(E.value)},[d("div",{class:h(T.classes.header)},[Me(T.$slots,"headerLeft"),f(sv,{class:h(T.classes.toolbar),toolbar:n.toolbar},null,8,["class","toolbar"]),Me(T.$slots,"headerRight")],2),d("div",{class:h(T.classes.main)},[_(r).state.panel.left?(w(),L("div",{key:0,class:h(T.classes.left)},[d("button",{type:"button",onClick:a,class:h(["quickprint-text-btn",T.classes.closePanelBtn])},[f(_(D),{icon:"icon-close",size:"12px"})],2),f(rm)],2)):U("",!0),d("div",{class:h([T.classes.center,_(G).CANVAS]),onWheelPassive:ie(k,["ctrl","stop","prevent"]),ref_key:"canvasRef",ref:i},[f(Rl,{canvas:_(u),page:_(p),scale:_(r).state.scale,direction:"horizontal"},null,8,["canvas","page","scale"]),f(Rl,{canvas:_(u),page:_(p),scale:_(r).state.scale,direction:"vertical"},null,8,["canvas","page","scale"]),d("div",{class:h([_(G).SCROLLABLE,T.classes.canvas]),style:Z(b.value),onScroll:C[0]||(C[0]=(...I)=>_(m)&&_(m)(...I)),onClickCapture:C[1]||(C[1]=(...I)=>_(g)&&_(g)(...I))},[(w(!0),L(W,null,te(c.value.pages,I=>(w(),K(Zf,{key:I.id,doc:c.value,page:I,onSave:v,onPreview:S},null,8,["doc","page"]))),128))],38),d("div",{class:h(T.classes.footer)},[f(gm),f(_(Xs),{scale:_(r).state.scale,onZoomIn:_(r).zoomIn,onZoomOut:_(r).zoomOut},null,8,["scale","onZoomIn","onZoomOut"])],2)],34),_(r).state.panel.right?(w(),L("div",{key:1,class:h(T.classes.right)},[d("button",{type:"button",onClick:y,class:h(["quickprint-text-btn",T.classes.closePanelBtn])},[f(_(D),{icon:"icon-close",size:"12px"})],2),f(_(Xh))],2)):U("",!0)],2),d("div",{ref_key:"ghostRef",ref:o,class:h(T.classes.ghost)},null,2),f(_(js))],6))}}),rv="_designer_grxxm_2",av="_header_grxxm_17",cv="_toolbar_grxxm_25",uv="_footer_grxxm_31",dv="_main_grxxm_47",pv="_left_grxxm_55",fv="_center_grxxm_63",mv="_right_grxxm_75",hv="_canvas_grxxm_83",gv="_closePanelBtn_grxxm_96",vv="_ghost_grxxm_103",bv={designer:rv,header:av,toolbar:cv,footer:uv,main:dv,left:pv,center:fv,right:mv,canvas:hv,closePanelBtn:gv,ghost:vv},yv={classes:bv},_v=P(iv,[["__cssModules",yv]]),Ev={default:{pinnable:!1},editor:{pinnable:!1,mask:!0,top:"15vh",width:"800px",height:"480px",resizeMode:on.DISABLED,menus:[{label:"确定",handler:n=>n.dispatchConfirm().catch(qe)}]},docDebug:{width:"1200px",height:"860px",menus:[{label:"保存",handler:n=>n.dispatchConfirm()}]},elementDebug:{width:"1200px",height:"860px",pinnable:!1},setting:{pinnable:!1,top:"15vh",width:"420px",height:"520px",resizeMode:on.DISABLED},variable:{pinnable:!1,top:"15vh",width:"840px",height:"600px",mask:!0,resizeMode:on.DISABLED}};function Tv(n,e={}){const t=Zs(e.zIndexManager);n.use(Ks,{zIndex:t,presets:Ev}),Js(n._context)}const kv="0.0.0",wv={version:kv,install:Tv},Sv=["onClick"],Cv=x({__name:"SwitchCase",emits:["switch"],setup(n,{emit:e}){const t=Pe();function l(o){t==null||t.confirm(o)}return(o,s)=>(w(),L("div",{class:h(o.classes.panel)},[(w(!0),L(W,null,te(_(Qs),(c,r)=>(w(),L("div",{key:c.id,class:h(o.classes.item),onClick:i=>l(c)},[d("div",null,[d("span",null,z(r+1)+". ",1),d("span",null,z(c.name),1)])],10,Sv))),128))],2))}}),Rv="_panel_1he7q_2",Lv="_item_1he7q_9",Nv={panel:Rv,item:Lv},Iv={classes:Nv},$v=P(Cv,[["__cssModules",Iv]]),xv="local",Il="quickprint-local-define",Av=x({__name:"index",setup(n){const e=Ie("classes"),t=E(),l="20250817",o=[{label:"新建",icon:"icon-file-text",handler:p},{label:"加载示例",icon:"icon-import",handler:i},"---",...Ss];function s(){const b=JSON.stringify(t.value);localStorage.setItem(Il,b)}function c(){s()}function r(){const b=t.value.id,a=b.startsWith("case_")?b:xv,y=`${window.location.origin}/preview.html?id=${a}`;s(),Tt("文档预览",st("iframe",{src:y,className:e.iframe}),{pinnable:!1,mask:!0,closeOnPressEsc:!0,width:Math.min(Math.max(1600,t.value.paperWidth+240),window.innerWidth-20)+"px",height:"calc(100vh - 100px)",menus:[{label:"从外部打开链接",handler(R){window.open(y,"_blank"),R.close()}}]})}function i(){const b={mask:!0,top:"15vh",width:"800px",height:"600px",resizeMode:on.DISABLED};Tt("选择示例",st($v),b).promisify().then(a=>u(a.id)).catch(qe)}async function u(b){const a=await pl(b,!1);a!=null&&(eo(b),t.value=ge.create(a.define),m())}function p(){const b=ge.createNormalDocument();t.value=b,m()}function m(){document.title=t.value.name+" - OpenPrint(开发中...)"}async function g(){const b=localStorage.getItem(Il);if(b!=null)return ge.create(b);const a=to(),y=await pl(a.id,!1);return y==null?ge.createNormalDocument():ge.create(y.define)}function E(){const b=Q();return g().then(a=>{b.value=a,m()}),b}return(b,a)=>_(t)?(w(),K(_(_v),{modelValue:_(t),"onUpdate:modelValue":a[0]||(a[0]=y=>Ge(t)?t.value=y:null),toolbar:o,class:h(_(e).main),key:_(t).id,onSave:c,onPreview:r},{headerLeft:he(()=>[d("div",{class:h(_(e).logo)},[a[1]||(a[1]=d("h1",null,"OpenPrint",-1)),d("div",{class:h(_(e).dev)},"DEV_"+z(_(l)),3)],2)]),headerRight:he(()=>[d("div",{class:h(_(e).operate)},[d("button",{type:"button",class:"quickprint-text-btn",title:"预览",onClick:r},[f(_(D),{icon:"icon-run"}),a[2]||(a[2]=d("span",null,"预览",-1))]),d("button",{type:"button",onClick:s,class:"quickprint-text-btn",title:"保存"},[f(_(D),{icon:"icon-save"}),a[3]||(a[3]=d("span",null,"保存",-1))])],2)]),_:1},8,["modelValue","class"])):U("",!0)}}),Dv="_main_he2u6_2",qv="_iframe_he2u6_6",Ov="_divider_he2u6_14",Mv="_logo_he2u6_20",Pv="_dev_he2u6_39",Vv="_operate_he2u6_51",Fv={main:Dv,iframe:qv,divider:Ov,logo:Mv,dev:Pv,operate:Vv},zv={classes:Fv},Bv=P(Av,[["__cssModules",zv]]),Cs=io(Bv);Cs.use(wv);Cs.mount("#app");
