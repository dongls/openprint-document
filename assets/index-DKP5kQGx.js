const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/component-dgQ-nAH0.js","assets/vue-C4hvfNT6.js","assets/component-L55ah7FP.css","assets/component-ChG9rybb.js","assets/utils-B5FdvqY9.js","assets/utils-B7EFy5Gd.css","assets/component-DVhZYvzc.css"])))=>i.map(i=>d[i]);
var Do=Object.defineProperty;var dl=n=>{throw TypeError(n)};var Oo=(n,e,t)=>e in n?Do(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var F=(n,e,t)=>Oo(n,typeof e!="symbol"?e+"":e,t),On=(n,e,t)=>e.has(n)||dl("Cannot "+t);var ke=(n,e,t)=>(On(n,e,"read from private field"),t?t.call(n):e.get(n)),ze=(n,e,t)=>e.has(n)?dl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ut=(n,e,t,l)=>(On(n,e,"write to private field"),l?l.call(n,t):e.set(n,t),t),Ce=(n,e,t)=>(On(n,e,"access private method"),t);import{D as ve,E as yt,N as Yt,a as pt,b as X,c as De,P as jn,d as Zt,e as fl,f as hn,g as vn,O as Kt,h as ne,i as on,j as bn,L as xe,I as $,_ as z,k as ql,s as Tn,l as Mo,m as ie,n as $o,B as te,o as Po,S as Zn,p as Kn,F as le,V as Ye,q as Jn,r as me,t as Vo,u as et,U as Fn,v as Dl,w as Et,x as yn,y as tt,z as Ol,A as Ml,C as $l,G as he,H as Ke,J as Bo,T as Fo,K as Be,R as Tt,M as $e,Q as Qt,W as nt,X as zo,Y as Uo,Z as Ho,$ as Qn,a0 as el,a1 as Pl,a2 as Ut,a3 as un,a4 as Rt,a5 as En,a6 as gt,a7 as be,a8 as Go,a9 as dn,aa as Nt,ab as ht,ac as lt,ad as Wo,ae as St,af as It,ag as Yo,ah as Xo,ai as jo,aj as Zo,ak as Ko,al as Jo,am as Ne,an as Re,ao as Qo,ap as Pt,aq as sn,ar as pl,as as es,at as ml,au as Mn,av as $n,aw as ts,ax as ns,ay as fn,az as ls,aA as os,aB as ss,aC as is,aD as gl,aE as rs,aF as as}from"./utils-B5FdvqY9.js";import{r as ce,o as tl,d as P,c as I,a as S,n as h,b as f,e as p,f as Xe,u as Le,s as ue,g as Me,h as N,w as oe,i as y,j as Q,k as H,T as Vl,l as J,m as wt,p as en,q as Bl,F as Z,t as re,v as Y,x as Vt,y as hl,z as Fl,A as zl,B as _e,C as Ae,D as se,E as ye,G as Bt,H as cs,I as Ul,J as tn,K as nl,L as Pn,M as Ge,N as kt,O as us,P as ds,Q as fs,R as ps}from"./vue-C4hvfNT6.js";const Hl="@quickprint_drag_mode",Gl="@quickprint_drop_data",Sn="@quickprint_operate",je="@quickprint_element",ll="@quickprint_element_type",Wl="@quickprint_resize_flag",_t=160,wn=32,Ht=[50,75,100,125,150,200,300,400];var Xt=(n=>(n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n))(Xt||{}),Lt=(n=>(n[n.NONE=0]="NONE",n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n[n.BOTTOM_RIGHT=10]="BOTTOM_RIGHT",n))(Lt||{});const it={SINGLE:0,MULTIPLE:1},Ie=Object.freeze({INSERT:0,MOVE:1}),ol=Object.freeze({DRAG_ELEMENT:0,SELECTION:1}),G=Object.freeze({CANVAS:"quickprint-is-canvas",DRAGGABLE:"quickprint-is-draggable",DRAGGING:"quickprint-is-dragging",RESIZEABLE:"quickprint-is-resizeable",RESIZEABLE_INDICATOR:"quickprint-is-resizeable-indicator",RESIZING:"quickprint-is-resizing",DROPPABLE:"quickprint-is-droppable",ELEMENT:"quickprint-is-element",ELEMENT_EDITOR:"quickprint-is-element-editor",PAGE:"quickprint-is-page",PAPER:"quickprint-is-paper",SCROLLABLE:"quickprint-is-scrollable",SELECTABLE:"quickprint-is-selectable",SELECTED:"quickprint-is-selected",GUIDE_LINE:"quickprint-is-guideline"}),pe=Object.freeze({NONE:0,ELEMENT:1,PAGE:2}),Yl=[{label:"固定值",value:ve.CONST},{label:"变量",value:ve.VARIABLE},{label:"公式",value:ve.FORMULA,detail:"使用内置的公式生成数据"},{label:"自定义",value:ve.CODE,detail:"使用Javascript代码生成数据"}],ms=[{label:"显示",value:yt.VISIBLE,detail:"元素总是可见"},{label:"隐藏",value:yt.HIDDEN,detail:"元素在打印时隐藏"},{label:"满足条件时显示",value:yt.CONDITION,detail:"元素只在满足指定条件后显示"}],gs=[{label:"四舍五入",value:Yt.ROUND},{label:"向下舍入",value:Yt.FLOOR},{label:"向上舍入",value:Yt.CEIL},{label:"四舍六入",value:Yt.BANKER_ROUND}],hs=[{label:"原始值",value:pt.NONE},{label:"固定位数",value:pt.FIXED},{label:"金额千位",value:pt.THOUSAND},{label:"金额万位",value:pt.TEN_THOUSAND},{label:"金额大写",value:pt.DAXIE},{label:"百分比",value:pt.PERCENTAGE}],vs=[{label:"显示",value:!0},{label:"隐藏",value:!1}],bs=[{label:"默认",value:void 0},{label:"文本",value:X.TEXT},{label:"数字",value:X.NUMBER},{label:"日期",value:X.DATE}],ae={LAYOUT:0,COORD:1,SIZE:2,POSITION:3,VISIBILITY:5,OVERFLOW:6,PRINT_MODE:7,BASIC:100,PREFIX:101,SUFFIX:102,DISPLAY:103,ATTRIBUTES:200,DATASOURCE:300},Xl=[{label:"年-月",value:De.YEAR_MONTH,detail:"示例：2024-12"},{label:"年月",value:De.YEAR_MONTH_CHS,detail:"示例：2024年12月"},{label:"年-月-日",value:De.YEAR_MONTH_DAY,detail:"示例：2024-12-01"},{label:"年月日",value:De.YEAR_MONTH_DAY_CHS,detail:"示例：2024年12月01日"},{label:"年-月-日 时:分",value:De.DATETIME_SHORT,detail:"示例：2024-12-01 12:00"},{label:"年-月-日 时:分:秒",value:De.DATETIME,detail:"示例：2024-12-01 12:00:00"},{label:"时:分:秒",value:De.TIME,detail:"示例：12:00:00"},{label:"时:分",value:De.TIME_SHORT,detail:"示例：12:00"},{label:"年",value:De.YEAR,detail:"示例：2024"},{label:"月",value:De.MONTH,detail:"示例：12"},{label:"日",value:De.DAY,detail:"示例：01"}];Xl.forEach(n=>n.detail=`模板：${n.value}
${n.detail}`);const ys=[{label:"元素值",value:jn.ELEMENT_VALUR}],Es=[{label:"基于纸张",value:Zt.PAPER},{label:"基于内容",value:Zt.CONTENT}],jl=[{label:"纵向",value:fl.PORTRAIT},{label:"横向",value:fl.LANDSCAPE}],_s=[{label:"当前位置",value:hn.DEFAULT,detail:"元素按当前位置进行定位，参与分页。如果之前的元素尺寸变化，会进行相应调整"},{label:"固定位置",value:hn.FIXED,detail:"元素会在固定位置显示，不参与分页"}],Ts=[{label:"单次打印",value:vn.ONCE,detail:"元素只打印一次"},{label:"每页打印",value:vn.EACH,detail:"元素将每页打印一次"}],Ss=[{label:"按内容调整高度",value:Kt.AUTO,detail:"元素内容溢出时，将会根据内容自动调整元素高度"},{label:"隐藏溢出内容",value:Kt.HIDDEN,detail:"元素内容溢出时，内容将会被隐藏"},{label:"缩放内容",value:Kt.SCALE,detail:"元素内容溢出时，会对内容进行缩放，确保内容全部显示",disabled:!0}],zn=[{label:"页码",value:on.PAGE_NUMBER,type:ne.NUMBER},{label:"总页数",value:on.PAGE_TOTAL,type:ne.NUMBER},{label:"行序号",value:on.ROW_INDEX,type:ne.NUMBER},{label:"当前时间",value:on.CURRENT_DATE,type:ne.DATE}],ws=["[0.3.pageNumber]","'[0.3.pageNumber]/[0.3.pageTotal]'","'第[0.3.pageNumber]页/共[0.3.pageTotal]页'"];function Zl(n,e){return e=="body"?document.body:e=="parent"?n.parentElement:n.closest("."+e)}function ks(n,e){const t=n.getBoundingClientRect(),l=e.getBoundingClientRect();return!(t.top>l.bottom||t.right<l.left||t.bottom<l.top||t.left>l.right)}function Kl(n){return n.isSelected?n.type===X.PARAGRAPH?52:n.type===X.TABLE?32:20:20}function Cs(){const n=ce(window.devicePixelRatio),e=()=>n.value=window.devicePixelRatio,t=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return t.addEventListener("change",e),window.addEventListener("resize",e),tl(()=>{t.removeEventListener("change",e),window.removeEventListener("resize",e)}),n}class Rs{constructor(e,t,l){F(this,"originalEvent");F(this,"target");F(this,"ghost");F(this,"container");F(this,"paths",[]);F(this,"dropTarget");F(this,"top",0);F(this,"left",0);F(this,"deltaX");F(this,"deltaY");F(this,"moved",!1);this.originalEvent=e,this.ghost=t,this.target=t,this.container=l;const s=t.getBoundingClientRect();this.deltaX=s.left-e.clientX,this.deltaY=s.top-e.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.ghost.setPointerCapture(this.originalEvent.pointerId)}}var Dt,Ot,rt,Jl,Ql,eo;const bt=class bt extends bn{constructor(t={}){var l,s,o;super();ze(this,rt);F(this,"context",null);F(this,"selector");F(this,"scale");F(this,"onDragStart");ze(this,Dt);ze(this,Ot);this.selector={container:((l=t.selector)==null?void 0:l.container)??G.PAGE,element:((s=t.selector)==null?void 0:s.element)??G.DRAGGABLE,droppable:((o=t.selector)==null?void 0:o.droppable)??G.DROPPABLE},this.onDragStart=Ce(this,rt,Jl).bind(this),this.scale=t.scale,ut(this,Dt,Ce(this,rt,Ql).bind(this)),ut(this,Ot,Ce(this,rt,eo).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){this.context!=null&&(window.removeEventListener("pointermove",ke(this,Dt)),window.removeEventListener("pointerup",ke(this,Ot)),this.context=null)}};Dt=new WeakMap,Ot=new WeakMap,rt=new WeakSet,Jl=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.element);if(l==null)return xe.warn(bt.TAG_NAME,"未找到的可拖拽元素");const s=this.selector.container,o=Zl(l,s);this.context=new Rs(t,l,o);const a=this.createEvent("before-dragstart",this.context);if(this.dispatch(a).defaultPrevented)return xe.warn(bt.TAG_NAME,"已取消拖拽");if(this.context.container==null)return xe.warn(bt.TAG_NAME,"未找到的拖拽元素的容器");this.context.init(this.normalizeScale());const i=this.createEvent("dragstart",this.context);if(this.dispatch(i).defaultPrevented)return xe.warn(bt.TAG_NAME,"已取消拖拽");t.stopPropagation(),t.preventDefault(),window.addEventListener("pointermove",ke(this,Dt)),window.addEventListener("pointerup",ke(this,Ot))},Ql=function(t){const l=this.context;if(l==null)return;const s=l.container.getBoundingClientRect(),o=document.elementsFromPoint(t.clientX,t.clientY),a=Array.from(o).filter(r=>!(r===l.ghost||r===l.target||l.ghost.contains(r))),i=this.normalizeScale();l.originalEvent=t,l.paths=a,l.dropTarget=a.find(r=>r.matches("."+G.DROPPABLE)),l.top=(t.clientY+l.deltaY-s.top)/i,l.left=(t.clientX+l.deltaX-s.left)/i,!this.dispatch(this.createEvent("dragging",l)).defaultPrevented&&(l.ghost.style.top=l.top+"px",l.ghost.style.left=l.left+"px")},eo=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const s=this.createEvent("dragend",l);this.dispatch(s).defaultPrevented||this.reset()},F(bt,"TAG_NAME","quickprint-draggable");let Un=bt;const Ns=["title"],Ls=P({__name:"HelpTitle",props:{title:{type:String,required:!0}},setup(n){return(e,t)=>(S(),I("span",{title:n.title,class:h(e.classes.help)},[f("span",null,[Xe(e.$slots,"default")]),p($,{icon:"icon-question-circle"})],10,Ns))}}),Is="_help_1l6l8_2",xs={help:Is},As={classes:xs},qs=z(Ls,[["__cssModules",As]]),Ds=P({__name:"Popover",props:{width:{type:Number,default:null}},emits:["show","close"],setup(n,{expose:e,emit:t}){const l=n,s=t,o=Le("classes"),a=ce(!1),i=ue(),r=ue(),d=Me({minWidth:0,top:0,left:0,visible:!1}),u=N(()=>({minWidth:l.width==null?d.minWidth+"px":l.width+"px",top:d.top+"px",left:d.left+"px",visibility:d.visible?"visible":"hidden",zIndex:ql()}));async function m(){if(a.value)return g();a.value=!0,s("show"),await Tn(),T()}function g(){A(),a.value=!1,s("close")}function E(C){if(!(C.target instanceof Node))return;const L=i.value;if(L&&L.contains(C.target))return C.preventDefault();const k=r.value;if(k&&k.contains(C.target))return C.preventDefault();g()}function v(){const C=i.value,L=r.value;if(L==null||C==null)return;const k=C.getBoundingClientRect(),w=L.getBoundingClientRect(),_=l.width==null?k.width:l.width;let R=k.bottom+1;R+w.height>window.innerHeight&&k.top>w.height&&(R=k.top-w.height-1);let x=k.left;x+w.width>window.innerWidth&&(x=window.innerWidth-w.width-2),d.minWidth=_,d.top=R,d.left=x,d.visible=!0}function c(C){const L=C.target;if(!(L instanceof HTMLElement))return;const k=i.value;k==null||!L.contains(k)||g()}function b(C){if(C.key!=="Escape")return;const L=r.value;if(L!=null){const k=L.style.zIndex;if(Number(k)<Mo())return}C.preventDefault(),g()}function T(){window.addEventListener("click",E,{capture:!0}),window.addEventListener("contextmenu",g,{capture:!0}),window.addEventListener("scroll",c,{capture:!0,passive:!0}),window.addEventListener("resize",v),window.addEventListener("keydown",b)}function A(){window.removeEventListener("click",E,!0),window.removeEventListener("contextmenu",g,!0),window.removeEventListener("scroll",c,!0),window.removeEventListener("resize",v),window.removeEventListener("keydown",b)}return e({close:g}),(C,L)=>(S(),I("div",{class:h(y(o).reference),onClick:oe(m,["stop"]),ref_key:"referenceRef",ref:i,tabindex:"0"},[Xe(C.$slots,"default"),a.value?(S(),Q(Vl,{key:0,to:"body"},[f("div",{class:h(y(o).popover),onVnodeMounted:v,onMousedown:L[0]||(L[0]=oe(()=>{},["prevent"])),style:J(u.value),ref_key:"popoverRef",ref:r},[Xe(C.$slots,"popover")],38)])):H("",!0)],2))}}),Os="_reference_1arli_2",Ms="_popover_1arli_7",$s={reference:Os,popover:Ms},Ps={classes:$s},to=z(Ds,[["__cssModules",Ps]]),Vs=["title","onKeydown"],Bs=["onMouseover","onClick"],Fs=P({__name:"Select",props:wt({modelValue:{type:[String,Number,Array]},options:{type:Array,default(){return[]}},size:{type:String,default:"default"},button:{type:Boolean,default:!1},width:{type:String,default:"100%"},popoverWidth:{type:Number,default:null},placeholder:{type:String,default:"请选择"},title:{type:String,default:null},border:{type:String,default:"auto"},appearance:{type:String,default:"auto"},clearable:{type:Boolean,default:!1},teleport:{type:String,default:"body"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:wt(["select","update:modelValue"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=n,s=Le("classes"),o=ue(),a=ue(),i=en(n,"modelValue"),r=ce(),d=ce(!1),u=Me({width:0,top:0,left:0,visible:!1,scrollable:!1}),m=N(()=>l.teleport==="none"),g=N(()=>l.teleport=="none"?"body":l.teleport),E=N(()=>{const D={label:"",options:[]},B=[D];for(const U of l.options){if(Array.isArray(U.options)){B.push({label:U.label,options:U.options});continue}D.options.push(U)}return B}),v=N(()=>E.value.reduce((D,B)=>D.concat(B.options),[])),c=N(()=>{if(l.multiple!==!0){const B=qn();return B?B.label:l.button?l.title:ie(l.modelValue)?l.placeholder:l.modelValue}const D=Dn();return D.length>0?D.map(B=>B.label).join(","):l.button?l.title:l.placeholder}),b=N(()=>l.clearable!==!0?!1:l.modelValue!=null),T=N(()=>({"quickprint-form-control":!0,"quickprint-form-control-small":l.size==="small"||l.button,"quickprint-form-hidden-border":l.button||l.border==="none","quickprint-form-disabled":l.disabled,[s.mini]:l.size==="mini",[s.select]:!0,[s.appearance]:l.appearance!=="none"&&!b.value,[s.button]:l.button,[s.showClearIcon]:b.value,[s.text]:l.size==="text"})),A=N(()=>({width:l.width})),C=N(()=>u.visible?{width:l.popoverWidth==null?u.width+"px":l.popoverWidth+"px",top:u.top+"px",left:u.left+"px",visibility:"visible",zIndex:ql()}:{minWidth:l.popoverWidth==null?u.width+"px":l.popoverWidth+"px",visibility:"hidden"}),L=N(()=>({[s.content]:!0,[s.placeholder]:$o(l.modelValue)}));async function k(){if(l.disabled)return;const D=v.value;if(D.length===0)return;if(d.value)return w();const B=o.value;B!=null&&(u.width=B.getBoundingClientRect().width,u.visible=!1,r.value=D.find(U=>U.value===l.modelValue),d.value=!0,await Tn(),Ao())}function w(){qo(),d.value=!1}function _(D){V(),ct()}function R(D){D.disabled!==!0&&(r.value=D)}function x(D){if(l.disabled==!0||D.disabled===!0)return;if(l.multiple!==!0){i.value=D.value,t("select",D),w();return}const B=Array.isArray(i.value)?i.value:[],U=B.findIndex(fe=>fe===D.value);U>=0?B.splice(U,1):B.push(D.value),i.value=B,t("select",B)}function q(D){if(!(D.target instanceof Node))return;const B=o.value;if(B&&B.contains(D.target))return D.preventDefault();const U=a.value;if(U&&U.contains(D.target))return D.preventDefault();w()}async function V(){const D=o.value,B=a.value;if(B==null||D==null)return;await Vt();const U=D.getBoundingClientRect(),fe=B.getBoundingClientRect();let ge=U.bottom+1;ge+fe.height>window.innerHeight&&U.top>fe.height&&(ge=U.top-fe.height-1);let Ct=U.left;Ct+fe.width>window.innerWidth&&(Ct=window.innerWidth-fe.width-2),u.width=fe.width,u.top=ge,u.left=Ct,u.visible=!0;const zt=B.querySelector("."+s.list);u.scrollable=zt?zt.scrollHeight>zt.clientHeight:!1}function O(D){const B=D.target;if(!(B instanceof HTMLElement))return;const U=o.value;U==null||!B.contains(U)||w()}function j(){const D=v.value,B=hl(r.value);if(B==null){r.value=we(0),ct();return}const U=D.indexOf(B);if(U==0)return de();const fe=we(U-1);fe!=null&&(r.value=fe,ct())}function W(){const D=v.value,B=hl(r.value);if(B==null){r.value=Ee(0),ct();return}const U=D.indexOf(B);if(U>=D.length-1){M();return}const fe=we(U+1);fe!=null&&(r.value=fe,ct())}function M(){r.value=Ee(0),ct()}function de(){const D=v.value;r.value=we(D.length-1),ct()}function ee(){i.value=void 0,w()}function Ee(D){const U=v.value[D];return U==null?null:U.disabled===!0?Ee(D+1):U}function we(D){const U=v.value[D];return U==null?null:U.disabled===!0?we(D-1):U}function Ve(D){switch(D.key){case"Enter":D.preventDefault(),r.value&&x(r.value);return;case"Escape":D.preventDefault(),w();return;case"ArrowUp":D.preventDefault(),j();return;case"ArrowDown":D.preventDefault(),W();return;case"Home":D.preventDefault(),M();return;case"End":D.preventDefault(),de();return}}function nn(D){if(l.disabled)return;const B=o.value;B!=null&&document.activeElement===B&&(d.value||(D.stopPropagation(),k()))}function ln(D){if(l.multiple!==!0)return l.modelValue===D.value;const B=l.modelValue;return Array.isArray(B)?B.includes(D.value):!1}async function ct(){if(r.value==null)return;await Vt();const D=a.value;if(D==null)return;const B=D.querySelector("."+s.hover);B&&B.scrollIntoView({block:"nearest"})}function qn(){const D=v.value,B=Array.isArray(l.modelValue)?l.modelValue[0]:l.modelValue;return D.find(U=>U.value===B)}function Dn(){const D=v.value;return(Array.isArray(l.modelValue)?l.modelValue:[l.modelValue]).filter(U=>U).map(U=>{const fe=D.find(ge=>ge.value===U);return fe||{value:U,label:U}})}function Ao(){window.addEventListener("mousedown",q,{capture:!0}),window.addEventListener("pointerdown",q,{capture:!0}),window.addEventListener("contextmenu",w,{capture:!0}),window.addEventListener("scroll",O,{capture:!0,passive:!0}),window.addEventListener("resize",V),window.addEventListener("keydown",Ve)}function qo(){window.removeEventListener("mousedown",q,!0),window.removeEventListener("pointerdown",q,!0),window.removeEventListener("contextmenu",w,!0),window.removeEventListener("scroll",O,!0),window.removeEventListener("resize",V),window.removeEventListener("keydown",Ve)}return(D,B)=>{var U;return S(),I("div",{class:h(T.value),title:n.title,style:J(A.value),onClick:oe(k,["stop"]),onKeydown:Bl(oe(nn,["prevent"]),["enter"]),ref_key:"selectRef",ref:o,tabindex:"0"},[D.$slots.selected?Xe(D.$slots,"selected",{key:0,option:qn(),options:Dn()}):Xe(D.$slots,"option",{key:1,option:qn(),options:Dn()},()=>[f("div",{class:h(L.value)},[f("span",null,Y(c.value),1),b.value?(S(),Q($,{key:0,icon:"icon-close",onClick:oe(ee,["stop"]),size:"12px",class:h(y(s).clearIcon)},null,8,["class"])):H("",!0)],2)]),d.value?(S(),Q(Vl,{key:2,to:g.value,disabled:m.value},[f("div",{class:h(y(s).popover),onClick:B[0]||(B[0]=oe(()=>{},["stop"])),onVnodeMounted:_,onMousedown:B[1]||(B[1]=oe(()=>{},["prevent"])),style:J(C.value),ref_key:"popoverRef",ref:a},[f("div",{class:h(y(s).list)},[(S(!0),I(Z,null,re(E.value,fe=>(S(),I(Z,null,[fe.label?(S(),I("div",{key:0,class:h(y(s).groupLabel)},Y(fe.label),3)):H("",!0),(S(!0),I(Z,null,re(fe.options,ge=>{var Ct;return S(),I("div",{key:ge.value,class:h({[y(s).option]:!0,[y(s).disabled]:ge.disabled===!0,[y(s).selected]:ln(ge),[y(s).hover]:((Ct=r.value)==null?void 0:Ct.value)==ge.value}),style:J(ge.style),onMouseover:zt=>R(ge),onClick:zt=>x(ge)},[Xe(D.$slots,"option",{option:ge},()=>[f("div",{class:h(y(s).label)},[ge.icon?(S(),Q($,{key:0,icon:ge.icon,class:h(y(s).icon)},null,8,["icon","class"])):H("",!0),f("span",null,Y(ge.label),1)],2),ge.short?(S(),I("div",{key:0,class:h(y(s).short)},Y(ge.short),3)):H("",!0)])],46,Bs)}),128))],64))),256))],2),(U=r.value)!=null&&U.detail&&u.visible?(S(),I("div",{key:0,class:h(y(s).detail)},Y(r.value.detail),3)):H("",!0)],38)],8,["to","disabled"])):H("",!0)],46,Vs)}}}),zs="_button_qag3j_2",Us="_select_qag3j_7",Hs="_appearance_qag3j_16",Gs="_content_qag3j_31",Ws="_placeholder_qag3j_37",Ys="_popover_qag3j_41",Xs="_list_qag3j_51",js="_option_qag3j_80",Zs="_label_qag3j_95",Ks="_icon_qag3j_102",Js="_hover_qag3j_106",Qs="_detail_qag3j_117",ei="_short_qag3j_127",ti="_selected_qag3j_133",ni="_disabled_qag3j_137",li="_showClearIcon_qag3j_142",oi="_clearIcon_qag3j_146",si="_text_qag3j_159",ii="_mini_qag3j_171",ri="_groupLabel_qag3j_183",ai={button:zs,select:Us,appearance:Hs,content:Gs,placeholder:Ws,popover:Ys,list:Xs,option:js,label:Zs,icon:Ks,hover:Js,detail:Qs,short:ei,selected:ti,disabled:ni,showClearIcon:li,clearIcon:oi,text:si,mini:ii,groupLabel:ri},ci={classes:ai},K=z(Fs,[["__cssModules",ci]]),ui="_tree_1p28f_1",di="_node_1p28f_5",fi="_content_1p28f_11",pi="_space_1p28f_27",mi="_expand_1p28f_28",gi="_active_1p28f_47",hi="_children_1p28f_55",Je={tree:ui,node:di,content:fi,space:pi,expand:mi,active:gi,children:hi},no=Symbol(),lo=P({emits:["nodeClick","nodeHover"],props:{node:{type:Object,required:!0}},setup(n,{emit:e}){const t=Fl(no),l=N(()=>Array.isArray(n.node.children)&&n.node.children.length>0),s=N({get(){const c=t==null?void 0:t.state[n.node.value];return c==null?!1:c.expand},set(c){const b=t==null?void 0:t.state[n.node.value];b!=null&&(b.expand=c)}});function o(c){c.preventDefault(),s.value=!s.value}function a(){if(!l.value)return p("div",{class:Je.space},null);const c={[Je.expand]:!0,[Je.active]:s.value};return p("div",{onMousedown:v,onClick:o,class:c},[p($,{icon:"icon-right",size:"12px"},null)])}function i(){return typeof(t==null?void 0:t.content)=="function"?t.content({node:n.node}):p("span",null,[n.node.label])}function r(){return p("div",{class:Je.content,onClick:u,onMouseenter:g},[i()])}function d(){if(!l.value||!s.value)return;const c=n.node.children.map(b=>p(lo,{node:b,onNodeClick:m,onNodeHover:E},null));return p("div",{class:Je.children},[c])}function u(){e("nodeClick",n.node)}function m(c){e("nodeClick",c)}function g(){e("nodeHover",n.node)}function E(c){e("nodeHover",c)}function v(c){c.preventDefault()}return function(){return p("div",{class:Je.subTree},[p("div",{class:Je.node},[a(),r()]),d()])}}}),vi=P({props:{data:{type:Array,required:!0}},emits:["nodeClick","nodeHover"],setup(n,{slots:e,emit:t}){const l=a();function s(r){t("nodeClick",r)}function o(r){t("nodeHover",r)}function a(){const r=Me({}),d=function(u,m){for(const g of u)m[g.value]={expand:g.expand!==!1},g.children&&d(g.children,m)};return d(n.data,r),r}function i(r){return typeof e.default=="function"?e.default(r):null}return zl(no,{state:l,content:i}),function(){const r=n.data.map(d=>p(lo,{node:d,onNodeClick:s,onNodeHover:o},null));return p("div",{class:Je.tree},[r])}}});function bi(n,e=0){let t=null;return function(...l){t&&clearTimeout(t),t=window.setTimeout(()=>{n.apply(this,l),t=null},e)}}function yi(n,e=0){let t=0,l=null;return function(...s){const o=Date.now();if(o-t<e){l&&clearTimeout(l),l=window.setTimeout(()=>{l=null,n.apply(this,s),t=Date.now()},e);return}l&&clearTimeout(l),n.apply(this,s),t=o}}function sl(n,e){const t=[];if(e&&e!=le.DEFAULT&&t.push(`"${e}"`),n&&n!==le.DEFAULT&&t.push(`"${n}"`),t.length!=0)return t.join(",")}function oo(n){if(n.underline===!0)return{textDecorationLine:"underline",textDecorationStyle:n.underlineStyle,textDecorationColor:n.underlineColor}}function so(n,e={}){const t={},l=n.style??{},s=sl(l.fontFamily,l.enFontFamily);s&&(t.fontFamily=s);const o=oo(l);return o&&et(t,o),l.fontSize&&(t.fontSize=l.fontSize),l.fontWeight&&(t.fontWeight=l.fontWeight),l.color&&(t.color=l.color),_i("border",e)&&l.border&&et(t,Hn(n)),l.lineHeight&&(t.lineHeight=l.lineHeight),l.highlightColor&&(t["--quickprint-variable-highlight-color"]=l.highlightColor),l.backgroundColor&&(t.backgroundColor=l.backgroundColor),l.fontStyle&&(t.fontStyle=l.fontStyle),l.textIndent&&(t.textIndent=l.textIndent),l.padding&&et(t,Si(n)),et(t,Ti(n)),et(t,io(l.verticalAlign)),t}function Ei(n,e={}){const t=[];let l=n;for(;me.isDefineElement(l);)t.unshift(so(l,e)),l=l.parent;return Vo({},...t)}function _i(n,e){return e.exclude==null?!0:!e.exclude.includes(n)}function Ti(n){if(n==null)return{};const e=n.style??{},t={};return e.textAlign&&(t.textAlign=e.textAlign),e.textAlignLast&&(t.textAlignLast=e.textAlignLast),t}function io(n){return n==null||n==Ye.MIDDLE?{display:"flex",alignItems:"center"}:n==Ye.BOTTOM?{display:"flex",alignItems:"end"}:{}}function Si(n){if(n==null)return{};const e=n.style??{};if(e.padding==null)return{};const t={};return e.padding.top&&(t.paddingTop=e.padding.top),e.padding.right&&(t.paddingRight=e.padding.right),e.padding.bottom&&(t.paddingBottom=e.padding.bottom),e.padding.left&&(t.paddingLeft=e.padding.left),t}function Hn(n){if(n==null)return{};const e=n.style??{};if(e.border==null||e.border===te.NONE)return{};const t={},l=e.borderWidth??1,s=e.borderStyle??Po.SOLID,o=e.borderColor??Zn.BLACK;if(e.border==te.ALL||e.border&te.TOP){const a=e.borderTopWidth??l,i=e.borderTopStyle??s,r=e.borderTopColor??o;t.borderTop=`${a}px ${i} ${r}`}if(e.border==te.ALL||e.border&te.RIGHT){const a=e.borderRightWidth??l,i=e.borderRightStyle??s,r=e.borderRightColor??o;t.borderRight=`${a}px ${i} ${r}`}if(e.border==te.ALL||e.border&te.BOTTOM){const a=e.borderBottomWidth??l,i=e.borderBottomStyle??s,r=e.borderBottomColor??o;t.borderBottom=`${a}px ${i} ${r}`}if(e.border==te.ALL||e.border&te.LEFT){const a=e.borderLeftWidth??l,i=e.borderLeftStyle??s,r=e.borderLeftColor??o;t.borderLeft=`${a}px ${i} ${r}`}return t}const vt={SPACE:" ",has(n,e){return typeof n!="string"?!1:n.split(vt.SPACE).includes(e)},push(n,e){if(typeof n!="string")return e;const t=n.split(vt.SPACE).filter(s=>Kn(s));return t.indexOf(e)>=0?n:(t.push(e),t.join(vt.SPACE))},remove(n,e){if(typeof n!="string"||n=="")return n;const t=n.split(vt.SPACE),l=t.indexOf(e);return l<0?n:(t.splice(l,1),t.join(vt.SPACE))}};function We(n){if(ie(n))return{num:null,unit:null};const e=n.match(/^(-?\d+(?:\.\d+)?)(px|pt|mm|em)?$/);if(e==null)return{num:null,unit:null};const t=Number(e[1]),l=Jn(t)?t:null,s=ie(e[2])?null:e[2];return{num:l,unit:s}}function vl(n){if(n==null)return null;if(typeof n=="number")return n;if(typeof n!="string")return null;const e=We(n);if(e.num==null)return null;switch(e.unit){case"px":return e.num;case"pt":return Fn.pt_to_px(e.num);case"mm":return Fn.mm_to_px(e.num);default:return null}}function il(n,e){const t=n.ds;if(t!=null)return t.type===ve.FORMULA?{type:t.type,content:rl(t.value,n.doc)}:t.type===ve.VARIABLE?{type:t.type,content:Ze(t.value,e)}:{type:t.type,content:t.value}}function Ze(n,e){var g,E,v;if(ie(n))return n;const t=Dl(n),l=t.path;if(l==null||l=="")return;const s=l.split(".");if(s.length==0)return l;const o=s[0];if(t.varType===Et.BUILTIN)return((g=zn.find(c=>c.value===o))==null?void 0:g.label)??o;if(t.varType===Et.SPECIAL)return((E=ys.find(c=>c.value===o))==null?void 0:E.label)??o;if(e==null)return l;const i=(e.fields??[]).find(c=>c.name===o);if(i==null)return l;const r=s[1],d=ie(i.title)?i.name:i.title;if(r==null)return d;const u=(v=i.children)==null?void 0:v.find(c=>c.name===r);if(u==null)return`${d}.${r}`;const m=ie(u.title)?u.name:u.title;return`${d}.${m}`}function rl(n,e){return ie(n)?void 0:yn.tokenize(n).map(s=>s.type===tt.VARIABLE?`[${Ze(s.value,e==null?void 0:e.ds)}]`:s.type===tt.REFERENCE?`[${ro(s.value,e)}]`:s.type===tt.TEMPLATE?(Array.isArray(s.value)?s.value:[s.value]).map(a=>a.type===tt.VARIABLE?`[${Ze(a.value,e==null?void 0:e.ds)}]`:a.value).join(""):yn.formatTokenValue(s)).join("")}function ro(n,e){if(e==null)return"="+n;const t=e.findElement(n);return t==null?"="+n:t.title?"="+t.title:t.ds.type===ve.VARIABLE&&t.ds.value?Ze(t.ds.value,e.ds):"="+n}function wi(n){switch(Dl(n).dataType){case ne.OBJECT:return"对象";case ne.ARRAY:return"数组";case ne.STRING:return"文本";case ne.NUMBER:return"数字";case ne.DATE:return"日期";case ne.BOOLEAN:return"布尔";default:return"未知类型"}}function ki(n){var e;return((e=Yl.find(t=>t.value===n))==null?void 0:e.label)??n}const ao=Ol(()=>Ml(()=>import("./component-dgQ-nAH0.js"),__vite__mapDeps([0,1,2]))),Ci=["onClick","onMouseenter"],Ri=P({__name:"Builtin",emits:["select"],setup(n,{emit:e}){const t=e,l=ce(zn[0].value),s=N(()=>`builtin_${$l(l.value,"_").toLowerCase()}`);function o(i){t("select",i)}function a(i){l.value=i.value}return(i,r)=>(S(),I("div",{class:h(i.classes.builtin)},[f("div",{class:h(["quickprint-is-scrollable",i.classes.panel])},[(S(!0),I(Z,null,re(y(zn),d=>(S(),I("div",{class:h({[i.classes.param]:!0,[i.classes.active]:d.value===l.value}),onClick:u=>o(d),onMouseenter:u=>a(d)},[f("strong",null,Y(d.label),1),f("span",null,Y(d.value),1)],42,Ci))),256))],2),f("div",{class:h(["quickprint-is-scrollable",i.classes.desc])},[p(y(ao),{name:s.value},null,8,["name"])],2)],2))}}),Ni="_builtin_m1n0z_2",Li="_panel_m1n0z_11",Ii="_desc_m1n0z_17",xi="_param_m1n0z_24",Ai="_active_m1n0z_34",qi={builtin:Ni,panel:Li,desc:Ii,param:xi,active:Ai},Di={classes:qi},Oi=z(Ri,[["__cssModules",Di]]),bl=[{label:"文本",value:ne.STRING},{label:"数字",value:ne.NUMBER},{label:"日期",value:ne.DATE},{label:"对象",value:ne.OBJECT},{label:"数组",value:ne.ARRAY}],Mi=P({emit:["select"],props:{doc:{type:he,required:!0},readonly:{type:Boolean,default:!1}},setup(n,{expose:e,emit:t}){const l=Le("classes"),s=Ke(),o=r(),a=i();function i(){const b=[{name:"$index"},{name:"$expand"},{name:"type",title:"类型",width:110,render(T,A,C){var L;if(n.readonly){const k=T[A.name],w=((L=bl.find(_=>_.value===k))==null?void 0:L.label)??k;return p("div",{class:C.classes.cell},[w])}return p("div",{class:C.classes.cell},[p(K,{options:bl,modelValue:T.type,"onUpdate:modelValue":E.bind(null,T),size:"small"},null)])}},{name:"name",title:"名称",width:180,render(T,A,C){return n.readonly?p("div",{class:C.classes.cell},[T[A.name]]):p("div",{class:C.classes.cell},[_e(p("input",{"onUpdate:modelValue":L=>T.name=L,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[必填] 请输入"},null),[[Ae,T.name]])])}},{name:"title",title:"标题",width:180,render(T,A,C){return n.readonly?p("div",{class:C.classes.cell},[T[A.name]]):p("div",{class:C.classes.cell},[_e(p("input",{"onUpdate:modelValue":L=>T.title=L,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[可选] 请输入"},null),[[Ae,T.title]])])}}];return n.readonly!==!0&&b.push({name:"operate",title:"操作",width:200,render(T,A,C){const L=[p("button",{type:"button",class:"quickprint-text-btn",onClick:u.bind(null,T,C.parent)},[p($,{icon:"icon-subnode"},null),p("span",null,[se("插入行")])])];return(T.type===ne.ARRAY||T.type===ne.OBJECT)&&L.push(p("button",{type:"button",class:"quickprint-text-btn",onClick:g.bind(null,T)},[p($,{icon:"icon-sisternode"},null),p("span",null,[se("插入子级")])])),L.push(p("button",{type:"button",class:"quickprint-text-btn",onClick:m.bind(null,T,C.parent)},[p($,{icon:"icon-delete"},null),p("span",null,[se("删除")])])),L}}),b}function r(){const b=Bo(n.doc.ds.fields??[]).map(A=>{const C=A.type;return{...A,$expand:C===ne.ARRAY||C===ne.OBJECT}}),T=ce(b);return T.value.length==0&&T.value.push(d()),T}function d(){return{type:ne.STRING,name:"",title:""}}function u(b,T){if(T){const C=T.children??[],L=C.indexOf(b);L>=0&&C.splice(L+1,0,d());return}const A=o.value.indexOf(b);A>=0&&o.value.splice(A+1,0,d())}function m(b,T){if(T){const C=T.children??[],L=C.indexOf(b);L>=0&&C.splice(L,1);return}const A=o.value.indexOf(b);A>=0&&o.value.splice(A,1),o.value.length==0&&o.value.push(d())}function g(b){b.type!==ne.ARRAY&&b.type!==ne.OBJECT||(b.children==null&&(b.children=[]),b.children.push(d()))}function E(b,T){b.type=T,T===ne.ARRAY||T===ne.OBJECT?b.$expand=!0:b.children=void 0}function v(){return{fields:o.value.map(T=>ie(T.name)?null:T.type!==ne.ARRAY&&T.type!==ne.OBJECT?{type:T.type,name:T.name,title:T.title}:{type:T.type,name:T.name,title:T.title,children:(T.children??[]).map(A=>ie(T.name)?null:{type:A.type,name:A.name,title:A.title}).filter(A=>A!=null)}).filter(T=>T!=null)}}function c(b,T){n.readonly===!0&&t("select",b,T)}return s==null||s.useHandle("confirm",v),e({submit:v}),function(){return p("div",{class:[l.datasource,n.readonly?l.readonly:l.form]},[p(Fo,{columns:a,data:o.value,onSelect:c},null)])}}}),$i="_form_6lybl_2",Pi="_readonly_6lybl_6",Vi="_datasource_6lybl_11",Bi={form:$i,readonly:Pi,datasource:Vi},Fi={classes:Bi},co=z(Mi,[["__cssModules",Fi]]),zi={class:"quickprint-config-group"},Ui={class:"quickprint-config-section quickprint-config-inline"},Hi={class:"quickprint-config-content"},Gi={class:"quickprint-config-section quickprint-config-inline"},Wi={class:"quickprint-config-content"},Yi={class:"quickprint-config-id"},Xi={class:"quickprint-config-section quickprint-config-inline"},ji={class:"quickprint-config-content"},Zi={class:"quickprint-config-group"},Ki={class:"quickprint-config-group-title"},Ji=P({__name:"Detail",props:{element:{type:me,required:!0}},setup(n){const e=n,t=N(()=>{var l,s;return(s=il(e.element,(l=e.element.doc)==null?void 0:l.ds))==null?void 0:s.content});return(l,s)=>(S(),I("div",{class:h(l.classes.detail)},[f("div",zi,[f("section",Ui,[s[0]||(s[0]=f("header",{class:"quickprint-config-header"},"类型",-1)),f("div",Hi,Y(y(Jt)(n.element.type)),1)]),f("section",Gi,[s[1]||(s[1]=f("header",{class:"quickprint-config-header"},"标识",-1)),f("div",Wi,[f("span",Yi,Y(n.element.id),1)])]),f("section",Xi,[s[2]||(s[2]=f("header",{class:"quickprint-config-header"},"标题",-1)),f("div",ji,Y(n.element.title),1)])]),f("div",Zi,[f("div",Ki,[s[3]||(s[3]=f("span",null,"数据",-1)),f("span",{class:h(l.classes.type)},Y(y(ki)(n.element.ds.type)),3)]),f("div",null,Y(t.value),1)])],2))}}),Qi="_detail_11ox4_2",er="_type_11ox4_10",tr={detail:Qi,type:er},nr={classes:tr},lr=z(Ji,[["__cssModules",nr]]),or=P({__name:"index",props:{doc:{type:he,required:!0}},emits:["select"],setup(n,{emit:e}){const t=e,l=n,s=i(),o=ce();function a(g){return g.reduce((E,v)=>{const c=Array.isArray(v.children)?a(v.children):[];if(Kn(v.ds.value)||c.length>0){const b={value:v.id,label:v.title??v.id,data:v,children:c};return E.push(b),E}return E},[])}function i(){const g=l.doc.pages.reduce((v,c)=>v.concat(c.children),[]),E=a(g);return ce(E)}function r(g){o.value=g}function d(g){return g.title?g.title:Jt(g.type)}function u(g){return Du(g.type)??"icon-zhanweifu"}function m(g){t("select",g.data)}return(g,E)=>(S(),I("div",{class:h(g.classes.reference)},[f("div",{class:h([g.classes.panel,"quickprint-is-scrollable"])},[p(y(vi),{data:y(s),onNodeHover:r,onNodeClick:m},{default:ye(({node:v})=>[p(y($),{icon:u(v.data)},null,8,["icon"]),f("span",{class:h(g.classes.title)},Y(d(v.data)),3),f("span",{class:h(g.classes.id)},"<"+Y(v.value)+">",3)]),_:1},8,["data"])],2),f("div",{class:h([g.classes.detail,"quickprint-is-scrollable"])},[o.value?(S(),Q(lr,{element:o.value.data,key:o.value.value},null,8,["element"])):H("",!0)],2)],2))}}),sr="_reference_1ekkx_2",ir="_panel_1ekkx_12",rr="_detail_1ekkx_20",ar="_title_1ekkx_25",cr="_id_1ekkx_29",ur={reference:sr,panel:ir,detail:rr,title:ar,id:cr},dr={classes:ur},fr=z(or,[["__cssModules",dr]]),pr=P({__name:"index",props:{doc:{type:he,required:!0},value:{type:String,default:null},include:{type:Array,default(){return["ds","builtin"]}},active:{type:String,default:null}},setup(n){const e=Ke();function t(a,i){return a==null?null:i==null?`${Et.DS}.${a.type}.${a.name}`:`${Et.DS}.${a.type}.${i.name}.${a.name}`}function l(a,i){e==null||e.confirm({type:"ds",value:t(a,i),parent:i})}function s(a){e==null||e.confirm({type:"builtin",value:`${Et.BUILTIN}.${a.type}.${a.value}`})}function o(a){e==null||e.confirm({type:"reference",value:a.id})}return(a,i)=>(S(),I("div",{class:h(a.classes.var)},[n.active==="ds"?(S(),Q(co,{key:0,doc:n.doc,onSelect:l,readonly:""},null,8,["doc"])):H("",!0),n.active==="builtin"?(S(),Q(Oi,{key:1,onSelect:s})):H("",!0),n.active==="reference"?(S(),Q(fr,{key:2,doc:n.doc,onSelect:o},null,8,["doc"])):H("",!0)],2))}}),mr={var:"_var_12wxd_2"},gr={classes:mr},uo=z(pr,[["__cssModules",gr]]),hr=["onClick","onMouseenter"],vr=P({__name:"Document",props:{options:{type:Array,required:!0},type:{type:String,default:"function"}},emits:["select"],setup(n,{emit:e}){var r;const t=n,l=e,s=ce((r=t.options[0])==null?void 0:r.value),o=N(()=>`${t.type}_${s.value.toLowerCase()}`);function a(d){l("select",d.value)}function i(d){s.value=d.value}return(d,u)=>(S(),I("div",{class:h(d.classes.doc)},[f("div",{class:h(["quickprint-is-scrollable",d.classes.panel])},[(S(!0),I(Z,null,re(n.options,m=>(S(),I("div",{key:m.value,class:h({[d.classes.option]:!0,[d.classes.active]:m.value===s.value}),onClick:g=>a(m),onMouseenter:g=>i(m)},[f("strong",null,Y(m.label),1)],42,hr))),128))],2),f("div",{class:h(["quickprint-is-scrollable",d.classes.desc])},[p(y(ao),{name:o.value},null,8,["name"])],2)],2))}}),br="_doc_1pdoc_2",yr="_panel_1pdoc_10",Er="_desc_1pdoc_16",_r="_option_1pdoc_23",Tr="_active_1pdoc_33",Sr={doc:br,panel:yr,desc:Er,option:_r,active:Tr},wr={classes:Sr},Gt=z(vr,[["__cssModules",wr]]),kr=P({__name:"index",props:{active:{type:String,default:null}},setup(n){const e=Ke(),t=[{label:"STRING",value:"STRING"},{label:"LENGTH",value:"LENGTH"},{label:"LOWER",value:"LOWER"},{label:"UPPER",value:"UPPER"},{label:"UPPER_FIRST",value:"UPPER_FIRST"},{label:"TRIM",value:"TRIM"},{label:"REPLACE",value:"REPLACE"},{label:"REPLACE_ALL",value:"REPLACE_ALL"},{label:"SLICE",value:"SLICE"},{label:"INCLUDES",value:"INCLUDES"},{label:"INDEX_OF",value:"INDEX_OF"},{label:"LAST_INDEX_OF",value:"LAST_INDEX_OF"},{label:"STARTS_WITH",value:"STARTS_WITH"},{label:"ENDS_WITH",value:"ENDS_WITH"}],l=[{label:"NUMBER",value:"NUMBER"},{label:"ABS",value:"ABS"},{label:"TRUNC",value:"TRUNC"},{label:"MIN",value:"MIN"},{label:"MAX",value:"MAX"},{label:"CEIL",value:"CEIL"},{label:"FLOOR",value:"FLOOR"},{label:"ROUND",value:"ROUND"},{label:"DIGIT",value:"DIGIT"},{label:"NUMBER_FORMAT",value:"NUMBER_FORMAT"}],s=[{label:"IF",value:"IF"},{label:"IFNA",value:"IFNA"},{label:"IFERROR",value:"IFERROR"},{label:"SWITCH",value:"SWITCH"},{label:"IS_NAN",value:"IS_NAN"},{label:"IS_NUMBER",value:"IS_NUMBER"},{label:"IS_INTEGER",value:"IS_INTEGER"},{label:"IS_STRING",value:"IS_STRING"},{label:"IS_BOOLEAN",value:"IS_BOOLEAN"},{label:"IS_NULL",value:"IS_NULL"},{label:"IS_UNDEFINED",value:"IS_UNDEFINED"},{label:"IS_NULLISH",value:"IS_NULLISH"},{label:"IS_EMPTY",value:"IS_EMPTY"}],o=[{label:"DATE",value:"DATE"},{label:"NOW",value:"NOW"},{label:"YEAR",value:"YEAR"},{label:"MONTH",value:"MONTH"},{label:"DAY",value:"DAY"},{label:"HOUR",value:"HOUR"},{label:"MINUTE",value:"MINUTE"},{label:"SECOND",value:"SECOND"}],a=[{label:"COL_SUM",value:"COL_SUM"},{label:"COL_AVG",value:"COL_AVG"}];function i(r){return e==null?void 0:e.confirm({type:"function",value:`${r}()`})}return(r,d)=>(S(),I("div",{class:h(r.classes.function)},[n.active==="string"?(S(),Q(Gt,{options:t,onSelect:i,key:"string"})):H("",!0),n.active==="number"?(S(),Q(Gt,{options:l,onSelect:i,key:"number"})):H("",!0),n.active==="logical"?(S(),Q(Gt,{options:s,onSelect:i,key:"logical"})):H("",!0),n.active==="date"?(S(),Q(Gt,{options:o,onSelect:i,key:"date"})):H("",!0),n.active==="aggregate"?(S(),Q(Gt,{options:a,onSelect:i,key:"aggregate"})):H("",!0)],2))}}),Cr={function:"_function_19szx_2"},Rr={classes:Cr},Nr=z(kr,[["__cssModules",Rr]]),Lr=["onMouseenter"],Ir=["onClick"],xr={key:1},Ar=P({__name:"Formula",props:{doc:{type:he,default:null}},setup(n){const e=n,t=Ke(),l=[{id:"pageNumber",name:"页码",options:r(ws)}],s=ce(l[0]);function o(d){s.value=d}function a(d){return t==null?void 0:t.confirm({type:"formula",value:d})}function i(d){const u=yn.tokenize(d),m=e.doc;return u.reduce((g,E)=>{if(E.type===tt.VARIABLE)return g.push({type:"highlight",value:Ze(E.value,m==null?void 0:m.ds)}),g;if(E.type===tt.REFERENCE)return g.push({type:"highlight",value:ro(E.value,m)}),g;if(E.type===tt.TEMPLATE){const c=(Array.isArray(E.value)?E.value:[E.value]).map(b=>b.type===tt.VARIABLE?{type:"highlight",value:Ze(b.value,m.ds)}:{type:"text",value:b.value});return g.concat(c)}return g.push({type:"text",value:yn.formatTokenValue(E)}),g},[])}function r(d){return d.map(u=>({nodes:i(u),value:u}))}return(d,u)=>(S(),I("div",{class:h(d.classes.formula)},[f("div",{class:h([d.classes.left,"quickprint-is-scrollable"])},[(S(),I(Z,null,re(l,m=>f("div",{key:m.name,onMouseenter:g=>o(m),class:h({[d.classes.group]:!0,[d.classes.active]:m.id===s.value.id})},Y(m.name),43,Lr)),64))],2),f("div",{class:h(d.classes.right)},[(S(!0),I(Z,null,re(s.value.options,(m,g)=>(S(),I("div",{key:g,class:h(d.classes.code),onClick:E=>a(m.value)},[(S(!0),I(Z,null,re(m.nodes,E=>(S(),I(Z,null,[E.type==="highlight"?(S(),I("span",{key:0,class:h(d.classes.highlight)},"["+Y(E.value)+"]",3)):(S(),I("span",xr,Y(E.value),1))],64))),256)),f("span",{class:h(d.classes.badge)},"插入",2)],10,Ir))),128))],2)],2))}}),qr="_formula_ms7c3_2",Dr="_left_ms7c3_12",Or="_right_ms7c3_17",Mr="_group_ms7c3_24",$r="_active_ms7c3_34",Pr="_highlight_ms7c3_39",Vr="_code_ms7c3_43",Br="_badge_ms7c3_65",Fr={formula:qr,left:Dr,right:Or,group:Mr,active:$r,highlight:Pr,code:Vr,badge:Br},zr={classes:Fr},Ur=z(Ar,[["__cssModules",zr]]),al=Be(function(n){return Qt("变量",(e,t)=>p(uo,{doc:n.doc,value:n.value,active:t},null),{preset:"variable",icon:"svg:icon-var",tabs:[{label:"数据源",name:"ds",active:!0},{label:"内置变量",name:"builtin"},{label:"引用组件",name:"reference"}]}).promisify().catch($e)}),Hr=Be(function(n){return Tt("数据源",p(co,{doc:n},null),{preset:"variable",icon:p($,{icon:"icon-datasource",class:"quickprint-ds-icon",size:"16px"},null),menus:[{label:"保存",handler:e=>e.dispatchConfirm()}]}).promisify().catch($e)}),Gr=Be(function(n){const e=["ds","builtin","reference"];return Qt("变量",(t,l)=>p(uo,{doc:n.doc,value:n.value,include:e,active:l},null),{preset:"variable",icon:"svg:icon-var",tabs:[{label:"数据源",name:"ds",active:!0},{label:"内置变量",name:"builtin"},{label:"引用组件",name:"reference"}]}).promisify().catch($e)}),Wr=Be(function(){return Qt("函数",(n,e)=>p(Nr,{active:e},null),{preset:"variable",icon:"svg:icon-function",tabs:[{label:"文本",name:"string",active:!0},{label:"数字",name:"number"},{label:"日期",name:"date"},{label:"逻辑",name:"logical"},{label:"聚合",name:"aggregate"}]}).promisify().catch($e)}),Yr=Be(function(n){return Tt("公式",p(Ur,{doc:n.doc},null),{preset:"variable"}).promisify().catch($e)}),Xr={key:1},jr=P({__name:"Content",props:{element:{type:me,required:!0}},setup(n){const e=n,t=Te(),l=Bt("editorRef"),s=Bt("contentRef"),o=ce(!1),a=N(()=>{const u=e.element.type===X.TABLE_CELL?Ei(e.element,{exclude:["border"]}):so(e.element);return u.color&&(u["--quickprint-element-var-color"]=u.color),o.value&&(u.alignItems="flex-start"),u}),i=N(()=>{const u=il(e.element,t.doc.ds);return u==null||u.content==null?null:[{tag:"span",content:e.element.attributes.prefix},{tag:u.type===ve.CONST?"span":"strong",content:u.content},{tag:"span",content:e.element.attributes.suffix}]});async function r(){var E;const u=await al({doc:t.doc,value:e.element.ds.value}).catch(nt);if(u==null||(e.element.setDataSource(ve.VARIABLE,u.value),e.element.type!=X.TABLE_CELL||u.type!=="ds"))return;const m=e.element.parent;if(m==null||m.isBindVariable||((E=u.parent)==null?void 0:E.type)!==ne.ARRAY)return;const g=u.parent;m.setDataSource(ve.VARIABLE,`${Et.DS}.${g.type}.${g.name}`)}function d(){const u=l.value,m=s.value;u==null||m==null||(o.value=m.offsetHeight>u.offsetHeight)}return(u,m)=>(S(),I("div",{class:"quickprint-is-element-editor",style:J(a.value),onVnodeMounted:d,ref_key:"editorRef",ref:l},[f("div",{class:"quickprint-is-content",ref_key:"contentRef",ref:s},[f("span",{class:h({[u.classes.lineThrough]:n.element.style.lineThrough})},[(S(!0),I(Z,null,re(i.value,(g,E)=>(S(),I(Z,{key:E},[g.tag=="strong"?(S(),I("strong",{key:0,class:h(u.classes.highlight)},"["+Y(g.content)+"]",3)):(S(),I("span",Xr,Y(g.content),1))],64))),128))],2)],512),n.element.isBindVariable||n.element.isBindTemplate?(S(),Q(y($),{key:0,icon:"icon-ds",size:"11px",color:"#da7f00",class:h(u.classes.dsIcon),onClick:r,onPointerdown:m[0]||(m[0]=oe(()=>{},["stop"]))},null,8,["class"])):H("",!0)],4))}}),Zr="_dsIcon_ss96n_2",Kr="_lineThrough_ss96n_10",Jr="_highlight_ss96n_14",Qr={dsIcon:Zr,lineThrough:Kr,highlight:Jr},ea={classes:Qr},kn=z(jr,[["__cssModules",ea]]),ta=P({__name:"TextEditor",props:{element:{type:zo,required:!0}},setup(n){return(e,t)=>(S(),Q(kn,{element:n.element},null,8,["element"]))}}),Cn=Object.freeze({title:"文本",icon:"icon-text",type:X.TEXT,editor:ta,onCreate(){return me.create({type:X.TEXT,width:_t,height:wn})}}),na=P({__name:"NumberEditor",props:{element:{type:Uo,required:!0}},setup(n){return(e,t)=>(S(),Q(kn,{element:n.element},null,8,["element"]))}}),la=["value","disabled"],oa=P({__name:"RadioButton",props:wt({modelValue:{},options:{type:Array,default(){return[]}},compacted:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=en(n,"modelValue");return(t,l)=>(S(),I("div",{class:h({[t.classes.radioGroup]:!0,[t.classes.compacted]:n.compacted,[t.classes.disabled]:n.disabled})},[(S(!0),I(Z,null,re(n.options,s=>(S(),I("label",{class:h({[t.classes.radio]:!0,[t.classes.selected]:s.value===n.modelValue})},[_e(f("input",{type:"radio",value:s.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value=o),disabled:n.disabled},null,8,la),[[cs,e.value]]),f("span",null,Y(s.label),1)],2))),256))],2))}}),sa="_radioGroup_67myk_2",ia="_compacted_67myk_10",ra="_radio_67myk_2",aa="_selected_67myk_50",ca="_disabled_67myk_56",ua={radioGroup:sa,compacted:ia,radio:ra,selected:aa,disabled:ca},da={classes:ua},xt=z(oa,[["__cssModules",da]]),fa={class:"quickprint-config-section quickprint-config-inline"},pa={class:"quickprint-config-content"},ma={class:"quickprint-config-section quickprint-config-inline"},ga={class:"quickprint-config-content"},ha={class:"quickprint-config-section quickprint-config-inline"},va={class:"quickprint-config-content"},ba={class:"quickprint-config-section quickprint-config-inline"},ya={class:"quickprint-config-content"},Ea=P({__name:"NumberConfig",props:{element:{type:me,required:!0}},setup(n){const e=n,t=N({get(){return e.element.attributes.showZero??!0},set(o){const a=e.element.attributes;a.showZero=o}}),l=N({get(){return e.element.attributes.round??Yt.ROUND},set(o){const a=e.element.attributes;a.round=o}}),s=N({get(){return e.element.attributes.format??pt.NONE},set(o){const a=e.element.attributes;a.format=o}});return(o,a)=>(S(),I(Z,null,[f("section",fa,[a[4]||(a[4]=f("header",{class:"quickprint-config-header"},"小数位数",-1)),f("div",pa,[_e(f("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>n.element.attributes.precision=i),type:"number",min:0,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ae,n.element.attributes.precision]])])]),f("section",ma,[a[5]||(a[5]=f("header",{class:"quickprint-config-header"},"舍入规则",-1)),f("div",ga,[p(y(K),{options:y(gs),modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),f("section",ha,[a[6]||(a[6]=f("header",{class:"quickprint-config-header"},"显示类型",-1)),f("div",va,[p(y(K),{options:y(hs),modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=i=>s.value=i),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),f("section",ba,[a[7]||(a[7]=f("header",{class:"quickprint-config-header"},"值为0时",-1)),f("div",ya,[p(xt,{modelValue:t.value,"onUpdate:modelValue":a[3]||(a[3]=i=>t.value=i),options:y(vs),class:"quickprint-w-full"},null,8,["modelValue","options"])])])],64))}}),Rn=Object.freeze({title:"数字",type:X.NUMBER,icon:"icon-number",editor:na,config:{display:Ea},onCreate(){return me.create({type:X.NUMBER,width:_t,height:wn})}}),_a=P({__name:"DateEditor",props:{element:{type:Ho,required:!0}},setup(n){return(e,t)=>(S(),Q(kn,{element:n.element},null,8,["element"]))}}),Ta={class:"quickprint-config-section"},Sa={class:"quickprint-config-content"},wa=P({__name:"DateConfig",props:{element:{type:me,required:!0}},setup(n){const e=n,t={NONE:"NONE"},l=N(()=>[{label:"原始值",value:t.NONE},...Xl]);function s(o){if(o.value==t.NONE){e.element.attributes.format=void 0;return}e.element.attributes.format=o.value}return(o,a)=>(S(),I("section",Ta,[f("header",{class:h(["quickprint-config-header",o.classes.header])},[a[1]||(a[1]=f("span",null,"格式",-1)),p(y(K),{options:l.value,onSelect:s,class:h(o.classes.picker),appearance:"none",size:"mini",border:"none",popoverWidth:200},{selected:ye(()=>[f("span",{class:h(o.classes.placeholder)},"预设模板",2)]),_:1},8,["options","class"])],2),f("div",Sa,[_e(f("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=i=>n.element.attributes.format=i),class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ae,n.element.attributes.format]])])]))}}),ka="_header_79607_2",Ca="_picker_79607_8",Ra="_placeholder_79607_15",Na={header:ka,picker:Ca,placeholder:Ra},La={classes:Na},Ia=z(wa,[["__cssModules",La]]),Nn=Object.freeze({title:"日期",type:X.DATE,icon:"icon-date",editor:_a,config:{display:Ia},onCreate(){return me.create({type:X.DATE,width:_t,height:wn})}}),xa=["colspan","rowspan"],Aa=P({__name:"TableCellEditor",props:{element:{type:Qn,required:!0}},setup(n){const e=n,t=N(()=>e.element.isCollapse),l=Te(),s=Le("classes"),o=N(()=>{var r;return{[s.cell]:!0,[G.SELECTED]:(r=e.element.state)==null?void 0:r.selected}}),a=N(()=>{var u;const r=Hn((u=e.element.parent)==null?void 0:u.parent),d=Hn(e.element);return{"--quickprint-cell-editor-width":e.element.offsetWidth+"px","--quickprint-cell-editor-height":e.element.offsetHeight+"px",...et(r,d)}});function i(r){r.button==0&&l.selectElement(e.element)}return(r,d)=>t.value?H("",!0):(S(),I("td",Ul({key:0,[`.${y(je)||""}`]:n.element,class:o.value,style:a.value,colspan:n.element.attributes.colspan,rowspan:n.element.attributes.rowspan,onClick:oe(i,["stop"])}),[p(kn,{element:n.element,class:h(y(s).content)},null,8,["element","class"])],48,xa))}}),qa="_cell_rp1x6_2",Da="_content_rp1x6_31",Oa={cell:qa,content:Da},Ma={classes:Oa},fo=z(Aa,[["__cssModules",Ma]]);function po(n,e){return{type:"menu",label:"层级",icon:"icon-cengji",submenu:[{type:"menu",icon:"icon-vertical-align-top",label:"移至顶层",handler(){const t=e.page;if(t==null)return;const l=t.topZIndex;e.setZIndex(l+1),n.createSnapshot()}},{type:"menu",label:"上移一层",icon:"icon-arrowup",handler(){const t=e.zIndex;e.setZIndex(t+1),n.createSnapshot()}},{type:"menu",icon:"icon-arrowdown",label:"下移一层",handler(){const t=e.zIndex;t<=0||(e.setZIndex(t-1),n.createSnapshot())}},{type:"menu",icon:"icon-vertical-align-bottom",label:"移至底层",handler(){e.setZIndex(0),n.createSnapshot()}}]}}function $a(n,e){const t=e.getSelected(),l={menus:[{type:"menu",label:"选中表格",icon:"icon-aim",handler:e.selectTable},{type:"divider"}]},s=[];return t.length>=2&&s.push({type:"menu",label:"合并单元格",icon:"icon-merge-cells",handler:e.mergeCells}),t.some(o=>o.hasSpan)&&s.push({type:"menu",label:"拆分单元格",icon:"icon-solit-cells",handler:e.splitCells}),t.length===1&&t[0].noSpan&&s.push({type:"menu",label:"拆分列",handler:e.splitByColumn},{type:"menu",label:"拆分行",handler:e.splitByRow}),s.length>0&&l.menus.push(...s,{type:"divider"}),l.menus.push({type:"menu",label:"插入",icon:"icon-plus-square",submenu:[{type:"menu",label:"左侧插入列",handler:e.insertColumnLeft},{type:"menu",label:"右侧插入列",handler:e.insertColumnRight},{type:"menu",label:"上侧插入行",handler:e.insertRowTop},{type:"menu",label:"下侧插入行",handler:e.inserRowBottom}]},{type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"删除列",icon:"icon-deletecolumn",handler:e.deleteColumns},{type:"menu",label:"删除行",icon:"icon-deleterow",handler:e.deleteRows},{type:"menu",label:"数据源",icon:"icon-datasource",handler:e.deleteDataSource}]},{type:"divider"},{type:"menu",label:"自动调整",icon:"icon-auto-resize",submenu:[{type:"menu",label:"根据纸张调整列宽",handler:e.autoReiszeColumnByPaper},{type:"menu",label:"均分表格宽度",handler:e.avgTableWidth},{type:"menu",label:"均分表格高度",handler:e.avgTableHeight},{type:"menu",label:"将其他行设为相同高度",handler:e.setOtherRowSameHeight,disabled(){return e.toArea(t).rowSpan!==1}},{type:"menu",label:"将其他列设为相同宽度",handler:e.setOtherColSameWidth,disabled(){return e.toArea(t).colSpan!==1}}]},po(e.getDesignApi(),e.getTable())),el.open(n.clientX,n.clientY,l)}function Pa(n,e){function t(){return n.element}function l(){const w=t();return e.getSelectedElements().filter(R=>{var q;if(R.type!==X.TABLE_CELL)return!1;const x=(q=R.parent)==null?void 0:q.parent;return x==null?!1:x.id==w.id}).sort(Qn.sort)}function s(w){var j,W,M;const[_,...R]=w;let x=_.index,q=_.index,V=((j=_.parent)==null?void 0:j.index)??-1,O=((W=_.parent)==null?void 0:W.index)??-1;for(const de of R){const ee=de.index,Ee=((M=de.parent)==null?void 0:M.index)??-1,we=de.attributes.colspan??1,Ve=de.attributes.rowspan??1,nn=ee+we-1,ln=Ee+Ve-1;ee>=0&&ee<x&&(x=ee),ee>=0&&nn>q&&(q=nn),Ee>=0&&Ee<V&&(V=Ee),Ee>=0&&ln>O&&(O=ln)}return{colStart:x,colEnd:q,rowStart:V,rowEnd:O,colSpan:q-x+1,rowSpan:O-V+1}}function o(){var R;const w=l()[0];if(w==null)return!1;const _=(R=w.parent)==null?void 0:R.parent;return _==null?!1:e.selectElement(_)}function a(){const w=l();if(w.length===0)return!1;const _=s(w);return t().insertColumn(_.colStart,0),e.createSnapshot(),!0}function i(){const w=l();if(w.length===0)return!1;const _=s(w);return t().insertColumn(_.colEnd,1),e.createSnapshot(),!0}function r(){const w=l();if(w.length===0)return!1;const _=s(w);return t().inserRow(_.rowStart,0),e.createSnapshot(),!0}function d(){const w=l();if(w.length===0)return!1;const _=s(w);return t().inserRow(_.rowEnd,1),e.createSnapshot(),!0}function u(){var ee,Ee;const w=t(),_=w.page;if(_==null)return;const R=w.doc,x=vl((ee=R==null?void 0:R.margins)==null?void 0:ee.left)??38,q=vl((Ee=R==null?void 0:R.margins)==null?void 0:Ee.right)??38,V=w.columns,O=V.reduce((we,Ve)=>we+Ve,0),j=Fn.mm_to_px(_.width)-x-q,W=[];for(const we of V){const Ve=Math.round(we/O*j);W.push(Ve)}const M=W.reduce((we,Ve)=>we+Ve,0),de=j-M;W[W.length-1]+=de,w.setColumns(W),w.updateBoxSize(),e.createSnapshot()}function m(){const w=t(),_=w.columns,R=_.reduce((O,j)=>O+j,0),x=Math.floor(R/_.length),q=new Array(_.length).fill(x),V=R-q.reduce((O,j)=>O+j,0);q[q.length-1]+=V,w.setColumns(q),w.updateBoxSize(),e.createSnapshot()}function g(){const w=t(),_=Math.round(w.height/w.children.length);w.children.forEach((R,x)=>w.setRowHeight(x,_)),w.updateBoxSize(),e.createSnapshot()}function E(){const w=e.getSelectedElements()[0];if(w==null)return;const _=w.parent;if(_==null||_.type!="TableRow")return;const R=t(),x=_.height;R.children.forEach(q=>q.setRowHeight(x)),R.updateBoxSize(),e.createSnapshot()}function v(){const w=e.getSelectedElements()[0];if(w==null)return;const _=t(),R=w.width,x=_.attributes.colgroup.map(q=>R);_.setColumns(x),_.updateBoxSize(),e.createSnapshot()}function c(){const w=l();if(w.length<2)return;const R=t().mergeCells(w);e.selectElement(R),e.createSnapshot()}function b(){const w=l();if(w.length==0)return;t().splitCells(w),e.createSnapshot()}function T(){const w=l()[0];if(w==null)return;t().removeColumn(w.index),e.resetSelectedElement(),e.createSnapshot()}function A(){const w=l()[0];if(w==null)return;const _=w.parent;if(_==null)return;t().removeRow(_.index),e.resetSelectedElement(),e.createSnapshot()}function C(){e.getSelectedElements().forEach(_=>_.resetDS()),e.createSnapshot()}function L(){const w=e.getSelectedElements();if(w.length!=1)return;const _=w[0];if(_.hasSpan)return;const R=_.index,x=t();x.insertColumn(R,1,!0);for(const q of x.children){const V=q.children[R];if(V.id===_.id)continue;const O=q.children[R+1];x.mergeCells([V,O])}e.selectElement(_),e.createSnapshot()}function k(){const w=e.getSelectedElements();if(w.length!=1)return;const _=w[0];if(_.hasSpan)return;const R=_.parent;if(R==null)return;const x=t();x.inserRow(R.index,1);const q=x.children[R.index+1];for(let V=0;V<R.children.length;V++){const O=R.children[V];if(O.id===_.id)continue;const j=q.children[V];x.mergeCells([O,j])}e.selectElement(_),e.createSnapshot()}return{getDesignApi(){return e},getTable:t,getSelected:l,selectTable:o,toArea:s,insertColumnLeft:a,insertColumnRight:i,insertRowTop:r,inserRowBottom:d,autoReiszeColumnByPaper:u,avgTableWidth:m,avgTableHeight:g,setOtherRowSameHeight:E,setOtherColSameWidth:v,mergeCells:c,splitCells:b,splitByColumn:L,splitByRow:k,deleteColumns:T,deleteRows:A,deleteDataSource:C}}function Va(n,e,t){const s={moved:!1,left:0,colIndex:0,target:null,container:null};function o(u){return u<=0?null:n.getTable().getColumnLeft(u-1)}function a(u){const m=n.getTable(),g=m.attributes.colgroup.length;return u>=g?null:m.getColumnLeft(u+1)}function i(u,m){if(!(u.target instanceof Element))return;const g=u.target.closest("."+e.colResize);if(g==null)return;const E=g.closest("."+e.layer);E!=null&&(u.stopPropagation(),u.preventDefault(),s.left=g.offsetLeft,s.colIndex=m,s.target=g,s.container=E,s.target.setPointerCapture(u.pointerId),window.addEventListener("pointermove",r),window.addEventListener("pointerup",d))}function r(u){if(s.target==null||s.container==null)return;const m=s.container.getBoundingClientRect(),g=n.getDesignApi().state.scale/100,E=o(s.colIndex),v=a(s.colIndex);let c=u.clientX-m.left;E!=null&&c<=E*g+4&&(c=E*g+4),v!=null&&c>=v*g-4&&(c=v*g-4),s.left=c/g,s.target.style.left=c/g+"px",s.moved=!0}function d(u){s.moved&&t.onResizeEnd(s.colIndex,Math.round(s.left)),s.left=0,s.target=null,s.container=null,window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",d)}return i}function Ba(n,e,t){const s={moved:!1,top:0,rowIndex:0,target:null,container:null};function o(u){return u<=0?null:n.getTable().getRowTop(u-1)}function a(u){const m=n.getTable(),g=m.children.length;return u>=g?null:m.getRowTop(u+1)}function i(u,m){if(!(u.target instanceof Element))return;const g=u.target.closest("."+e.rowResize);if(g==null)return;const E=g.closest("."+e.layer);E!=null&&(u.stopPropagation(),u.preventDefault(),s.top=g.offsetTop,s.rowIndex=m,s.target=g,s.container=E,s.target.setPointerCapture(u.pointerId),window.addEventListener("pointermove",r),window.addEventListener("pointerup",d))}function r(u){if(s.target==null||s.container==null)return;const m=n.getDesignApi().state.scale/100,g=s.container.getBoundingClientRect(),E=o(s.rowIndex),v=a(s.rowIndex);let c=u.clientY-g.top;E!=null&&c<=E*m+4&&(c=E*m+4),v!=null&&c>=v*m-4&&(c=v*m-4),s.moved=!0,s.top=c/m,s.target.style.top=c/m+"px"}function d(u){s.moved&&t.onResizeEnd(s.rowIndex,Math.round(s.top)),s.top=0,s.target=null,s.container=null,window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",d)}return i}const Fa=["width"],za=["onClick"],Ua=["onClick"],Ha=P({__name:"TableEditor",props:{element:{type:Pl,required:!0}},setup(n){const e=n,t=Te(),l=Le("classes"),s=Pa(e,t),o=Me({colIndex:-1,rowIndex:-1,silence:!1}),a=N(()=>e.element.attributes.colgroup??[]),i=Va(s,l,{onResizeEnd:T,onResizeStart:b}),r=Ba(s,l,{onResizeEnd:A,onResizeStart:b});function d(_){return{left:(e.element.attributes.colgroup??[]).slice(0,_).reduce((x,q)=>x+q,0)+"px"}}function u(_){return{top:(e.element.children??[]).slice(0,_).reduce((q,V)=>q+V.height,0)-1+"px"}}function m(_){const R=e.element.attributes.colgroup??[],x=R.slice(0,_).reduce((O,j)=>O+j,0),q=_===0?0:1,V=_>0&&_<R.length?-1:0;return{left:x+q+"px",width:R[_]+V+"px"}}function g(_){const R=e.element.children??[],x=R.slice(0,_).reduce((O,j)=>O+j.height,0),q=_===0?0:1,V=_>0&&_<R.length?-1:0;return{top:x+q+"px",height:R[_].height+V+"px"}}function E(_){t.selectElement(_)}function v(_){const R=[];for(const x of e.element.children){const q=x.children[_];q.isColCollapse||R.push(q)}t.multiSelectElements(R)}async function c(_){const R=_.target.closest("td");if(R==null)return;const x=Reflect.get(R,je);x!=null&&(t.state.selectMode==it.SINGLE&&(t.selectElement(x),await Vt()),$a(_,s))}function b(){o.silence=!0}function T(_,R){o.silence=!1;const x=e.element.attributes.colgroup??[];if(_==0){const W=e.element.left,M=e.element.calculateCoord(W+R),de=x[0]-(M-W);e.element.setLeft(M),e.element.setColWidth(0,de),e.element.updateBoxSize(),t.createSnapshot();return}if(_==x.length){const W=_-1,M=x.slice(0,W).reduce((ee,Ee)=>ee+Ee,0),de=R-M;e.element.setColWidth(_-1,de),e.element.updateBoxSize(),t.createSnapshot();return}const q=_-1,V=x[q]+x[_],O=R-x.slice(0,q).reduce((W,M)=>W+M,0),j=V-O;e.element.setColWidth(q,O),e.element.setColWidth(_,j),e.element.updateBoxSize(),t.createSnapshot()}function A(_,R){o.silence=!1;const x=e.element.children;if(_==0){const W=e.element.top,M=e.element.calculateCoord(W+R),de=x[0].height-(M-W);e.element.setTop(M),e.element.setRowHeight(_,de),e.element.updateBoxSize(),t.createSnapshot();return}if(_==x.length){const W=_-1,M=x.slice(0,W).reduce((ee,Ee)=>ee+Ee.height,0),de=R-M;e.element.setRowHeight(_-1,de),e.element.updateBoxSize(),t.createSnapshot();return}const q=_-1,V=x[q].height+x[_].height,O=R-x.slice(0,q).reduce((W,M)=>W+M.height,0),j=V-O;e.element.setRowHeight(q,O),e.element.setRowHeight(_,j),e.element.updateBoxSize(),t.createSnapshot()}function C(){o.rowIndex=-1,o.colIndex=-1}function L(_){if(o.silence)return;const R=_.target.closest("td");if(R==null)return;const x=Reflect.get(R,je);if(x==null||!(x instanceof Qn))return;const q=x.parent;if(q==null)return;const V=R.getBoundingClientRect(),O=_.clientY-V.top,W=_.clientX-V.left<V.width/2,M=O<V.height/2;o.colIndex=W?x.index:x.getNextColIndex(),o.rowIndex=M?q.index:x.getNextRowIndex()}function k(){const _=e.element;_.insertColumn(_.colSize-1,1)}function w(){const _=e.element;_.inserRow(_.rowSize-1,1)}return(_,R)=>(S(),I("div",{class:h(y(l).tableEditor),onContextmenu:oe(c,["stop","prevent"]),onClick:R[3]||(R[3]=oe(()=>{},["stop"])),onMouseleave:C},[f("table",{class:h(y(l).table),onMousemove:L},[f("colgroup",null,[(S(!0),I(Z,null,re(a.value,(x,q)=>(S(),I("col",{key:q,width:x},null,8,Fa))),128))]),f("tbody",null,[(S(!0),I(Z,null,re(n.element.children,x=>(S(),I("tr",{key:x.id,class:h({[y(G).SELECTED]:x.isSelected})},[(S(!0),I(Z,null,re(x.children,q=>(S(),Q(fo,{key:q.id,element:q},null,8,["element"]))),128))],2))),128))])],34),f("div",{class:h(y(l).layer)},[o.colIndex>=0?(S(),I("div",{key:0,title:"调整列宽",class:h(y(l).colResize),style:J(d(o.colIndex)),onPointerdown:R[0]||(R[0]=oe(x=>y(i)(x,o.colIndex),["stop","prevent"]))},null,38)):H("",!0),o.rowIndex>=0?(S(),I("div",{key:1,title:"调整行高",class:h(y(l).rowResize),style:J(u(o.rowIndex)),onPointerdown:R[1]||(R[1]=oe(x=>y(r)(x,o.rowIndex),["stop","prevent"]))},null,38)):H("",!0),(S(!0),I(Z,null,re(a.value,(x,q)=>(S(),I("div",{title:"选中此列",key:q,style:J(m(q)),class:h(y(l).colIndicator),onClick:oe(V=>v(q),["stop"])},null,14,za))),128)),(S(!0),I(Z,null,re(n.element.children,(x,q)=>(S(),I("div",{title:"选中此行",key:q,style:J(g(q)),class:h(y(l).rowIndicator),onClick:oe(V=>E(x),["stop"])},null,14,Ua))),128)),n.element.isSelected?(S(),I("button",{key:2,onClick:oe(k,["stop"]),type:"button",class:h(["quickprint-text-btn",y(l).addCol]),title:"添加列"},[p(y($),{icon:"icon-plus",size:"14px"})],2)):H("",!0),n.element.isSelected?(S(),I("button",{key:3,onClick:oe(w,["stop"]),type:"button",class:h(["quickprint-text-btn",y(l).addRow]),title:"添加行"},[p(y($),{icon:"icon-plus",size:"14px"})],2)):H("",!0)],2),f("div",{class:h(y(l).indicator),onPointerdown:R[2]||(R[2]=(...x)=>y(t).onDragStart&&y(t).onDragStart(...x)),title:"选中/拖动表格"},null,34)],34))}}),Ga="_tableEditor_5qbkt_2",Wa="_table_5qbkt_2",Ya="_layer_5qbkt_33",Xa="_colResize_5qbkt_43",ja="_rowResize_5qbkt_66",Za="_colIndicator_5qbkt_89",Ka="_rowIndicator_5qbkt_95",Ja="_indicator_5qbkt_114",Qa="_addCol_5qbkt_151",ec="_addRow_5qbkt_166",tc={tableEditor:Ga,table:Wa,layer:Ya,colResize:Xa,rowResize:ja,colIndicator:Za,rowIndicator:Ka,indicator:Ja,addCol:Qa,addRow:ec},nc={classes:tc},lc=z(Ha,[["__cssModules",nc]]),oc={class:"quickprint-config-section quickprint-config-inline"},sc={class:"quickprint-config-content"},ic=P({__name:"TableConfig",props:{element:{type:Pl,required:!0}},setup(n){const e=n,t=N({get(){return e.element.attributes.rowMode??Ut.CONST},set(s){e.element.attributes.rowMode=s===Ut.CONST?void 0:s}}),l=[{label:"固定行数",value:Ut.CONST,detail:"按照画布中设计打印固定行数，并依此拆分表格"},{label:"忽略空白行",value:Ut.IGNORE_BLANK,detail:"不固定行数，忽略表格中的空白行"},{label:"打印空白行",value:Ut.PRINT_BLANK,detail:"不固定行数，打印表格中的空白行"}];return(s,o)=>(S(),I("section",oc,[o[1]||(o[1]=f("header",{class:"quickprint-config-header"},"行模式",-1)),f("div",sc,[p(y(K),{options:l,modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=a=>t.value=a),class:"quickprint-w-full"},null,8,["modelValue"])])]))}}),rc={class:"quickprint-config-section quickprint-config-inline"},ac={class:"quickprint-config-content"},cc=P({__name:"TableRowConfig",props:{element:{type:un,required:!0}},setup(n){const e=n,t=[{label:"表头",value:Rt.HEADER},{label:"表体",value:Rt.BODY},{label:"表尾",value:Rt.FOOTER}],l=N({get(){return e.element.attributes.type??Rt.BODY},set(s){switch(s){case Rt.HEADER:e.element.asHeader();break;case Rt.FOOTER:e.element.asFooter();break;default:e.element.asBody()}}});return(s,o)=>(S(),I("section",rc,[o[1]||(o[1]=f("header",{class:"quickprint-config-header"},"行模式",-1)),f("div",ac,[p(y(K),{options:t,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value=a),class:"quickprint-w-full"},null,8,["modelValue"])])]))}}),Ln=Object.freeze({title:"表格",type:X.TABLE,icon:"icon-table",editor:lc,config:{attributes:ic,exclude:[ae.DISPLAY,ae.BASIC]},features:{draggable:!1,resizable:!1,contextMenu:!1},onCreate(){const n=[_t,_t,_t],e=me.create({type:X.TABLE});return e.setColgroup(n),e.append(un.createDefault(n)),e.append(un.createDefault(n)),e.append(un.createDefault(n)),e.updateBoxSize(),e}}),mo=Object.freeze({title:"表格行",type:X.TABLE_ROW,icon:"icon-table-row",exposed:!1,editor:null,config:{exclude:[ae.POSITION,ae.COORD,ae.OVERFLOW],attributes:cc}}),cl=Object.freeze({title:"单元格",type:X.TABLE_CELL,icon:"icon-table-cell",exposed:!1,editor:fo,config:{exclude:[ae.POSITION,ae.COORD]}});function rn(n,e){const t=Math.pow(10,Math.max(0,e));return Math.round(n*t)/t}const Vn={A:10,B:11,C:12,D:13,E:14,F:15},yl={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};function uc(n){return typeof n=="string"&&n.includes(".")&&Number.parseFloat(n)===1}function dc(n){return typeof n=="string"&&n.includes("%")}function qt(n,e){uc(n)&&(n="100%");const t=dc(n);return n=Math.min(e,Math.max(0,Number.parseFloat(`${n}`))),t&&(n=Number.parseInt(`${n*e}`,10)/100),Math.abs(n-e)<1e-6?1:n%e/Number.parseFloat(e)}function dt(n){return n.length===2?(Vn[n[0].toUpperCase()]||+n[0])*16+(Vn[n[1].toUpperCase()]||+n[1]):Vn[n[1].toUpperCase()]||+n[1]}function El(n,e,t){n=qt(n,255),e=qt(e,255),t=qt(t,255);const l=Math.max(n,e,t),s=Math.min(n,e,t);let o;const a=l,i=l-s,r=l===0?0:i/l;if(l===s)o=0;else{switch(l){case n:{o=(e-t)/i+(e<t?6:0);break}case e:{o=(t-n)/i+2;break}case t:{o=(n-e)/i+4;break}}o/=6}return{h:o*360,s:r*100,v:a*100}}const fc=function(n,e,t){e=e/100,t=t/100;let l=e;const s=Math.max(t,.01);t*=2,e*=t<=1?t:2-t,l*=s<=1?s:2-s;const o=(t+e)/2,a=t===0?2*l/(s+l):2*e/(t+e);return{h:n,s:a*100,v:o*100}},pc=function(n,e,t){return[n,e*t/((n=(2-e)*t)<1?n:2-n)||0,n/2]};function Bn(n,e,t){n=qt(n,360)*6,e=qt(e,100),t=qt(t,100);const l=Math.floor(n),s=n-l,o=t*(1-e),a=t*(1-s*e),i=t*(1-(1-s)*e),r=l%6,d=[t,a,o,o,i,t][r],u=[i,t,t,a,o,o][r],m=[o,o,i,t,t,a][r];return{r:Math.round(d*255),g:Math.round(u*255),b:Math.round(m*255)}}function pn(n){n=Math.min(Math.round(n),255);const e=Math.floor(n/16),t=n%16;return`${yl[e]||e}${yl[t]||t}`}function mc({r:n,g:e,b:t}){return Number.isNaN(+n)||Number.isNaN(+e)||Number.isNaN(+t)?"":`#${pn(n)}${pn(e)}${pn(t)}`}class In{constructor(e){F(this,"h",0);F(this,"s",100);F(this,"v",100);F(this,"a",100);e&&this.setColor(e)}setColor(e){const t=this.processColor(e);t!=null&&(this.setHue(t.h),this.setSaturation(t.s),this.setValue(t.v),this.setAlpha(t.a))}setHue(e){this.h=rn(e,2)}setSaturation(e){this.s=rn(e,2)}setValue(e){this.v=rn(e,2)}setAlpha(e){this.a=rn(e,2)}processColor(e){return e==null||e==""?null:e.startsWith("#")?this.processHEX(e):e.startsWith("rgb")?this.processRGB(e):e.startsWith("hsl")?this.processHSL(e):this.processHSV(e)}processHSV(e){const t=e.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(s=>s!=="").map((s,o)=>o>2?Number.parseFloat(s):Number.parseInt(s,10)),l=t.length===4?t[3]*100:100;return{h:t[0],s:t[1],v:t[2],a:l}}processHEX(e){const t=e.replace("#","").trim();if(!/^[0-9a-fA-F]{3}$|^[0-9a-fA-F]{6}$|^[0-9a-fA-F]{8}$/.test(t))return null;let l,s,o,a=100;t.length===3?(l=dt(t[0]+t[0]),s=dt(t[1]+t[1]),o=dt(t[2]+t[2])):(t.length===6||t.length===8)&&(l=dt(t.slice(0,2)),s=dt(t.slice(2,4)),o=dt(t.slice(4,6))),t.length===8&&(a=dt(t.slice(6))/255*100);const{h:i,s:r,v:d}=El(l,s,o);return{h:i,s:r,v:d,a}}processRGB(e){const t=e.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,s)=>s>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:s,s:o,v:a}=El(t[0],t[1],t[2]);return{h:s,s:o,v:a,a:l}}return null}processHSL(e){const t=e.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,s)=>s>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:s,s:o,v:a}=fc(t[0],t[1],t[2]);return{h:s,s:o,v:a,a:l}}return null}toString(e){switch(e){case"hsl":{const t=pc(this.h,this.s/100,this.v/100);return`hsla(${this.h},${Math.round(t[1]*100)}%,${Math.round(t[2]*100)}%,${this.a/100})`}case"hex":return`${mc(Bn(this.h,this.s,this.v))}${pn(this.a*255/100)}`;case"rgb":{const{r:t,g:l,b:s}=Bn(this.h,this.s,this.v);return`rgba(${t},${l},${s},${this.a/100})`}default:return`hsva(${this.h},${Math.round(this.s)}%,${Math.round(this.v)}%,${this.a/100})`}}toRGB(){return this.toString("rgb")}toHSL(){return this.toString("hsl")}toHEX(){return this.toString("hex")}rgb(){return Bn(this.h,this.s,this.v)}}function go(n){const e={init:!1,target:null,container:null,offsetX:0};function t(a){const i=e.container.getBoundingClientRect(),d=e.target.getBoundingClientRect().width/2;let u=a.clientX-i.left-e.offsetX;return u<-d&&(u=-d),u>i.width-d&&(u=i.width-d),u}function l(a){a.stopPropagation(),a.preventDefault();const i=a.target,r=a.currentTarget;origin==null||i==null||(e.container=r,e.target=i===r?i.firstElementChild:i,e.offsetX=i===r?e.target.offsetWidth/2:a.clientX-i.getBoundingClientRect().left,window.addEventListener("pointermove",s),window.addEventListener("pointerup",o))}function s(a){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(a.pointerId),e.init=!0);const i=t(a);e.target.style.left=i+"px",n("move",i)}function o(a){if(a.preventDefault(),a.stopPropagation(),e.container&&e.target){const i=t(a);n("end",i)}e.target&&e.target.releasePointerCapture(a.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",o)}return l}function gc(n){const e={init:!1,target:null,container:null,offsetX:0,offsetY:0};function t(i){const r=e.container.getBoundingClientRect(),u=e.target.getBoundingClientRect().width/2;let m=i.clientX-r.left-e.offsetX;return m<-u&&(m=-u),m>r.width-u&&(m=r.width-u),m}function l(i){const r=e.container.getBoundingClientRect(),u=e.target.getBoundingClientRect().height/2;let m=i.clientY-r.top-e.offsetY;return m<-u&&(m=-u),m>r.height-u&&(m=r.height-u),m}function s(i){i.stopPropagation(),i.preventDefault();const r=i.target,d=i.currentTarget;origin==null||r==null||(e.container=d,e.target=r===d?r.firstElementChild:r,e.offsetX=r===d?e.target.offsetWidth/2:i.clientX-r.getBoundingClientRect().left,e.offsetY=r===d?e.target.offsetHeight/2:i.clientY-r.getBoundingClientRect().top,window.addEventListener("pointermove",o),window.addEventListener("pointerup",a))}function o(i){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(i.pointerId),e.init=!0);const r=t(i),d=l(i);e.target.style.left=r+"px",e.target.style.top=d+"px",n("move",{left:r,top:d})}function a(i){if(i.preventDefault(),i.stopPropagation(),e.container&&e.target){const r=t(i),d=l(i);n("end",{top:d,left:r})}e.target&&e.target.releasePointerCapture(i.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",a)}return s}const hc=P({__name:"SvPanel",props:{modelValue:{type:In,required:!0}},setup(n){const e=n,t=ue(),l=ue(),s=Me(i()),o=N(()=>({left:s.left+"px",top:s.top+"px"})),a=gc((r,d)=>{r=="end"&&(s.top=d.top,s.left=d.left);const u=t.value,m=l.value,g=(d.left+m.offsetWidth/2)/u.offsetWidth*100,E=100-(d.top+m.offsetHeight)/u.offsetHeight*100;e.modelValue.setSaturation(g),e.modelValue.setValue(E)});function i(){const r=t.value,d=l.value;if(r==null||d==null)return{top:-6,left:-6};const u=e.modelValue.s,g=(100-e.modelValue.v)/100*r.offsetHeight,E=u/100*r.offsetWidth;return{top:g-d.offsetHeight/2,left:E-d.offsetWidth/2}}return tn(()=>{const r=i();s.top=r.top,s.left=r.left}),(r,d)=>(S(),I("div",{class:h(r.classes.svPanel),onPointerdown:d[0]||(d[0]=(...u)=>y(a)&&y(a)(...u)),ref_key:"svPanelRef",ref:t},[f("div",{class:h(r.classes.thumb),style:J(o.value),ref_key:"thumbRef",ref:l},null,6)],34))}}),vc="_svPanel_1sv6o_2",bc="_thumb_1sv6o_10",yc={svPanel:vc,thumb:bc},Ec={classes:yc},_c=z(hc,[["__cssModules",Ec]]),Tc=P({__name:"HueSlider",props:{modelValue:{type:In,required:!0}},setup(n){const e=n,t=ce(-6),l=ue(),s=ue(),o=go((i,r)=>{i=="end"&&(t.value=r);const d=l.value,u=s.value,m=Math.round((r+u.offsetWidth/2)/d.offsetWidth*360);e.modelValue.setHue(m)});function a(){const i=l.value,r=s.value;if(i==null||r==null)return-6;const d=e.modelValue.h;return Math.round(d/360*i.offsetWidth)-r.offsetWidth/2}return tn(()=>{t.value=a()}),(i,r)=>(S(),I("div",{class:h(i.classes.hue),onPointerdown:r[0]||(r[0]=(...d)=>y(o)&&y(o)(...d)),ref_key:"hueRef",ref:l},[f("div",{class:h(i.classes.thumb),style:J({left:t.value+"px"}),ref_key:"thumbRef",ref:s},null,6)],34))}}),Sc="_hue_1ozoc_2",wc="_thumb_1ozoc_10",kc={hue:Sc,thumb:wc},Cc={classes:kc},Rc=z(Tc,[["__cssModules",Cc]]),Nc=P({__name:"AlphaSlider",props:{modelValue:{type:In,required:!0}},setup(n){const e=n,t=ce(-6),l=ue(),s=ue(),o=go((i,r)=>{i=="end"&&(t.value=r);const d=l.value,u=s.value,m=Math.round((r+u.offsetWidth/2)/d.offsetWidth*100);e.modelValue.setAlpha(m)});function a(){const i=l.value,r=s.value;if(i==null||r==null)return-6;const d=e.modelValue.a;return Math.round(d/100*i.offsetWidth)-r.offsetWidth/2}return tn(()=>{t.value=a()}),(i,r)=>(S(),I("div",{class:h(i.classes.alpha),onPointerdown:r[0]||(r[0]=(...d)=>y(o)&&y(o)(...d)),ref_key:"alphaRef",ref:l},[f("div",{class:h(i.classes.thumb),style:J({left:t.value+"px"}),ref_key:"thumbRef",ref:s},null,6)],34))}}),Lc="_alpha_1x8jd_2",Ic="_thumb_1x8jd_26",xc={alpha:Lc,thumb:Ic},Ac={classes:xc},qc=z(Nc,[["__cssModules",Ac]]),Dc=["#FFFFFF","#000000","#485368","#2972F4","#00A3F5","#319B62","#DE3C36","#F88825","#F5C400","#9A38D7","#F2F2F2","#7F7F7F","#F3F5F7","#E5EFFF","#E5F6FF","#EAFAF1","#FFE9E8","#FFF3EB","#FFF9E3","#FDEBFF","#D8D8D8","#595959","#C5CAD3","#C7DCFF","#C7ECFF","#C3EAD5","#FFC9C7","#FFDCC4","#FFEEAD","#F2C7FF","#BFBFBF","#3F3F3F","#808B9E","#99BEFF","#99DDFF","#98D7B6","#FF9C99","#FFBA84","#FFE270","#D58EFF","#A5A5A5","#262626","#353B45","#1450B8","#1274A5","#277C4F","#9E1E1A","#B86014","#A38200","#5E2281","#939393","#0D0D0D","#24272E","#0C306E","#0A415C","#184E32","#58110E","#5C300A","#665200","#3B1551"];function Oc(){try{return typeof window.EyeDropper=="function"}catch(n){return console.log(n),!1}}async function Mc(){try{return(await new EyeDropper().open()).sRGBHex}catch(n){return console.error(n),null}}const _l={isSupport:Oc,open:Mc},$c=["title","onClick"],Pc=["title","onClick"],Tl="quickprint-recent-use-colors",Vc=P({__name:"index",props:{modelValue:{type:String,default:null},showText:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(n,{emit:e}){const t=e,l=n,s=[{value:"hex",label:"HEX"},{value:"rgb",label:"RGB"},{value:"hsl",label:"HSL"}],o=ce(new In(l.modelValue)),a=ue(),i=ue(),r=ce(A()),d=_l.isSupport(),u=ce("hex"),m=N(()=>{const k=l.modelValue;return k?{backgroundColor:k}:null}),g=N(()=>{const k=o.value,{r:w,g:_,b:R}=k.rgb();return{"--hue-channel-color":`hsl(${k.h}, 100%, 50%)`,"--alpha-channel-color-a":`rgba(${w}, ${_}, ${R}, 0)`,"--alpha-channel-color-b":`rgba(${w}, ${_}, ${R}, 1)`}}),E=N({get(){return o.value.toString(u.value)},set(k){o.value.setColor(k)}});function v(){var k;(k=a.value)==null||k.close()}function c(k){k!=null&&(t("update:modelValue",k),t("select",k),C(k),v())}function b(){t("update:modelValue",void 0),t("select",void 0),v()}function T(){_l.open().then(k=>c(k))}function A(){const k=localStorage.getItem(Tl);if(k==null||k=="")return[];const w=En(k);return w==null?[]:Array.isArray(w)?w:[]}function C(k){const w=r.value,_=w.indexOf(k);_>=0&&w.splice(_,1),w.length>10&&w.pop(),w.unshift(k),localStorage.setItem(Tl,JSON.stringify(w))}function L(){t("update:modelValue",o.value.toString(u.value)),t("select",o.value.toString(u.value)),v()}return nl(()=>l.modelValue,()=>o.value.setColor(l.modelValue)),(k,w)=>(S(),Q(y(to),{class:h(k.classes.colorPicker),onMousedown:w[7]||(w[7]=oe(()=>{},["prevent"])),ref_key:"popoverRef",ref:a},{popover:ye(()=>[f("div",{class:h(k.classes.colorPickerPanel)},[f("div",{class:h(k.classes.presetPanel)},[f("div",{class:h(k.classes.presetTools)},[f("button",{type:"button",class:h(k.classes.clearBtn),onClick:b},[f("span",{class:h(k.classes.none)},null,2),w[8]||(w[8]=f("span",null,"无颜色",-1))],2),y(d)?(S(),I("button",{key:0,type:"button",class:h(k.classes.indicator),onClick:T},[p(y($),{icon:"icon-eye-dropper"}),w[9]||(w[9]=f("span",null,"拾色器",-1))],2)):H("",!0)],2),f("div",{class:h(k.classes.colourAtla)},[(S(!0),I(Z,null,re(y(Dc),_=>(S(),I("div",{style:J({backgroundColor:_}),title:_,class:h(k.classes.color),onClick:R=>c(_)},null,14,$c))),256))],2),f("div",{class:h(k.classes.recentColors)},"最近使用",2),f("div",{class:h(k.classes.colourAtla)},[(S(),I(Z,null,re(10,_=>f("div",{key:_,title:r.value[_-1],style:J({backgroundColor:r.value[_-1]}),class:h(k.classes.color),onClick:R=>c(r.value[_-1])},null,14,Pc)),64))],2)],2),f("div",{class:h(k.pacls.panel),style:J(g.value)},[p(_c,{class:h(k.pacls.sv),modelValue:o.value,"onUpdate:modelValue":w[1]||(w[1]=_=>o.value=_)},null,8,["class","modelValue"]),f("div",{class:h(k.pacls.sliders)},[p(Rc,{class:h(k.pacls.hua),modelValue:o.value,"onUpdate:modelValue":w[2]||(w[2]=_=>o.value=_)},null,8,["class","modelValue"]),p(qc,{modelValue:o.value,"onUpdate:modelValue":w[3]||(w[3]=_=>o.value=_)},null,8,["modelValue"]),f("div",{class:h(k.pacls.preview)},[f("div",{class:h(k.pacls.previewColor),style:J({backgroundColor:o.value.toRGB()})},null,6)],2)],2),f("div",{class:h(k.pacls.tools)},[p(y(K),{options:s,teleport:"none",modelValue:u.value,"onUpdate:modelValue":w[4]||(w[4]=_=>u.value=_),width:"42px",border:"none",size:"text"},null,8,["modelValue"]),_e(f("input",{type:"text","onUpdate:modelValue":w[5]||(w[5]=_=>E.value=_),onMousedown:w[6]||(w[6]=oe(()=>{},["stop"])),class:"quickprint-form-control",style:{width:"120px"}},null,544),[[Ae,E.value]]),f("button",{type:"button",class:h(k.pacls.confirm),onClick:L},"确定",2)],2)],6)],2)]),default:ye(()=>[f("div",{class:h(k.classes.colorPickerInput),ref_key:"inputRef",ref:i},[Xe(k.$slots,"default",{},()=>[f("span",{class:h(k.classes.colorBlock),style:J(m.value)},null,6)]),n.showText?(S(),I("div",{key:0,class:h(k.classes.colorValue),onClick:w[0]||(w[0]=oe(()=>{},["stop"]))},Y(n.modelValue),3)):H("",!0)],2)]),_:3},8,["class"]))}}),Bc="_colorPicker_qpnrm_2",Fc="_colorPickerInput_qpnrm_6",zc="_colorBlock_qpnrm_13",Uc="_colorValue_qpnrm_22",Hc="_colorPickerPanel_qpnrm_27",Gc="_presetPanel_qpnrm_42",Wc="_colourAtla_qpnrm_46",Yc="_color_qpnrm_2",Xc="_presetTools_qpnrm_73",jc="_clearBtn_qpnrm_79",Zc="_indicator_qpnrm_80",Kc="_none_qpnrm_98",Jc="_recentColors_qpnrm_129",Qc={colorPicker:Bc,colorPickerInput:Fc,colorBlock:zc,colorValue:Uc,colorPickerPanel:Hc,presetPanel:Gc,colourAtla:Wc,color:Yc,presetTools:Xc,clearBtn:jc,indicator:Zc,none:Kc,recentColors:Jc},eu="_panel_911zv_2",tu="_sv_911zv_7",nu="_hua_911zv_11",lu="_sliders_911zv_15",ou="_tools_911zv_20",su="_confirm_911zv_37 quickprint-text-btn",iu="_preview_911zv_44",ru="_previewColor_911zv_59",au={panel:eu,sv:tu,hua:nu,sliders:lu,tools:ou,confirm:su,preview:iu,previewColor:ru},cu={classes:Qc,pacls:au},st=z(Vc,[["__cssModules",cu]]);class uu{constructor(e){F(this,"__v_skip",!0);F(this,"observer");F(this,"callbacks",[]);F(this,"handler");this.handler=bi((t,l)=>{for(const s of this.callbacks)s(t,l)},500),this.observer=new MutationObserver((t,l)=>this.handler(t,l)),this.observer.observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}addListener(e){return typeof e!="function"||this.callbacks.findIndex(l=>l===e)>=0?!1:(this.callbacks.push(e),!0)}removeListener(e){const t=this.callbacks.findIndex(l=>l===e);return t<0?!1:(this.callbacks.splice(t,1),!0)}cleanup(){this.observer.disconnect(),this.callbacks=[]}}function du(n,e){switch(n){case"fontSize":return e===be.DEFAULT?void 0:e;case"fontFamily":return e===le.DEFAULT?void 0:e;case"lineHeight":return e===gt.DEFAULT?void 0:e;default:return e}}const Sl="texteditor-const-node",fu=Object.freeze({CONST:0});class pu{constructor(e,t={}){F(this,"__v_skip",!0);F(this,"emitter",new bn);F(this,"container");F(this,"options");F(this,"observer");F(this,"handleClick");this.container=e,this.container.contentEditable="plaintext-only",this.container.classList.add("quickprint-text-editor"),this.options=t,this.observer=new uu(e),this.handleClick=this.onClick.bind(this),Reflect.defineProperty(this,"emitter",{configurable:!1,enumerable:!1,writable:!1,value:new bn}),e.addEventListener("click",this.handleClick)}on(e,t){return this.emitter.on(e,t)}once(e,t){return this.emitter.once(e,t)}off(e,t){return this.emitter.off(e,t)}dispatch(e){return this.emitter.dispatch(e)}createEvent(e,t){return new Go(e,t)}watch(e){return this.observer.addListener(e),()=>{this.observer!=null&&this.observer.removeListener(e)}}cleanup(){this.container.removeEventListener("click",this.handleClick),this.observer.cleanup(),this.emitter.cleanup()}getHTML(){return this.container.innerHTML}setHTML(e){return console.log("TODO: 光标"),this.container.innerHTML=e,!0}clear(){return this.container.innerHTML="",!0}focus(){this.container.focus()}blur(){this.container.blur()}getSelection(){const e=this.container,t=window.getSelection();if(t==null||!e.contains(t.anchorNode)||!e.contains(t.focusNode))return null;const l=t.getRangeAt(0);return l==null?null:{selection:t,range:l}}hasSelection(){const e=this.getSelection();return e==null?!1:!e.selection.isCollapsed}normalize(){const e=this.container;for(let t=e.childNodes.length-1;t>=0;t--){const l=e.childNodes[t];if(ie(l.textContent)){e.removeChild(l);continue}if(l instanceof HTMLElement){if(l.contentEditable==="false")continue;l.style.length===0&&l.replaceWith(l.textContent)}}return e.normalize(),e}updateHeight(){const e=this.container.scrollHeight;return this.dispatch(this.createEvent("resize",{height:e})),e}async autosize(){this.container.style.height="auto";const e=this.updateHeight();return await Tn(),this.container.style.removeProperty("height"),e}checkHeight(){const e=this.container;e.scrollHeight>e.clientHeight&&this.updateHeight()}createConstNode(e){const t=document.createElement("span");return t.contentEditable="false",t.innerText=`${e.label??e.value}`,t.className=Sl,t.dataset.value=e.value,t.dataset.type=e.type+"",t}focusAfterNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),t.collapseToEnd(),!0}focusNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),!0}focusNodes(e){if(e.length==0)return!1;if(e.length==1)return this.focusNode(e[0]);const t=window.getSelection();if(t==null)return!1;const l=new Range,s=e[0],o=e[e.length-1];return!this.container.contains(s)||!this.container.contains(o)?!1:(t.removeAllRanges(),l.setStartBefore(s),l.setEndAfter(o),t.addRange(l),!0)}insertNode(e,t){var g;const l=this.getSelection();if(l==null)return!1;const{selection:s,range:o}=l;if(s.isCollapsed!=!0&&s.deleteFromDocument(),s.isCollapsed!=!0)return!1;const a=s.anchorNode;if(a==null)return!1;const i=this.container,r=this.createConstNode(e);if(typeof(t==null?void 0:t.onCreateNode)=="function"&&t.onCreateNode(r),a.parentNode===i||(g=a.parentNode)!=null&&g.contains(i))return o.insertNode(r),this.normalize(),this.focusAfterNode(r),!0;const d=a.parentNode;if(d==null)return!1;const u=d.textContent;if(u==null)return!1;if(s.anchorOffset==u.length)return i.insertBefore(r,d.nextSibling),this.normalize(),this.focusAfterNode(r),!0;const m=document.createElement("span");return m.textContent=u.slice(0,s.anchorOffset),d instanceof HTMLElement&&(m.style.cssText=d.style.cssText),d.textContent=u.slice(s.anchorOffset),i.insertBefore(r,d),i.insertBefore(m,r),this.normalize(),this.focusAfterNode(r),!0}insertText(e){const t=this.getSelection();if(t==null)return!1;const{selection:l,range:s}=t;return l.isCollapsed||l.deleteFromDocument(),s.insertNode(document.createTextNode(e)),l.collapseToEnd(),this.normalize(),!0}normalizeRange(e){const t=this.container,l=e.startContainer,s=e.endContainer,o={};return l===t?(o.startNode=t.childNodes[e.startOffset],o.startOffset=-1):(o.startNode=l.parentNode==t?l:l.parentNode,o.startOffset=e.startOffset),s===t?(o.endNode=t.childNodes[e.endOffset],o.endOffset=-1):(o.endNode=s.parentNode==t?s:s.parentNode,o.endOffset=e.endOffset),o}findNodesBetween(e,t){const l=[];let s=e.nextSibling;for(;s!=null&&s!==t;)l.push(s),s=s.nextSibling;return l}inheritStyle(e,t){if(!(t instanceof HTMLElement))return!1;const l=t.style.cssText;return ie(l)?!1:(e.style.cssText=l,!0)}extractNodesFromRange(){var u;const e=this.container,t=this.getSelection();if(t==null||t.selection.isCollapsed)return null;const s=t.range,{startNode:o,startOffset:a,endNode:i,endOffset:r}=this.normalizeRange(s);if(o===i){const m=o.textContent??"";if(o instanceof CharacterData){const v=document.createElement("span");return v.textContent=m.slice(a,r),s.deleteContents(),s.insertNode(v),[v]}const g=document.createElement("span");g.textContent=m.slice(0,a),this.inheritStyle(g,i);const E=document.createElement("span");return E.textContent=m.slice(a,r),this.inheritStyle(E,i),i.textContent=m.slice(r),e.insertBefore(E,i),e.insertBefore(g,E),[E]}const d=this.findNodesBetween(o,i);if(a>0){const m=o.textContent??"",g=document.createElement("span");g.textContent=m.slice(0,a),this.inheritStyle(g,o),o.textContent=m.slice(a),e.insertBefore(g,o)}if(r>=0&&r<=(((u=i.textContent)==null?void 0:u.length)??0)){const m=i.textContent??"";if(i instanceof HTMLElement){i.textContent=m.slice(0,r);const g=document.createElement("span");g.textContent=m.slice(r),this.inheritStyle(g,i),e.insertBefore(g,i.nextSibling),d.push(i)}else{const g=document.createElement("span");g.textContent=m.slice(0,r),e.replaceChild(g,i);const E=document.createTextNode(m.slice(r));e.insertBefore(E,i.nextSibling),d.push(g)}}return d.unshift(o),d}setStyle(e,t){const l=this.extractNodesFromRange();if(l==null||l.length==0)return!1;let s=!0;const o=$l(e),a=du(e,t);for(let i=0;i<l.length;i++){const r=l[i];if(r instanceof HTMLElement){this.matchElementStyle(r,o,a)||(s=!1);continue}const d=document.createElement("span");d.textContent=r.textContent,this.container.replaceChild(d,r),l[i]=d,s=!1}for(const i of l){if(s||a==null){this.removeElementStyle(i,o,a);continue}this.setElementStyle(i,o,a)}return this.focusNodes(l),!0}matchElementStyle(e,t,l){const s=e.style.getPropertyValue(t);return t==="text-decoration-line"?s.includes(l):s==l}setElementStyle(e,t,l){if(t==="text-decoration-line"){const s=e.style.getPropertyValue("text-decoration-line"),o=vt.push(s,l);e.style.setProperty("text-decoration-line",o);return}e.style.setProperty(t,l)}removeElementStyle(e,t,l){if(t==="text-decoration-line"){const s=e.style.getPropertyValue("text-decoration-line"),o=vt.remove(s,l);ie(o)?e.style.removeProperty("text-decoration-line"):e.style.setProperty("text-decoration-line",o);return}e.style.removeProperty(t)}onClick(e){const t=e.target;if(t instanceof HTMLElement&&t.matches("."+Sl)){e.preventDefault(),e.stopPropagation(),this.focusNode(t);return}}}const mu=[{label:"微软雅黑",value:"Microsoft YaHei"},{label:"宋体",value:le.SONG},{label:"黑体",value:"黑体"},{label:"仿宋",value:"仿宋"},{label:"楷体",value:"楷体"}],ho=[{label:"Arial",value:"Arial"},{label:"Consolas",value:"Consolas"},{label:"Times",value:"Times"},{label:"Times New Roman",value:"Times New Roman"}],vo=[{label:"默认",value:le.DEFAULT},...ho],xn=[{label:"默认",value:le.DEFAULT},...mu,...ho],ul=[{label:"默认",value:be.DEFAULT},{label:"初号",value:be.SIZE_0+"pt",short:"56px"},{label:"小初",value:be.SIZE_0_S+"pt",short:"≈49.33px"},{label:"一号",value:be.SIZE_1+"pt",short:"≈34.67px"},{label:"小一",value:be.SIZE_1_S+"pt",short:"32px"},{label:"二号",value:be.SIZE_2+"pt",short:"≈29.33px"},{label:"小二",value:be.SIZE_2_S+"pt",short:"24px"},{label:"三号",value:be.SIZE_3+"pt",short:"≈21.33px"},{label:"小三",value:be.SIZE_3_S+"pt",short:"20px"},{label:"四号",value:be.SIZE_4+"pt",short:"≈18.67px"},{label:"小四",value:be.SIZE_4_S+"pt",short:"16px"},{label:"五号",value:be.SIZE_5+"pt",short:"14px"},{label:"小五",value:be.SIZE_5_S+"pt",short:"12px"},{label:"12px",value:"12px"},{label:"13px",value:"13px"},{label:"14px",value:"14px"},{label:"15px",value:"15px"},{label:"16px",value:"16px"},{label:"18px",value:"18px"},{label:"20px",value:"20px"},{label:"22px",value:"22px"},{label:"24px",value:"24px"},{label:"28px",value:"28px"},{label:"32px",value:"32px"},{label:"36px",value:"36px"},{label:"42px",value:"42px"},{label:"48px",value:"48px"},{label:"56px",value:"56px"},{label:"72px",value:"72px"}],bo=[{label:"默认",value:gt.DEFAULT},{label:"1.0",value:gt.TIMES_1,short:"单倍行距"},{label:"1.1",value:gt.TIMES_1_1},{label:"1.5",value:gt.TIMES_1_5},{label:"2.0",value:gt.TIMES_2,short:"两倍行距"}],gu=[{label:"无",value:dn.NONE},{label:"实线",value:Nt.SOLID},{label:"虚线",value:Nt.DASHED},{label:"点划线",value:Nt.DOTTED},{label:"双实线",value:Nt.DOUBLE},{label:"波浪线",value:Nt.WAVY}],hu=[{label:"默认",value:ht.AUTO},{label:"左对齐",value:ht.LEFT},{label:"居中对齐",value:ht.CENTER},{label:"右对齐",value:ht.RIGHT},{label:"两端对齐",value:ht.JUSTIFY}],Gn=[{label:"顶部对齐",value:Ye.TOP,icon:"icon-vertical-align-top"},{label:"垂直居中",value:Ye.MIDDLE,icon:"icon-vertical-align-middl"},{label:"底部对齐",value:Ye.BOTTOM,icon:"icon-vertical-align-bottom"}],Wn=[{label:"左对齐",value:lt.LEFT,icon:"icon-align-left"},{label:"居中对齐",value:lt.CENTER,icon:"icon-align-center"},{label:"右对齐",value:lt.RIGHT,icon:"icon-align-right"},{label:"两端对齐",value:lt.JUSTIFY,icon:"icon-menu"}],vu=P({__name:"ParagraphEditor",props:{element:{type:Wo,required:!0}},setup(n){const e=n,t=Te(),l=ue(),s=N(()=>e.element.isSelected!==!0?!1:t.state.selectMode===it.SINGLE);let o=null;const a=N(()=>xn.map(k=>(k.style={fontFamily:k.value==le.DEFAULT?le.SONG:k.value},k)));function i(){}async function r(){if(o==null)return;const k=await al({doc:t.doc}).catch(nt);if(k==null)return;const w=Ze(k.value,t.doc.ds)??k.value,_={type:fu.CONST,value:k.value,label:w};o.insertNode(_)}function d(){o==null||o.blur()}function u(){o==null||o.autosize()}function m(k){const w=e.element.ds.value,_=new pu(k);return _.on("resize",R=>{var q;const x=(q=R.detail)==null?void 0:q.height;x!=null&&e.element.setHeight(x+2)}),_.watch(()=>{const R=_.getHTML(),x=e.element.ds.value;R!==x&&(e.element.ds.value=R,_.checkHeight())}),ie(w)||_.setHTML(w),_}function g(k){o==null||o.setStyle("fontFamily",k.value)}function E(k){o==null||o.setStyle("fontSize",k.value)}function v(k){o==null||o.setStyle("lineHeight",k.value)}function c(k){o==null||o.setStyle("backgroundColor",k)}function b(k){o==null||o.setStyle("color",k)}function T(){o==null||o.setStyle("fontWeight","700")}function A(){o==null||o.setStyle("fontStyle","italic")}function C(){o==null||o.setStyle("textDecorationLine","underline")}function L(){o==null||o.setStyle("textDecorationLine","line-through")}return nl(()=>e.element.ds.value,k=>{o==null||o.getHTML()==k||o.setHTML(k)}),tn(()=>{e.element.on("blur",d),o=m(l.value)}),tl(()=>{e.element.off("blur",d),o&&o.cleanup()}),(k,w)=>(S(),I("div",{class:h(k.classes.paragraph),onPointerdown:w[2]||(w[2]=oe(()=>{},["stop"])),onContextmenu:oe(i,["stop","prevent"])},[f("div",{class:h(k.classes.indicator),onPointerdown:w[0]||(w[0]=(..._)=>y(t).onDragStart&&y(t).onDragStart(..._)),title:"选中/拖动段落"},null,34),s.value?(S(),I("div",{key:0,class:h(k.classes.toolbar),onMousedown:w[1]||(w[1]=oe(()=>{},["prevent"]))},[p(y(K),{onSelect:g,title:"字体",width:"60px",options:a.value,class:h(k.classes.tool),button:""},null,8,["options","class"]),p(y(K),{onSelect:E,title:"字号",width:"60px",options:y(ul),class:h(k.classes.tool),button:""},null,8,["options","class"]),p(y(K),{onSelect:v,title:"行高",width:"60px",options:y(bo),class:h(k.classes.tool),popoverWidth:120,button:""},null,8,["options","class"]),f("div",{class:h(k.classes.divider)},null,2),p(st,{class:h(k.classes.tool),onSelect:c},{default:ye(()=>[f("div",{class:h(k.classes.colorIcon),title:"突出显示"},[p(y($),{icon:"icon-bg-color-b",size:"15px"}),f("div",{class:h(k.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),p(st,{class:h(k.classes.tool),onSelect:b},{default:ye(()=>[f("div",{class:h(k.classes.colorIcon),title:"字体颜色"},[p(y($),{icon:"icon-font",size:"15px"}),f("div",{class:h(k.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),f("button",{onClick:T,type:"button",title:"加粗",class:h(["quickprint-text-btn",k.classes.tool])},[p(y($),{icon:"icon-font-bold",size:"16px"})],2),f("button",{onClick:A,type:"button",title:"斜体",class:h(["quickprint-text-btn",k.classes.tool])},[p(y($),{icon:"icon-italic",size:"16px"})],2),f("button",{onClick:C,type:"button",title:"下划线",class:h(["quickprint-text-btn",k.classes.tool])},[p(y($),{icon:"icon-underline",size:"16px"})],2),f("button",{onClick:L,type:"button",title:"删除线",class:h(["quickprint-text-btn",k.classes.tool])},[p(y($),{icon:"icon-through-line",size:"16px"})],2),f("div",{class:h(k.classes.divider)},null,2),f("button",{class:"quickprint-text-btn",type:"button",onClick:r},[p(y($),{icon:"icon-insert-var",size:"16px"}),w[3]||(w[3]=f("span",null,"插入变量",-1))]),f("button",{class:"quickprint-text-btn",type:"button",onClick:u},[p(y($),{icon:"icon-colum-height",size:"16px"}),w[4]||(w[4]=f("span",null,"调整高度",-1))])],34)):H("",!0),f("div",{ref_key:"editorRef",ref:l,class:h(k.classes.editor)},null,2)],34))}}),bu="_paragraph_1v2pj_2",yu="_indicator_1v2pj_6",Eu="_editor_1v2pj_18",_u="_toolbar_1v2pj_44",Tu="_tool_1v2pj_44",Su="_colorIcon_1v2pj_66",wu="_colorIndicator_1v2pj_86",ku="_divider_1v2pj_95",Cu={paragraph:bu,indicator:yu,editor:Eu,toolbar:_u,tool:Tu,colorIcon:Su,colorIndicator:wu,divider:ku},Ru={classes:Cu},Nu=z(vu,[["__cssModules",Ru]]),An=Object.freeze({title:"段落",type:X.PARAGRAPH,icon:"icon-paragraph",features:{draggable:!1,contextMenu:!1},editor:Nu,config:{exclude:[ae.DATASOURCE,ae.BASIC,ae.OVERFLOW]},onCreate(){return me.create({type:X.PARAGRAPH,width:_t*4,height:wn*6})}}),yo=[Cn,Rn,Nn,Ln,cl,mo,An],Lu=[Cn,Rn,Nn,Ln,An],Iu={[X.TEXT]:Cn.editor,[X.NUMBER]:Rn.editor,[X.DATE]:Nn.editor,[X.TABLE]:Ln.editor,[X.TABLE_CELL]:cl.editor,[X.PARAGRAPH]:An.editor},xu={[X.TEXT]:Cn.config,[X.NUMBER]:Rn.config,[X.DATE]:Nn.config,[X.TABLE]:Ln.config,[X.TABLE_CELL]:cl.config,[X.TABLE_ROW]:mo.config,[X.PARAGRAPH]:An.config},Ft=yo.reduce((n,e)=>(n[e.type]=e,n),{});function Au(n){const e=yo.find(t=>t.type===n);if(e==null||typeof e.onCreate!="function")throw new Error("未知的打印元素");return e.onCreate()}function qu(n){return Reflect.get(Iu,n)}function Wt(n){return Reflect.get(xu,n)}function Jt(n){var e;return((e=Ft[n])==null?void 0:e.title)??n}function Du(n){var e;return(e=Ft[n])==null?void 0:e.icon}function Ou(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.selection)!==!1}function Mu(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.contextMenu)!==!1}function $u(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.resizable)!==!1}function Pu(n){var e,t;return((t=(e=Ft[n])==null?void 0:e.features)==null?void 0:t.draggable)!==!1}function wl(n,e,t,l){const[s,o]=e.top>t.top?[t,e]:[e,t],a=s.top-l.top,i=o.bottom-s.top;return{top:a,left:n,height:i}}function kl(n,e,t,l){const[s,o]=e.left>t.left?[t,e]:[e,t],a=s.left-l.left,i=o.right-s.left;return{top:n,left:a,width:i}}function Cl(n,e){const t=n.find(r=>r.left===e.left);if(t==null||t.height==null)return n.push(e);const l=e.top+e.height,s=t.top+t.height,o=Math.min(t.top,e.top),i=Math.max(l,s)-o;t.top=o,t.height=i}function Rl(n,e){const t=n.find(r=>r.top===e.top);if(t==null||t.width==null)return n.push(e);const l=e.left+e.width,s=t.left+t.width,o=Math.min(t.left,e.left),i=Math.max(l,s)-o;t.left=o,t.width=i}function Vu(n){const e=document.createElement("div");return n.appendChild(e),e}function Bu(n,e){const t=[...e.querySelectorAll(":scope ."+G.GUIDE_LINE)];for(const l of n){const s=t.shift()??Vu(e);s.className=G.GUIDE_LINE,s.style.top=l.top+"px",s.style.left=l.left+"px",s.style.height=(l.height??1)+"px",s.style.width=(l.width??1)+"px"}for(const l of t)l.remove()}function Fu(n,e){const l=e.querySelectorAll(":scope ."+G.ELEMENT),s=e.getBoundingClientRect(),o=n.getBoundingClientRect(),a=[];for(const i of l){if(n==i)continue;const r=i.getBoundingClientRect();if(Math.abs(o.left-r.left)<=1||Math.abs(o.right-r.left)<=1){const d=r.left-s.left;Cl(a,wl(d,o,r,s))}if(Math.abs(o.left-r.right)<=1||Math.abs(o.right-r.right)<=1){const d=r.right-s.left;Cl(a,wl(d,o,r,s))}if(Math.abs(o.top-r.top)<=1||Math.abs(o.bottom-r.top)<=1){const d=r.top-s.top;Rl(a,kl(d,o,r,s))}if(Math.abs(o.bottom-r.bottom)<=1||Math.abs(o.top-r.bottom)<=1){const d=r.bottom-s.top;Rl(a,kl(d,o,r,s))}}Bu(a,e)}function zu(){const n=document.querySelectorAll("."+G.GUIDE_LINE);for(const e of n)e.remove()}const _n={create:yi(Fu,50),clean:zu};async function Uu(n){await Tn(),n&&Reflect.deleteProperty(n,Sn)}async function Hu(n,e){if(await Promise.resolve(),e.dropTarget==null){e.indicatorElement&&(e.indicatorElement.style.display="none");return}if(e.indicatorElement==null){const o=document.createElement("div");o.className="quickprint-is-indicator",e.indicatorElement=o,document.body.appendChild(o)}const t=Gu(n,e);if(t==null){e.indicatorElement.style.display="none";return}const l=e.indicatorElement,s=e.ghost.getBoundingClientRect();l.style.display="block",l.style.left=s.left+"px",l.style.top=s.top-Kl(e.element)+"px",l.textContent=`x:${t.x},y:${t.y},w:${t.w},h:${t.h}`}function Gu(n,e){const t=e.dropTarget;if(t==null)return null;const l=n.doc.useGrid;if(e.mode===Ie.INSERT){const s=t.closest("."+G.PAGE);if(s==null)return null;const o=s.getBoundingClientRect();return{x:l?It(e.left-o.left):Math.round(e.left-o.left),y:l?It(e.top-o.top):Math.round(e.top-o.top),w:e.element.width,h:e.element.height}}return{x:l?It(e.left):Math.round(e.left),y:l?It(e.top):Math.round(e.top),w:e.element.width,h:e.element.height}}function Wu(n,e){const t=n.getSelectedElements();if(t.length<2)return;const l=e.diffX??0,s=e.diffY??0;for(const o of t){if(o.id===e.element.id)continue;const a=document.getElementById(o.id);a!=null&&(a.style.left=o.left+l+"px",a.style.top=o.top+s+"px")}}function Yu(n,e){const t=n.getSelectedElements();if(t.length<2)return;const l=e.diffX??0,s=e.diffY??0;for(const o of t){if(o.id===e.element.id)continue;o.setLeft(o.left+l),o.setTop(o.top+s);const a=document.getElementById(o.id);a==null||a.style.removeProperty("top"),a==null||a.style.removeProperty("left")}}function Xu(n){return!(n.style.rotate&&!n.isSelected)}function ju(n){const e=new Un({selector:{container:G.DROPPABLE},scale(t){return t.mode===Ie.INSERT?100:n.state.scale}});return e.on("before-dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const s=Reflect.get(l.target,Hl),o=Reflect.get(l.target,ll);s===Ie.INSERT&&(l.container=n.component.queryElement("root"),l.ghost=n.component.queryElement("ghost")),l.mode=s===Ie.INSERT?s:Ie.MOVE,l.elementType=o,l.initDragElement=!1}),e.on("dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();if(l.mode===Ie.INSERT){const o=Au(l.elementType);l.element=o,l.ghost.style.width=o.width+"px",l.ghost.style.height=o.height+"px";return}const s=Reflect.get(l.target,je);if(s==null||!Xu(s))return t.preventDefault();l.element=s}),e.on("dragging",t=>{const l=t.detail;l!=null&&(l.initDragElement!==!0&&(l.mode===Ie.INSERT&&(l.ghost.style.display="block"),l.mode===Ie.MOVE&&Reflect.set(l.target,Sn,ol.DRAG_ELEMENT),l.ghost.classList.add(G.DRAGGING),l.initDragElement=!0),l.diffX=l.left-l.element.left,l.diffY=l.top-l.element.top,Hu(n,l),Wu(n,l),l.dropTarget&&_n.create(l.ghost,l.dropTarget))}),e.on("dragend",t=>{const l=t.detail;if(l==null||l.initDragElement!==!0)return;_n.clean(),l.ghost.classList.remove(G.DRAGGING),l.indicatorElement&&document.body.removeChild(l.indicatorElement),l.mode===Ie.INSERT&&(l.ghost.style.display="none"),l.mode==Ie.MOVE&&Uu(l.target);const s=l.element;if(l.mode==Ie.MOVE){const d=s.left,u=s.top;s.setTop(l.top),s.setLeft(l.left),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),l.diffX=s.left-d,l.diffY=s.top-u,Yu(n,l),n.selectElement(s),n.createSnapshot();return}if(l.dropTarget==null)return;const o=Reflect.get(l.dropTarget,Gl);if(o==null)return;const a=o instanceof St||o instanceof me?o:null;if(a==null)return;const i=l.dropTarget.getBoundingClientRect(),r=n.state.scale/100;s.setTop((l.top-i.top)/r),s.setLeft((l.left-i.left)/r),s.setWidth(s.width/r),s.setHeight(s.height/r),a.append(l.element),n.selectElement(s),n.createSnapshot()}),n.onDragStart=e.onDragStart,e}const Nl="quickprint-history-0000",Zu=1,Qe="snapshot",mn="health",Ll="owner",Ue="INDEX_OWNER",Ku=15*60*1e3,Ju=10*60*1e3;function Qu(){const n={db:null,timer:null,promise:null};async function e(){const u=await r(mn,"readwrite");if(u==null)return n.timer=o(),!1;const m=[],g=u.openCursor();g.onsuccess=async function(E){const v=E.target.result;if(v==null){t(m),n.timer=o(),xe.debug("History","已检查无效快照");return}const c=v.value;c!=null&&Date.now()-c.timestamp>Ku&&m.push(c),v.continue()},g.onerror=function(E){console.error(E),n.timer=o()}}async function t(u){const m=await Promise.allSettled(u.map(g=>l(g.owner)));for(let g=0;g<m.length;g++){const E=m[g];E.status==="rejected"||E.value!==!0||s(u[g].id)}}async function l(u){const m=await r(Qe,"readwrite");return m==null?!1:new Promise(g=>{const E=m.index(Ue).openCursor(IDBKeyRange.only(u));E.onsuccess=function(v){const c=v.target.result;if(c==null)return g(!0);c.delete(),c.continue()},E.onerror=function(v){console.error(v),g(!1)}})}async function s(u){const m=await r(mn,"readwrite");return m==null?!1:jt(m.delete(u)).then(()=>!0).catch(g=>(console.log(g),!1))}function o(){return n.timer&&clearTimeout(n.timer),setTimeout(()=>e(),Ju)}function a(){return new Promise(u=>{const m=indexedDB.open(Nl,Zu);m.onupgradeneeded=g=>{const v=g.target.result,c=v.createObjectStore(mn,{keyPath:"id",autoIncrement:!0}),b=v.createObjectStore(Qe,{keyPath:"id",autoIncrement:!0});c.createIndex(Ue,Ll),b.createIndex(Ue,Ll)},m.onsuccess=g=>{const E=g.target;n.db=E.result,xe.debug("History",`已连接数据库【${Nl}】`),u(n.db)},m.onerror=function(g){console.error(g),n.db=null,u(null)}})}function i(){return n.promise==null?Promise.resolve(n.db):n.promise}async function r(u,m="readonly"){const g=await i();if(g==null)return null;try{return g.transaction(u,m).objectStore(u)}catch(E){return console.error(E),null}}function d(){n.promise=null,n.db&&(n.db.close(),n.db=null),n.timer&&(clearTimeout(n.timer),n.timer=null)}return n.promise=a(),n.timer=o(),e(),{ready:i,findStore:r,cleanup:d}}function jt(n){return new Promise((e,t)=>{n.onsuccess=function(l){const s=l.target;e(s.result)},n.onerror=function(l){console.error(l),t()}})}const ed=5*60*1e3,ft=Qu();var He,Oe,gn,Yn,Eo;class td{constructor(e,t={}){ze(this,Oe);F(this,"state");F(this,"owner");ze(this,He);this.state=e,this.owner=t.owner??Yo(Xo.HISTORY_OWNER),Ce(this,Oe,Yn).call(this)}get index(){return this.state.index}get count(){return this.state.count}async createSnapshot(e,t){const l=await ft.findStore(Qe,"readwrite");if(l==null)return!1;await Ce(this,Oe,Eo).call(this,l);const s=this.state.index+1,o={index:s,data:JSON.stringify(e),timestamp:Date.now(),owner:this.owner,action:t==null?void 0:t.action};return await jt(l.put(o)).catch(nt)==null?!1:(this.state.index=s,this.state.count=s+1,!0)}async replaceSnapshot(e,t){const l=await this.getCurrentSnapshot();if(l==null||l.action!==t.action)return this.createSnapshot(e,t);const s=await ft.findStore(Qe,"readwrite");return!(s==null||(l.data=JSON.stringify(e),await jt(s.put(l)).catch(nt)==null))}async getCurrentSnapshot(){const e=await ft.findStore(Qe);if(e==null)return null;const t=this.index;if(t<0)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ue).openCursor(IDBKeyRange.only(l),"prev");o.onsuccess=a=>{const i=a.target.result;if(i==null)return s(null);const r=i.value;if(r.owner!=l)return i.continue();if(r.index==t)return s(r);i.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getPrevSnapshot(){const e=await ft.findStore(Qe);if(e==null)return null;const t=this.state.index-1;if(t<0)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ue).openCursor(IDBKeyRange.only(l),"prev");o.onsuccess=a=>{const i=a.target.result;if(i==null)return s(null);const r=i.value;if(r.owner!=l)return i.continue();if(r.index==t)return this.state.index=t,s(i.value);i.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getNextSnapshot(){const e=await ft.findStore(Qe);if(e==null)return null;const t=this.state.index+1;if(t>this.state.count-1)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ue).openCursor(IDBKeyRange.only(l),"next");o.onsuccess=a=>{const i=a.target.result;if(i==null)return s(null);const r=i.value;if(r.owner!=l)return i.continue();if(r.index==t)return this.state.index=t,s(i.value);i.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getUsageSpace(){const e=await navigator.storage.estimate(),t=e.usage;return t==null?null:{usage:t/1024/1024,percent:e.quota?t/e.quota*100:-1}}async list(){const e=await ft.findStore(Qe);if(e==null)return[];const t=this.owner;return new Promise(l=>{const s=e.index(Ue).openCursor(IDBKeyRange.only(t),"prev"),o=[];s.onsuccess=a=>{const i=a.target.result;if(i==null)return l(o);const r=i.value;if(r.owner!=t)return i.continue();o.push(r),i.continue()},s.onerror=function(a){console.error(a),l([])}})}cleanup(){ke(this,He)&&(clearTimeout(ke(this,He)),ut(this,He,null))}}He=new WeakMap,Oe=new WeakSet,gn=function(){ut(this,He,setTimeout(()=>Ce(this,Oe,Yn).call(this),ed))},Yn=async function(){ke(this,He)&&clearTimeout(ke(this,He));const e=await ft.findStore(mn,"readwrite");if(e==null)return Ce(this,Oe,gn).call(this);const t=await jt(e.index(Ue).get(this.owner)).catch(nt);if(t==null){const l={owner:this.owner,timestamp:Date.now()};return e.add(l),Ce(this,Oe,gn).call(this)}t.timestamp=Date.now(),await jt(e.put(t)).catch(nt),Ce(this,Oe,gn).call(this)},Eo=function(e){const t=this.state.index,l=this.state.count;if(t<0||t==l-1)return Promise.resolve(!0);const s=this.owner;return new Promise(o=>{const a=e.index(Ue).openCursor(IDBKeyRange.only(s),"prev");a.onsuccess=function(i){const r=i.target.result;if(r==null)return o(!0);const d=r.value;if(d.owner!=s)return r.continue();if(d.index>t){r.delete(),r.continue();return}o(!0)},a.onerror=function(i){console.error(i),o(!1)}})};function nd(n){const e=new td(Me({index:-1,count:0}));function t(){return e.index>0}function l(){return e.index>=0&&e.index<e.count-1}function s(u){return e.createSnapshot(n.value,u)}function o(u){return e.replaceSnapshot(n.value,u)}async function a(){const u=await e.getPrevSnapshot();if(u==null)return!1;const m=En(u.data);return m==null?!1:(n.value=he.create(m),!0)}async function i(){const u=await e.getNextSnapshot();if(u==null)return!1;const m=En(u.data);return m==null?!1:(n.value=he.create(m),!0)}function r(){return e.list()}function d(){e.cleanup()}return s(),{allowRedo:l,allowUndo:t,createSnapshot:s,undo:a,redo:i,list:r,cleanup:d,replaceSnapshot:o}}class ld{constructor(e){F(this,"moved",!1);F(this,"position");F(this,"top",0);F(this,"left",0);F(this,"width",0);F(this,"height",0);F(this,"initX",0);F(this,"initY",0);F(this,"indicator");F(this,"container");F(this,"originalEvent");F(this,"target");this.indicator=e.indicator,this.container=e.container,this.target=e.target,this.originalEvent=e.event,this.position=e.position,this.initX=e.event.clientX,this.initY=e.event.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.width=t.width/e,this.height=t.height/e,this.indicator.setPointerCapture(this.originalEvent.pointerId)}}var Mt,$t,at,_o,To,So;const Se=class Se extends bn{constructor(t={}){var l,s,o;super();ze(this,at);F(this,"context",null);F(this,"selector");F(this,"scale");F(this,"onResizeStart");ze(this,Mt);ze(this,$t);this.scale=t.scale,this.selector={container:((l=t.selector)==null?void 0:l.container)??G.PAGE,element:((s=t.selector)==null?void 0:s.element)??G.RESIZEABLE,indicator:((o=t.selector)==null?void 0:o.indicator)??G.RESIZEABLE_INDICATOR},this.onResizeStart=Ce(this,at,_o).bind(this),ut(this,Mt,Ce(this,at,To).bind(this)),ut(this,$t,Ce(this,at,So).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){if(this.context==null)return;const t=this.context.indicator;t&&t.releasePointerCapture(this.context.originalEvent.pointerId),window.removeEventListener("pointermove",ke(this,Mt)),window.removeEventListener("pointerup",ke(this,$t)),this.context=null}};Mt=new WeakMap,$t=new WeakMap,at=new WeakSet,_o=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.indicator);if(l==null)return xe.warn(Se.TAG_NAME,"未找到的可调整元素");const s=Reflect.get(l,Wl);if(s==null)return xe.warn(Se.TAG_NAME,"未找到的可调整元素");const o=l.closest("."+this.selector.element);if(o==null)return xe.warn(Se.TAG_NAME,"未找到的可调整元素");const a=Zl(o,this.selector.container);this.context=new ld({event:t,indicator:l,target:o,container:a,position:s});const i=this.createEvent("before-resizestart",this.context);if(this.dispatch(i).defaultPrevented)return xe.warn(Se.TAG_NAME,"已取消调整");if(this.context.container==null)return xe.warn(Se.TAG_NAME,"未找到的调整元素的容器");this.context.init(this.normalizeScale()),t.stopPropagation(),t.preventDefault();const r=this.createEvent("resizestart",this.context);if(this.dispatch(r).defaultPrevented)return xe.warn(Se.TAG_NAME,"已取消调整");window.addEventListener("pointermove",ke(this,Mt)),window.addEventListener("pointerup",ke(this,$t))},To=function(t){const l=this.context;if(l==null)return;const s=l.position,o=this.normalizeScale(),a=l.container.getBoundingClientRect(),i=l.target.getBoundingClientRect();if(s&Xt.TOP){const d=Math.max((i.bottom-t.clientY)/o,Se.MIN_LENGTH);l.top=(i.bottom-a.top)/o-d,l.height=d}if(s&Xt.BOTTOM&&(l.height=Math.max((t.clientY-i.top)/o,Se.MIN_LENGTH)),s&Xt.LEFT){const d=Math.max((i.right-t.clientX)/o,Se.MIN_LENGTH);l.left=(i.right-a.left)/o-d,l.width=d}s&Xt.RIGHT&&(l.width=Math.max((t.clientX-i.left)/o,Se.MIN_LENGTH));const r=this.createEvent("resizing",l);this.dispatch(r).defaultPrevented||(l.target.style.top=l.top+"px",l.target.style.left=l.left+"px",l.target.style.width=l.width+"px",l.target.style.height=l.height+"px")},So=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const s=this.createEvent("resizeend",l);this.dispatch(s).defaultPrevented||this.reset()},F(Se,"TAG_NAME","quickprint-resizeable"),F(Se,"MIN_LENGTH",12);let Xn=Se;async function od(n,e){if(await Promise.resolve(),e.indicatorElement==null){const i=document.createElement("div");i.className="quickprint-is-indicator",e.indicatorElement=i,document.body.appendChild(i)}const t=n.doc.useGrid,l=t?It(e.width):Math.round(e.width),s=t?It(e.height):Math.round(e.height),o=e.indicatorElement,a=e.target.getBoundingClientRect();o.style.display="block",o.style.left=a.left+"px",o.style.top=a.top-Kl(e.element)+"px",o.textContent=`x:${e.top},y:${e.left},w:${l},h:${s}`}function sd(n){const e=new Xn({scale:()=>n.state.scale});return e.on("resizestart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const s=Reflect.get(l.target,je);if(s==null)return t.preventDefault();l.element=s}),e.on("resizing",t=>{const l=t.detail;l!=null&&(od(n,l),_n.create(l.target,l.container))}),e.on("resizeend",t=>{const l=t.detail;if(l==null)return;l.indicatorElement&&document.body.removeChild(l.indicatorElement);const s=l.element;s.setTop(l.top),s.setLeft(l.left),s.setWidth(l.width),s.setHeight(l.height),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),l.target.style.removeProperty("width"),l.target.style.removeProperty("height"),n.createSnapshot(),_n.clean()}),n.onResizeStart=e.onResizeStart,e}function id(n){function e(a){const i=document.activeElement,r=a.target;return i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i.isContentEditable===!0||r.closest(".quickprint-text-editor")!=null}function t(){const a=n.doc.firstPage;if(n.state.selectMode===pe.PAGE){const i=n.state.selectedPage;return i==null?a:n.doc.findPage(i)??a}if(n.state.selectMode===pe.ELEMENT){const i=n.getSelectedElements()[0];return i==null?a:i.page??a}return a}function l(a){if(!(e(a)||jo()))switch(a.key){case"Delete":case"Backspace":return a.preventDefault(),n.deleteSelectedElement();case"Y":case"y":if(a.ctrlKey)return a.preventDefault(),n.history.redo();case"Z":case"z":if(a.ctrlKey)return a.preventDefault(),n.history.undo();case"ArrowUp":case"ArrowDown":{const i=n.getSelectedElements();if(i.length==0)return;a.preventDefault(),a.stopPropagation();const r=a.key==="ArrowUp"?-1:1,d=i.map(u=>u.setTop(u.top+r,!0)?u:null).filter(u=>u!=null);d.length>0&&n.replaceSnapshot("top",d);return}case"ArrowLeft":case"ArrowRight":{const i=n.getSelectedElements();if(i.length==0)return;a.preventDefault(),a.stopPropagation();const r=a.key==="ArrowLeft"?-1:1,d=i.map(u=>u.setLeft(u.left+r,!0)?u:null).filter(u=>u!=null);d.length>0&&n.replaceSnapshot("left",d);return}case"P":case"p":if(a.ctrlKey)return a.preventDefault(),n.component.dispatchEvent("preview");case"S":case"s":if(a.ctrlKey)return a.preventDefault(),n.component.dispatchEvent("save");case"A":case"a":if(a.ctrlKey){a.preventDefault();const r=n.doc.pages.reduce((d,u)=>d.concat(u.children),[]);return n.multiSelectElements(r)}case"C":case"c":{const i=n.getSelectedElements();if(a.ctrlKey&&i.length>0)return a.preventDefault(),n.clipboard.writeElement(i)}case"V":case"v":if(a.ctrlKey)return n.clipboard.readElement().then(i=>{if(i.length==0)return;const r=t();for(const d of i)d.setLeft(d.left+8),d.setTop(d.top+8),r.append(d);n.createSnapshot()})}}function s(){window.addEventListener("keydown",l)}function o(){window.removeEventListener("keydown",l)}return{enable:s,disable:o}}const an="openprint:element,";function rd(n){function e(){return navigator.clipboard.readText().catch(r=>(console.log(r),null))}function t(r){return navigator.clipboard.writeText(r).catch(d=>{console.log(d)})}async function l(){const r=await e();if(r==null||!r.startsWith(an))return[];t("");const d=En(Ko(r.slice(an.length)),[]);return d.length===0?[]:d.map(u=>(delete u.id,me.create(u))).sort(me.sort)}function s(r){const d=`${an}${Zo(JSON.stringify(r))}`;return t(d)}async function o(){const r=await e();return typeof r=="string"&&r.startsWith(an)}function a(){}function i(r){}return{readElement:l,writeElement:s,hasElement:o,readStyle:a,writeStyle:i}}const wo=Symbol();function ad(){return{panel:{left:!0,right:!0},scale:100,selectedType:pe.NONE,selectedPage:void 0,selectMode:it.SINGLE,selected:[]}}function cd(n,e){const t=Me(ad()),l=nd(n),o={get doc(){return n.value},history:l,document:n,state:t,component:e,setDocument:r,selectPage:m,selectElement:g,resetSelectedElement:E,deleteSelectedElement:v,multiSelectElements:c,zoomIn:T,zoomOut:b,toggleBackground:A,toggleElementPanel:C,toggleConfigPanel:L,getSelectedElements:d,getSelectedPage:u,cleanup:w,replaceSnapshot:k},a=ju(o),i=sd(o);o.shortcut=id(o),o.createSnapshot=l.createSnapshot,o.clipboard=rd();function r(_){o.document.value=_,o.history.createSnapshot()}function d(){const _=t.selected;return _.length==0?[]:_.map(R=>o.doc.findElement(R)).filter(R=>R!=null)}function u(){var R;const _=t.selectedPage;if(_!=null)return(R=n.value)==null?void 0:R.findPage(_)}function m(_){return E(),t.selectedPage=_.id,t.selectedType=pe.PAGE,!0}function g(_){t.selectMode=it.SINGLE,t.selectedType=pe.ELEMENT,t.selectedPage=void 0;const R=d();for(const x of R)x.id!==_.id&&x.blur();return _.focus(),t.selected=[_.id],!0}function E(){const _=d();for(const R of _)R.blur();return t.selected=[],t.selectedType=pe.NONE,!0}function v(){if(t.selectedType!=pe.ELEMENT||t.selected.length==0)return!1;let _=!1;const R=d();for(const x of R)x.remove()&&(_=!0);return _&&o.history.createSnapshot(),!0}function c(_){t.selectMode=it.MULTIPLE,t.selectedType=pe.ELEMENT,t.selectedPage=void 0;const R=d();for(const x of R)x.blur();for(const x of _)x.focus();return t.selected=_.map(x=>x.id),!0}function b(){const _=t.scale??100,R=Ht.indexOf(_);return R<0?(t.scale=100,!1):R>=Ht.length-1?!1:(t.scale=Ht[R+1],!0)}function T(){const _=t.scale??100,R=Ht.indexOf(_);return R<0?(t.scale=100,!1):R==0?!1:(t.scale=Ht[R-1],!0)}function A(){const R=o.doc.attributes.grid==null?!0:void 0;o.doc.attributes.grid=R}function C(){o.state.panel.left=!o.state.panel.left}function L(){o.state.panel.right=!o.state.panel.right}function k(_,R){const x=R??o.doc,q=Array.isArray(x)?"element":x instanceof he?"document":x instanceof St?"page":"element",V=Array.isArray(x)?x.map(j=>j.id).join(","):x.id,O=`${q}:${V}:${_}`;return l.replaceSnapshot({action:O})}function w(){a.cleanup(),i.cleanup(),l.cleanup(),o.shortcut.disable(),o.doc.cleanup()}return o.shortcut.enable(),o.selectPage(n.value.firstPage),zl(wo,o),tl(w),o}function Te(){return Fl(wo)}const ud=P({__name:"Ruler",props:{direction:{type:String,default:"horizontal"},canvas:{type:Object,required:!0},page:{type:Object,required:!0},scale:{type:Number,default:100}},setup(n){const e=n,t=Le("classes"),l=Te(),s=N(()=>({[t.horizontalRuler]:e.direction==="horizontal",[t.verticalRuler]:e.direction==="vertical"})),o=N(()=>{const c=e.page.id,b=l.doc.pages.find(T=>T.id===c);return b==null?0:e.direction=="horizontal"?b.width:b.height}),a=N(()=>{const c=o.value,b=[];for(let T=0;T<=c;T+=10)b.push(T/10);return b}),i=N(()=>{const c=o.value,b=[];for(let T=0;T<=c;T+=2.5)b.push(T);return b}),r=N(()=>{const c=l.getSelectedElements();return c.length==1?c[0]:null}),d=N(()=>e.direction==="horizontal"?{height:"100%",width:o.value*e.scale/100+"mm",left:e.page.left+"px",transform:`translateX(${-e.canvas.scrollLeft}px)`}:{width:"100%",height:o.value*e.scale/100+"mm",top:e.page.top+"px",transform:`translateY(${-e.canvas.scrollTop}px)`}),u=N(()=>{const c=r.value;if(c==null)return 0;if(c.type==="TableCell"){const b=c.parent;if(b==null)return 0;const T=b.parent;return b==null?0:T.top+b.offsetTop}if(c.type==="TableRow"){const b=c.parent;return b==null?0:b.top+c.offsetTop}return c.top}),m=N(()=>{const c=r.value;if(c==null)return 0;if(c.type==="TableCell"){const b=c.parent;if(b==null)return 0;const T=b.parent;return b==null?0:T.left+c.offsetLeft}if(c.type==="TableRow"){const b=c.parent;return b==null?0:b.left}return c.left});function g(c,b){return e.direction==="horizontal"?{left:c*(e.scale/100)+"mm",height:(b-2)%4==0?"8px":"4px"}:{top:c*(e.scale/100)+"mm",width:(b-2)%4==0?"8px":"4px"}}function E(c){return e.direction==="horizontal"?{left:c*(e.scale/100)+"cm"}:{top:c*(e.scale/100)+"cm"}}function v(c){return e.direction==="horizontal"?{left:m.value*(e.scale/100)+"px",width:c.width*(e.scale/100)+"px",height:"100%"}:{top:u.value*(e.scale/100)+"px",height:c.height*(e.scale/100)+"px",width:"100%"}}return(c,b)=>(S(),I("div",{class:h(s.value)},[f("div",{class:h(y(t).ruler),style:J(d.value)},[r.value?(S(),I("div",{key:0,class:h(y(t).selected),style:J(v(r.value))},null,6)):H("",!0),(S(!0),I(Z,null,re(i.value,(T,A)=>(S(),I("div",{key:T,class:h(y(t).scale),style:J(g(T,A))},null,6))),128)),(S(!0),I(Z,null,re(a.value,T=>(S(),I("div",{class:h(y(t).number),style:J(E(T))},Y(T),7))),256))],6)],2))}}),dd="_horizontalRuler_170u5_2",fd="_verticalRuler_170u5_15",pd="_ruler_170u5_27",md="_scale_170u5_32",gd="_number_170u5_46",hd="_selected_170u5_71",vd={horizontalRuler:dd,verticalRuler:fd,ruler:pd,scale:md,number:gd,selected:hd},bd={classes:vd},Il=z(ud,[["__cssModules",bd]]),yd=["title"],cn=8,Ed=P({__name:"DragLine",props:{top:{type:Number,default:0},zoom:{type:Number,default:1},title:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:null},max:{type:Number,default:null}},emits:["move"],setup(n,{emit:e}){const t=n,l=e,s=Le("classes"),o={},a=Te(),i=N(()=>({top:Math.round(t.top*t.zoom)+"px"}));function r(g){if(g.button!=0||t.disabled===!0)return;const E=g.target.closest("."+s.dragLine);E!=null&&(g.stopPropagation(),o.init=!1,o.target=E,o.parent=E.offsetParent,o.target.setPointerCapture(g.pointerId),window.addEventListener("pointermove",d),window.addEventListener("pointerup",u))}function d(g){g.preventDefault();const E=m(o.parent);let v=g.clientY-E.top;v<0&&(v=0),v>E.height&&(v=E.height),t.min>0&&v<t.min+cn&&(v=t.min+cn),t.max>0&&v>t.max-cn&&(v=t.max-cn),o.target.style.top=v/(a.state.scale/100)+"px",o.top=v,o.init=!0}function u(g){o.init===!0&&l("move",{top:o.top/(a.state.scale/100)}),o.target.releasePointerCapture(g.pointerId),window.removeEventListener("pointermove",d),window.removeEventListener("pointerup",u)}function m(g){return g instanceof HTMLElement?g.getBoundingClientRect():new DOMRect(0,0,window.innerWidth,window.innerHeight)}return(g,E)=>(S(),I("div",{class:h({[y(s).dragLine]:!0,[y(s).disabled]:n.disabled}),style:J(i.value),onPointerdown:oe(r,["stop"]),title:n.title},null,46,yd))}}),_d="_dragLine_1m7rt_2",Td="_disabled_1m7rt_26",Sd={dragLine:_d,disabled:Td},wd={classes:Sd},xl=z(Ed,[["__cssModules",wd]]),kd=P({__name:"Selection",setup(n,{expose:e}){const t=ue(),l=ue(),s=Bt("selectionRef"),o=ue(),a=Te();let i=[];function r(){return{init:!1,initialX:0,initialY:0,top:0,left:0}}function d(){const v=[],c=l.value;if(c==null)return v;const b=u(c);if(b.length==0)return v;const T=s.value;return b.forEach(A=>{if(!ks(A,T)){A.classList.remove(G.SELECTED);return}const C=Reflect.get(A,je);C instanceof me&&(A.classList.add(G.SELECTED),v.push(C))}),v}function u(v){if(v.matches("."+G.ELEMENT)){const c=Reflect.get(v,je);if(c&&c.type===X.TABLE)return v.querySelectorAll(":scope td")}return v.querySelectorAll(`:scope .${G.PAGE} > .${G.SELECTABLE}`)}function m(v,c){const b=c.closest("."+G.PAPER);if(b==null)return;v.stopPropagation(),v.preventDefault();const T=r(),A=b.getBoundingClientRect();T.initialX=v.clientX,T.initialY=v.clientY,T.top=v.clientY-A.top,T.left=v.clientX-A.left,l.value=c,o.value=T,t.value=b,i=[],window.addEventListener("pointermove",g),window.addEventListener("pointerup",E)}function g(v){const c=o.value;if(c==null)return;v.stopPropagation(),v.preventDefault();const b=s.value;if(c.init!==!0){if(Math.abs(v.clientX-c.initialX)<4&&Math.abs(v.clientY-c.initialY)<4)return;b.setPointerCapture(v.pointerId),b.style.display="block",c.init=!0}const T=Math.abs(v.clientX-c.initialX),A=Math.abs(v.clientY-c.initialY),C=v.clientX<c.initialX?-T:0,L=v.clientY<c.initialY?-A:0;b.style.top=c.top+L+"px",b.style.left=c.left+C+"px",b.style.width=T+"px",b.style.height=A+"px",i=d()}function E(v){const c=o.value;if(c==null)return;c.init&&(v.stopPropagation(),v.preventDefault()),i.length>0&&a.multiSelectElements(i);const b=s.value;b.releasePointerCapture(v.pointerId),b.style.display="none",o.value=void 0,window.removeEventListener("pointermove",g),window.removeEventListener("pointerup",E)}return e({onSelectStart:m}),(v,c)=>(S(),I("div",{ref_key:"selectionRef",ref:s,class:h(v.classes.selection),onClick:c[0]||(c[0]=oe(()=>{},["stop"]))},null,2))}}),Cd="_selection_10jfe_2",Rd={selection:Cd},Nd={classes:Rd},Ld=z(kd,[["__cssModules",Nd]]),Id={class:"quickprint-is-row"},xd=["onClick"],Ad=P({__name:"FontSize",props:{modelValue:{type:String,default:null},height:{type:String,default:"100%"}},emits:["update:modelValue","update:unit"],setup(n,{emit:e}){const t=[{value:"px",label:"像素"},{value:"pt",label:"磅"}],l=Le("classes"),s=e,o=n,a=ue(),i=N(()=>({height:o.height})),r=N({get(){return We(o.modelValue).num??void 0},set(v){if(v==""||Jo(v)||v<0){m(void 0);return}const c=We(o.modelValue);m(`${v}${c.unit}`)}}),d=N({get(){return We(o.modelValue).unit??Ne.PX},set(v){const c=We(o.modelValue);m(`${c.num}${v}`)}});function u(v){const c=v===be.DEFAULT?void 0:v;s("update:modelValue",c)}function m(v){s("update:modelValue",v),E()}function g(v){const c=o.modelValue;return c==null&&v.value===be.DEFAULT?!0:c===v.value}async function E(){await Vt();const v=document.querySelector("."+l.fontSelected);v&&v.scrollIntoView({block:"nearest"})}return(v,c)=>(S(),I("div",{class:h(y(l).fontSize),style:J(i.value)},[f("div",Id,[_e(f("input",{type:"number",placeholder:"请输入",class:h(["quickprint-form-control",y(l).input]),min:0,"onUpdate:modelValue":c[0]||(c[0]=b=>r.value=b)},null,2),[[Ae,r.value]]),p(y(K),{width:"54px",options:t,modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=b=>d.value=b)},null,8,["modelValue"])]),f("div",{class:h(["quickprint-is-fill-h quickprint-is-scrollable",y(l).fonts]),ref_key:"scrollRef",ref:a},[(S(!0),I(Z,null,re(y(ul),b=>(S(),I("div",{key:b.value,class:h({[y(l).option]:!0,[y(l).fontSelected]:g(b)}),onClick:T=>u(b.value)},[f("span",null,Y(b.label),1)],10,xd))),128))],2)],6))}}),qd="_input_9oh9n_2",Dd="_fontSize_9oh9n_8",Od="_fonts_9oh9n_13",Md="_option_9oh9n_25",$d="_fontSelected_9oh9n_34",Pd={input:qd,fontSize:Dd,fonts:Od,option:Md,fontSelected:$d},Vd={classes:Pd},ko=z(Ad,[["__cssModules",Vd]]),Bd=["title"],Fd={key:0},zd="中文字体 AbBbCc",Ud=P({__name:"Font",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=N(()=>xn.map(c=>(c.style={fontFamily:c.value==le.DEFAULT?le.SONG:c.value},c))),l=N(()=>vo.map(c=>(c.style={fontFamily:c.value==le.DEFAULT?le.SONG:c.value},c))),s=N({get(){const c=e.options.style.fontFamily;return ie(c)?le.DEFAULT:c},set(c){e.options.style.fontFamily=c==le.DEFAULT?void 0:c}}),o=N({get(){const c=e.options.style.enFontFamily;return ie(c)?le.DEFAULT:c},set(c){e.options.style.enFontFamily=c==le.DEFAULT?void 0:c}}),a=N({get(){const c=e.options.style.color;return ie(c)?Re.DEFAULT:c},set(c){e.options.style.color=c==Re.DEFAULT?void 0:c}}),i=N({get(){const c=e.options.style.highlightColor;return ie(c)?Re.DEFAULT:c},set(c){e.options.style.highlightColor=c==Re.DEFAULT?void 0:c}}),r=N({get(){return e.options.style.fontSize},set(c){const b=ie(c)?void 0:c;e.options.style.fontSize=b}}),d=N({get(){return e.options.style.fontWeight===700},set(c){e.options.style.fontWeight=c?700:void 0}}),u=N({get(){return e.options.style.fontStyle==="italic"},set(c){e.options.style.fontStyle=c?"italic":void 0}}),m=N({get(){return e.options.style.lineThrough===!0},set(c){e.options.style.lineThrough=c?!0:void 0}}),g=N({get(){const c=e.options.style.underline;if(c==null||c===!1)return dn.NONE;const b=e.options.style.underlineStyle;return ie(b)?Nt.SOLID:b},set(c){if(c===dn.NONE){e.options.style.underline=void 0,e.options.style.underlineStyle=void 0;return}e.options.style.underline=!0,e.options.style.underlineStyle=c}}),E=N({get(){const c=e.options.style.underlineColor;return ie(c)?Re.DEFAULT:c},set(c){e.options.style.underlineColor=c==Re.DEFAULT?void 0:c}}),v=N(()=>{const c=e.options.style,b={},T=sl(c.fontFamily,c.enFontFamily);T&&(b.fontFamily=T);const A=oo(c);return A&&et(b,A),c.fontSize&&(b.fontSize=c.fontSize),c.fontWeight&&(b.fontWeight=c.fontWeight),c.color&&(b.color=c.color),c.fontStyle&&(b.fontStyle=c.fontStyle),c.highlightColor&&(b["--quickprint-variable-highlight-color"]=c.highlightColor),b});return(c,b)=>(S(),I("div",{class:h(["quickprint-is-scrollable quickprint-is-fill-h",c.classes.font])},[f("div",{class:h(c.classes.fontFamily)},[f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"中文字体",2),f("div",{class:h(c.classes.content)},[p(y(K),{options:t.value,modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=T=>s.value=T)},null,8,["options","modelValue"])],2)],2),f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"颜色",2),p(st,{modelValue:a.value,"onUpdate:modelValue":b[1]||(b[1]=T=>a.value=T)},{default:ye(()=>[f("div",{class:h(c.classes.indicator)},[f("div",{class:h({[c.classes.colorBlock]:!0,[c.classes.colorNone]:a.value===y(Re).DEFAULT}),style:J({backgroundColor:a.value})},null,6),f("div",{class:h(c.classes.colorValue)},Y(a.value==y(Re).DEFAULT?"默认":a.value),3)],2)]),_:1},8,["modelValue"])],2),f("div",{class:h([c.classes.config,c.classes.fontSize])},[f("div",{class:h(c.classes.title)},"字号",2),p(ko,{modelValue:r.value,"onUpdate:modelValue":b[2]||(b[2]=T=>r.value=T),height:"144px"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"西文字体",2),f("div",{class:h(c.classes.content)},[p(y(K),{options:l.value,modelValue:o.value,"onUpdate:modelValue":b[3]||(b[3]=T=>o.value=T)},null,8,["options","modelValue"])],2)],2),f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"前景色",2),p(st,{modelValue:i.value,"onUpdate:modelValue":b[4]||(b[4]=T=>i.value=T)},{default:ye(()=>[f("div",{class:h(c.classes.indicator)},[f("div",{class:h({[c.classes.colorBlock]:!0,[c.classes.colorNone]:i.value===y(Re).DEFAULT}),style:J({backgroundColor:i.value})},null,6),f("div",{class:h(c.classes.colorValue)},Y(i.value==y(Re).DEFAULT?"默认":i.value),3)],2)]),_:1},8,["modelValue"])],2),f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"下划线",2),f("div",{class:h(c.classes.content)},[p(y(K),{modelValue:g.value,"onUpdate:modelValue":b[5]||(b[5]=T=>g.value=T),options:y(gu),width:"138px"},{option:ye(({option:T})=>[f("div",{title:T.label,class:h(c.classes.option)},[T.value==y(dn).NONE?(S(),I("div",Fd,Y(T.label),1)):(S(),I("div",{key:1,class:h(c.classes.line),style:J({textDecorationStyle:T.value})},"--",6))],10,Bd)]),_:1},8,["modelValue","options"])],2)],2),f("div",{class:h(c.classes.config)},[f("div",{class:h(c.classes.title)},"线条颜色",2),f("div",{class:h(c.classes.content)},[p(st,{modelValue:E.value,"onUpdate:modelValue":b[6]||(b[6]=T=>E.value=T),class:"quickprint-w-full"},{default:ye(()=>[f("div",{class:h(c.classes.indicator)},[f("div",{class:h({[c.classes.colorBlock]:!0,[c.classes.colorNone]:E.value===y(Re).DEFAULT}),style:J({backgroundColor:E.value})},null,6),f("div",{class:h(c.classes.colorValue)},Y(E.value==y(Re).DEFAULT?"默认":E.value),3)],2)]),_:1},8,["modelValue"])],2)],2)],2),f("div",{class:h(c.classes.fieldset)},[b[13]||(b[13]=f("header",null,"效果",-1)),f("div",{class:h(c.classes.configs)},[f("label",{class:h(c.classes.checkbox)},[_e(f("input",{type:"checkbox","onUpdate:modelValue":b[7]||(b[7]=T=>d.value=T)},null,512),[[Pn,d.value]]),b[10]||(b[10]=f("span",null,"粗体",-1))],2),f("label",{class:h(c.classes.checkbox)},[_e(f("input",{type:"checkbox","onUpdate:modelValue":b[8]||(b[8]=T=>u.value=T)},null,512),[[Pn,u.value]]),b[11]||(b[11]=f("span",null,"斜体",-1))],2),f("label",{class:h(c.classes.checkbox)},[_e(f("input",{type:"checkbox","onUpdate:modelValue":b[9]||(b[9]=T=>m.value=T)},null,512),[[Pn,m.value]]),b[12]||(b[12]=f("span",null,"删除线",-1))],2)],2)],2),f("div",{class:h(c.classes.fieldset)},[b[14]||(b[14]=f("header",null,"预览",-1)),f("div",{class:h(c.classes.preview)},[f("span",{style:J(v.value)},[f("span",{class:h({[c.classes.lineThrough]:n.options.style.lineThrough})},Y(zd),2)],4)],2)],2)],2))}}),Hd="_font_16792_2",Gd="_fontFamily_16792_7",Wd="_config_16792_14",Yd="_fontSize_16792_19",Xd="_fieldset_16792_23",jd="_title_16792_39",Zd="_content_16792_44",Kd="_indicator_16792_49",Jd="_colorBlock_16792_69",Qd="_colorValue_16792_80",ef="_colorNone_16792_87",tf="_configs_16792_98",nf="_checkbox_16792_104",lf="_option_16792_119",of="_line_16792_127",sf="_preview_16792_138",rf="_lineThrough_16792_153",af={font:Hd,fontFamily:Gd,config:Wd,fontSize:Yd,fieldset:Xd,title:jd,content:Zd,indicator:Kd,colorBlock:Jd,colorValue:Qd,colorNone:ef,configs:tf,checkbox:nf,option:lf,line:of,preview:sf,lineThrough:rf},cf={classes:af},uf=z(Ud,[["__cssModules",cf]]),df=["placeholder","min"],ff=P({__name:"InputWithUnit",props:{modelValue:{type:String,default:void 0},options:{type:Array,required:!0},placeholder:{type:String,default:"请输入"},defaultUnit:{type:String,default:null},min:{type:Number,default:0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=e,l=n,s=N(()=>{const r=l.defaultUnit;return l.options.some(d=>d.value===r)?r:l.options[0].value}),o=N({get(){return We(l.modelValue).num},set(r){if(Jn(r)){const u=We(l.modelValue).unit??s.value;return i(`${r}${u}`)}i()}}),a=N({get(){return We(l.modelValue).unit??s.value},set(r){const u=We(l.modelValue).num??l.min;i(`${u}${r}`)}});function i(r=void 0){t("update:modelValue",r)}return(r,d)=>(S(),I("div",{class:h(r.classes.input)},[_e(f("input",{type:"number","onUpdate:modelValue":d[0]||(d[0]=u=>o.value=u),class:"quickprint-form-control",placeholder:n.placeholder,min:n.min},null,8,df),[[Ae,o.value]]),p(y(K),{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=u=>a.value=u),class:h(r.classes.unit),options:n.options,width:"auto",border:"none"},null,8,["modelValue","class","options"])],2))}}),pf="_input_gtdaq_2",mf="_unit_gtdaq_14",gf={input:pf,unit:mf},hf={classes:gf},mt=z(ff,[["__cssModules",hf]]),vf="永和九年，岁在癸丑，暮春之初，会于会稽山阴之兰亭，修禊事也。群贤毕至，少长咸集。此地有崇山峻岭，茂林修竹；又有清流激湍，映带左右，引以为流觞曲水，列坐其次。虽无丝竹管弦之盛，一觞一咏，亦足以畅叙幽情。是日也，天朗气清，惠风和畅，仰观宇宙之大，俯察品类之盛，所以游目骋怀，足以极视听之娱，信可乐也。",bf=P({__name:"Paragraph",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:Ne.NONE},{label:"磅",value:Ne.PT},{label:"像素",value:Ne.PX}],l=[{label:"字符",value:Ne.EM},{label:"磅",value:Ne.PT},{label:"像素",value:Ne.PX}],s=[{label:"毫米",value:Ne.MM},{label:"磅",value:Ne.PT},{label:"像素",value:Ne.PX}],o=N({get(){return e.options.style.textAlign??lt.LEFT},set(c){const b=c===lt.LEFT?void 0:c;e.options.style.textAlign=b}}),a=N({get(){return e.options.style.textAlignLast??ht.AUTO},set(c){const b=c===ht.AUTO?void 0:c;e.options.style.textAlignLast=b}}),i=N({get(){return e.options.style.verticalAlign??Ye.MIDDLE},set(c){const b=c===Ye.MIDDLE?void 0:c;e.options.style.verticalAlign=b}}),r=v("top"),d=v("bottom"),u=v("left"),m=v("right"),g=N(()=>{const c=e.options.style,b={};return c.textAlign&&(b.textAlign=c.textAlign),c.textAlignLast&&(b.textAlignLast=c.textAlignLast),c.textIndent&&(b.textIndent=c.textIndent),c.lineHeight&&(b.lineHeight=c.lineHeight),et(b,io(c.verticalAlign)),b}),E=N(()=>{var T,A,C,L;const c=e.options.style,b={};return b["--openprint-paragraph-preview-padding-top"]=((T=c.padding)==null?void 0:T.top)??"2px",b["--openprint-paragraph-preview-padding-right"]=((A=c.padding)==null?void 0:A.right)??"2px",b["--openprint-paragraph-preview-padding-bottom"]=((C=c.padding)==null?void 0:C.bottom)??"2px",b["--openprint-paragraph-preview-padding-left"]=((L=c.padding)==null?void 0:L.left)??"2px",b});function v(c){return N({get(){var b;return(b=e.options.style.padding)==null?void 0:b[c]},set(b){e.options.style.padding==null&&(e.options.style.padding={});const T=ie(b)?void 0:b;e.options.style.padding[c]=T}})}return(c,b)=>(S(),I("div",{class:h(["quickprint-is-scrollable quickprint-is-fill-h",c.classes.paragraph])},[f("div",{class:h(c.classes.textAlign)},[f("div",{class:h(c.classes.configItem)},[f("div",{class:h(c.classes.configItemLabel)},"文本对齐",2),p(y(K),{options:y(Wn),modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=T=>o.value=T)},null,8,["options","modelValue"])],2),f("div",{class:h(c.classes.alignLast)},[f("div",{class:h(c.classes.configItemLabel)},"最后一行",2),p(y(K),{options:y(hu),modelValue:a.value,"onUpdate:modelValue":b[1]||(b[1]=T=>a.value=T)},null,8,["options","modelValue"])],2)],2),f("div",{class:h(c.classes.configItem)},[f("div",{class:h(c.classes.configItemLabel)},"垂直对齐",2),p(y(K),{options:y(Gn),modelValue:i.value,"onUpdate:modelValue":b[2]||(b[2]=T=>i.value=T)},null,8,["options","modelValue"])],2),f("div",{class:h(c.classes.configItem)},[f("div",{class:h(c.classes.configItemLabel)},"首行缩进",2),p(mt,{modelValue:n.options.style.textIndent,"onUpdate:modelValue":b[3]||(b[3]=T=>n.options.style.textIndent=T),options:l,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.configItem)},[f("div",{class:h(c.classes.configItemLabel)},"行高",2),p(mt,{modelValue:n.options.style.lineHeight,"onUpdate:modelValue":b[4]||(b[4]=T=>n.options.style.lineHeight=T),options:t,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.fieldset)},[b[9]||(b[9]=f("header",null,"内边距",-1)),f("div",{class:h(c.classes.padding)},[f("div",{class:h(c.classes.paddingItem)},[f("label",{class:h(c.classes.paddingItemLabel)},"上边距",2),p(mt,{modelValue:y(r),"onUpdate:modelValue":b[5]||(b[5]=T=>Ge(r)?r.value=T:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.paddingItem)},[f("label",{class:h(c.classes.paddingItemLabel)},"下边距",2),p(mt,{modelValue:y(d),"onUpdate:modelValue":b[6]||(b[6]=T=>Ge(d)?d.value=T:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.paddingItem)},[f("label",{class:h(c.classes.paddingItemLabel)},"左边距",2),p(mt,{modelValue:y(u),"onUpdate:modelValue":b[7]||(b[7]=T=>Ge(u)?u.value=T:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),f("div",{class:h(c.classes.paddingItem)},[f("label",{class:h(c.classes.paddingItemLabel)},"右边距",2),p(mt,{modelValue:y(m),"onUpdate:modelValue":b[8]||(b[8]=T=>Ge(m)?m.value=T:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2)],2)],2),f("div",{class:h(c.classes.fieldset)},[b[10]||(b[10]=f("header",null,"预览",-1)),f("div",{class:h(c.classes.preview),style:J(g.value)},[f("div",{style:J(E.value),class:h(c.classes.previewText)},[se(Y(vf)+" "),f("div",{class:h(c.classes.paddingPreview)},null,2)],6)],6)],2)],2))}}),yf="_paragraph_1ex97_2",Ef="_fieldset_1ex97_7",_f="_preview_1ex97_23",Tf="_textAlign_1ex97_34 quickprint-is-row",Sf="_configItem_1ex97_39 quickprint-is-row",wf="_alignLast_1ex97_44 quickprint-is-row",kf="_configItemLabel_1ex97_54",Cf="_padding_1ex97_59",Rf="_paddingItem_1ex97_66",Nf="_paddingItemLabel_1ex97_72",Lf="_previewText_1ex97_77",If="_paddingPreview_1ex97_86",xf={paragraph:yf,fieldset:Ef,preview:_f,textAlign:Tf,configItem:Sf,alignLast:wf,configItemLabel:kf,padding:Cf,paddingItem:Rf,paddingItemLabel:Nf,previewText:Lf,paddingPreview:If},Af={classes:xf},qf=z(bf,[["__cssModules",Af]]),Df=P({__name:"index",props:{options:{type:Object,required:!0},active:{type:String,default:null}},setup(n){const e=n,t=Ke();function l(){t==null||t.confirm(e.options)}function s(){t==null||t.cancel()}return(o,a)=>(S(),I("div",{class:h(o.classes.setting)},[n.active==="font"?(S(),Q(uf,{key:0,options:e.options},null,8,["options"])):H("",!0),n.active==="paragraph"?(S(),Q(qf,{key:1,options:e.options},null,8,["options"])):H("",!0),f("div",{class:h(o.classes.footer)},[f("button",{type:"button",class:"quickprint-text-btn",onClick:s},"取消"),f("button",{type:"button",class:"quickprint-text-btn",onClick:l},"确定")],2)],2))}}),Of="_setting_1v5ya_2",Mf="_footer_1v5ya_9",$f={setting:Of,footer:Mf},Pf={classes:$f},Vf=z(Df,[["__cssModules",Pf]]);function Bf(n){return Me({style:Qo(n.style??{})})}function Ff(n,e){n.style=Object.assign({},n.style,e.style)}const zf=Be(function(n){return Qt("元素",(e,t)=>p(Vf,{options:Bf(n),active:t},null),{preset:"setting",icon:"svg:icon-setting",tabs:[{label:"字体",name:"font",active:!0},{label:"段落",name:"paragraph"}]}).promisify().then(e=>Ff(n,e)).catch($e)});function Uf(n,e,t){const l=[{type:"menu",label:"设置",icon:"icon-setting",handler(){zf(e.element)}},{type:"divider"},{type:"menu",label:"复制",icon:"icon-copy",detail:"Ctrl+C",handler(){t.clipboard.writeElement([e.element])}}];l.push({type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"元素",icon:"icon-pintu",detail:"Delete",handler(){e.element.remove(),t.createSnapshot()}},{type:"menu",label:"数据源",icon:"icon-datasource",handler(){e.element.resetDS(),t.createSnapshot()}}]},{type:"divider"},po(t,e.element)),el.open(n.clientX,n.clientY,{menus:l})}const Hf=P({props:{element:{type:me,required:!0}},setup(n){const e=Le("classes"),t=Te(),l=N(()=>{const m=n.element;m.state.key;const g={"--quickprint-element-top":m.top+"px","--quickprint-element-left":m.left+"px","--quickprint-element-width":m.width+"px","--quickprint-element-height":m.height+"px","z-index":m.zIndex};return a()&&(g.transform=`rotate(${m.style.rotate}deg)`),g}),s={TOP:[e.resizeTop,Lt.TOP],BOTTOM:[e.resizeBottom,Lt.BOTTOM],LEFT:[e.resizeLeft,Lt.LEFT],RIGHT:[e.resizeRight,Lt.RIGHT],BOTTOM_RIGHT:[e.resizeBottomRight,Lt.BOTTOM_RIGHT]},o=[s.TOP,s.BOTTOM,s.LEFT,s.RIGHT,s.BOTTOM_RIGHT];function a(){const m=n.element;return m.style.rotate==0||m.style.rotate==null?!1:t.state.selectMode===it.SINGLE?!m.isSelected:!0}function i(m){const g=qu(m.type);if(g==null)return p("div",{class:e.unknown},[p("span",null,[se("未知的打印元素")])]);const E={element:m,key:m.id+"_"+m.state.key};return Mu(m.type)?(E.onContextmenu=d,kt(g,E)):kt(g,E)}function r(m,g){g.stopPropagation();const E=g.target.closest("."+G.ELEMENT);E&&Reflect.get(E,Sn)===ol.DRAG_ELEMENT||t.selectElement(m)}function d(m){m.stopPropagation(),m.preventDefault(),Uf(m,n,t)}function u(){return!$u(n.element.type)||a()?null:o.map(m=>{const g={class:[G.RESIZEABLE_INDICATOR,m[0]],["."+Wl]:m[1]};return p("div",us(g,{onPointerdown:t.onResizeStart}),null)})}return function(){const m=n.element,g={["."+je]:m,["."+ll]:m.type,id:m.id,key:m.id,class:{[G.ELEMENT]:!0,[G.DRAGGABLE]:!0,[G.RESIZEABLE]:!0,[G.SELECTED]:m.state.selected,[G.SELECTABLE]:Ou(m.type),["quickprint-is-"+m.type.toLowerCase()]:!0},style:l.value,onClick:r.bind(null,m)};return p("div",g,[i(m),u()])}}}),Gf="_unknown_za8zh_2",Wf="_resizeTop_za8zh_12",Yf="_resizeBottom_za8zh_20",Xf="_resizeLeft_za8zh_28",jf="_resizeRight_za8zh_36",Zf="_resizeBottomRight_za8zh_44",Kf={unknown:Gf,resizeTop:Wf,resizeBottom:Yf,resizeLeft:Xf,resizeRight:jf,resizeBottomRight:Zf},Jf={classes:Kf},Qf=z(Hf,[["__cssModules",Jf]]),Co=Ol(()=>Ml(()=>import("./component-ChG9rybb.js"),__vite__mapDeps([3,4,1,5,6]))),ep=P({__name:"DocJson",props:{doc:{type:he,required:!0}},setup(n){const e=n,t=Ke(),l=ce(JSON.stringify(e.doc,null,"  "));return t==null||t.useHandle("confirm",()=>l.value),(s,o)=>(S(),Q(y(Co),{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value=a),language:"json",class:h(s.classes.json)},null,8,["modelValue","class"]))}}),tp="_json_9crpe_2",np={json:tp},lp={classes:np},op=z(ep,[["__cssModules",lp]]),sp=Be(function(n){return Tt("调试",p(op,{doc:n.document.value},null),{preset:"docDebug"}).promisify().catch(nt)});async function ip(n,e,t){const l=[{type:"menu",label:"重新加载",icon:"icon-reload",detail:"Ctrl+R",handler(){window.location.reload()}},{type:"menu",label:"全部选中",icon:"icon-select-all",detail:"Ctrl+A",handler:()=>{const a=e.page.children??[];t.multiSelectElements(a)}},{type:"divider"}],s=[],o=t.getSelectedElements();o.length>0&&s.push({type:"menu",label:"复制",icon:"icon-copy",detail:"Ctrl+C",handler:()=>{t.clipboard.writeElement(o)}}),await t.clipboard.hasElement()&&s.push({type:"menu",label:"粘贴",icon:"icon-paste",detail:"Ctrl+V",async handler(){const a=n.target.closest("."+G.PAGE);if(a==null)return;const i=await t.clipboard.readElement();if(i.length==0)return;const r=a.getBoundingClientRect(),d=n.clientX-r.left-i[0].left,u=n.clientY-r.top-i[0].top;for(const m of i)m.setLeft(m.left+d),m.setTop(m.top+u),e.page.append(m);t.createSnapshot()}}),s.length>0&&l.push(...s,{type:"divider"}),l.push({type:"menu",label:"调试",icon:"icon-bug",handler(){sp(t).then(a=>{if(a==null)return;const i=he.create(a);t.setDocument(i)})}},{type:"menu",label:"预览",icon:"icon-run",detail:"Ctrl+P",handler(){t.component.dispatchEvent("preview")}},{type:"menu",label:"保存",icon:"icon-save",detail:"Ctrl+S",handler(){t.component.dispatchEvent("save")}}),el.open(n.clientX,n.clientY,{menus:l})}const rp=P({props:{doc:{type:he,required:!0},page:{type:St,required:!0}},setup(n){const e=Le("classes"),t=Te(),l=Bt("selectionRef"),s=Bt("paperRef"),o=ce(0),a=N(()=>n.page.width),i=N(()=>n.page.height);function r(A){A.stopPropagation();const C=A.target.closest("."+G.PAPER);C&&Reflect.get(C,Sn)===ol.SELECTION||(t.resetSelectedElement(),t.selectPage(n.page))}function d(){if(n.page.header.display===!1)return null;const A=n.page.header.height,C="page_header_"+o.value;return p(xl,{title:"页眉",top:A,onMove:m,key:C},null)}function u(){if(n.page.footer.display===!1)return null;const A=Pt(i.value)-n.page.footer.height,C="page_footer_"+o.value;return p(xl,{title:"页脚",top:A,onMove:g,key:C},null)}function m(A){n.page.setHeaderHeight(A.top),o.value++}function g(A){n.page.setFooterHeight(Pt(i.value)-A.top),o.value++}function E(A){A.stopPropagation(),A.preventDefault(),ip(A,n,t)}function v(){const A=n.doc.margins;if(A==null)return null;const C=[];return A.top&&C.push(p("div",{title:"上边距参考线",class:e.marginHorizontalGuide,style:{top:A.top+"px"}},null)),A.bottom&&C.push(p("div",{title:"下边距参考线",class:e.marginHorizontalGuide,style:{bottom:A.bottom+"px"}},null)),A.left&&C.push(p("div",{title:"左边距参考线",class:e.marginVerticalGuide,style:{left:A.left+"px"}},null)),A.right&&C.push(p("div",{title:"右边距参考线",class:e.marginVerticalGuide,style:{right:A.right+"px"}},null)),C.length>0?C:null}function c(){const A={["."+Gl]:n.page,key:n.page.id,style:{width:a.value+"mm",height:i.value+"mm"},class:{[G.PAGE]:!0,[G.DROPPABLE]:!0,[e.grid]:n.doc.useGrid},onContextmenu:E},C=n.page.children.map(L=>p(Qf,{element:L},null));return p("div",A,[d(),C,u(),v()])}function b(A){if(A.button!==0)return;A.stopPropagation(),A.preventDefault();const L=A.target.closest("."+G.ELEMENT);if(L==null)return T(A,s.value);const k=Reflect.get(L,je);return k==null?T(A,s.value):k.type===X.TABLE?T(A,L):Pu(k.type)?t.onDragStart(A):T(A,s.value)}function T(A,C){var L;(L=l.value)==null||L.onSelectStart(A,C)}return function(){const A=t.state.scale/100,C={id:"@"+n.page.id,ref:"paperRef",class:{[G.PAPER]:!0,[G.SELECTED]:t.state.selectedPage===n.page.id},style:{width:a.value*A+"mm",height:i.value*A+"mm"},onPointerdown:b,onClick:r};return p("div",C,[c(),p(Ld,{ref:"selectionRef"},null)])}}}),ap="_paper_fdphx_2",cp="_grid_fdphx_12",up="_marginHorizontalGuide_fdphx_21",dp="_marginVerticalGuide_fdphx_29",fp={paper:ap,grid:cp,marginHorizontalGuide:up,marginVerticalGuide:dp},pp={classes:fp},mp=z(rp,[["__cssModules",pp]]),gp={class:"quickprint-is-fill-h quickprint-is-scrollable"},hp="icon-zhanweifu",vp=P({__name:"Element",setup(n){const e=Te();return(t,l)=>(S(),I("div",{class:h(t.classes.panel)},[f("div",{class:h(t.classes.header)},"可打印元素",2),f("div",gp,[f("div",{class:h(t.classes.grid)},[(S(!0),I(Z,null,re(y(Lu),s=>(S(),I("div",Ul({key:s.type,class:[y(G).DRAGGABLE,t.classes.element],[`.${y(Hl)||""}`]:y(Ie).INSERT,[`.${y(ll)||""}`]:s.type,onPointerdown:l[0]||(l[0]=(...o)=>y(e).onDragStart&&y(e).onDragStart(...o))}),[p(y($),{icon:s.icon??hp,size:"16px",class:h(t.classes.icon)},null,8,["icon","class"]),f("span",null,Y(s.title),1)],48))),128))],2)])],2))}}),bp="_panel_1p36j_2",yp="_header_1p36j_8",Ep="_grid_1p36j_18",_p="_element_1p36j_30",Tp="_icon_1p36j_45",Sp={panel:bp,header:yp,grid:Ep,element:_p,icon:Tp},wp={classes:Sp},kp=z(vp,[["__cssModules",wp]]),Cp=["onClick"],Rp=P({__name:"SelectPath",setup(n){const e=Te(),t=N(()=>{const o=e.state,a=[{id:e.doc.id,title:"文档",type:"document"}];if(o.selectedType===pe.PAGE){const i=e.getSelectedPage();if(i!=null){const r="页面"+(i.index+1);a.push({id:i.id,title:r,type:"page",data:i})}return a}if(o.selectedType===pe.ELEMENT){if(o.selectMode===it.MULTIPLE){const d=e.getSelectedElements();if(d.length===0)return a;let u=d[0];for(;u.parent;){const m=u.parent;if(m instanceof St){const g="页面"+(m.index+1);return a.push({id:m.id,title:g,type:"page",data:m}),a}u=m}return a}let i=e.getSelectedElements()[0];if(i==null)return a;const r=[{id:i.id,title:Jt(i.type),type:"element",data:i}];for(;i.parent;){const d=i.parent;if(d instanceof St){const u="页面"+(d.index+1);return r.unshift({id:d.id,title:u,type:"page",data:d}),a.concat(r)}r.unshift({id:d.id,title:Jt(d.type),type:"element",data:d}),i=d}}return a}),l=N(()=>{if(e.state.selectedType!=pe.ELEMENT)return;const a=e.getSelectedElements();if(a.length!=1)return;const i=a[0],r=il(i,e.doc.ds);if(!(r==null||!r.content))return r.type===ve.VARIABLE||r.type===ve.FORMULA?`[${r.content}]`:r.content});function s(o){if(o.type==="element")return e.selectElement(o.data);if(o.type==="page")return e.selectPage(o.data)}return(o,a)=>(S(),I("div",{class:h(o.classes.paths)},[(S(!0),I(Z,null,re(t.value,(i,r)=>(S(),I(Z,{key:i.id},[r>0?(S(),Q(y($),{key:0,class:h(o.classes.icon),icon:"icon-right",size:"12px"},null,8,["class"])):H("",!0),f("div",{class:h(o.classes.path),onClick:d=>s(i)},Y(i.title),11,Cp)],64))),128)),l.value?(S(),I(Z,{key:0},[p(y($),{class:h(o.classes.ion),icon:"icon-right",size:"12px"},null,8,["class"]),f("div",{class:h(o.classes.content)},Y(l.value),3)],64)):H("",!0)],2))}}),Np="_paths_fuk62_2",Lp="_path_fuk62_2",Ip="_icon_fuk62_28",xp="_content_fuk62_33",Ap={paths:Np,path:Lp,icon:Ip,content:xp},qp={classes:Ap},Dp=z(Rp,[["__cssModules",qp]]),Op=["min","readonly","placeholder"],Mp=P({__name:"LabelNumber",props:wt({modelValue:{type:Number,default:null},label:{type:String,default:null},min:{type:Number,default:null},defaultValue:{type:Number,default:0},precision:{type:Number,default:null},readonly:{type:Boolean,default:!1},placeholder:{type:String,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=n,t=en(n,"modelValue");function l(s){const a=s.target.value;if(t==null||a===""){const r=e.min?e.min:e.defaultValue;t.value=r;return}const i=Number(a);if(!Number.isNaN(i)&&(e.min!=null&&i<e.min&&(t.value=e.min),e.precision!=null)){const r=Math.pow(10,e.precision);t.value=Math.round(i*r)/r}}return(s,o)=>(S(),I("label",{class:h({[s.classes.labelNumber]:!0,[s.classes.readonly]:n.readonly})},[_e(f("input",{class:"quickprint-form-control",type:"number","onUpdate:modelValue":o[0]||(o[0]=a=>t.value=a),min:n.min,readonly:n.readonly,placeholder:n.placeholder,onBlur:l},null,40,Op),[[Ae,t.value]]),f("span",{class:h(s.classes.label)},Y(n.label),3)],2))}}),$p="_labelNumber_1aifb_2",Pp="_label_1aifb_2",Vp="_readonly_1aifb_25",Bp={labelNumber:$p,label:Pp,readonly:Vp},Fp={classes:Bp},At=z(Mp,[["__cssModules",Fp]]),zp={class:"quickprint-config"},Up={class:"quickprint-config-body quickprint-is-scrollable quickprint-is-fill-h"},Hp={class:"quickprint-config-group"},Gp={class:"quickprint-config-section quickprint-config-inline"},Wp={class:"quickprint-config-content quickprint-config-inline"},Yp={class:"quickprint-config-group"},Xp={class:"quickprint-config-section quickprint-config-inline"},jp={class:"quickprint-config-content quickprint-config-inline"},Zp={class:"quickprint-config-section quickprint-config-inline"},Kp={class:"quickprint-config-content quickprint-form-inline"},Jp={class:"quickprint-config-group"},Qp={class:"quickprint-config-section quickprint-config-inline"},em={class:"quickprint-config-content quickprint-form-inline"},tm={key:0,class:"quickprint-config-section quickprint-config-inline"},nm={class:"quickprint-config-content quickprint-form-inline"},lm={class:"quickprint-config-section quickprint-config-inline"},om={class:"quickprint-config-content quickprint-form-inline"},sm=P({__name:"PageConfig",props:{page:{type:St,required:!0}},setup(n){const e=n,t=[{label:"显示",value:!0},{label:"隐藏",value:!1}],l=[{label:"禁止",value:sn.NONE},{label:"跟随表格",value:sn.TABLE,detail:"在尾页最后一个元素是表格，则页脚显示在表格下方"}],s=N({get(){return e.page.size.type},set(d){e.page.size.type=d,d===Zt.CONTENT&&(e.page.size.orientation=void 0)}}),o=N({get(){return e.page.orientation},set(d){e.page.size.orientation=d}}),a=N(()=>e.page.width),i=N({get(){return e.page.height},set(d){const u=Number(d);!Jn(u)||u<0||(e.page.size.height=u)}}),r=N({get(){return e.page.footer.flow??sn.NONE},set(d){e.page.footer.flow=d===sn.NONE?void 0:d}});return(d,u)=>(S(),I("div",zp,[u[15]||(u[15]=f("div",{class:"quickprint-config-title"},"页面配置",-1)),f("div",Up,[f("div",Hp,[u[7]||(u[7]=f("div",{class:"quickprint-config-group-title"},"页眉",-1)),f("section",Gp,[u[6]||(u[6]=f("header",{class:"quickprint-config-header"},"位置",-1)),f("div",Wp,[p(At,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.header.height,readonly:""},null,8,["modelValue"]),p(xt,{modelValue:n.page.header.display,"onUpdate:modelValue":u[0]||(u[0]=m=>n.page.header.display=m),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])])]),f("div",Yp,[u[10]||(u[10]=f("div",{class:"quickprint-config-group-title"},"页脚",-1)),f("section",Xp,[u[8]||(u[8]=f("header",{class:"quickprint-config-header"},"位置",-1)),f("div",jp,[p(At,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.footer.height,readonly:""},null,8,["modelValue"]),p(xt,{modelValue:n.page.footer.display,"onUpdate:modelValue":u[1]||(u[1]=m=>n.page.footer.display=m),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])]),f("section",Zp,[u[9]||(u[9]=f("header",{class:"quickprint-config-header"},"跟随",-1)),f("div",Kp,[p(y(K),{modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=m=>r.value=m),options:l},null,8,["modelValue"])])])]),f("div",Jp,[u[14]||(u[14]=f("div",{class:"quickprint-config-group-title"},"画布",-1)),f("section",Qp,[u[11]||(u[11]=f("header",{class:"quickprint-config-header"},"尺寸",-1)),f("div",em,[p(xt,{modelValue:s.value,"onUpdate:modelValue":u[3]||(u[3]=m=>s.value=m),options:y(Es),class:"quickprint-w-full"},null,8,["modelValue","options"])])]),n.page.size.type===y(Zt).CONTENT?(S(),I("section",tm,[u[12]||(u[12]=f("header",{class:"quickprint-config-header"},"内容",-1)),f("div",nm,[p(At,{class:"quickprint-form-inline-item",label:"宽",modelValue:a.value,readonly:""},null,8,["modelValue"]),p(At,{class:"quickprint-form-inline-item",label:"高",modelValue:i.value,"onUpdate:modelValue":u[4]||(u[4]=m=>i.value=m)},null,8,["modelValue"])])])):H("",!0),f("section",lm,[u[13]||(u[13]=f("header",{class:"quickprint-config-header"},"方向",-1)),f("div",om,[p(xt,{modelValue:o.value,"onUpdate:modelValue":u[5]||(u[5]=m=>o.value=m),class:"quickprint-w-full",options:y(jl),disabled:n.page.size.type===y(Zt).CONTENT},null,8,["modelValue","options","disabled"])])])])])]))}}),im=["value","placeholder"],rm=P({__name:"InputUnit",props:{label:{type:String,default:null},modelValue:{type:Number,default:null},standard:{type:String,default:"px"},target:{type:String,default:"px"},placeholder:{type:String,default:"请输入"},min:{type:Number,default:1},defaultValue:{type:Number,default:0},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,l=e,s=Bt("inputRef"),o=N({get(){return t.standard===t.target?t.modelValue:t.standard==="px"&&t.target==="mm"?pl(t.modelValue):t.standard==="mm"&&t.target==="px"?Pt(t.modelValue):0},set(u){if(t.standard===t.target)return l("update:modelValue",u);if(t.standard==="px"&&t.target==="mm")return l("update:modelValue",Pt(u));if(t.standard==="mm"&&t.target==="px")return l("update:modelValue",pl(u))}}),a=N(()=>t.clearable&&o.value!=null);function i(u){const g=u.target.value;if(o==null||g===""){if(t.clearable)return;const v=t.min?t.min:t.defaultValue;o.value=v;return}const E=Number(g);if(!Number.isNaN(E)){if(t.min!=null&&E<t.min){o.value=t.min;return}if(t.standard==="px"){o.value=Math.round(E);return}o.value=E}}function r(){l("update:modelValue",void 0)}function d(){var u;(u=s.value)==null||u.blur(),setTimeout(()=>{var m;return(m=s.value)==null?void 0:m.focus()},50)}return(u,m)=>(S(),I("label",{class:h({[u.classes.inputUnit]:!0,[u.classes.withClear]:n.clearable})},[f("span",{class:h(u.classes.label)},Y(n.label),3),f("input",{ref_key:"inputRef",ref:s,class:"quickprint-form-control",type:"number",value:o.value,placeholder:n.placeholder,onBlur:i,onKeydown:Bl(d,["enter"])},null,40,im),a.value?(S(),I("span",{key:0,class:h(u.classes.clearBtn),onClick:oe(r,["stop"])},[p(y($),{icon:"icon-close",size:"11px"})],2)):H("",!0)],2))}}),am="_inputUnit_2ymft_2",cm="_clearBtn_2ymft_7",um="_label_2ymft_11",dm="_withClear_2ymft_31",fm={inputUnit:am,clearBtn:cm,label:um,withClear:dm},pm={classes:fm},ot=z(rm,[["__cssModules",pm]]),mm=P({__name:"UnitSelect",props:wt({modelValue:{type:String,default:"px"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=[{label:"像素(px)",value:"px"},{label:"毫米(mm)",value:"mm"}],t=n,l=en(n,"modelValue"),s=N(()=>{var o;return((o=e.find(a=>a.value===t.modelValue))==null?void 0:o.label)??t.modelValue});return(o,a)=>(S(),I("span",{class:h(o.classes.unit),title:"1毫米≈3.778像素，1像素≈0.265毫米"},[p(y(K),{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=i=>l.value=i),options:e,class:h(o.classes.select),appearance:"none",border:"none"},{selected:ye(()=>[f("span",{class:h(o.classes.text)},Y(s.value),3)]),_:1},8,["modelValue","class"])],2))}}),gm="_unit_135mn_2",hm="_text_135mn_8",vm="_select_135mn_25",bm={unit:gm,text:hm,select:vm},ym={classes:bm},Ro=z(mm,[["__cssModules",ym]]),Em=P({__name:"CopyBtn",emits:["copy"],setup(n,{emit:e}){const t=e,l=ce(!1);function s(){t("copy",async function(a){await navigator.clipboard.writeText(a).catch(es)!==!1&&(l.value=!0,setTimeout(()=>l.value=!1,500))})}return(o,a)=>(S(),I("button",{type:"button",class:h(["quickprint-text-btn",o.classes.btn]),title:"复制",onClick:s},[p(y($),{icon:"icon-copy"}),p(ds,{name:"quickprint-fade"},{default:ye(()=>[l.value?(S(),I("span",{key:0,class:h(o.classes.message)},"已复制",2)):H("",!0)]),_:1})],2))}}),_m="_btn_v9scw_2",Tm="_message_v9scw_6",Sm={btn:_m,message:Tm},wm={classes:Sm},km=z(Em,[["__cssModules",wm]]),Cm=P({__name:"window",props:{code:{type:String,default:""},doc:{type:he,default:null},mode:{type:String,default:"code"}},setup(n){const e=n,t=Ke(),l=ce(e.code),s=ue();function o(){return l.value}function a(){e.doc!=null&&Gr({doc:e.doc}).then(m=>{var E;if(m==null)return;const g=m.type=="reference"?`[=${m.value}]`:`[${m.value}]`;(E=s.value)==null||E.insert(g)})}function i(m){var g;return Ze(m,(g=e.doc)==null?void 0:g.ds)}function r(){var m;(m=s.value)==null||m.insert(`[2.6.${jn.ELEMENT_VALUR}]`)}function d(){Wr().then(m=>{var g;m!=null&&((g=s.value)==null||g.insert(m.value))})}function u(){Yr({doc:e.doc}).then(m=>{var g;m!=null&&((g=s.value)==null||g.insert(m.value))})}return t==null||t.useHandle("confirm",o),(m,g)=>(S(),I("div",{class:h(m.classes.window)},[n.mode!=="code"?(S(),I("div",{key:0,class:h(m.classes.toolbar)},[n.mode=="condition"?(S(),I(Z,{key:0},[f("button",{type:"button",class:"quickprint-text-btn",onClick:r},[p(y($),{icon:"icon-number-sign"}),g[1]||(g[1]=f("span",null,"插入元素值",-1))]),f("div",{class:h(m.classes.divider)},null,2)],64)):H("",!0),f("button",{type:"button",onClick:a,class:"quickprint-text-btn"},[p(y($),{icon:"icon-insert-var"}),g[2]||(g[2]=f("span",null,"插入变量",-1))]),f("button",{type:"button",class:"quickprint-text-btn",onClick:d},[p(y($),{icon:"icon-function"}),g[3]||(g[3]=f("span",null,"插入函数",-1))]),f("button",{type:"button",class:"quickprint-text-btn",onClick:u},[p(y($),{icon:"icon-formula"}),g[4]||(g[4]=f("span",null,"插入公式",-1))])],2)):H("",!0),p(y(Co),{modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=E=>l.value=E),language:"javascript",class:h(m.classes.code),formatVariable:i,autofocus:"",ref_key:"codeRef",ref:s},null,8,["modelValue","class"])],2))}}),Rm="_window_n935p_2",Nm="_toolbar_n935p_11",Lm="_code_n935p_22",Im="_divider_n935p_27",xm={window:Rm,toolbar:Nm,code:Lm,divider:Im},Am={classes:xm},No=z(Cm,[["__cssModules",Am]]),Lo=Be(function(n){return Tt("公式",p(No,{code:n==null?void 0:n.code,doc:n==null?void 0:n.doc,mode:n==null?void 0:n.mode},null),{preset:"editor"}).promisify().catch($e)}),qm=Be(function(n,e){return Tt(n,p(No,{code:e},null),{preset:"editor"}).promisify().catch($e)}),Dm={class:"quickprint-config-section quickprint-config-inline"},Om={class:"quickprint-config-content"},Mm=["value"],$m=P({__name:"Visibility",props:{element:{type:me,required:!0}},setup(n){const e=n,t=N({get(){var i;return((i=e.element.visibility)==null?void 0:i.type)??yt.VISIBLE},set(i){e.element.visibility==null&&(e.element.visibility={}),i!==yt.CONDITION&&(e.element.visibility.condition=void 0),e.element.visibility.type=i}}),l=N({get(){var i;return((i=e.element.visibility)==null?void 0:i.condition)??""},set(i){e.element.visibility==null&&(e.element.visibility={}),e.element.visibility.condition=i}}),s=N(()=>{var i;return rl((i=e.element.visibility)==null?void 0:i.condition,e.element.doc)}),o=N(()=>{var i;return t.value!==yt.CONDITION?!1:!((i=e.element.visibility)!=null&&i.condition)});function a(){const i=l.value||`[2.6.${jn.ELEMENT_VALUR}]`;Lo({code:i,doc:e.element.doc,mode:"condition"}).then(r=>{r!=null&&(l.value=r)})}return(i,r)=>(S(),I(Z,null,[f("section",Dm,[r[1]||(r[1]=f("header",{class:"quickprint-config-header"},"可见性",-1)),f("div",Om,[p(y(K),{class:"quickprint-w-full",options:y(ms),modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=d=>t.value=d)},null,8,["options","modelValue"])])]),t.value===y(yt).CONDITION?(S(),I("div",{key:0,class:h([i.classes.condition,"quickprint-config-section"]),onClick:a},[f("textarea",{value:s.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,Mm),o.value?(S(),Q(y($),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2)):H("",!0)],64))}}),Pm="_condition_siopf_2",Vm={condition:Pm},Bm={classes:Vm},Fm=z($m,[["__cssModules",Bm]]);function zm(n){return N({get(){return n.element.attributes.position??hn.DEFAULT},set(e){const t=e===hn.DEFAULT?void 0:e;n.element.attributes.position=t}})}function Um(n){return N({get(){return n.element.attributes.printMode??vn.ONCE},set(e){const t=e===vn.ONCE?void 0:e;n.element.attributes.printMode=t}})}function Hm(n){return N({get(){return n.element.attributes.overflow??Kt.HIDDEN},set(e){const t=e===Kt.HIDDEN?void 0:e;n.element.attributes.overflow=t}})}function Gm(n){return N({get(){return n.element.width},set(e){n.element.setWidth(e,!0)}})}function Wm(n){return N({get(){return n.element.height},set(e){n.element.setHeight(e,!0)}})}function Ym(n){return N({get(){return n.element.attributes.display},set(e){if(e==null){n.element.attributes.display=void 0;return}n.element.attributes.display=e}})}function Xm(n){return N({get(){return n.element.ds.type},set(e){const t=n.element.ds.type;n.element.ds.type=e,t!=e&&(n.element.ds.value=void 0)}})}const jm=P({__name:"Const",props:{element:{type:me,required:!0}},setup(n){const e=n,t=N({get(){return e.element.ds.value},set(l){e.element.ds.value=l}});return(l,s)=>_e((S(),I("textarea",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),class:"quickprint-form-control quickprint-form-control-block quickprint-config-space",rows:"3",placeholder:"请输入"},null,512)),[[Ae,t.value]])}}),Zm={class:"quickprint-config-ds-var-type"},Km=["title"],Jm=P({__name:"Variable",props:{element:{type:me,required:!0}},setup(n){const e=n,t=Te(),l=N(()=>ie(e.element.ds.value)),s=N(()=>Ze(e.element.ds.value,t.doc.ds));function o(i){i.stopPropagation(),e.element.ds.value=void 0}async function a(){var u;const i=await al({doc:t.doc,value:e.element.ds.value}).catch(nt);if(i==null||(e.element.setDataSource(ve.VARIABLE,i.value),e.element.type!=X.TABLE_CELL||i.type!=="ds"))return;const r=e.element.parent;if(r==null||r.isBindVariable||((u=i.parent)==null?void 0:u.type)!==ne.ARRAY)return;const d=i.parent;r.setDataSource(ve.VARIABLE,`${Et.DS}.${d.type}.${d.name}`)}return(i,r)=>(S(),I("div",{class:"quickprint-config-ds-variable",onClick:a},[l.value?(S(),I(Z,{key:0},[r[0]||(r[0]=f("span",{class:"quickprint-config-ds-placeholder"},"请选择",-1)),p(y($),{icon:"icon-open-new",size:"14px"})],64)):(S(),I(Z,{key:1},[f("span",Zm,"<"+Y(y(wi)(e.element.ds.value))+">",1),f("span",{class:"quickprint-is-fill-w quickprint-is-truncate",title:s.value},Y(s.value),9,Km),f("button",{type:"button",class:"quickprint-text-btn quickprint-config-ds-remove-var",onClick:o},[p(y($),{icon:"icon-close",size:"12px"})])],64))]))}}),Qm=["value"],eg=P({__name:"Code",props:{element:{type:me,required:!0}},setup(n){const e=n,t=N(()=>ie(e.element.ds.value));function l(){return Kn(e.element.ds.value)?e.element.ds.value:`function data(element){
  // 在此处自定义返回值
  // 支持返回Promise
  return
}`}function s(){qm("自定义",l()).then(o=>{o!=null&&(e.element.ds.value=o)})}return(o,a)=>(S(),I("div",{onClick:s,class:h(o.classes.code)},[f("textarea",{value:e.element.ds.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,Qm),t.value?(S(),Q(y($),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2))}}),tg="_code_1az68_2",ng={code:tg},lg={classes:ng},og=z(eg,[["__cssModules",lg]]),sg=["value"],ig=P({__name:"Formula",props:{element:{type:me,required:!0}},setup(n){const e=n,t=Te(),l=N(()=>ie(e.element.ds.value)),s=N(()=>rl(e.element.ds.value,e.element.doc));function o(){const a=e.element.ds.value;Lo({code:a,doc:t.doc,mode:"formula"}).then(i=>{i!=null&&(e.element.ds.value=i)})}return(a,i)=>(S(),I("div",{onClick:o,class:h(a.classes.code)},[f("textarea",{value:s.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,sg),l.value?(S(),Q(y($),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2))}}),rg="_code_ipm2q_2",ag={code:rg},cg={classes:ag},ug=z(ig,[["__cssModules",cg]]);function dg(n){switch(n.ds.type){case ve.CONST:return p(jm,{element:n},null);case ve.VARIABLE:return p(Jm,{element:n},null);case ve.CODE:return p(og,{element:n},null);case ve.FORMULA:return p(ug,{element:n},null);default:return null}}const fg=P({props:{element:{type:me,required:!0}},setup(n){const e=N(()=>Jt(n.element.type)),t=N(()=>bs.filter(C=>C.value!=n.element.type)),l=ce("px"),s=Gm(n),o=Wm(n),a=Hm(n),i=zm(n),r=Um(n),d=Ym(n),u=Xm(n),m=N(()=>{const C=n.element,L=C.parent;if(L===null||!(L instanceof St))return!1;const k=L.header;if(k.display&&C.bottom<=(k.height??0))return!1;const w=L.parent;if(w==null)return!1;const _=L.footer;return!(_.display&&C.top>=Math.floor(Pt(w.paper.height))-(_.height??0))});function g(C,L){return L==null?!1:!!L.includes(C)}function E(){const C=Wt(n.element.type);if(g(ae.LAYOUT,C==null?void 0:C.exclude))return null;const L=n.element,k=g(ae.COORD,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("位置")]),p("div",{class:"quickprint-config-content quickprint-form-inline"},[p(ot,{class:"quickprint-form-inline-item",label:"左",modelValue:L.left,"onUpdate:modelValue":V=>L.left=V,target:l.value},null),p(ot,{class:"quickprint-form-inline-item",label:"上",modelValue:L.top,"onUpdate:modelValue":V=>L.top=V,target:l.value},null)])]),w=g(ae.SIZE)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[p("span",null,[se("尺寸")])]),p("div",{class:"quickprint-config-content quickprint-form-inline"},[p(ot,{class:"quickprint-form-inline-item",label:"宽",modelValue:s.value,"onUpdate:modelValue":V=>s.value=V,target:l.value},null),p(ot,{class:"quickprint-form-inline-item",label:"高",modelValue:o.value,"onUpdate:modelValue":V=>o.value=V,target:l.value},null)])]),_=g(ae.VISIBILITY,C==null?void 0:C.exclude)?null:p(Fm,{element:L},null),R=g(ae.OVERFLOW,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("溢出时")]),p("div",{class:"quickprint-config-content"},[p(K,{modelValue:a.value,"onUpdate:modelValue":V=>a.value=V,options:Ss,class:"quickprint-w-full"},null)])]),x=g(ae.PRINT_MODE,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header "},[se("打印模式")]),p("div",{class:"quickprint-config-content"},[p(K,{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,options:Ts,class:"quickprint-w-full"},null)])]),q=g(ae.POSITION,C==null?void 0:C.exclude)||!m.value?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("定位模式")]),p("div",{class:"quickprint-config-content"},[p(K,{modelValue:i.value,"onUpdate:modelValue":V=>i.value=V,options:_s,class:"quickprint-w-full"},null)])]);return p("div",{class:"quickprint-config-group"},[p("div",{class:"quickprint-config-group-title quickprint-is-row"},[p("span",{class:"quickprint-is-fill-w"},[se("布局")]),p("span",null,[se("单位：")]),p(Ro,{modelValue:l.value,"onUpdate:modelValue":V=>l.value=V},null)]),k,w,_,R,x,q])}function v(){const C=Wt(n.element.type);if(g(ae.BASIC,C==null?void 0:C.exclude))return null;const L=n.element,k=g(ae.PREFIX,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("前缀")]),p("div",{class:"quickprint-config-content"},[_e(p("input",{"onUpdate:modelValue":R=>L.attributes.prefix=R,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ae,L.attributes.prefix]])])]),w=g(ae.SUFFIX,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("后缀")]),p("div",{class:"quickprint-config-content"},[_e(p("input",{"onUpdate:modelValue":R=>L.attributes.suffix=R,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ae,L.attributes.suffix]])])]),_=g(ae.DISPLAY,C==null?void 0:C.exclude)?null:p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("数据类型")]),p("div",{class:"quickprint-config-content"},[p(K,{options:t.value,modelValue:d.value,"onUpdate:modelValue":R=>d.value=R,class:"quickprint-w-full"},null)])]);return p("div",{class:"quickprint-config-group"},[p("div",{class:"quickprint-config-group-title"},[se("基础")]),k,w,_])}function c(){const C=Wt(n.element.display);return(C==null?void 0:C.display)==null?null:kt(C.display,{element:n.element})}function b(){const C=Wt(n.element.type);if(g(ae.ATTRIBUTES,C==null?void 0:C.exclude))return null;const L=C!=null&&C.attributes?kt(C.attributes,{element:n.element}):null,k=c();if(L==null&&k==null)return null;const w=k!=null&&L!=null?p("div",{class:"quickprint-config-divider"},null):null;return p("div",{class:"quickprint-config-group"},[p("div",{class:"quickprint-config-group-title"},[se("属性")]),k,w,L])}function T(){const C=Wt(n.element.type);return g(ae.DATASOURCE,C==null?void 0:C.exclude)?null:p("div",{class:"quickprint-config-group"},[p("div",{class:"quickprint-config-group-title"},[se("数据")]),p(K,{options:Yl,modelValue:u.value,"onUpdate:modelValue":L=>u.value=L},null),dg(n.element)])}function A(C){C(n.element.id)}return function(){const L=n.element;return p("div",{class:"quickprint-config"},[p("div",{class:"quickprint-config-title"},[p("span",null,[e.value,se("配置")]),null]),p("div",{class:"quickprint-config-body quickprint-is-fill-h quickprint-is-scrollable"},[p("div",{class:"quickprint-config-group"},[p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("标识")]),p("div",{class:"quickprint-config-content"},[p("span",{class:"quickprint-config-id"},[L.id]),p(km,{onCopy:A},null)])]),p("section",{class:"quickprint-config-section quickprint-config-inline"},[p("header",{class:"quickprint-config-header"},[se("标题")]),p("div",{class:"quickprint-config-content"},[_e(p("input",{type:"text","onUpdate:modelValue":k=>L.title=k,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ae,L.title]])])])]),E(),v(),b(),T()])])}}}),pg=P({setup(){const n=Te(),e=Le("classes");function t(){return p("div",{class:e.tip},[se("未知的打印元素")])}function l(){return p("div",{class:e.tip},[se("请先选择元素")])}function s(){const i=n.getSelectedPage()??n.doc.firstPage;return p(sm,{page:i},null)}function o(){const i=n.getSelectedElements()[0];return i==null?l():Object.values(X).includes(i.type)===!1?t():kt(fg,{element:i,key:i.id})}function a(){const i=n.state;return i.selectedType!==pe.ELEMENT?!1:i.selectMode===it.SINGLE?!0:i.selected.length===1}return function(){return a()?o():s()}}}),mg="_tip_cdonk_2",gg={tip:mg},hg={classes:gg},vg=z(pg,[["__cssModules",hg]]);function Fe(n,e){if(n.state.selectedType!==pe.ELEMENT)return;const l=n.getSelectedElements();if(l.length===1)return l[0].getStyle(e)}function qe(n,e,t){if(n.state.selectedType!==pe.ELEMENT)return;const s=n.getSelectedElements();if(s.length!=0){for(const o of s)o.setStyle(e,t);n.createSnapshot()}}function Pe(n,e){if(n.state.selectedType!==pe.ELEMENT)return;const l=n.getSelectedElements();if(l.length!=0){for(const s of l)s.removeStyle(e);n.createSnapshot()}}function bg(n){const e="underline";return N({get(){if(n.state.selectedType!==pe.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?qe(n,e,t):Pe(n,e)}})}function yg(n){const e="lineThrough";return N({get(){if(n.state.selectedType!==pe.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?qe(n,e,t):Pe(n,e)}})}function Eg(n){const e="lineHeight";return N({get(){return Fe(n,e)},set(t){t===gt.DEFAULT?Pe(n,e):qe(n,e,t)}})}function _g(n){const e="highlightColor";return N({get(){return Fe(n,e)??Zn.BLACK},set(t){t===""?Pe(n,e):qe(n,e,t)}})}function Tg(n){const e="backgroundColor";return N({get(){return Fe(n,e)??Zn.BLACK},set(t){t===""?Pe(n,e):qe(n,e,t)}})}function Sg(n){const e="fontStyle";return N({get(){return Fe(n,e)===ml.ITALIC},set(t){t?qe(n,e,ml.ITALIC):Pe(n,e)}})}function wg(n){const e="textAlign";return N({get(){return Fe(n,e)??lt.LEFT},set(t){t===lt.LEFT?Pe(n,e):qe(n,e,t)}})}function kg(n){const e="verticalAlign";return N({get(){return Fe(n,e)??Ye.MIDDLE},set(t){t===Ye.MIDDLE?Pe(n,e):qe(n,e,t)}})}function Cg(n){const e="fontFamily";return N({get(){return Fe(n,e)},set(t){t===le.DEFAULT?Pe(n,e):qe(n,e,t)}})}function Rg(n){const e="fontSize";return N({get(){return Fe(n,e)},set(t){t===be.DEFAULT?Pe(n,e):qe(n,e,t)}})}function Ng(n){const e="color";return N({get(){return Fe(n,e)??Re.REGULAR},set(t){qe(n,e,t)}})}function Lg(n){const e="fontWeight";return N({get(){return Fe(n,e)===700},set(t){t?qe(n,e,700):Pe(n,e)}})}const Ig=["title","onClick"],xg=P({__name:"BorderSelect",setup(n){const e=[te.ALL,te.NONE,te.INSIDE,te.OUTSIDE],t=Te(),l=N(()=>{if(t.state.selectedType!==pe.ELEMENT)return null;const d=t.getSelectedElements();if(d.length!==1)return null;const m=d[0].getStyle("border");if(m==null||m===te.NONE)return null;if(m===te.ALL)return{borderStyle:"solid"};const g={};return m&te.TOP&&(g.borderTopStyle="solid"),m&te.RIGHT&&(g.borderRightStyle="solid"),m&te.BOTTOM&&(g.borderBottomStyle="solid"),m&te.LEFT&&(g.borderLeftStyle="solid"),g}),s=[{label:"上框线",value:te.TOP,icon:"icon-border-top"},{label:"下框线",value:te.BOTTOM,icon:"icon-border-bottom"},{label:"左框线",value:te.LEFT,icon:"icon-border-left"},{label:"右框线",value:te.RIGHT,icon:"icon-border-right"}];function o(r){if(t.state.selectedType!==pe.ELEMENT)return!1;const u=t.getSelectedElements();if(u.length!==1)return!1;const g=u[0].getStyle("border");return g==null?!1:e.includes(r)?g==r:g&r}function a(r){if(t.state.selectedType!==pe.ELEMENT)return;const u=t.getSelectedElements();if(u.length!=0){for(const m of u){const g=m.getStyle("border");if(g==null){m.setStyle("border",r);continue}if(g===te.ALL){m.setStyle("border",r===te.ALL?te.NONE:r);continue}if(e.includes(r)){m.setStyle("border",r);continue}if(e.includes(g)){m.setStyle("border",r);continue}m.setStyle("border",g^r)}t.createSnapshot()}}function i(){if(t.state.selectedType!==pe.ELEMENT)return;const d=t.getSelectedElements();if(d.length!=0){for(const u of d)u.setStyle("border",void 0);t.createSnapshot()}}return(r,d)=>(S(),Q(y(to),null,{popover:ye(()=>[f("div",{class:h(r.classes.popover)},[f("div",null,[(S(),I("button",{type:"button",title:"全部框线",key:y(te).ALL,class:h({"quickprint-text-btn":!0,[r.classes.tool]:!0,"quickprint-is-selected":o(y(te).ALL)}),onClick:d[0]||(d[0]=u=>a(y(te).ALL))},[p(y($),{icon:"icon-border",size:"16px"})],2)),(S(),I("button",{type:"button",title:"无框线",key:y(te).ALL,class:h({"quickprint-text-btn":!0,[r.classes.tool]:!0}),onClick:i},[p(y($),{icon:"icon-border-none",size:"16px"})],2))]),f("div",{class:h(r.classes.divider)},[(S(),I(Z,null,re(s,u=>f("button",{type:"button",title:u.label,key:u.value,class:h({"quickprint-text-btn":!0,[r.classes.tool]:!0,"quickprint-is-selected":o(u.value)}),onClick:m=>a(u.value)},[p(y($),{icon:u.icon,size:"16px"},null,8,["icon"])],10,Ig)),64))],2)],2)]),default:ye(()=>[f("div",{class:h(["quickprint-text-btn",r.classes.borderSelect]),title:"边框"},[f("div",{class:h({[r.classes.border]:!0}),style:J(l.value)},null,6)],2)]),_:1}))}}),Ag="_border_rprfx_2",qg="_borderSelect_rprfx_10",Dg="_popover_rprfx_14",Og="_divider_rprfx_18",Mg={border:Ag,borderSelect:qg,popover:Dg,divider:Og},$g={classes:Mg},Pg=z(xg,[["__cssModules",$g]]),Vg={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},Bg={class:"quickprint-config-section"},Fg={class:"quickprint-form-inline"},zg={class:"quickprint-config-section quickprint-config-inline"},Ug={class:"quickprint-config-section"},Hg={class:"quickprint-config-header quickprint-is-row"},Gg={class:"quickprint-is-fill-w"},Wg={class:"quickprint-config-content quickprint-form-inline quickprint-form-bottom-gap"},Yg={class:"quickprint-config-content quickprint-form-inline"},Xg=P({__name:"Paper",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=ce("px"),l=g("top"),s=g("bottom"),o=g("left"),a=g("right"),i=N(()=>Mn.map(E=>({label:E.size===$n.CUSTOM?"自定义":`${E.size}(${E.width}mm ✕ ${E.height}mm)`,value:E.size})));function r(E){e.config.width=E,m()}function d(E){e.config.height=E,m()}function u(E){const v=Mn.find(c=>c.size===E);v!=null&&(e.config.width=v.width,e.config.height=v.height,e.config.orientation=v.orientation,e.config.margins=v.margins,e.config.size=v.size)}function m(){const E=e.config,v=Mn.find(c=>c.size===$n.CUSTOM?!1:c.orientation===E.orientation&&c.width===E.width&&c.height===E.height);if(v==null){E.size=$n.CUSTOM;return}E.size=v.size}function g(E){return N({get(){var v;return(v=e.config.margins)==null?void 0:v[E]},set(v){e.config.margins==null&&(e.config.margins={}),e.config.margins[E]=v}})}return(E,v)=>(S(),I("div",Vg,[f("section",Bg,[v[6]||(v[6]=f("header",{class:"quickprint-config-header"},[f("span",null,"尺寸")],-1)),p(y(K),{options:i.value,modelValue:n.config.size,"onUpdate:modelValue":u,class:"quickprint-form-control-block quickprint-form-bottom-gap"},null,8,["options","modelValue"]),f("div",Fg,[p(At,{class:"quickprint-form-inline-item",label:"宽",modelValue:n.config.width,min:1,"onUpdate:modelValue":r},null,8,["modelValue"]),p(At,{class:"quickprint-form-inline-item",label:"高",modelValue:n.config.height,min:1,"onUpdate:modelValue":d},null,8,["modelValue"])])]),f("section",zg,[v[7]||(v[7]=f("header",{class:"quickprint-config-header"},"方向",-1)),p(xt,{modelValue:n.config.orientation,"onUpdate:modelValue":v[0]||(v[0]=c=>n.config.orientation=c),options:y(jl)},null,8,["modelValue","options"])]),f("section",Ug,[f("header",Hg,[f("span",Gg,[p(y(qs),{title:"纸张的打印边距，可用于标记可打印区域。请确保设打印元素在可打印区域内，避免内容被裁剪。"},{default:ye(()=>v[8]||(v[8]=[se("参考边距")])),_:1})]),v[9]||(v[9]=f("span",null,"单位：",-1)),p(Ro,{modelValue:t.value,"onUpdate:modelValue":v[1]||(v[1]=c=>t.value=c)},null,8,["modelValue"])]),f("div",Wg,[p(ot,{class:"quickprint-form-inline-item",label:"上",modelValue:y(l),"onUpdate:modelValue":v[2]||(v[2]=c=>Ge(l)?l.value=c:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),p(ot,{class:"quickprint-form-inline-item",label:"下",modelValue:y(s),"onUpdate:modelValue":v[3]||(v[3]=c=>Ge(s)?s.value=c:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])]),f("div",Yg,[p(ot,{class:"quickprint-form-inline-item",label:"左",modelValue:y(o),"onUpdate:modelValue":v[4]||(v[4]=c=>Ge(o)?o.value=c:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),p(ot,{class:"quickprint-form-inline-item",label:"右",modelValue:y(a),"onUpdate:modelValue":v[5]||(v[5]=c=>Ge(a)?a.value=c:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])])])]))}}),jg={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},Zg={class:"quickprint-is-fill-h"},Kg={class:"quickprint-is-fill-h"},Jg=P({__name:"Font",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:Ne.NONE},{label:"磅",value:Ne.PT},{label:"像素",value:Ne.PX}],l=N(()=>xn.map(d=>(d.style={fontFamily:d.value==le.DEFAULT?le.SONG:d.value},d))),s=N(()=>vo.map(d=>(d.style={fontFamily:d.value==le.DEFAULT?le.SONG:d.value},d))),o=N({get(){return e.config.style.fontFamily??le.DEFAULT},set(d){const u=d===le.DEFAULT?void 0:d;e.config.style.fontFamily=u}}),a=N({get(){return e.config.style.enFontFamily??le.DEFAULT},set(d){const u=d===le.DEFAULT?void 0:d;e.config.style.enFontFamily=u}}),i=N({get(){return e.config.style.fontSize},set(d){const u=ie(d)?void 0:d;e.config.style.fontSize=u}}),r=N({get(){return e.config.style.lineHeight},set(d){e.config.style.lineHeight=d}});return(d,u)=>(S(),I("div",jg,[f("section",{class:h(d.classes.font)},[f("div",{class:h(d.classes.zhFont)},[f("div",{class:h(d.classes.title)},"中文字体",2),f("div",Zg,[p(y(K),{options:l.value,modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=m=>o.value=m)},null,8,["options","modelValue"])])],2),f("div",{class:h(d.classes.enFont)},[f("div",{class:h(d.classes.title)},"西文字体",2),f("div",Kg,[p(y(K),{options:s.value,modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m)},null,8,["options","modelValue"])])],2),f("div",{class:h(d.classes.lineHeight)},[f("div",{class:h(d.classes.title)},"行高",2),p(mt,{modelValue:r.value,"onUpdate:modelValue":u[2]||(u[2]=m=>r.value=m),options:t},null,8,["modelValue"])],2),f("div",{class:h(d.classes.fontSize)},[f("div",{class:h(d.classes.title)},"字号",2),p(ko,{modelValue:i.value,"onUpdate:modelValue":u[3]||(u[3]=m=>i.value=m),height:"144px"},null,8,["modelValue"])],2)],2)]))}}),Qg="_font_145qf_2",eh="_zhFont_145qf_9",th="_enFont_145qf_16",nh="_lineHeight_145qf_23",lh="_fontSize_145qf_30",oh="_title_145qf_45",sh={font:Qg,zhFont:eh,enFont:th,lineHeight:nh,fontSize:lh,title:oh},ih={classes:sh},rh=z(Jg,[["__cssModules",ih]]),ah=P({__name:"index",props:{doc:{type:he,required:!0},active:{type:String,default:null}},setup(n){const e=n,t=Ke(),l=Me(s());function s(){const i=e.doc;return{size:i.paper.size,width:i.paper.width,height:i.paper.height,orientation:i.paper.orientation,margins:i.margins?{...i.margins}:void 0,style:{...i.style}}}function o(){t==null||t.confirm(l)}function a(){t==null||t.cancel()}return(i,r)=>(S(),I("div",{class:h(i.classes.setting)},[n.active=="paper"?(S(),Q(Xg,{key:0,config:l},null,8,["config"])):H("",!0),n.active=="font"?(S(),Q(rh,{key:1,config:l},null,8,["config"])):H("",!0),f("div",{class:h(i.classes.footer)},[f("button",{type:"button",class:"quickprint-text-btn",onClick:a},"取消"),f("button",{type:"button",class:"quickprint-text-btn",onClick:o},"确定")],2)],2))}}),ch="_setting_h98ws_2",uh="_footer_h98ws_10",dh={setting:ch,footer:uh},fh={classes:dh},ph=z(ah,[["__cssModules",fh]]),mh=Be(function(n){return Qt("文档",(e,t)=>p(ph,{doc:n,active:t},null),{preset:"setting",icon:"svg:icon-setting",tabs:[{label:"纸张",name:"paper",active:!0},{label:"字体",name:"font"}]}).promisify().then(e=>(n.paper.size=e.size,n.paper.width=e.width,n.paper.height=e.height,n.paper.orientation=e.orientation,n.margins=e.margins,n.style=e.style,e)).catch($e)}),gh=P({props:{toolbar:{type:Array,required:!0}},setup(n){const e=Te(),t=Le("classes"),l=Cg(e),s=Rg(e),o=Eg(e),a=Tg(e),i=_g(e),r=Ng(e),d=Lg(e),u=Sg(e),m=bg(e),g=yg(e),E=wg(e),v=kg(e),c=N(()=>xn.map(O=>(O.style={fontFamily:O.value==le.DEFAULT?le.SONG:O.value},O)));function b(O){return p("button",{type:"button",class:"quickprint-text-btn",onClick:()=>O.handler(e)},[O.icon&&p($,{icon:O.icon},null),p("span",null,[O.label])])}function T(O){O.preventDefault()}function A(){d.value=!d.value}function C(){u.value=!u.value}function L(){m.value=!m.value}function k(){g.value=!g.value}function w(){const O=e.getSelectedElements();if(O.length==0)return;const j=Math.min(...O.map(W=>W.left));for(const W of O)W.setLeft(j,!0);e.createSnapshot()}function _(){const O=e.getSelectedElements();if(O.length==0)return;const j=O[0].page;if(j==null)return;const W=Pt(j.width);for(const M of O)M.setLeft((W-M.width)/2);e.createSnapshot()}function R(){const O=e.getSelectedElements();if(O.length==0)return;const j=Math.max(...O.map(W=>W.left+W.width));for(const W of O)W.setLeft(j-W.width,!0);e.createSnapshot()}async function x(){const O=await Hr(e.doc);O!=null&&(e.doc.ds=e.doc.createDS(O))}function q(){mh(e.doc)}function V(O){var j,W;if(typeof O=="function")return O(e,t);if(typeof O=="object")return b(O);if(typeof O!="string")return null;switch(O){case"divider":case"---":return p("div",{class:t.divider},null);case"space":return p("div",{class:"quickprint-is-fill-w"},null);case"undo":{const M=!e.history.allowUndo();return p("button",{type:"button",title:"撤销 Ctrl + Z",class:"quickprint-text-btn",disabled:M,onClick:e.history.undo},[p($,{icon:"icon-undo"},null)])}case"redo":{const M=!e.history.allowRedo();return p("button",{type:"button",title:"重做 Ctrl + Y",class:"quickprint-text-btn",disabled:M,onClick:e.history.redo},[p($,{icon:"icon-redo"},null)])}case"delete":return p("button",{type:"button",class:["quickprint-text-btn",t.tool],title:"删除",onClick:e.deleteSelectedElement},[p($,{icon:"icon-delete",size:"16px"},null)]);case"fontFamily":return p(K,{title:"字体",width:"80px",modelValue:l.value,"onUpdate:modelValue":M=>l.value=M,options:c.value,class:t.tool,button:!0},null);case"fontSize":return p(K,{title:"字号",width:"60px",modelValue:s.value,"onUpdate:modelValue":M=>s.value=M,options:ul,class:t.tool,button:!0},null);case"lineHeight":return p(K,{title:"行高",width:"60px",modelValue:o.value,"onUpdate:modelValue":M=>o.value=M,options:bo,class:t.tool,popoverWidth:120,button:!0},null);case"backgroundColor":return p(st,{modelValue:a.value,"onUpdate:modelValue":M=>a.value=M,class:t.tool},{default:()=>[p("div",{class:t.colorIcon,title:"背景色"},[p($,{icon:"icon-bg-color-a",size:"15px"},null),p("div",{class:t.colorIndicator,style:{backgroundColor:a.value}},null)])]});case"highlightColor":return p(st,{modelValue:i.value,"onUpdate:modelValue":M=>i.value=M,class:t.tool},{default:()=>[p("div",{class:t.colorIcon,title:"突出显示"},[p($,{icon:"icon-bg-color-b",size:"15px"},null),p("div",{class:t.colorIndicator,style:{backgroundColor:i.value}},null)])]});case"fontColor":return p(st,{modelValue:r.value,"onUpdate:modelValue":M=>r.value=M,class:t.tool},{default:()=>[p("div",{class:t.colorIcon,title:"字体颜色"},[p($,{icon:"icon-font",size:"15px"},null),p("div",{class:t.colorIndicator,style:{backgroundColor:r.value}},null)])]});case"fontWeight":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":d.value};return p("button",{type:"button",title:"加粗",class:M,onClick:A},[p($,{icon:"icon-font-bold",size:"16px"},null)])}case"fontStyle":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":u.value};return p("button",{type:"button",title:"斜体",class:M,onClick:C},[p($,{icon:"icon-italic",size:"16px"},null)])}case"underline":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":m.value};return p("button",{type:"button",title:"下划线",class:M,onClick:L},[p($,{icon:"icon-underline",size:"16px"},null)])}case"throughLine":{const M={"quickprint-text-btn":!0,[t.tool]:!0,"quickprint-is-selected":g.value};return p("button",{type:"button",title:"删除线",class:M,onClick:k},[p($,{icon:"icon-through-line",size:"16px"},null)])}case"border":return p(Pg,null,null);case"textAlign":{const M=((j=Wn.find(ee=>ee.value===E.value))==null?void 0:j.label)??"水平对齐",de={selected({option:ee}){return p($,{icon:ee==null?void 0:ee.icon,class:"quickprint-is-self-center"},null)}};return p(K,{modelValue:E.value,"onUpdate:modelValue":ee=>E.value=ee,options:Wn,title:M,class:t.tool,width:"36px",size:"mini",button:!0},de)}case"verticalAlign":{const M=((W=Gn.find(ee=>ee.value===v.value))==null?void 0:W.label)??"垂直对齐",de={selected({option:ee}){return p($,{icon:ee==null?void 0:ee.icon,class:"quickprint-is-self-center"},null)}};return p(K,{modelValue:v.value,"onUpdate:modelValue":ee=>v.value=ee,options:Gn,title:M,class:t.tool,width:"36px",size:"mini",button:!0},de)}case"alignLeft":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return p("button",{type:"button",title:"左侧对齐",class:M,onClick:w},[p($,{icon:"icon-layout-align-left",size:"16px"},null)])}case"alignCenter":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return p("button",{type:"button",title:"水平居中",class:M,onClick:_},[p($,{icon:"icon-layout-align-center",size:"16px"},null)])}case"alignRight":{const M={"quickprint-text-btn":!0,[t.tool]:!0};return p("button",{type:"button",title:"右侧对齐",class:M,onClick:R},[p($,{icon:"icon-layout-align-right",size:"16px"},null)])}case"useGrid":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.doc.useGrid};return p("button",{type:"button",title:"网格",class:M,onClick:e.toggleBackground},[p($,{icon:"icon-beijing",size:"16px"},null)])}case"elementPanel":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.state.panel.left};return p("button",{type:"button",title:"元素面板",class:M,onClick:e.toggleElementPanel},[p($,{icon:"icon-pintu",size:"16px"},null)])}case"configPanel":{const M={"quickprint-text-btn":!0,"quickprint-is-selected":e.state.panel.right};return p("button",{type:"button",title:"配置面板",class:M,onClick:e.toggleConfigPanel},[p($,{icon:"icon-config",size:"16px"},null)])}case"datasource":return p("button",{type:"button",class:"quickprint-text-btn",onClick:x},[p($,{icon:"icon-datasource"},null),p("span",null,[se("数据源")])]);case"document":return p("button",{type:"button",class:"quickprint-text-btn",onClick:q},[p($,{icon:"icon-file-text"},null),p("span",null,[se("文档配置")])]);default:return null}}return function(){return p("div",{class:t.toolbar,onMousedown:T},[n.toolbar.map(V)])}}}),hh="_toolbar_1bhq2_2",vh="_divider_1bhq2_8",bh="_tool_1bhq2_2",yh="_colorIcon_1bhq2_18",Eh="_colorIndicator_1bhq2_38",_h={toolbar:hh,divider:vh,tool:bh,colorIcon:yh,colorIndicator:Eh},Th={classes:_h},Sh=z(gh,[["__cssModules",Th]]);function wh(n){let e=null;const t=ue(),l=Me({width:0,height:0,scrollTop:0,scrollLeft:0}),s=ue(),o=Me({id:"",top:0,left:0,width:0,height:0});async function a(){await Vt();const E=t.value;E!=null&&(l.width=E.offsetWidth,l.height=E.offsetHeight)}function i(E){const v=E.target;l.scrollLeft=v.scrollLeft,l.scrollTop=v.scrollTop}function r(E){const c=E.target.closest("."+G.PAPER);c!=null&&(s.value=c,u(c),d())}async function d(){await Vt();const E=s.value;E!=null&&(o.id=E.id.slice(1),o.width=E.offsetWidth,o.height=E.offsetHeight,o.top=E.offsetTop,o.left=E.offsetLeft)}function u(E){E!=null&&(s.value&&(e==null||e.unobserve(s.value)),e==null||e.observe(E))}function m(){const E=n.doc.firstPage;if(E==null)return;const v=document.querySelector("#\\@"+E.id);s.value=v,e&&v&&e.observe(v),d()}function g(E){E.some(v=>v.target.matches("."+G.CANVAS))&&(a(),d()),E.some(v=>v.target.matches("."+G.PAPER))&&(a(),d())}return nl(()=>n.state.scale,()=>d()),tn(()=>{e=new ResizeObserver(g),e.observe(t.value),m(),a()}),fs(()=>{e==null||e.disconnect(),e=null}),{canvasRef:t,canvasRect:l,pageRect:o,onScroll:i,onSelectPage:r}}const Io=Object.freeze(["undo","redo","delete","---","fontFamily","fontSize","lineHeight","---","backgroundColor","highlightColor","fontColor","fontWeight","fontStyle","underline","throughLine","---","border","textAlign","verticalAlign","---","alignLeft","alignCenter","alignRight","---","useGrid","elementPanel","configPanel","---","datasource","document"]),kh=P({__name:"index",props:wt({modelValue:{type:he,required:!0},toolbar:{type:Array,default(){return Io}}},{modelValue:{required:!0},modelModifiers:{}}),emits:wt(["save","preview"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=ue(),s=ue(),o=Cs(),a=en(n,"modelValue"),i=cd(a,{queryElement:T,dispatchEvent:A}),{canvasRef:r,canvasRect:d,pageRect:u,onScroll:m,onSelectPage:g}=wh(i),E=N(()=>({"--quickprint-page-scale":i.state.scale/100,"--quickprint-dpr":o.value})),v=N(()=>{const L=i.doc.style;return{fontFamily:sl(L==null?void 0:L.fontFamily,L==null?void 0:L.enFontFamily),fontSize:L==null?void 0:L.fontSize,lineHeight:L==null?void 0:L.lineHeight}});function c(){i.state.panel.left=!1}function b(){i.state.panel.right=!1}function T(L){switch(L){case"ghost":return s.value;case"root":return l.value;default:return}}function A(L,...k){t(L,...k)}function C(L){L.deltaY>0?i.zoomIn():i.zoomOut()}return(L,k)=>(S(),I("div",{class:h(L.classes.designer),ref_key:"rootRef",ref:l,style:J(E.value)},[f("div",{class:h(L.classes.header)},[Xe(L.$slots,"headerLeft"),p(Sh,{class:h(L.classes.toolbar),toolbar:n.toolbar},null,8,["class","toolbar"]),Xe(L.$slots,"headerRight")],2),f("div",{class:h(L.classes.main)},[y(i).state.panel.left?(S(),I("div",{key:0,class:h(L.classes.left)},[f("button",{type:"button",onClick:c,class:h(["quickprint-text-btn",L.classes.closePanelBtn])},[p(y($),{icon:"icon-close",size:"12px"})],2),p(kp)],2)):H("",!0),f("div",{class:h([L.classes.center,y(G).CANVAS]),onWheel:oe(C,["ctrl","stop","prevent"]),ref_key:"canvasRef",ref:r},[p(Il,{canvas:y(d),page:y(u),scale:y(i).state.scale,direction:"horizontal"},null,8,["canvas","page","scale"]),p(Il,{canvas:y(d),page:y(u),scale:y(i).state.scale,direction:"vertical"},null,8,["canvas","page","scale"]),f("div",{class:h([y(G).SCROLLABLE,L.classes.canvas]),style:J(v.value),onScroll:k[0]||(k[0]=(...w)=>y(m)&&y(m)(...w)),onClickCapture:k[1]||(k[1]=(...w)=>y(g)&&y(g)(...w))},[(S(!0),I(Z,null,re(a.value.pages,w=>(S(),Q(mp,{key:w.id,doc:a.value,page:w},null,8,["doc","page"]))),128))],38),f("div",{class:h(L.classes.footer)},[p(Dp),p(y(ts),{scale:y(i).state.scale,onZoomIn:y(i).zoomIn,onZoomOut:y(i).zoomOut},null,8,["scale","onZoomIn","onZoomOut"])],2)],34),y(i).state.panel.right?(S(),I("div",{key:1,class:h(L.classes.right)},[f("button",{type:"button",onClick:b,class:h(["quickprint-text-btn",L.classes.closePanelBtn])},[p(y($),{icon:"icon-close",size:"12px"})],2),p(vg)],2)):H("",!0)],2),f("div",{ref_key:"ghostRef",ref:s,class:h(L.classes.ghost)},null,2),p(y(ns))],6))}}),Ch="_designer_grxxm_2",Rh="_header_grxxm_17",Nh="_toolbar_grxxm_25",Lh="_footer_grxxm_31",Ih="_main_grxxm_47",xh="_left_grxxm_55",Ah="_center_grxxm_63",qh="_right_grxxm_75",Dh="_canvas_grxxm_83",Oh="_closePanelBtn_grxxm_96",Mh="_ghost_grxxm_103",$h={designer:Ch,header:Rh,toolbar:Nh,footer:Lh,main:Ih,left:xh,center:Ah,right:qh,canvas:Dh,closePanelBtn:Oh,ghost:Mh},Ph={classes:$h},Vh=z(kh,[["__cssModules",Ph]]),Bh={default:{pinnable:!1},editor:{pinnable:!1,mask:!0,top:"15vh",width:"800px",height:"480px",resizeMode:fn.DISABLED,menus:[{label:"确定",handler:n=>n.dispatchConfirm().catch($e)}]},docDebug:{width:"1200px",height:"860px",menus:[{label:"保存",handler:n=>n.dispatchConfirm()}]},elementDebug:{width:"1200px",height:"860px",pinnable:!1},setting:{pinnable:!1,top:"15vh",width:"420px",height:"520px",resizeMode:fn.DISABLED},variable:{pinnable:!1,top:"15vh",width:"840px",height:"600px",mask:!0,resizeMode:fn.DISABLED}};function Fh(n,e={}){const t=ls(e.zIndexManager);n.use(os,{zIndex:t,presets:Bh}),ss(n._context)}const zh="0.0.0",Uh={version:zh,install:Fh},Hh=["onClick"],Gh=P({__name:"SwitchCase",emits:["switch"],setup(n,{emit:e}){const t=Ke();function l(s){t==null||t.confirm(s)}return(s,o)=>(S(),I("div",{class:h(s.classes.panel)},[(S(!0),I(Z,null,re(y(is),(a,i)=>(S(),I("div",{key:a.id,class:h(s.classes.item),onClick:r=>l(a)},[f("div",null,[f("span",null,Y(i+1)+". ",1),f("span",null,Y(a.name),1)])],10,Hh))),128))],2))}}),Wh="_panel_1he7q_2",Yh="_item_1he7q_9",Xh={panel:Wh,item:Yh},jh={classes:Xh},Zh=z(Gh,[["__cssModules",jh]]),Kh="local",Al="quickprint-local-define",Jh=P({__name:"index",setup(n){const e=Le("classes"),t=E(),l="20250831",s=[{label:"新建",icon:"icon-file-text",handler:u},{label:"加载示例",icon:"icon-import",handler:r},"---",...Io];function o(){const v=JSON.stringify(t.value);localStorage.setItem(Al,v)}function a(){o()}function i(){const v=t.value.id,c=v.startsWith("case_")?v:Kh,b=`${window.location.origin}/preview.html?id=${c}`;o(),Tt("文档预览",kt("iframe",{src:b,className:e.iframe}),{pinnable:!1,mask:!0,closeOnPressEsc:!0,width:Math.min(Math.max(1600,t.value.paperWidth+240),window.innerWidth-20)+"px",height:"calc(100vh - 100px)",menus:[{label:"从外部打开链接",handler(T){window.open(b,"_blank"),T.close()}}]})}function r(){const v={mask:!0,top:"15vh",width:"800px",height:"600px",resizeMode:fn.DISABLED};Tt("选择示例",kt(Zh),v).promisify().then(c=>d(c.id)).catch($e)}async function d(v){const c=await gl(v,!1);c!=null&&(rs(v),t.value=he.create(c.define),m())}function u(){const v=he.createNormalDocument();t.value=v,m()}function m(){document.title=t.value.name+" - OpenPrint(开发中...)"}async function g(){const v=localStorage.getItem(Al);if(v!=null)return he.create(v);const c=as(),b=await gl(c.id,!1);return b==null?he.createNormalDocument():he.create(b.define)}function E(){const v=ce();return g().then(c=>{v.value=c,m()}),v}return(v,c)=>y(t)?(S(),Q(y(Vh),{modelValue:y(t),"onUpdate:modelValue":c[0]||(c[0]=b=>Ge(t)?t.value=b:null),toolbar:s,class:h(y(e).main),key:y(t).id,onSave:a,onPreview:i},{headerLeft:ye(()=>[f("div",{class:h(y(e).logo)},[c[1]||(c[1]=f("h1",null,"OpenPrint",-1)),f("div",{class:h(y(e).dev)},"DEV_"+Y(y(l)),3)],2)]),headerRight:ye(()=>[f("div",{class:h(y(e).operate)},[f("button",{type:"button",class:"quickprint-text-btn",title:"预览",onClick:i},[p(y($),{icon:"icon-run"}),c[2]||(c[2]=f("span",null,"预览",-1))]),f("button",{type:"button",onClick:o,class:"quickprint-text-btn",title:"保存"},[p(y($),{icon:"icon-save"}),c[3]||(c[3]=f("span",null,"保存",-1))])],2)]),_:1},8,["modelValue","class"])):H("",!0)}}),Qh="_main_he2u6_2",ev="_iframe_he2u6_6",tv="_divider_he2u6_14",nv="_logo_he2u6_20",lv="_dev_he2u6_39",ov="_operate_he2u6_51",sv={main:Qh,iframe:ev,divider:tv,logo:nv,dev:lv,operate:ov},iv={classes:sv},rv=z(Jh,[["__cssModules",iv]]),xo=ps(rv);xo.use(Uh);xo.mount("#app");
