const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/component-B1YiyZOk.js","assets/vue-DBh96Ghl.js","assets/component-PO_-BFKc.js","assets/utils-BNf-qKKy.js","assets/utils-FAH5tsUN.css","assets/component-DVhZYvzc.css"])))=>i.map(i=>d[i]);
var Ps=Object.defineProperty;var gl=n=>{throw TypeError(n)};var Vs=(n,e,t)=>e in n?Ps(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var P=(n,e,t)=>Vs(n,typeof e!="symbol"?e+"":e,t),xn=(n,e,t)=>e.has(n)||gl("Cannot "+t);var _e=(n,e,t)=>(xn(n,e,"read from private field"),t?t.call(n):e.get(n)),Pe=(n,e,t)=>e.has(n)?gl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),rt=(n,e,t,l)=>(xn(n,e,"write to private field"),l?l.call(n,t):e.set(n,t),t),Ee=(n,e,t)=>(xn(n,e,"access private method"),t);import{D as ge,E as vt,N as Wt,a as ut,b as W,c as Le,P as Qn,d as jt,e as vl,f as bn,g as yn,O as Zt,h as ne,i as Pn,j as _n,L as Se,I as O,_ as D,k as Vl,s as kn,l as zs,m as se,n as Bs,B as J,o as Fs,S as el,p as tl,U as Hn,q as nl,F as Q,r as ft,V as Fe,t as En,u as We,v as ll,w as Ye,x as Oe,y as sl,z as zl,A as Bl,C as Fl,G as fe,H as Ul,T as Us,J as pe,R as ce,K as Qt,M as Ie,Q as Tt,Y as yt,W as Xe,X as Hs,Z as Gs,$ as Ws,a0 as Hl,a1 as ol,a2 as Ys,a3 as an,a4 as wt,a5 as Gn,a6 as pt,a7 as me,a8 as Xs,a9 as cn,aa as St,ab as mt,ac as je,ad as js,ae as _t,af as Lt,ag as Zs,ah as Ks,ai as Js,aj as Qs,ak as ke,al as Te,am as xt,an as bl,ao as yl,ap as Vn,aq as zn,ar as eo,as as to,at as no,au as lo,av as so,aw as oo,ax as _l,ay as io,az as ro}from"./utils-BNf-qKKy.js";import{r as Z,o as il,d as q,c as L,a as C,n as p,b as c,e as g,f as Ue,u as $e,s as re,g as qe,h as N,w as ee,i as b,j as K,k as H,T as Gl,l as Y,m as Et,p as en,t as B,F as U,q as j,v as Wl,x as Pt,y as El,z as Yl,A as Xl,B as ve,C as Ce,D as oe,E as ie,G as Vt,H as ao,I as jl,J as tn,K as rl,L as Bn,M as he,N as Je,O as co,P as uo,Q as fo,R as po,S as mo}from"./vue-DBh96Ghl.js";const Zl="@quickprint_drag_mode",Kl="@quickprint_drop_data",wn="@quickprint_operate",Qe="@quickprint_element",al="@quickprint_element_type",Jl="@quickprint_resize_flag",bt=160,Sn=32,Gt=[50,75,100,125,150,200,300,400];var Yt=(n=>(n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n))(Yt||{}),Ct=(n=>(n[n.NONE=0]="NONE",n[n.TOP=1]="TOP",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=4]="LEFT",n[n.RIGHT=8]="RIGHT",n[n.BOTTOM_RIGHT=10]="BOTTOM_RIGHT",n))(Ct||{});const et={SINGLE:0,MULTIPLE:1},we=Object.freeze({INSERT:0,MOVE:1}),cl=Object.freeze({DRAG_ELEMENT:0,SELECTION:1}),F=Object.freeze({CANVAS:"quickprint-is-canvas",DRAGGABLE:"quickprint-is-draggable",DRAGGING:"quickprint-is-dragging",RESIZEABLE:"quickprint-is-resizeable",RESIZEABLE_INDICATOR:"quickprint-is-resizeable-indicator",RESIZING:"quickprint-is-resizing",DROPPABLE:"quickprint-is-droppable",ELEMENT:"quickprint-is-element",ELEMENT_EDITOR:"quickprint-is-element-editor",PAGE:"quickprint-is-page",PAPER:"quickprint-is-paper",SCROLLABLE:"quickprint-is-scrollable",SELECTABLE:"quickprint-is-selectable",SELECTED:"quickprint-is-selected",GUIDE_LINE:"quickprint-is-guideline"}),de=Object.freeze({NONE:0,ELEMENT:1,PAGE:2}),Ql=[{label:"固定值",value:ge.CONST},{label:"变量",value:ge.VARIABLE},{label:"公式",value:ge.FORMULA,detail:"使用内置的公式生成数据"},{label:"自定义",value:ge.CODE,detail:"使用Javascript代码生成数据"}],ho=[{label:"显示",value:vt.VISIBLE,detail:"元素总是可见"},{label:"隐藏",value:vt.HIDDEN,detail:"元素在打印时隐藏"},{label:"满足条件时显示",value:vt.CONDITION,detail:"元素只在满足指定条件后显示"}],go=[{label:"四舍五入",value:Wt.ROUND},{label:"向下舍入",value:Wt.FLOOR},{label:"向上舍入",value:Wt.CEIL},{label:"四舍六入",value:Wt.BANKER_ROUND}],vo=[{label:"原始值",value:ut.NONE},{label:"固定位数",value:ut.FIXED},{label:"金额千位",value:ut.THOUSAND},{label:"金额万位",value:ut.TEN_THOUSAND},{label:"金额大写",value:ut.DAXIE},{label:"百分比",value:ut.PERCENTAGE}],bo=[{label:"显示",value:!0},{label:"隐藏",value:!1}],yo=[{label:"默认",value:void 0},{label:"文本",value:W.TEXT},{label:"数字",value:W.NUMBER},{label:"日期",value:W.DATE}],le={LAYOUT:0,COORD:1,SIZE:2,POSITION:3,VISIBILITY:5,OVERFLOW:6,PRINT_MODE:7,BASIC:100,PREFIX:101,SUFFIX:102,DISPLAY:103,ATTRIBUTES:200,DATASOURCE:300},es=[{label:"年-月",value:Le.YEAR_MONTH,detail:"示例：2024-12"},{label:"年月",value:Le.YEAR_MONTH_CHS,detail:"示例：2024年12月"},{label:"年-月-日",value:Le.YEAR_MONTH_DAY,detail:"示例：2024-12-01"},{label:"年月日",value:Le.YEAR_MONTH_DAY_CHS,detail:"示例：2024年12月01日"},{label:"年-月-日 时:分",value:Le.DATETIME_SHORT,detail:"示例：2024-12-01 12:00"},{label:"年-月-日 时:分:秒",value:Le.DATETIME,detail:"示例：2024-12-01 12:00:00"},{label:"时:分:秒",value:Le.TIME,detail:"示例：12:00:00"},{label:"时:分",value:Le.TIME_SHORT,detail:"示例：12:00"},{label:"年",value:Le.YEAR,detail:"示例：2024"},{label:"月",value:Le.MONTH,detail:"示例：12"},{label:"日",value:Le.DAY,detail:"示例：01"}];es.forEach(n=>n.detail=`模板：${n.value}
${n.detail}`);const _o=[{label:"元素值",value:Qn.ELEMENT_VALUR}],Eo=[{label:"基于纸张",value:jt.PAPER},{label:"基于内容",value:jt.CONTENT}],ts=[{label:"纵向",value:vl.PORTRAIT},{label:"横向",value:vl.LANDSCAPE}],To=[{label:"当前位置",value:bn.DEFAULT,detail:"元素按当前位置进行定位，参与分页。如果之前的元素尺寸变化，会进行相应调整"},{label:"固定位置",value:bn.FIXED,detail:"元素会在固定位置显示，不参与分页"}],ko=[{label:"单次打印",value:yn.ONCE,detail:"元素只打印一次"},{label:"每页打印",value:yn.EACH,detail:"元素将每页打印一次"}],wo=[{label:"按内容调整高度",value:Zt.AUTO,detail:"元素内容溢出时，将会根据内容自动调整元素高度"},{label:"隐藏溢出内容",value:Zt.HIDDEN,detail:"元素内容溢出时，内容将会被隐藏"},{label:"缩放内容",value:Zt.SCALE,detail:"元素内容溢出时，会对内容进行缩放，确保内容全部显示",disabled:!0}],Wn=[{label:"页码",value:Pn.PAGE_NUMBER,type:ne.NUMBER},{label:"总页数",value:Pn.PAGE_TOTAL,type:ne.NUMBER},{label:"行序号",value:Pn.ROW_INDEX,type:ne.NUMBER}],So=["[0.3.pageNumber]","'[0.3.pageNumber]/[0.3.pageTotal]'","'第[0.3.pageNumber]页/共[0.3.pageTotal]页'"];function ns(n,e){return e=="body"?document.body:e=="parent"?n.parentElement:n.closest("."+e)}function Co(n,e){const t=n.getBoundingClientRect(),l=e.getBoundingClientRect();return!(t.top>l.bottom||t.right<l.left||t.bottom<l.top||t.left>l.right)}function ls(n){return n.isSelected?n.type===W.PARAGRAPH?52:n.type===W.TABLE?32:20:20}function Ro(){const n=Z(window.devicePixelRatio),e=()=>n.value=window.devicePixelRatio,t=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return t.addEventListener("change",e),window.addEventListener("resize",e),il(()=>{t.removeEventListener("change",e),window.removeEventListener("resize",e)}),n}class Lo{constructor(e,t,l){P(this,"originalEvent");P(this,"target");P(this,"ghost");P(this,"container");P(this,"paths",[]);P(this,"dropTarget");P(this,"top",0);P(this,"left",0);P(this,"deltaX");P(this,"deltaY");P(this,"moved",!1);this.originalEvent=e,this.ghost=t,this.target=t,this.container=l;const s=t.getBoundingClientRect();this.deltaX=s.left-e.clientX,this.deltaY=s.top-e.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.ghost.setPointerCapture(this.originalEvent.pointerId)}}var qt,Ot,nt,ss,os,is;const gt=class gt extends _n{constructor(t={}){var l,s,o;super();Pe(this,nt);P(this,"context",null);P(this,"selector");P(this,"onDragStart");P(this,"scale");Pe(this,qt);Pe(this,Ot);this.selector={container:((l=t.selector)==null?void 0:l.container)??F.PAGE,element:((s=t.selector)==null?void 0:s.element)??F.DRAGGABLE,droppable:((o=t.selector)==null?void 0:o.droppable)??F.DROPPABLE},this.onDragStart=Ee(this,nt,ss).bind(this),this.scale=t.scale,rt(this,qt,Ee(this,nt,os).bind(this)),rt(this,Ot,Ee(this,nt,is).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){this.context!=null&&(window.removeEventListener("pointermove",_e(this,qt)),window.removeEventListener("pointerup",_e(this,Ot)),this.context=null)}};qt=new WeakMap,Ot=new WeakMap,nt=new WeakSet,ss=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.element);if(l==null)return Se.warn(gt.TAG_NAME,"未找到的可拖拽元素");const s=this.selector.container,o=ns(l,s);this.context=new Lo(t,l,o);const a=this.createEvent("before-dragstart",this.context);if(this.dispatch(a).defaultPrevented)return Se.warn(gt.TAG_NAME,"已取消拖拽");if(this.context.container==null)return Se.warn(gt.TAG_NAME,"未找到的拖拽元素的容器");this.context.init(this.normalizeScale());const r=this.createEvent("dragstart",this.context);if(this.dispatch(r).defaultPrevented)return Se.warn(gt.TAG_NAME,"已取消拖拽");t.stopPropagation(),t.preventDefault(),window.addEventListener("pointermove",_e(this,qt)),window.addEventListener("pointerup",_e(this,Ot))},os=function(t){const l=this.context;if(l==null)return;const s=l.container.getBoundingClientRect(),o=document.elementsFromPoint(t.clientX,t.clientY),a=Array.from(o).filter(i=>!(i===l.ghost||i===l.target||l.ghost.contains(i))),r=this.normalizeScale();l.originalEvent=t,l.paths=a,l.dropTarget=a.find(i=>i.matches("."+F.DROPPABLE)),l.top=(t.clientY+l.deltaY-s.top)/r,l.left=(t.clientX+l.deltaX-s.left)/r,!this.dispatch(this.createEvent("dragging",l)).defaultPrevented&&(l.ghost.style.top=l.top+"px",l.ghost.style.left=l.left+"px")},is=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const s=this.createEvent("dragend",l);this.dispatch(s).defaultPrevented||this.reset()},P(gt,"TAG_NAME","quickprint-draggable");let Yn=gt;const No=["title"],Io=q({__name:"HelpTitle",props:{title:{type:String,required:!0}},setup(n){return(e,t)=>(C(),L("span",{title:n.title,class:p(e.classes.help)},[c("span",null,[Ue(e.$slots,"default")]),g(O,{icon:"icon-question-circle"})],10,No))}}),$o="_help_1l6l8_2",Ao={help:$o},qo={classes:Ao},Oo=D(Io,[["__cssModules",qo]]),Mo=q({__name:"Popover",props:{width:{type:Number,default:null}},emits:["show","close"],setup(n,{expose:e,emit:t}){const l=n,s=t,o=$e("classes"),a=Z(!1),r=re(),i=re(),u=qe({minWidth:0,top:0,left:0,visible:!1}),m=N(()=>({minWidth:l.width==null?u.minWidth+"px":l.width+"px",top:u.top+"px",left:u.left+"px",visibility:u.visible?"visible":"hidden",zIndex:Vl()}));async function d(){if(a.value)return h();a.value=!0,s("show"),await kn(),I()}function h(){M(),a.value=!1,s("close")}function v(E){if(!(E.target instanceof Node))return;const k=r.value;if(k&&k.contains(E.target))return E.preventDefault();const _=i.value;if(_&&_.contains(E.target))return E.preventDefault();h()}function y(){const E=r.value,k=i.value;if(k==null||E==null)return;const _=E.getBoundingClientRect(),T=k.getBoundingClientRect(),w=l.width==null?_.width:l.width;let R=_.bottom+1;R+T.height>window.innerHeight&&_.top>T.height&&(R=_.top-T.height-1);let $=_.left;$+T.width>window.innerWidth&&($=window.innerWidth-T.width-2),u.minWidth=w,u.top=R,u.left=$,u.visible=!0}function f(E){const k=E.target;if(!(k instanceof HTMLElement))return;const _=r.value;_==null||!k.contains(_)||h()}function S(E){if(E.key!=="Escape")return;const k=i.value;if(k!=null){const _=k.style.zIndex;if(Number(_)<zs())return}E.preventDefault(),h()}function I(){window.addEventListener("click",v,{capture:!0}),window.addEventListener("contextmenu",h,{capture:!0}),window.addEventListener("scroll",f,{capture:!0,passive:!0}),window.addEventListener("resize",y),window.addEventListener("keydown",S)}function M(){window.removeEventListener("click",v,!0),window.removeEventListener("contextmenu",h,!0),window.removeEventListener("scroll",f,!0),window.removeEventListener("resize",y),window.removeEventListener("keydown",S)}return e({close:h}),(E,k)=>(C(),L("div",{class:p(b(o).reference),onClick:ee(d,["stop"]),ref_key:"referenceRef",ref:r,tabindex:"0"},[Ue(E.$slots,"default"),a.value?(C(),K(Gl,{key:0,to:"body"},[c("div",{class:p(b(o).popover),onVnodeMounted:y,onMousedown:k[0]||(k[0]=ee(()=>{},["prevent"])),style:Y(m.value),ref_key:"popoverRef",ref:i},[Ue(E.$slots,"popover")],38)])):H("",!0)],2))}}),Do="_reference_1arli_2",xo="_popover_1arli_7",Po={reference:Do,popover:xo},Vo={classes:Po},rs=D(Mo,[["__cssModules",Vo]]),zo=["title","onKeydown"],Bo=["onMouseover","onClick"],Fo=q({__name:"Select",props:Et({modelValue:{type:[String,Number,Array]},options:{type:Array,default(){return[]}},size:{type:String,default:"default"},button:{type:Boolean,default:!1},width:{type:String,default:"100%"},popoverWidth:{type:Number,default:null},placeholder:{type:String,default:"请选择"},title:{type:String,default:null},border:{type:String,default:"auto"},appearance:{type:String,default:"auto"},clearable:{type:Boolean,default:!1},teleport:{type:String,default:"body"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:Et(["select","update:modelValue"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=n,s=$e("classes"),o=re(),a=re(),r=en(n,"modelValue"),i=Z(),u=Z(!1),m=qe({width:0,top:0,left:0,visible:!1,scrollable:!1}),d=N(()=>l.teleport==="none"),h=N(()=>l.teleport=="none"?"body":l.teleport),v=N(()=>{const A={label:"",options:[]},x=[A];for(const z of l.options){if(Array.isArray(z.options)){x.push({label:z.label,options:z.options});continue}A.options.push(z)}return x}),y=N(()=>v.value.reduce((A,x)=>A.concat(x.options),[])),f=N(()=>{if(l.multiple!==!0){const x=Mn();return x?x.label:l.button?l.title:se(l.modelValue)?l.placeholder:l.modelValue}const A=Dn();return A.length>0?A.map(x=>x.label).join(","):l.button?l.title:l.placeholder}),S=N(()=>l.clearable!==!0?!1:l.modelValue!=null),I=N(()=>({"quickprint-form-control":!0,"quickprint-form-control-small":l.size==="small"||l.button,"quickprint-form-hidden-border":l.button||l.border==="none","quickprint-form-disabled":l.disabled,[s.mini]:l.size==="mini",[s.select]:!0,[s.appearance]:l.appearance!=="none"&&!S.value,[s.button]:l.button,[s.showClearIcon]:S.value,[s.text]:l.size==="text"})),M=N(()=>({width:l.width})),E=N(()=>m.visible?{width:l.popoverWidth==null?m.width+"px":l.popoverWidth+"px",top:m.top+"px",left:m.left+"px",visibility:"visible",zIndex:Vl()}:{minWidth:l.popoverWidth==null?m.width+"px":l.popoverWidth+"px",visibility:"hidden"}),k=N(()=>({[s.content]:!0,[s.placeholder]:Bs(l.modelValue)}));async function _(){if(l.disabled)return;const A=y.value;if(A.length===0)return;if(u.value)return T();const x=o.value;x!=null&&(m.width=x.getBoundingClientRect().width,m.visible=!1,i.value=A.find(z=>z.value===l.modelValue),u.value=!0,await kn(),Ds())}function T(){xs(),u.value=!1}function w(A){V(),it()}function R(A){A.disabled!==!0&&(i.value=A)}function $(A){if(l.disabled==!0||A.disabled===!0)return;if(l.multiple!==!0){r.value=A.value,t("select",A),T();return}const x=Array.isArray(r.value)?r.value:[],z=x.findIndex(ae=>ae===A.value);z>=0?x.splice(z,1):x.push(A.value),r.value=x,t("select",x)}function G(A){if(!(A.target instanceof Node))return;const x=o.value;if(x&&x.contains(A.target))return A.preventDefault();const z=a.value;if(z&&z.contains(A.target))return A.preventDefault();T()}async function V(){const A=o.value,x=a.value;if(x==null||A==null)return;await Pt();const z=A.getBoundingClientRect(),ae=x.getBoundingClientRect();let ue=z.bottom+1;ue+ae.height>window.innerHeight&&z.top>ae.height&&(ue=z.top-ae.height-1);let kt=z.left;kt+ae.width>window.innerWidth&&(kt=window.innerWidth-ae.width-2),m.width=ae.width,m.top=ue,m.left=kt,m.visible=!0;const Ht=x.querySelector("."+s.list);m.scrollable=Ht?Ht.scrollHeight>Ht.clientHeight:!1}function te(A){const x=A.target;if(!(x instanceof HTMLElement))return;const z=o.value;z==null||!x.contains(z)||T()}function De(){const A=y.value,x=El(i.value);if(x==null){i.value=Ut(0),it();return}const z=A.indexOf(x);if(z==0)return Ft();const ae=Ut(z-1);ae!=null&&(i.value=ae,it())}function st(){const A=y.value,x=El(i.value);if(x==null){i.value=xe(0),it();return}const z=A.indexOf(x);if(z>=A.length-1){Bt();return}const ae=Ut(z+1);ae!=null&&(i.value=ae,it())}function Bt(){i.value=xe(0),it()}function Ft(){const A=y.value;i.value=Ut(A.length-1),it()}function ot(){r.value=void 0,T()}function xe(A){const z=y.value[A];return z==null?null:z.disabled===!0?xe(A+1):z}function Ut(A){const z=y.value[A];return z==null?null:z.disabled===!0?Ut(A-1):z}function hl(A){switch(A.key){case"Enter":A.preventDefault(),i.value&&$(i.value);return;case"Escape":A.preventDefault(),T();return;case"ArrowUp":A.preventDefault(),De();return;case"ArrowDown":A.preventDefault(),st();return;case"Home":A.preventDefault(),Bt();return;case"End":A.preventDefault(),Ft();return}}function Os(A){if(l.disabled)return;const x=o.value;x!=null&&document.activeElement===x&&(u.value||(A.stopPropagation(),_()))}function Ms(A){if(l.multiple!==!0)return l.modelValue===A.value;const x=l.modelValue;return Array.isArray(x)?x.includes(A.value):!1}async function it(){if(i.value==null)return;await Pt();const A=a.value;if(A==null)return;const x=A.querySelector("."+s.hover);x&&x.scrollIntoView({block:"nearest"})}function Mn(){const A=y.value,x=Array.isArray(l.modelValue)?l.modelValue[0]:l.modelValue;return A.find(z=>z.value===x)}function Dn(){const A=y.value;return(Array.isArray(l.modelValue)?l.modelValue:[l.modelValue]).filter(z=>z).map(z=>{const ae=A.find(ue=>ue.value===z);return ae||{value:z,label:z}})}function Ds(){window.addEventListener("mousedown",G,{capture:!0}),window.addEventListener("pointerdown",G,{capture:!0}),window.addEventListener("contextmenu",T,{capture:!0}),window.addEventListener("scroll",te,{capture:!0,passive:!0}),window.addEventListener("resize",V),window.addEventListener("keydown",hl)}function xs(){window.removeEventListener("mousedown",G,!0),window.removeEventListener("pointerdown",G,!0),window.removeEventListener("contextmenu",T,!0),window.removeEventListener("scroll",te,!0),window.removeEventListener("resize",V),window.removeEventListener("keydown",hl)}return(A,x)=>{var z;return C(),L("div",{class:p(I.value),title:n.title,style:Y(M.value),onClick:ee(_,["stop"]),onKeydown:Wl(ee(Os,["prevent"]),["enter"]),ref_key:"selectRef",ref:o,tabindex:"0"},[A.$slots.selected?Ue(A.$slots,"selected",{key:0,option:Mn(),options:Dn()}):Ue(A.$slots,"option",{key:1,option:Mn(),options:Dn()},()=>[c("div",{class:p(k.value)},[c("span",null,B(f.value),1),S.value?(C(),K(O,{key:0,icon:"icon-close",onClick:ee(ot,["stop"]),size:"12px",class:p(b(s).clearIcon)},null,8,["class"])):H("",!0)],2)]),u.value?(C(),K(Gl,{key:2,to:h.value,disabled:d.value},[c("div",{class:p(b(s).popover),onClick:x[0]||(x[0]=ee(()=>{},["stop"])),onVnodeMounted:w,onMousedown:x[1]||(x[1]=ee(()=>{},["prevent"])),style:Y(E.value),ref_key:"popoverRef",ref:a},[c("div",{class:p(b(s).list)},[(C(!0),L(U,null,j(v.value,ae=>(C(),L(U,null,[ae.label?(C(),L("div",{key:0,class:p(b(s).groupLabel)},B(ae.label),3)):H("",!0),(C(!0),L(U,null,j(ae.options,ue=>{var kt;return C(),L("div",{key:ue.value,class:p({[b(s).option]:!0,[b(s).disabled]:ue.disabled===!0,[b(s).selected]:Ms(ue),[b(s).hover]:((kt=i.value)==null?void 0:kt.value)==ue.value}),style:Y(ue.style),onMouseover:Ht=>R(ue),onClick:Ht=>$(ue)},[Ue(A.$slots,"option",{option:ue},()=>[c("div",{class:p(b(s).label)},[ue.icon?(C(),K(O,{key:0,icon:ue.icon,class:p(b(s).icon)},null,8,["icon","class"])):H("",!0),c("span",null,B(ue.label),1)],2),ue.short?(C(),L("div",{key:0,class:p(b(s).short)},B(ue.short),3)):H("",!0)])],46,Bo)}),128))],64))),256))],2),(z=i.value)!=null&&z.detail&&m.visible?(C(),L("div",{key:0,class:p(b(s).detail)},B(i.value.detail),3)):H("",!0)],38)],8,["to","disabled"])):H("",!0)],46,zo)}}}),Uo="_button_1h82x_2",Ho="_select_1h82x_7",Go="_appearance_1h82x_16",Wo="_content_1h82x_31",Yo="_placeholder_1h82x_37",Xo="_popover_1h82x_41",jo="_list_1h82x_51",Zo="_option_1h82x_80",Ko="_label_1h82x_95",Jo="_icon_1h82x_100",Qo="_hover_1h82x_104",ei="_detail_1h82x_115",ti="_short_1h82x_125",ni="_selected_1h82x_131",li="_disabled_1h82x_135",si="_showClearIcon_1h82x_140",oi="_clearIcon_1h82x_144",ii="_text_1h82x_157",ri="_mini_1h82x_169",ai="_groupLabel_1h82x_181",ci={button:Uo,select:Ho,appearance:Go,content:Wo,placeholder:Yo,popover:Xo,list:jo,option:Zo,label:Ko,icon:Jo,hover:Qo,detail:ei,short:ti,selected:ni,disabled:li,showClearIcon:si,clearIcon:oi,text:ii,mini:ri,groupLabel:ai},ui={classes:ci},X=D(Fo,[["__cssModules",ui]]),di="_tree_1p28f_1",fi="_node_1p28f_5",pi="_content_1p28f_11",mi="_space_1p28f_27",hi="_expand_1p28f_28",gi="_active_1p28f_47",vi="_children_1p28f_55",He={tree:di,node:fi,content:pi,space:mi,expand:hi,active:gi,children:vi},as=Symbol(),cs=q({emits:["nodeClick","nodeHover"],props:{node:{type:Object,required:!0}},setup(n,{emit:e}){const t=Yl(as),l=N(()=>Array.isArray(n.node.children)&&n.node.children.length>0),s=N({get(){const f=t==null?void 0:t.state[n.node.value];return f==null?!1:f.expand},set(f){const S=t==null?void 0:t.state[n.node.value];S!=null&&(S.expand=f)}});function o(f){f.preventDefault(),s.value=!s.value}function a(){if(!l.value)return g("div",{class:He.space},null);const f={[He.expand]:!0,[He.active]:s.value};return g("div",{onMousedown:y,onClick:o,class:f},[g(O,{icon:"icon-right",size:"12px"},null)])}function r(){return typeof(t==null?void 0:t.content)=="function"?t.content({node:n.node}):g("span",null,[n.node.label])}function i(){return g("div",{class:He.content,onClick:m,onMouseenter:h},[r()])}function u(){if(!l.value||!s.value)return;const f=n.node.children.map(S=>g(cs,{node:S,onNodeClick:d,onNodeHover:v},null));return g("div",{class:He.children},[f])}function m(){e("nodeClick",n.node)}function d(f){e("nodeClick",f)}function h(){e("nodeHover",n.node)}function v(f){e("nodeHover",f)}function y(f){f.preventDefault()}return function(){return g("div",{class:He.subTree},[g("div",{class:He.node},[a(),i()]),u()])}}}),bi=q({props:{data:{type:Array,required:!0}},emits:["nodeClick","nodeHover"],setup(n,{slots:e,emit:t}){const l=a();function s(i){t("nodeClick",i)}function o(i){t("nodeHover",i)}function a(){const i=qe({}),u=function(m,d){for(const h of m)d[h.value]={expand:h.expand!==!1},h.children&&u(h.children,d)};return u(n.data,i),i}function r(i){return typeof e.default=="function"?e.default(i):null}return Xl(as,{state:l,content:r}),function(){const i=n.data.map(u=>g(cs,{node:u,onNodeClick:s,onNodeHover:o},null));return g("div",{class:He.tree},[i])}}});function yi(n,e=0){let t=null;return function(...l){t&&clearTimeout(t),t=window.setTimeout(()=>{n.apply(this,l),t=null},e)}}function _i(n,e=0){let t=0,l=null;return function(...s){const o=Date.now();if(o-t<e){l&&clearTimeout(l),l=window.setTimeout(()=>{l=null,n.apply(this,s),t=Date.now()},e);return}l&&clearTimeout(l),n.apply(this,s),t=o}}function ul(n,e){const t=[];if(e&&e!=Q.DEFAULT&&t.push(`"${e}"`),n&&n!==Q.DEFAULT&&t.push(`"${n}"`),t.length!=0)return t.join(",")}function us(n){if(n.underline===!0)return{textDecorationLine:"underline",textDecorationStyle:n.underlineStyle,textDecorationColor:n.underlineColor}}function Ei(n,e={}){const t={},l=n.style??{},s=ul(l.fontFamily,l.enFontFamily);s&&(t.fontFamily=s);const o=us(l);return o&&ft(t,o),l.fontSize&&(t.fontSize=l.fontSize),l.fontWeight&&(t.fontWeight=l.fontWeight),l.color&&(t.color=l.color),Ti("border",e)&&l.border&&ft(t,Xn(n)),l.lineHeight&&(t.lineHeight=l.lineHeight),l.highlightColor&&(t["--quickprint-variable-highlight-color"]=l.highlightColor),l.backgroundColor&&(t.backgroundColor=l.backgroundColor),l.fontStyle&&(t.fontStyle=l.fontStyle),l.textIndent&&(t.textIndent=l.textIndent),l.padding&&ft(t,Si(n)),ft(t,ki(n)),ft(t,wi(n)),t}function Ti(n,e){return e.exclude==null?!0:!e.exclude.includes(n)}function ki(n){if(n==null)return{};const e=n.style??{},t={};return e.textAlign&&(t.textAlign=e.textAlign),e.textAlignLast&&(t.textAlignLast=e.textAlignLast),t}function wi(n){if(n==null)return{};const e=n.style??{};return e.verticalAlign==Fe.MIDDLE||e.verticalAlign==null?{display:"flex",alignItems:"center"}:e.verticalAlign==Fe.BOTTOM?{display:"flex",alignItems:"end"}:{}}function Si(n){if(n==null)return{};const e=n.style??{};if(e.padding==null)return{};const t={};return e.padding.top&&(t.paddingTop=e.padding.top),e.padding.right&&(t.paddingRight=e.padding.right),e.padding.bottom&&(t.paddingBottom=e.padding.bottom),e.padding.left&&(t.paddingLeft=e.padding.left),t}function Xn(n){if(n==null)return{};const e=n.style??{};if(e.border==null||e.border===J.NONE)return{};const t={},l=e.borderWidth??1,s=e.borderStyle??Fs.SOLID,o=e.borderColor??el.BLACK;return e.border==J.ALL?{borderTop:`${l}px ${s} ${o}`,borderRight:`${l}px ${s} ${o}`,borderBottom:`${l}px ${s} ${o}`,borderLeft:`${l}px ${s} ${o}`}:(e.border&J.TOP&&(t.borderTop=`${l}px ${s} ${o}`),e.border&J.RIGHT&&(t.borderRight=`${l}px ${s} ${o}`),e.border&J.BOTTOM&&(t.borderBottom=`${l}px ${s} ${o}`),e.border&J.LEFT&&(t.borderLeft=`${l}px ${s} ${o}`),t)}const ht={SPACE:" ",has(n,e){return typeof n!="string"?!1:n.split(ht.SPACE).includes(e)},push(n,e){if(typeof n!="string")return e;const t=n.split(ht.SPACE).filter(s=>tl(s));return t.indexOf(e)>=0?n:(t.push(e),t.join(ht.SPACE))},remove(n,e){if(typeof n!="string"||n=="")return n;const t=n.split(ht.SPACE),l=t.indexOf(e);return l<0?n:(t.splice(l,1),t.join(ht.SPACE))}};function Be(n){if(se(n))return{num:null,unit:null};const e=n.match(/^(-?\d+(?:\.\d+)?)(px|pt|mm|em)?$/);if(e==null)return{num:null,unit:null};const t=Number(e[1]),l=nl(t)?t:null,s=se(e[2])?null:e[2];return{num:l,unit:s}}function Tl(n){if(n==null)return null;if(typeof n=="number")return n;if(typeof n!="string")return null;const e=Be(n);if(e.num==null)return null;switch(e.unit){case"px":return e.num;case"pt":return Hn.pt_to_px(e.num);case"mm":return Hn.mm_to_px(e.num);default:return null}}function dl(n,e){const t=n.ds;if(t!=null)return t.type===ge.FORMULA?{type:t.type,content:fl(t.value,n.doc)}:t.type===ge.VARIABLE?{type:t.type,content:tt(t.value,e)}:{type:t.type,content:t.value}}function tt(n,e){var h,v,y;if(se(n))return n;const t=ll(n),l=t.path;if(l==null||l=="")return;const s=l.split(".");if(s.length==0)return l;const o=s[0];if(t.varType===Ye.BUILTIN)return((h=Wn.find(f=>f.value===o))==null?void 0:h.label)??o;if(t.varType===Ye.SPECIAL)return((v=_o.find(f=>f.value===o))==null?void 0:v.label)??o;if(e==null)return l;const r=(e.fields??[]).find(f=>f.name===o);if(r==null)return l;const i=s[1],u=se(r.title)?r.name:r.title;if(i==null)return u;const m=(y=r.children)==null?void 0:y.find(f=>f.name===i);if(m==null)return`${u}.${i}`;const d=se(m.title)?m.name:m.title;return`${u}.${d}`}function fl(n,e){return se(n)?void 0:En.tokenize(n).map(s=>s.type===We.VARIABLE?`[${tt(s.value,e==null?void 0:e.ds)}]`:s.type===We.REFERENCE?`[${ds(s.value,e)}]`:s.type===We.TEMPLATE?(Array.isArray(s.value)?s.value:[s.value]).map(a=>a.type===We.VARIABLE?`[${tt(a.value,e==null?void 0:e.ds)}]`:a.value).join(""):En.formatTokenValue(s)).join("")}function ds(n,e){if(e){const t=e.findElement(n);if(t&&t.title)return"="+t.title}return"="+n}function Ci(n){switch(ll(n).dataType){case ne.OBJECT:return"对象";case ne.ARRAY:return"数组";case ne.STRING:return"文本";case ne.NUMBER:return"数字";case ne.DATE:return"日期";default:return"未知类型"}}function Ri(n){var e;return((e=Ql.find(t=>t.value===n))==null?void 0:e.label)??n}const Li=["onClick"],Ni=q({__name:"WindowHeader",props:{modelValue:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=Oe(),l=e;function s(a){l("update:modelValue",a.value)}function o(){if(t==null)return null;const a=t.useMenus();return((a==null?void 0:a.value)??[]).map(i=>sl.renderMenu(t,i))}return(a,r)=>(C(),L("div",{class:p(a.classes.header)},[c("div",{class:p(a.classes.headerLeft)},[Ue(a.$slots,"prefix"),c("div",{class:p(a.classes.tabs)},[(C(!0),L(U,null,j(n.tabs,i=>(C(),L("div",{key:i.value,class:p({[a.classes.tab]:!0,[a.classes.active]:n.modelValue===i.value}),onClick:u=>s(i),onPointerdown:r[0]||(r[0]=ee(()=>{},["stop","prevent"]))},[c("span",null,B(i.label),1)],42,Li))),128))],2)],2),g(o)],2))}}),Ii="_header_1o09p_2",$i="_headerLeft_1o09p_14",Ai="_tabs_1o09p_27",qi="_tab_1o09p_27",Oi="_active_1o09p_69",Mi={header:Ii,headerLeft:$i,tabs:Ai,tab:qi,active:Oi},Di={classes:Mi},fs=D(Ni,[["__cssModules",Di]]),Cn=zl(()=>Bl(()=>import("./component-B1YiyZOk.js"),__vite__mapDeps([0,1]))),xi=["onClick","onMouseenter"],Pi=q({__name:"Builtin",emits:["select"],setup(n,{emit:e}){const t=e,l=Z(Wn[0].value),s=N(()=>`builtin_${Fl(l.value,"_").toLowerCase()}`);function o(r){t("select",r)}function a(r){l.value=r.value}return(r,i)=>(C(),L("div",{class:p(r.classes.builtin)},[c("div",{class:p(["quickprint-is-scrollable",r.classes.panel])},[(C(!0),L(U,null,j(b(Wn),u=>(C(),L("div",{class:p({[r.classes.param]:!0,[r.classes.active]:u.value===l.value}),onClick:m=>o(u),onMouseenter:m=>a(u)},[c("strong",null,B(u.label),1),c("span",null,B(u.value),1)],42,xi))),256))],2),c("div",{class:p(["quickprint-is-scrollable",r.classes.desc])},[g(b(Cn),{name:s.value},null,8,["name"])],2)],2))}}),Vi="_builtin_m1n0z_2",zi="_panel_m1n0z_11",Bi="_desc_m1n0z_17",Fi="_param_m1n0z_24",Ui="_active_m1n0z_34",Hi={builtin:Vi,panel:zi,desc:Bi,param:Fi,active:Ui},Gi={classes:Hi},Wi=D(Pi,[["__cssModules",Gi]]),kl=[{label:"文本",value:ne.STRING},{label:"数字",value:ne.NUMBER},{label:"日期",value:ne.DATE},{label:"对象",value:ne.OBJECT},{label:"数组",value:ne.ARRAY}],Yi=q({emit:["select"],props:{doc:{type:fe,required:!0},readonly:{type:Boolean,default:!1}},setup(n,{expose:e,emit:t}){const l=$e("classes"),s=Oe(),o=i(),a=r();function r(){const S=[{name:"$index"},{name:"$expand"},{name:"type",title:"类型",width:110,render(I,M,E){var k;if(n.readonly){const _=I[M.name],T=((k=kl.find(w=>w.value===_))==null?void 0:k.label)??_;return g("div",{class:E.classes.cell},[T])}return g("div",{class:E.classes.cell},[g(X,{options:kl,modelValue:I.type,"onUpdate:modelValue":v.bind(null,I),size:"small"},null)])}},{name:"name",title:"名称",width:180,render(I,M,E){return n.readonly?g("div",{class:E.classes.cell},[I[M.name]]):g("div",{class:E.classes.cell},[ve(g("input",{"onUpdate:modelValue":k=>I.name=k,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[必填] 请输入"},null),[[Ce,I.name]])])}},{name:"title",title:"标题",width:180,render(I,M,E){return n.readonly?g("div",{class:E.classes.cell},[I[M.name]]):g("div",{class:E.classes.cell},[ve(g("input",{"onUpdate:modelValue":k=>I.title=k,type:"text",class:"quickprint-form-control quickprint-form-control-small",placeholder:"[可选] 请输入"},null),[[Ce,I.title]])])}}];return n.readonly!==!0&&S.push({name:"operate",title:"操作",width:200,render(I,M,E){const k=[g("button",{type:"button",class:"quickprint-text-btn",onClick:m.bind(null,I,E.parent)},[g(O,{icon:"icon-subnode"},null),g("span",null,[oe("插入行")])])];return(I.type===ne.ARRAY||I.type===ne.OBJECT)&&k.push(g("button",{type:"button",class:"quickprint-text-btn",onClick:h.bind(null,I)},[g(O,{icon:"icon-sisternode"},null),g("span",null,[oe("插入子级")])])),k.push(g("button",{type:"button",class:"quickprint-text-btn",onClick:d.bind(null,I,E.parent)},[g(O,{icon:"icon-delete"},null),g("span",null,[oe("删除")])])),k}}),S}function i(){const S=Ul(n.doc.ds.fields??[]).map(M=>{const E=M.type;return{...M,$expand:E===ne.ARRAY||E===ne.OBJECT}}),I=Z(S);return I.value.length==0&&I.value.push(u()),I}function u(){return{type:ne.STRING,name:"",title:""}}function m(S,I){if(I){const E=I.children??[],k=E.indexOf(S);k>=0&&E.splice(k+1,0,u());return}const M=o.value.indexOf(S);M>=0&&o.value.splice(M+1,0,u())}function d(S,I){if(I){const E=I.children??[],k=E.indexOf(S);k>=0&&E.splice(k,1);return}const M=o.value.indexOf(S);M>=0&&o.value.splice(M,1),o.value.length==0&&o.value.push(u())}function h(S){S.type!==ne.ARRAY&&S.type!==ne.OBJECT||(S.children==null&&(S.children=[]),S.children.push(u()))}function v(S,I){S.type=I,I===ne.ARRAY||I===ne.OBJECT?S.$expand=!0:S.children=void 0}function y(){return{fields:o.value.map(I=>se(I.name)?null:I.type!==ne.ARRAY&&I.type!==ne.OBJECT?{type:I.type,name:I.name,title:I.title}:{type:I.type,name:I.name,title:I.title,children:(I.children??[]).map(M=>se(I.name)?null:{type:M.type,name:M.name,title:M.title}).filter(M=>M!=null)}).filter(I=>I!=null)}}function f(S,I){n.readonly===!0&&t("select",S,I)}return s==null||s.useHandle("confirm",y),e({submit:y}),function(){return g("div",{class:l.datasource},[g(Us,{columns:a,data:o.value,onSelect:f},null)])}}}),Xi="_datasource_xlc8o_2",ji={datasource:Xi},Zi={classes:ji},ps=D(Yi,[["__cssModules",Zi]]),Ki={class:"quickprint-config-group"},Ji={class:"quickprint-config-section quickprint-config-inline"},Qi={class:"quickprint-config-content"},er={class:"quickprint-config-section quickprint-config-inline"},tr={class:"quickprint-config-content"},nr={class:"quickprint-config-id"},lr={class:"quickprint-config-section quickprint-config-inline"},sr={class:"quickprint-config-content"},or={class:"quickprint-config-group"},ir={class:"quickprint-config-group-title"},rr=q({__name:"Detail",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=N(()=>{var l,s;return(s=dl(e.element,(l=e.element.doc)==null?void 0:l.ds))==null?void 0:s.content});return(l,s)=>(C(),L("div",{class:p(l.classes.detail)},[c("div",Ki,[c("section",Ji,[s[0]||(s[0]=c("header",{class:"quickprint-config-header"},"类型",-1)),c("div",Qi,B(b(Jt)(n.element.type)),1)]),c("section",er,[s[1]||(s[1]=c("header",{class:"quickprint-config-header"},"标识",-1)),c("div",tr,[c("span",nr,B(n.element.id),1)])]),c("section",lr,[s[2]||(s[2]=c("header",{class:"quickprint-config-header"},"标题",-1)),c("div",sr,B(n.element.title),1)])]),c("div",or,[c("div",ir,[s[3]||(s[3]=c("span",null,"数据",-1)),c("span",{class:p(l.classes.type)},B(b(Ri)(n.element.ds.type)),3)]),c("div",null,B(t.value),1)])],2))}}),ar="_detail_11ox4_2",cr="_type_11ox4_10",ur={detail:ar,type:cr},dr={classes:ur},fr=D(rr,[["__cssModules",dr]]),pr=q({__name:"index",props:{doc:{type:fe,required:!0}},emits:["select"],setup(n,{emit:e}){const t=e,l=n,s=r(),o=Z();function a(h){return h.reduce((v,y)=>{const f=Array.isArray(y.children)?a(y.children):[];if(tl(y.ds.value)||f.length>0){const S={value:y.id,label:y.title??y.id,data:y,children:f};return v.push(S),v}return v},[])}function r(){const h=l.doc.pages.reduce((y,f)=>y.concat(f.children),[]),v=a(h);return Z(v)}function i(h){o.value=h}function u(h){return h.title?h.title:Jt(h.type)}function m(h){return od(h.type)??"icon-zhanweifu"}function d(h){t("select",h.data)}return(h,v)=>(C(),L("div",{class:p(h.classes.reference)},[c("div",{class:p([h.classes.panel,"quickprint-is-scrollable"])},[g(b(bi),{data:b(s),onNodeHover:i,onNodeClick:d},{default:ie(({node:y})=>[g(b(O),{icon:m(y.data)},null,8,["icon"]),c("span",{class:p(h.classes.title)},B(u(y.data)),3),c("span",{class:p(h.classes.id)},"<"+B(y.value)+">",3)]),_:1},8,["data"])],2),c("div",{class:p([h.classes.detail,"quickprint-is-scrollable"])},[o.value?(C(),K(fr,{element:o.value.data,key:o.value.value},null,8,["element"])):H("",!0)],2)],2))}}),mr="_reference_1ekkx_2",hr="_panel_1ekkx_12",gr="_detail_1ekkx_20",vr="_title_1ekkx_25",br="_id_1ekkx_29",yr={reference:mr,panel:hr,detail:gr,title:vr,id:br},_r={classes:yr},Er=D(pr,[["__cssModules",_r]]),Tr=q({__name:"index",props:{doc:{type:fe,required:!0},value:{type:String,default:null},include:{type:Array,default(){return["ds","builtin"]}}},setup(n){const e=n,t=[{label:"数据源",value:"ds"},{label:"内置变量",value:"builtin"},{label:"引用组件",value:"reference"}],l=Oe(),s=Z(m()),o=N(()=>t.filter(d=>e.include.includes(d.value)));function a(d,h){return d==null?null:h==null?`${Ye.DS}.${d.type}.${d.name}`:`${Ye.DS}.${d.type}.${h.name}.${d.name}`}function r(d,h){l==null||l.confirm({type:"ds",value:a(d,h),parent:h})}function i(d){l==null||l.confirm({type:"builtin",value:`${Ye.BUILTIN}.${d.type}.${d.value}`})}function u(d){l==null||l.confirm({type:"reference",value:d.id})}function m(){const d=e.value;return d==null||d==""?"ds":ll(d).varType===Ye.BUILTIN?"builtin":"ds"}return(d,h)=>(C(),L("div",{class:p(d.classes.var)},[g(fs,{modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=v=>s.value=v),tabs:o.value},{prefix:ie(()=>[g(b(O),{icon:"icon-datasource",size:"16px"}),c("span",{class:p(d.classes.title)},"变量",2)]),_:1},8,["modelValue","tabs"]),s.value==="ds"?(C(),K(ps,{key:0,doc:n.doc,onSelect:r,readonly:""},null,8,["doc"])):H("",!0),s.value==="builtin"?(C(),K(Wi,{key:1,onSelect:i})):H("",!0),s.value==="reference"?(C(),K(Er,{key:2,doc:n.doc,onSelect:u},null,8,["doc"])):H("",!0)],2))}}),kr="_title_wuhum_10",wr={var:"_var_wuhum_2",title:kr},Sr={classes:wr},ms=D(Tr,[["__cssModules",Sr]]),Cr=["onClick","onMouseenter"],Rr=q({__name:"String",emits:["select"],setup(n,{emit:e}){const t=[{label:"STRING",value:"STRING"},{label:"LENGTH",value:"LENGTH"},{label:"LOWER",value:"LOWER"},{label:"UPPER",value:"UPPER"},{label:"UPPER_FIRST",value:"UPPER_FIRST"},{label:"TRIM",value:"TRIM"},{label:"REPLACE",value:"REPLACE"},{label:"REPLACE_ALL",value:"REPLACE_ALL"},{label:"SLICE",value:"SLICE"},{label:"INCLUDES",value:"INCLUDES"},{label:"INDEX_OF",value:"INDEX_OF"},{label:"LAST_INDEX_OF",value:"LAST_INDEX_OF"},{label:"STARTS_WITH",value:"STARTS_WITH"},{label:"ENDS_WITH",value:"ENDS_WITH"}],l=e,s=Z(t[0].value),o=N(()=>`function_${s.value.toLowerCase()}`);function a(i){l("select",i.value)}function r(i){s.value=i.value}return(i,u)=>(C(),L("div",{class:p(i.classes.string)},[c("div",{class:p(["quickprint-is-scrollable",i.classes.panel])},[(C(),L(U,null,j(t,m=>c("div",{key:m.value,class:p({[i.classes.option]:!0,[i.classes.active]:m.value===s.value}),onClick:d=>a(m),onMouseenter:d=>r(m)},[c("strong",null,B(m.label),1)],42,Cr)),64))],2),c("div",{class:p(["quickprint-is-scrollable",i.classes.desc])},[g(b(Cn),{name:o.value},null,8,["name"])],2)],2))}}),Lr="_string_shs83_2",Nr="_panel_shs83_10",Ir="_desc_shs83_16",$r="_option_shs83_23",Ar="_active_shs83_33",qr={string:Lr,panel:Nr,desc:Ir,option:$r,active:Ar},Or={classes:qr},Mr=D(Rr,[["__cssModules",Or]]),Dr=["onClick","onMouseenter"],xr=q({__name:"Number",emits:["select"],setup(n,{emit:e}){const t=[{label:"NUMBER",value:"NUMBER"},{label:"ABS",value:"ABS"},{label:"TRUNC",value:"TRUNC"},{label:"MIN",value:"MIN"},{label:"MAX",value:"MAX"},{label:"CEIL",value:"CEIL"},{label:"FLOOR",value:"FLOOR"},{label:"ROUND",value:"ROUND"}],l=e,s=Z(t[0].value),o=N(()=>`function_${s.value.toLowerCase()}`);function a(i){l("select",i.value)}function r(i){s.value=i.value}return(i,u)=>(C(),L("div",{class:p(i.classes.string)},[c("div",{class:p(["quickprint-is-scrollable",i.classes.panel])},[(C(),L(U,null,j(t,m=>c("div",{key:m.value,class:p({[i.classes.option]:!0,[i.classes.active]:m.value===s.value}),onClick:d=>a(m),onMouseenter:d=>r(m)},[c("strong",null,B(m.label),1)],42,Dr)),64))],2),c("div",{class:p(["quickprint-is-scrollable",i.classes.desc])},[g(b(Cn),{name:o.value},null,8,["name"])],2)],2))}}),Pr="_string_shs83_2",Vr="_panel_shs83_10",zr="_desc_shs83_16",Br="_option_shs83_23",Fr="_active_shs83_33",Ur={string:Pr,panel:Vr,desc:zr,option:Br,active:Fr},Hr={classes:Ur},Gr=D(xr,[["__cssModules",Hr]]),Wr=["onClick","onMouseenter"],Yr=q({__name:"Logical",emits:["select"],setup(n,{emit:e}){const t=[{label:"IF",value:"IF"},{label:"IFNA",value:"IFNA"},{label:"IFERROR",value:"IFERROR"},{label:"SWITCH",value:"SWITCH"},{label:"IS_NAN",value:"IS_NAN"},{label:"IS_NUMBER",value:"IS_NUMBER"},{label:"IS_INTEGER",value:"IS_INTEGER"},{label:"IS_STRING",value:"IS_STRING"},{label:"IS_BOOLEAN",value:"IS_BOOLEAN"},{label:"IS_NULL",value:"IS_NULL"},{label:"IS_UNDEFINED",value:"IS_UNDEFINED"},{label:"IS_NULLISH",value:"IS_NULLISH"},{label:"IS_EMPTY",value:"IS_EMPTY"}],l=e,s=Z(t[0].value),o=N(()=>`function_${s.value.toLowerCase()}`);function a(i){l("select",i.value)}function r(i){s.value=i.value}return(i,u)=>(C(),L("div",{class:p(i.classes.string)},[c("div",{class:p(["quickprint-is-scrollable",i.classes.panel])},[(C(),L(U,null,j(t,m=>c("div",{key:m.value,class:p({[i.classes.option]:!0,[i.classes.active]:m.value===s.value}),onClick:d=>a(m),onMouseenter:d=>r(m)},[c("strong",null,B(m.label),1)],42,Wr)),64))],2),c("div",{class:p(["quickprint-is-scrollable",i.classes.desc])},[g(b(Cn),{name:o.value},null,8,["name"])],2)],2))}}),Xr="_string_shs83_2",jr="_panel_shs83_10",Zr="_desc_shs83_16",Kr="_option_shs83_23",Jr="_active_shs83_33",Qr={string:Xr,panel:jr,desc:Zr,option:Kr,active:Jr},ea={classes:Qr},ta=D(Yr,[["__cssModules",ea]]),na=q({__name:"index",setup(n){const e=Oe(),t=Z("string"),l=[{label:"文本",value:"string"},{label:"数字",value:"number"},{label:"逻辑",value:"logical"}];function s(o){return e==null?void 0:e.confirm({type:"function",value:`${o}()`})}return(o,a)=>(C(),L("div",{class:p(o.classes.function)},[g(fs,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=r=>t.value=r),tabs:l},{prefix:ie(()=>[g(b(O),{icon:"icon-function",size:"16px"}),c("span",{class:p(o.classes.title)},"函数",2)]),_:1},8,["modelValue"]),t.value==="string"?(C(),K(Mr,{key:0,onSelect:s})):H("",!0),t.value==="number"?(C(),K(Gr,{key:1,onSelect:s})):H("",!0),t.value==="logical"?(C(),K(ta,{key:2,onSelect:s})):H("",!0)],2))}}),la="_title_vrlfq_11",sa={function:"_function_vrlfq_2",title:la},oa={classes:sa},ia=D(na,[["__cssModules",oa]]),ra=["onMouseenter"],aa=["onClick"],ca={key:1},ua=q({__name:"Formula",props:{doc:{type:fe,default:null}},setup(n){const e=n,t=Oe(),l=[{id:"pageNumber",name:"页码",options:i(So)}],s=Z(l[0]);function o(u){s.value=u}function a(u){return t==null?void 0:t.confirm({type:"formula",value:u})}function r(u){const m=En.tokenize(u),d=e.doc;return m.reduce((h,v)=>{if(v.type===We.VARIABLE)return h.push({type:"highlight",value:tt(v.value,d==null?void 0:d.ds)}),h;if(v.type===We.REFERENCE)return h.push({type:"highlight",value:ds(v.value,d)}),h;if(v.type===We.TEMPLATE){const f=(Array.isArray(v.value)?v.value:[v.value]).map(S=>S.type===We.VARIABLE?{type:"highlight",value:tt(S.value,d.ds)}:{type:"text",value:S.value});return h.concat(f)}return h.push({type:"text",value:En.formatTokenValue(v)}),h},[])}function i(u){return u.map(m=>({nodes:r(m),value:m}))}return(u,m)=>(C(),L("div",{class:p(u.classes.formula)},[c("div",{class:p([u.classes.left,"quickprint-is-scrollable"])},[(C(),L(U,null,j(l,d=>c("div",{key:d.name,onMouseenter:h=>o(d),class:p({[u.classes.group]:!0,[u.classes.active]:d.id===s.value.id})},B(d.name),43,ra)),64))],2),c("div",{class:p(u.classes.right)},[(C(!0),L(U,null,j(s.value.options,(d,h)=>(C(),L("div",{key:h,class:p(u.classes.code),onClick:v=>a(d.value)},[(C(!0),L(U,null,j(d.nodes,v=>(C(),L(U,null,[v.type==="highlight"?(C(),L("span",{key:0,class:p(u.classes.highlight)},"["+B(v.value)+"]",3)):(C(),L("span",ca,B(v.value),1))],64))),256)),c("span",{class:p(u.classes.badge)},"插入",2)],10,aa))),128))],2)],2))}}),da="_formula_ms7c3_2",fa="_left_ms7c3_12",pa="_right_ms7c3_17",ma="_group_ms7c3_24",ha="_active_ms7c3_34",ga="_highlight_ms7c3_39",va="_code_ms7c3_43",ba="_badge_ms7c3_65",ya={formula:da,left:fa,right:pa,group:ma,active:ha,highlight:ga,code:va,badge:ba},_a={classes:ya},Ea=D(ua,[["__cssModules",_a]]);function nn(){return{pinnable:!1,top:"15vh",width:"840px",height:"600px",mask:!0,resizeMode:Tt.DISABLED}}function $t(n){const e=ce.get($t);if(e)return e;const t=nn(),l=Qt("变量",g(ms,{doc:n.doc,value:n.value},null),t).promisify().catch(Ie).finally(()=>ce.set($t,void 0));return ce.set($t,l),l}function un(n){const e=ce.get(un);if(e)return e;const t=nn();t.icon=g(O,{icon:"icon-datasource",class:"quickprint-ds-icon",size:"16px"},null),t.menus=[{label:"保存",handler:s=>s.dispatchConfirm()}];const l=yt("数据源",g(ps,{doc:n},null),t).promisify().catch(Ie).finally(()=>ce.set(un,void 0));return ce.set(un,l),l}function dn(n){const e=ce.get(dn);if(e)return e;const t=["ds","builtin","reference"],l=nn(),s=Qt("变量",g(ms,{doc:n.doc,value:n.value,include:t},null),l).promisify().catch(Ie).finally(()=>ce.set(dn,void 0));return ce.set(dn,s),s}function fn(){const n=ce.get(fn);if(n)return n;const e=nn(),t=Qt("函数",g(ia,null,null),e).promisify().catch(Ie).finally(()=>ce.set(fn,void 0));return ce.set(fn,t),t}function pn(n){const e=ce.get(pn);if(e)return e;const t=nn(),l=yt("公式",g(Ea,{doc:n.doc},null),t).promisify().catch(Ie).finally(()=>ce.set(pn,void 0));return ce.set(pn,l),l}const Ta={key:1},ka=q({__name:"Content",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=be(),l=Vt("editorRef"),s=Vt("contentRef"),o=Z(!1),a=N(()=>{const m=Ei(e.element);return m.color&&(m["--quickprint-element-var-color"]=m.color),o.value&&(m.alignItems="flex-start"),m}),r=N(()=>{const m=dl(e.element,t.doc.ds);return m==null||m.content==null?null:[{tag:"span",content:e.element.attributes.prefix},{tag:m.type===ge.CONST?"span":"strong",content:m.content},{tag:"span",content:e.element.attributes.suffix}]});async function i(){var v;const m=await $t({doc:t.doc,value:e.element.ds.value}).catch(Xe);if(m==null||(e.element.setDataSource(ge.VARIABLE,m.value),e.element.type!=W.TABLE_CELL||m.type!=="ds"))return;const d=e.element.parent;if(d==null||d.isBindVariable||((v=m.parent)==null?void 0:v.type)!==ne.ARRAY)return;const h=m.parent;d.setDataSource(ge.VARIABLE,`${Ye.DS}.${h.type}.${h.name}`)}function u(){const m=l.value,d=s.value;m==null||d==null||(o.value=d.offsetHeight>m.offsetHeight)}return(m,d)=>(C(),L("div",{class:"quickprint-is-element-editor",style:Y(a.value),onVnodeMounted:u,ref_key:"editorRef",ref:l},[c("div",{class:"quickprint-is-content",ref_key:"contentRef",ref:s},[c("span",{class:p({[m.classes.lineThrough]:n.element.style.lineThrough})},[(C(!0),L(U,null,j(r.value,(h,v)=>(C(),L(U,{key:v},[h.tag=="strong"?(C(),L("strong",{key:0,class:p(m.classes.highlight)},"["+B(h.content)+"]",3)):(C(),L("span",Ta,B(h.content),1))],64))),128))],2)],512),n.element.isBindVariable||n.element.isBindTemplate?(C(),K(b(O),{key:0,icon:"icon-ds",size:"11px",color:"#da7f00",class:p(m.classes.dsIcon),onClick:i,onPointerdown:d[0]||(d[0]=ee(()=>{},["stop"]))},null,8,["class"])):H("",!0)],4))}}),wa="_dsIcon_ss96n_2",Sa="_lineThrough_ss96n_10",Ca="_highlight_ss96n_14",Ra={dsIcon:wa,lineThrough:Sa,highlight:Ca},La={classes:Ra},Rn=D(ka,[["__cssModules",La]]),Na=q({__name:"TextEditor",props:{element:{type:Hs,required:!0}},setup(n){return(e,t)=>(C(),K(Rn,{element:n.element},null,8,["element"]))}}),Ln=Object.freeze({title:"文本",type:W.TEXT,editor:Na,onCreate(){return pe.create({type:W.TEXT,width:bt,height:Sn})}}),Ia=q({__name:"NumberEditor",props:{element:{type:Gs,required:!0}},setup(n){return(e,t)=>(C(),K(Rn,{element:n.element},null,8,["element"]))}}),$a=["value","disabled"],Aa=q({__name:"RadioButton",props:Et({modelValue:{},options:{type:Array,default(){return[]}},compacted:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=en(n,"modelValue");return(t,l)=>(C(),L("div",{class:p({[t.classes.radioGroup]:!0,[t.classes.compacted]:n.compacted,[t.classes.disabled]:n.disabled})},[(C(!0),L(U,null,j(n.options,s=>(C(),L("label",{class:p({[t.classes.radio]:!0,[t.classes.selected]:s.value===n.modelValue})},[ve(c("input",{type:"radio",value:s.value,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value=o),disabled:n.disabled},null,8,$a),[[ao,e.value]]),c("span",null,B(s.label),1)],2))),256))],2))}}),qa="_radioGroup_67myk_2",Oa="_compacted_67myk_10",Ma="_radio_67myk_2",Da="_selected_67myk_50",xa="_disabled_67myk_56",Pa={radioGroup:qa,compacted:Oa,radio:Ma,selected:Da,disabled:xa},Va={classes:Pa},Nt=D(Aa,[["__cssModules",Va]]),za={class:"quickprint-config-section quickprint-config-inline"},Ba={class:"quickprint-config-content"},Fa={class:"quickprint-config-section quickprint-config-inline"},Ua={class:"quickprint-config-content"},Ha={class:"quickprint-config-section quickprint-config-inline"},Ga={class:"quickprint-config-content"},Wa={class:"quickprint-config-section quickprint-config-inline"},Ya={class:"quickprint-config-content"},Xa=q({__name:"NumberConfig",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=N({get(){return e.element.attributes.showZero??!0},set(o){const a=e.element.attributes;a.showZero=o}}),l=N({get(){return e.element.attributes.round??Wt.ROUND},set(o){const a=e.element.attributes;a.round=o}}),s=N({get(){return e.element.attributes.format??ut.NONE},set(o){const a=e.element.attributes;a.format=o}});return(o,a)=>(C(),L(U,null,[c("section",za,[a[4]||(a[4]=c("header",{class:"quickprint-config-header quickprint-todo"},"小数位数",-1)),c("div",Ba,[ve(c("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>n.element.attributes.precision=r),type:"number",min:0,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ce,n.element.attributes.precision]])])]),c("section",Fa,[a[5]||(a[5]=c("header",{class:"quickprint-config-header quickprint-todo"},"舍入规则",-1)),c("div",Ua,[g(b(X),{options:b(go),modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=r=>l.value=r),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),c("section",Ha,[a[6]||(a[6]=c("header",{class:"quickprint-config-header quickprint-todo"},"显示类型",-1)),c("div",Ga,[g(b(X),{options:b(vo),modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=r=>s.value=r),class:"quickprint-w-full"},null,8,["options","modelValue"])])]),c("section",Wa,[a[7]||(a[7]=c("header",{class:"quickprint-config-header quickprint-todo"},"值为0时",-1)),c("div",Ya,[g(Nt,{modelValue:t.value,"onUpdate:modelValue":a[3]||(a[3]=r=>t.value=r),options:b(bo),class:"quickprint-w-full"},null,8,["modelValue","options"])])])],64))}}),Nn=Object.freeze({title:"数字",type:W.NUMBER,editor:Ia,config:{display:Xa},onCreate(){return pe.create({type:W.NUMBER,width:bt,height:Sn})}}),ja=q({__name:"DateEditor",props:{element:{type:Ws,required:!0}},setup(n){return(e,t)=>(C(),K(Rn,{element:n.element},null,8,["element"]))}}),Za={class:"quickprint-config-section"},Ka={class:"quickprint-config-content"},Ja=q({__name:"DateConfig",props:{element:{type:pe,required:!0}},setup(n){const e=n,t={NONE:"NONE"},l=N(()=>[{label:"原始值",value:t.NONE},...es]);function s(o){if(o.value==t.NONE){e.element.attributes.format=void 0;return}e.element.attributes.format=o.value}return(o,a)=>(C(),L("section",Za,[c("header",{class:p(["quickprint-config-header",o.classes.header])},[a[1]||(a[1]=c("span",null,"格式",-1)),g(b(X),{options:l.value,onSelect:s,class:p(o.classes.picker),appearance:"none",size:"mini",border:"none",popoverWidth:200},{selected:ie(()=>[c("span",{class:p(o.classes.placeholder)},"预设模板",2)]),_:1},8,["options","class"])],2),c("div",Ka,[ve(c("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=r=>n.element.attributes.format=r),class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null,512),[[Ce,n.element.attributes.format]])])]))}}),Qa="_header_79607_2",ec="_picker_79607_8",tc="_placeholder_79607_15",nc={header:Qa,picker:ec,placeholder:tc},lc={classes:nc},sc=D(Ja,[["__cssModules",lc]]),In=Object.freeze({title:"日期",type:W.DATE,editor:ja,config:{display:sc},onCreate(){return pe.create({type:W.DATE,width:bt,height:Sn})}}),oc=["colspan","rowspan"],ic=q({__name:"TableCellEditor",props:{element:{type:Hl,required:!0}},setup(n){const e=n,t=N(()=>e.element.attributes.colspan===0||e.element.attributes.rowspan===0),l=be(),s=$e("classes"),o=N(()=>{var i;return{[s.cell]:!0,[F.SELECTED]:(i=e.element.state)==null?void 0:i.selected}}),a=N(()=>{var m;const i=Xn((m=e.element.parent)==null?void 0:m.parent),u=Xn(e.element);return{"--quickprint-cell-editor-width":e.element.offsetWidth+"px","--quickprint-cell-editor-height":e.element.height+"px",...ft(i,u)}});function r(i){i.button==0&&l.selectElement(e.element)}return(i,u)=>t.value?H("",!0):(C(),L("td",jl({key:0,[`.${b(Qe)||""}`]:n.element,class:o.value,style:a.value,colspan:n.element.attributes.colspan,rowspan:n.element.attributes.rowspan,onClick:ee(r,["stop"])}),[g(Rn,{element:n.element,class:p(b(s).content)},null,8,["element","class"])],48,oc))}}),rc="_cell_rp1x6_2",ac="_content_rp1x6_31",cc={cell:rc,content:ac},uc={classes:cc},hs=D(ic,[["__cssModules",uc]]);function dc(n,e){const t={top:[{type:"topMenu",label:"选中表格",icon:"icon-aim",handler:e.selectTable},{type:"topMenu",label:"复制表格",icon:"icon-copy",handler:()=>{console.log("TODO:复制")}}],menus:[]};return e.getTable,t.menus.push({type:"menu",label:"合并",icon:"icon-merge-cells",handler:e.mergeCells}),t.menus.push({type:"menu",label:"拆分",icon:"icon-solit-cells",handler:e.splitCells}),t.menus.push({type:"menu",label:"插入",icon:"icon-plus-square",submenu:[{type:"menu",label:"左侧插入列",icon:"icon-zhanweifu",handler:e.insertColumnLeft},{type:"menu",label:"右侧插入列",icon:"icon-zhanweifu",handler:e.insertColumnRight},{type:"menu",label:"上侧插入行",icon:"icon-zhanweifu",handler:e.insertRowTop},{type:"menu",label:"下侧插入行",icon:"icon-zhanweifu",handler:e.inserRowBottom}]}),t.menus.push({type:"menu",label:"自动调整",icon:"icon-auto-resize",submenu:[{type:"menu",label:"根据纸张调整列宽",handler:e.autoReiszeColumnByPaper},{type:"menu",label:"均分表格宽度",handler:e.avgTableWidth},{type:"menu",label:"均分表格高度",handler:e.avgTableHeight},{type:"menu",label:"将其他行设为相同高度",handler:e.setOtherRowSameHeight},{type:"menu",label:"将其他列设为相同宽度",handler:e.setOtherColSameWidth}]}),t.menus.push({type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"删除列",icon:"icon-deletecolumn",handler:e.deleteColumns},{type:"menu",label:"删除行",icon:"icon-deleterow",handler:e.deleteRows},{type:"menu",label:"数据源",icon:"icon-datasource",handler:e.deleteDataSource}]}),ol.open(n.clientX,n.clientY,t)}function fc(n,e){function t(){return n.element}function l(){const k=t();return e.getSelectedElements().filter(T=>{var R;if(T.type!==W.TABLE_CELL)return!1;const w=(R=T.parent)==null?void 0:R.parent;return w==null?!1:w.id==k.id}).sort(Hl.sort)}function s(k){var $;let _=0,T=0,w=0,R=0;for(const G of k){const V=(($=G.parent)==null?void 0:$.index)??-1,te=G.index;te>=0&&te<_&&(_=te),te>=0&&te>T&&(T=te),V>=0&&V<w&&(w=V),V>=0&&V>R&&(R=V)}return{colStart:_,colEnd:T,rowStart:w,rowEnd:R,colSpan:T-_+1,rowSpan:R-w+1}}function o(){var T;const k=l()[0];if(k==null)return!1;const _=(T=k.parent)==null?void 0:T.parent;return _==null?!1:e.selectElement(_)}function a(){const k=l();if(k.length===0)return!1;const _=s(k);return t().insertColumn(_.colStart,0),e.history.createSnapshot(),!0}function r(){const k=l();if(k.length===0)return!1;const _=s(k);return t().insertColumn(_.colEnd,1),e.history.createSnapshot(),!0}function i(){const k=l();if(k.length===0)return!1;const _=s(k);return t().inserRow(_.rowStart,0),e.history.createSnapshot(),!0}function u(){const k=l();if(k.length===0)return!1;const _=s(k);return t().inserRow(_.rowEnd,1),e.history.createSnapshot(),!0}function m(){var Bt,Ft;const k=t(),_=k.page;if(_==null)return;const T=k.doc,w=Tl((Bt=T==null?void 0:T.margins)==null?void 0:Bt.left)??38,R=Tl((Ft=T==null?void 0:T.margins)==null?void 0:Ft.right)??38,$=k.columns,G=$.reduce((ot,xe)=>ot+xe,0),V=Hn.mm_to_px(_.width)-w-R,te=[];for(const ot of $){const xe=Math.round(ot/G*V);te.push(xe)}const De=te.reduce((ot,xe)=>ot+xe,0),st=V-De;te[te.length-1]+=st,k.setColumns(te),k.updateBoxSize(),e.history.createSnapshot()}function d(){const k=t(),_=k.columns,T=_.reduce((G,V)=>G+V,0),w=Math.floor(T/_.length),R=new Array(_.length).fill(w),$=T-R.reduce((G,V)=>G+V,0);R[R.length-1]+=$,k.setColumns(R),k.updateBoxSize(),e.history.createSnapshot()}function h(){const k=t(),_=Math.round(k.height/k.children.length);k.children.forEach((T,w)=>k.setRowHeight(w,_)),k.updateBoxSize(),e.history.createSnapshot()}function v(){const k=e.getSelectedElements()[0];if(k==null)return;const _=k.parent;if(_==null||_.type!="TableRow")return;const T=t(),w=_.height;T.children.forEach(R=>R.setRowHeight(w)),T.updateBoxSize(),e.history.createSnapshot()}function y(){const k=e.getSelectedElements()[0];if(k==null)return;const _=t(),T=k.width,w=_.attributes.colgroup.map(R=>T);_.setColumns(w),_.updateBoxSize(),e.history.createSnapshot()}function f(){const k=e.getSelectedElements();if(k.length<2)return;const[_,...T]=k;for(const w of T)w.attributes.colspan=0;_.attributes.colspan=k.length}function S(){}function I(){const k=l()[0];if(k==null)return;t().removeColumn(k.index),e.history.createSnapshot()}function M(){const k=l()[0];if(k==null)return;const _=k.parent;if(_==null)return;t().removeRow(_.index),e.history.createSnapshot()}function E(){e.getSelectedElements().forEach(_=>_.resetDS()),e.history.createSnapshot()}return{getTable:t,getSelected:l,selectTable:o,toArea:s,insertColumnLeft:a,insertColumnRight:r,insertRowTop:i,inserRowBottom:u,autoReiszeColumnByPaper:m,avgTableWidth:d,avgTableHeight:h,setOtherRowSameHeight:v,setOtherColSameWidth:y,mergeCells:f,splitCells:S,deleteColumns:I,deleteRows:M,deleteDataSource:E}}function pc(n,e,t){const s={moved:!1,left:0,colIndex:0,target:null,container:null};function o(m,d){if(m==0)return null;const h=d.previousElementSibling;return h==null?0:h.offsetLeft}function a(m,d,h){const v=n.getTable().columns.length;if(m===v)return null;const y=d.nextElementSibling;return y==null?h.offsetWidth:y.offsetLeft}function r(m,d){if(!(m.target instanceof Element))return;const h=m.target.closest("."+e.colResize);if(h==null)return;const v=h.closest("."+e.layer);v!=null&&(m.stopPropagation(),m.preventDefault(),s.left=h.offsetLeft,s.colIndex=d,s.target=h,s.container=v,s.target.setPointerCapture(m.pointerId),window.addEventListener("pointermove",i),window.addEventListener("pointerup",u))}function i(m){if(s.target==null||s.container==null)return;const d=s.container.getBoundingClientRect(),h=o(s.colIndex,s.target),v=a(s.colIndex,s.target,s.container);let y=m.clientX-d.left;h!=null&&y<=h+4&&(y=h+4),v!=null&&y>=v-4&&(y=v-4),s.left=y,s.target.style.left=y+"px",s.moved=!0}function u(m){s.moved&&t.onResizeEnd(s.colIndex,Math.round(s.left)),s.left=0,s.target=null,s.container=null,window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",u)}return r}function mc(n,e,t){const s={moved:!1,top:0,rowIndex:0,target:null,container:null};function o(m,d){if(m==0)return null;const h=d.previousElementSibling;return h==null?0:h.offsetTop}function a(m,d,h){const v=n.getTable().children.length;if(m===v)return null;const y=d.nextElementSibling;return y==null?h.offsetHeight:y.offsetTop}function r(m,d){if(!(m.target instanceof Element))return;const h=m.target.closest("."+e.rowResize);if(h==null)return;const v=h.closest("."+e.layer);v!=null&&(m.stopPropagation(),m.preventDefault(),s.top=h.offsetTop,s.rowIndex=d,s.target=h,s.container=v,s.target.setPointerCapture(m.pointerId),window.addEventListener("pointermove",i),window.addEventListener("pointerup",u))}function i(m){if(s.target==null||s.container==null)return;const d=s.container.getBoundingClientRect(),h=o(s.rowIndex,s.target),v=a(s.rowIndex,s.target,s.container);let y=m.clientY-d.top;h!=null&&y<=h+4&&(y=h+4),v!=null&&y>=v-4&&(y=v-4),s.moved=!0,s.top=y,s.target.style.top=y+"px"}function u(m){s.moved&&t.onResizeEnd(s.rowIndex,Math.round(s.top)),s.top=0,s.target=null,s.container=null,window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",u)}return r}const hc=["width"],gc=["onPointerdown"],vc=["onPointerdown"],bc=["onClick"],yc=q({__name:"TableEditor",props:{element:{type:Ys,required:!0}},setup(n){const e=n,t=be(),l=$e("classes"),s=fc(e,t),o=pc(s,l,{onResizeEnd:I}),a=mc(s,l,{onResizeEnd:M}),r=N(()=>e.element.attributes.colgroup??[]),i=N(()=>r.value.length+1),u=N(()=>e.element.children.length+1),m=N(()=>t.getSelectedElements().length!=0?!1:e.element.state.selected===!0);function d(E){return{left:(e.element.attributes.colgroup??[]).slice(0,E).reduce((_,T)=>_+T,0)+"px"}}function h(E){return{top:(e.element.children??[]).slice(0,E).reduce((T,w)=>T+w.height,0)-1+"px"}}function v(E){const k=e.element.attributes.colgroup??[],_=k.slice(0,E).reduce((R,$)=>R+$,0),T=E===0?0:1,w=E>0&&E<k.length?-1:0;return{left:_+T+"px",width:k[E]+w+"px"}}function y(E){const k=e.element.children??[],_=k.slice(0,E).reduce((R,$)=>R+$.height,0),T=E===0?0:1,w=E>0&&E<k.length?-1:0;return{top:_+T+"px",height:k[E].height+w+"px"}}function f(E){t.selectElement(E)}async function S(E){const k=E.target.closest("td");if(k==null)return;const _=Reflect.get(k,Qe);_!=null&&(t.state.selectMode==et.SINGLE&&(t.selectElement(_),await Pt()),dc(E,s))}function I(E,k){const _=e.element.attributes.colgroup??[];if(E==0){const G=e.element.left,V=e.element.calculateCoord(G+k),te=_[0]-(V-G);e.element.setLeft(V),e.element.setColWidth(0,te),e.element.updateBoxSize(),t.createSnapshot();return}if(E==_.length){const G=E-1,V=_.slice(0,G).reduce((De,st)=>De+st,0),te=k-V;e.element.setColWidth(E-1,te),e.element.updateBoxSize(),t.createSnapshot();return}const T=E-1,w=_[T]+_[E],R=k-_.slice(0,T).reduce((G,V)=>G+V,0),$=w-R;e.element.setColWidth(T,R),e.element.setColWidth(E,$),e.element.updateBoxSize(),t.createSnapshot()}function M(E,k){const _=e.element.children;if(E==0){const G=e.element.top,V=e.element.calculateCoord(G+k),te=_[0].height-(V-G);e.element.setTop(V),e.element.setRowHeight(E,te),e.element.updateBoxSize(),t.createSnapshot();return}if(E==_.length){const G=E-1,V=_.slice(0,G).reduce((De,st)=>De+st.height,0),te=k-V;e.element.setRowHeight(E-1,te),e.element.updateBoxSize(),t.createSnapshot();return}const T=E-1,w=_[T].height+_[E].height,R=k-_.slice(0,T).reduce((G,V)=>G+V.height,0),$=w-R;e.element.setRowHeight(T,R),e.element.setRowHeight(E,$),e.element.updateBoxSize(),t.createSnapshot()}return(E,k)=>(C(),L("div",{class:p(b(l).tableEditor),onContextmenu:ee(S,["stop","prevent"]),onClick:k[1]||(k[1]=ee(()=>{},["stop"]))},[c("table",{class:p(b(l).table)},[c("colgroup",null,[(C(!0),L(U,null,j(r.value,(_,T)=>(C(),L("col",{key:T,width:_},null,8,hc))),128))]),c("tbody",null,[(C(!0),L(U,null,j(n.element.children,_=>(C(),L("tr",{key:_.id},[(C(!0),L(U,null,j(_.children,T=>(C(),K(hs,{key:T.id,element:T},null,8,["element"]))),128))]))),128))])],2),c("div",{class:p(b(l).layer)},[(C(!0),L(U,null,j(i.value,_=>(C(),L("div",{key:_,style:Y(d(_-1)),class:p(b(l).colResize),title:"调整列宽",onPointerdown:ee(T=>b(o)(T,_-1),["stop","prevent"])},null,46,gc))),128)),(C(!0),L(U,null,j(u.value,_=>(C(),L("div",{key:_,style:Y(h(_-1)),class:p(b(l).rowResize),title:"调整行高",onPointerdown:ee(T=>b(a)(T,_-1),["stop","prevent"])},null,46,vc))),128)),(C(!0),L(U,null,j(r.value,(_,T)=>(C(),L("div",{key:T,style:Y(v(T)),class:p(b(l).colIndicator),title:"选中此列"},null,6))),128)),(C(!0),L(U,null,j(n.element.children,(_,T)=>(C(),L("div",{key:T,style:Y(y(T)),class:p(b(l).rowIndicator),title:"选中此行",onClick:ee(w=>f(_),["stop"])},null,14,bc))),128))],2),m.value?(C(),L("div",{key:0,class:p(b(l).tools)},null,2)):H("",!0),c("div",{class:p(b(l).indicator),onPointerdown:k[0]||(k[0]=(..._)=>b(t).onDragStart&&b(t).onDragStart(..._)),title:"选中/拖动表格"},null,34)],34))}}),_c="_tableEditor_7pon8_2",Ec="_table_7pon8_2",Tc="_layer_7pon8_14",kc="_colResize_7pon8_24",wc="_rowResize_7pon8_47",Sc="_colIndicator_7pon8_70",Cc="_rowIndicator_7pon8_76",Rc="_tools_7pon8_95",Lc="_indicator_7pon8_105",Nc={tableEditor:_c,table:Ec,layer:Tc,colResize:kc,rowResize:wc,colIndicator:Sc,rowIndicator:Cc,tools:Rc,indicator:Lc},Ic={classes:Nc},$c=D(yc,[["__cssModules",Ic]]),Ac={class:"quickprint-config-section quickprint-config-inline"},qc={class:"quickprint-config-content"},Oc=q({__name:"TableRowConfig",props:{element:{type:an,required:!0}},setup(n){const e=n,t=[{label:"表头",value:wt.HEADER},{label:"表体",value:wt.BODY},{label:"表尾",value:wt.FOOTER}],l=N({get(){return e.element.attributes.type??wt.BODY},set(s){switch(s){case wt.HEADER:e.element.asHeader();break;case wt.FOOTER:e.element.asFooter();break;default:e.element.asBody()}}});return(s,o)=>(C(),L("section",Ac,[o[1]||(o[1]=c("header",{class:"quickprint-config-header quickprint-todo"},"行模式",-1)),c("div",qc,[g(b(X),{options:t,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value=a),class:"quickprint-w-full"},null,8,["modelValue"])])]))}}),$n=Object.freeze({title:"表格",type:W.TABLE,editor:$c,config:{exclude:[le.PREFIX,le.SUFFIX,le.DISPLAY,le.OVERFLOW]},features:{draggable:!1,resizable:!1,contextMenu:!1},onCreate(){const n=[bt,bt,bt],e=pe.create({type:W.TABLE});return e.setColgroup(n),e.append(an.createDefault(n)),e.append(an.createDefault(n)),e.append(an.createDefault(n)),e.updateBoxSize(),e}}),gs=Object.freeze({title:"表格行",type:W.TABLE_ROW,exposed:!1,editor:null,config:{exclude:[le.POSITION,le.COORD,le.OVERFLOW],attributes:Oc}}),pl=Object.freeze({title:"单元格",type:W.TABLE_CELL,exposed:!1,editor:hs,config:{exclude:[le.POSITION,le.COORD]}});function ln(n,e){const t=Math.pow(10,Math.max(0,e));return Math.round(n*t)/t}const Fn={A:10,B:11,C:12,D:13,E:14,F:15},wl={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};function Mc(n){return typeof n=="string"&&n.includes(".")&&Number.parseFloat(n)===1}function Dc(n){return typeof n=="string"&&n.includes("%")}function At(n,e){Mc(n)&&(n="100%");const t=Dc(n);return n=Math.min(e,Math.max(0,Number.parseFloat(`${n}`))),t&&(n=Number.parseInt(`${n*e}`,10)/100),Math.abs(n-e)<1e-6?1:n%e/Number.parseFloat(e)}function at(n){return n.length===2?(Fn[n[0].toUpperCase()]||+n[0])*16+(Fn[n[1].toUpperCase()]||+n[1]):Fn[n[1].toUpperCase()]||+n[1]}function Sl(n,e,t){n=At(n,255),e=At(e,255),t=At(t,255);const l=Math.max(n,e,t),s=Math.min(n,e,t);let o;const a=l,r=l-s,i=l===0?0:r/l;if(l===s)o=0;else{switch(l){case n:{o=(e-t)/r+(e<t?6:0);break}case e:{o=(t-n)/r+2;break}case t:{o=(n-e)/r+4;break}}o/=6}return{h:o*360,s:i*100,v:a*100}}const xc=function(n,e,t){e=e/100,t=t/100;let l=e;const s=Math.max(t,.01);t*=2,e*=t<=1?t:2-t,l*=s<=1?s:2-s;const o=(t+e)/2,a=t===0?2*l/(s+l):2*e/(t+e);return{h:n,s:a*100,v:o*100}},Pc=function(n,e,t){return[n,e*t/((n=(2-e)*t)<1?n:2-n)||0,n/2]};function Un(n,e,t){n=At(n,360)*6,e=At(e,100),t=At(t,100);const l=Math.floor(n),s=n-l,o=t*(1-e),a=t*(1-s*e),r=t*(1-(1-s)*e),i=l%6,u=[t,a,o,o,r,t][i],m=[r,t,t,a,o,o][i],d=[o,o,r,t,t,a][i];return{r:Math.round(u*255),g:Math.round(m*255),b:Math.round(d*255)}}function mn(n){n=Math.min(Math.round(n),255);const e=Math.floor(n/16),t=n%16;return`${wl[e]||e}${wl[t]||t}`}function Vc({r:n,g:e,b:t}){return Number.isNaN(+n)||Number.isNaN(+e)||Number.isNaN(+t)?"":`#${mn(n)}${mn(e)}${mn(t)}`}class An{constructor(e){P(this,"h",0);P(this,"s",100);P(this,"v",100);P(this,"a",100);e&&this.setColor(e)}setColor(e){const t=this.processColor(e);t!=null&&(this.setHue(t.h),this.setSaturation(t.s),this.setValue(t.v),this.setAlpha(t.a))}setHue(e){this.h=ln(e,2)}setSaturation(e){this.s=ln(e,2)}setValue(e){this.v=ln(e,2)}setAlpha(e){this.a=ln(e,2)}processColor(e){return e==null||e==""?null:e.startsWith("#")?this.processHEX(e):e.startsWith("rgb")?this.processRGB(e):e.startsWith("hsl")?this.processHSL(e):this.processHSV(e)}processHSV(e){const t=e.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(s=>s!=="").map((s,o)=>o>2?Number.parseFloat(s):Number.parseInt(s,10)),l=t.length===4?t[3]*100:100;return{h:t[0],s:t[1],v:t[2],a:l}}processHEX(e){const t=e.replace("#","").trim();if(!/^[0-9a-fA-F]{3}$|^[0-9a-fA-F]{6}$|^[0-9a-fA-F]{8}$/.test(t))return null;let l,s,o,a=100;t.length===3?(l=at(t[0]+t[0]),s=at(t[1]+t[1]),o=at(t[2]+t[2])):(t.length===6||t.length===8)&&(l=at(t.slice(0,2)),s=at(t.slice(2,4)),o=at(t.slice(4,6))),t.length===8&&(a=at(t.slice(6))/255*100);const{h:r,s:i,v:u}=Sl(l,s,o);return{h:r,s:i,v:u,a}}processRGB(e){const t=e.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,s)=>s>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:s,s:o,v:a}=Sl(t[0],t[1],t[2]);return{h:s,s:o,v:a,a:l}}return null}processHSL(e){const t=e.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(l=>l!=="").map((l,s)=>s>2?Number.parseFloat(l):Number.parseInt(l,10));if(t.length>=3){const l=t.length===4?t[3]*100:100,{h:s,s:o,v:a}=xc(t[0],t[1],t[2]);return{h:s,s:o,v:a,a:l}}return null}toString(e){switch(e){case"hsl":{const t=Pc(this.h,this.s/100,this.v/100);return`hsla(${this.h},${Math.round(t[1]*100)}%,${Math.round(t[2]*100)}%,${this.a/100})`}case"hex":return`${Vc(Un(this.h,this.s,this.v))}${mn(this.a*255/100)}`;case"rgb":{const{r:t,g:l,b:s}=Un(this.h,this.s,this.v);return`rgba(${t},${l},${s},${this.a/100})`}default:return`hsva(${this.h},${Math.round(this.s)}%,${Math.round(this.v)}%,${this.a/100})`}}toRGB(){return this.toString("rgb")}toHSL(){return this.toString("hsl")}toHEX(){return this.toString("hex")}rgb(){return Un(this.h,this.s,this.v)}}function vs(n){const e={init:!1,target:null,container:null,offsetX:0};function t(a){const r=e.container.getBoundingClientRect(),u=e.target.getBoundingClientRect().width/2;let m=a.clientX-r.left-e.offsetX;return m<-u&&(m=-u),m>r.width-u&&(m=r.width-u),m}function l(a){a.stopPropagation(),a.preventDefault();const r=a.target,i=a.currentTarget;origin==null||r==null||(e.container=i,e.target=r===i?r.firstElementChild:r,e.offsetX=r===i?e.target.offsetWidth/2:a.clientX-r.getBoundingClientRect().left,window.addEventListener("pointermove",s),window.addEventListener("pointerup",o))}function s(a){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(a.pointerId),e.init=!0);const r=t(a);e.target.style.left=r+"px",n("move",r)}function o(a){if(a.preventDefault(),a.stopPropagation(),e.container&&e.target){const r=t(a);n("end",r)}e.target&&e.target.releasePointerCapture(a.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",o)}return l}function zc(n){const e={init:!1,target:null,container:null,offsetX:0,offsetY:0};function t(r){const i=e.container.getBoundingClientRect(),m=e.target.getBoundingClientRect().width/2;let d=r.clientX-i.left-e.offsetX;return d<-m&&(d=-m),d>i.width-m&&(d=i.width-m),d}function l(r){const i=e.container.getBoundingClientRect(),m=e.target.getBoundingClientRect().height/2;let d=r.clientY-i.top-e.offsetY;return d<-m&&(d=-m),d>i.height-m&&(d=i.height-m),d}function s(r){r.stopPropagation(),r.preventDefault();const i=r.target,u=r.currentTarget;origin==null||i==null||(e.container=u,e.target=i===u?i.firstElementChild:i,e.offsetX=i===u?e.target.offsetWidth/2:r.clientX-i.getBoundingClientRect().left,e.offsetY=i===u?e.target.offsetHeight/2:r.clientY-i.getBoundingClientRect().top,window.addEventListener("pointermove",o),window.addEventListener("pointerup",a))}function o(r){if(e.container==null||e.target==null)return;e.init||(e.target.setPointerCapture(r.pointerId),e.init=!0);const i=t(r),u=l(r);e.target.style.left=i+"px",e.target.style.top=u+"px",n("move",{left:i,top:u})}function a(r){if(r.preventDefault(),r.stopPropagation(),e.container&&e.target){const i=t(r),u=l(r);n("end",{top:u,left:i})}e.target&&e.target.releasePointerCapture(r.pointerId),e.target=null,e.container=null,e.init=!1,window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",a)}return s}const Bc=q({__name:"SvPanel",props:{modelValue:{type:An,required:!0}},setup(n){const e=n,t=re(),l=re(),s=qe(r()),o=N(()=>({left:s.left+"px",top:s.top+"px"})),a=zc((i,u)=>{i=="end"&&(s.top=u.top,s.left=u.left);const m=t.value,d=l.value,h=(u.left+d.offsetWidth/2)/m.offsetWidth*100,v=100-(u.top+d.offsetHeight)/m.offsetHeight*100;e.modelValue.setSaturation(h),e.modelValue.setValue(v)});function r(){const i=t.value,u=l.value;if(i==null||u==null)return{top:-6,left:-6};const m=e.modelValue.s,h=(100-e.modelValue.v)/100*i.offsetHeight,v=m/100*i.offsetWidth;return{top:h-u.offsetHeight/2,left:v-u.offsetWidth/2}}return tn(()=>{const i=r();s.top=i.top,s.left=i.left}),(i,u)=>(C(),L("div",{class:p(i.classes.svPanel),onPointerdown:u[0]||(u[0]=(...m)=>b(a)&&b(a)(...m)),ref_key:"svPanelRef",ref:t},[c("div",{class:p(i.classes.thumb),style:Y(o.value),ref_key:"thumbRef",ref:l},null,6)],34))}}),Fc="_svPanel_1sv6o_2",Uc="_thumb_1sv6o_10",Hc={svPanel:Fc,thumb:Uc},Gc={classes:Hc},Wc=D(Bc,[["__cssModules",Gc]]),Yc=q({__name:"HueSlider",props:{modelValue:{type:An,required:!0}},setup(n){const e=n,t=Z(-6),l=re(),s=re(),o=vs((r,i)=>{r=="end"&&(t.value=i);const u=l.value,m=s.value,d=Math.round((i+m.offsetWidth/2)/u.offsetWidth*360);e.modelValue.setHue(d)});function a(){const r=l.value,i=s.value;if(r==null||i==null)return-6;const u=e.modelValue.h;return Math.round(u/360*r.offsetWidth)-i.offsetWidth/2}return tn(()=>{t.value=a()}),(r,i)=>(C(),L("div",{class:p(r.classes.hue),onPointerdown:i[0]||(i[0]=(...u)=>b(o)&&b(o)(...u)),ref_key:"hueRef",ref:l},[c("div",{class:p(r.classes.thumb),style:Y({left:t.value+"px"}),ref_key:"thumbRef",ref:s},null,6)],34))}}),Xc="_hue_1ozoc_2",jc="_thumb_1ozoc_10",Zc={hue:Xc,thumb:jc},Kc={classes:Zc},Jc=D(Yc,[["__cssModules",Kc]]),Qc=q({__name:"AlphaSlider",props:{modelValue:{type:An,required:!0}},setup(n){const e=n,t=Z(-6),l=re(),s=re(),o=vs((r,i)=>{r=="end"&&(t.value=i);const u=l.value,m=s.value,d=Math.round((i+m.offsetWidth/2)/u.offsetWidth*100);e.modelValue.setAlpha(d)});function a(){const r=l.value,i=s.value;if(r==null||i==null)return-6;const u=e.modelValue.a;return Math.round(u/100*r.offsetWidth)-i.offsetWidth/2}return tn(()=>{t.value=a()}),(r,i)=>(C(),L("div",{class:p(r.classes.alpha),onPointerdown:i[0]||(i[0]=(...u)=>b(o)&&b(o)(...u)),ref_key:"alphaRef",ref:l},[c("div",{class:p(r.classes.thumb),style:Y({left:t.value+"px"}),ref_key:"thumbRef",ref:s},null,6)],34))}}),eu="_alpha_1x8jd_2",tu="_thumb_1x8jd_26",nu={alpha:eu,thumb:tu},lu={classes:nu},su=D(Qc,[["__cssModules",lu]]),ou=["#FFFFFF","#000000","#485368","#2972F4","#00A3F5","#319B62","#DE3C36","#F88825","#F5C400","#9A38D7","#F2F2F2","#7F7F7F","#F3F5F7","#E5EFFF","#E5F6FF","#EAFAF1","#FFE9E8","#FFF3EB","#FFF9E3","#FDEBFF","#D8D8D8","#595959","#C5CAD3","#C7DCFF","#C7ECFF","#C3EAD5","#FFC9C7","#FFDCC4","#FFEEAD","#F2C7FF","#BFBFBF","#3F3F3F","#808B9E","#99BEFF","#99DDFF","#98D7B6","#FF9C99","#FFBA84","#FFE270","#D58EFF","#A5A5A5","#262626","#353B45","#1450B8","#1274A5","#277C4F","#9E1E1A","#B86014","#A38200","#5E2281","#939393","#0D0D0D","#24272E","#0C306E","#0A415C","#184E32","#58110E","#5C300A","#665200","#3B1551"];function iu(){try{return typeof window.EyeDropper=="function"}catch(n){return console.log(n),!1}}async function ru(){try{return(await new EyeDropper().open()).sRGBHex}catch(n){return console.error(n),null}}const Cl={isSupport:iu,open:ru},au=["title","onClick"],cu=["title","onClick"],Rl="quickprint-recent-use-colors",uu=q({__name:"index",props:{modelValue:{type:String,default:null},showText:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(n,{emit:e}){const t=e,l=n,s=[{value:"hex",label:"HEX"},{value:"rgb",label:"RGB"},{value:"hsl",label:"HSL"}],o=Z(new An(l.modelValue)),a=re(),r=re(),i=Z(M()),u=Cl.isSupport(),m=Z("hex"),d=N(()=>{const _=l.modelValue;return _?{backgroundColor:_}:null}),h=N(()=>{const _=o.value,{r:T,g:w,b:R}=_.rgb();return{"--hue-channel-color":`hsl(${_.h}, 100%, 50%)`,"--alpha-channel-color-a":`rgba(${T}, ${w}, ${R}, 0)`,"--alpha-channel-color-b":`rgba(${T}, ${w}, ${R}, 1)`}}),v=N({get(){return o.value.toString(m.value)},set(_){o.value.setColor(_)}});function y(){var _;(_=a.value)==null||_.close()}function f(_){_!=null&&(t("update:modelValue",_),t("select",_),E(_),y())}function S(){t("update:modelValue",void 0),t("select",void 0),y()}function I(){Cl.open().then(_=>f(_))}function M(){const _=localStorage.getItem(Rl);if(_==null||_=="")return[];const T=Gn(_);return T==null?[]:Array.isArray(T)?T:[]}function E(_){const T=i.value,w=T.indexOf(_);w>=0&&T.splice(w,1),T.length>10&&T.pop(),T.unshift(_),localStorage.setItem(Rl,JSON.stringify(T))}function k(){t("update:modelValue",o.value.toString(m.value)),t("select",o.value.toString(m.value)),y()}return rl(()=>l.modelValue,()=>o.value.setColor(l.modelValue)),(_,T)=>(C(),K(b(rs),{class:p(_.classes.colorPicker),onMousedown:T[7]||(T[7]=ee(()=>{},["prevent"])),ref_key:"popoverRef",ref:a},{popover:ie(()=>[c("div",{class:p(_.classes.colorPickerPanel)},[c("div",{class:p(_.classes.presetPanel)},[c("div",{class:p(_.classes.presetTools)},[c("button",{type:"button",class:p(_.classes.clearBtn),onClick:S},[c("span",{class:p(_.classes.none)},null,2),T[8]||(T[8]=c("span",null,"无颜色",-1))],2),b(u)?(C(),L("button",{key:0,type:"button",class:p(_.classes.indicator),onClick:I},[g(b(O),{icon:"icon-eye-dropper"}),T[9]||(T[9]=c("span",null,"拾色器",-1))],2)):H("",!0)],2),c("div",{class:p(_.classes.colourAtla)},[(C(!0),L(U,null,j(b(ou),w=>(C(),L("div",{style:Y({backgroundColor:w}),title:w,class:p(_.classes.color),onClick:R=>f(w)},null,14,au))),256))],2),c("div",{class:p(_.classes.recentColors)},"最近使用",2),c("div",{class:p(_.classes.colourAtla)},[(C(),L(U,null,j(10,w=>c("div",{key:w,title:i.value[w-1],style:Y({backgroundColor:i.value[w-1]}),class:p(_.classes.color),onClick:R=>f(i.value[w-1])},null,14,cu)),64))],2)],2),c("div",{class:p(_.pacls.panel),style:Y(h.value)},[g(Wc,{class:p(_.pacls.sv),modelValue:o.value,"onUpdate:modelValue":T[1]||(T[1]=w=>o.value=w)},null,8,["class","modelValue"]),c("div",{class:p(_.pacls.sliders)},[g(Jc,{class:p(_.pacls.hua),modelValue:o.value,"onUpdate:modelValue":T[2]||(T[2]=w=>o.value=w)},null,8,["class","modelValue"]),g(su,{modelValue:o.value,"onUpdate:modelValue":T[3]||(T[3]=w=>o.value=w)},null,8,["modelValue"]),c("div",{class:p(_.pacls.preview)},[c("div",{class:p(_.pacls.previewColor),style:Y({backgroundColor:o.value.toRGB()})},null,6)],2)],2),c("div",{class:p(_.pacls.tools)},[g(b(X),{options:s,teleport:"none",modelValue:m.value,"onUpdate:modelValue":T[4]||(T[4]=w=>m.value=w),width:"42px",border:"none",size:"text"},null,8,["modelValue"]),ve(c("input",{type:"text","onUpdate:modelValue":T[5]||(T[5]=w=>v.value=w),onMousedown:T[6]||(T[6]=ee(()=>{},["stop"])),class:"quickprint-form-control",style:{width:"120px"}},null,544),[[Ce,v.value]]),c("button",{type:"button",class:p(_.pacls.confirm),onClick:k},"确定",2)],2)],6)],2)]),default:ie(()=>[c("div",{class:p(_.classes.colorPickerInput),ref_key:"inputRef",ref:r},[Ue(_.$slots,"default",{},()=>[c("span",{class:p(_.classes.colorBlock),style:Y(d.value)},null,6)]),n.showText?(C(),L("div",{key:0,class:p(_.classes.colorValue),onClick:T[0]||(T[0]=ee(()=>{},["stop"]))},B(n.modelValue),3)):H("",!0)],2)]),_:3},8,["class"]))}}),du="_colorPicker_qpnrm_2",fu="_colorPickerInput_qpnrm_6",pu="_colorBlock_qpnrm_13",mu="_colorValue_qpnrm_22",hu="_colorPickerPanel_qpnrm_27",gu="_presetPanel_qpnrm_42",vu="_colourAtla_qpnrm_46",bu="_color_qpnrm_2",yu="_presetTools_qpnrm_73",_u="_clearBtn_qpnrm_79",Eu="_indicator_qpnrm_80",Tu="_none_qpnrm_98",ku="_recentColors_qpnrm_129",wu={colorPicker:du,colorPickerInput:fu,colorBlock:pu,colorValue:mu,colorPickerPanel:hu,presetPanel:gu,colourAtla:vu,color:bu,presetTools:yu,clearBtn:_u,indicator:Eu,none:Tu,recentColors:ku},Su="_panel_911zv_2",Cu="_sv_911zv_7",Ru="_hua_911zv_11",Lu="_sliders_911zv_15",Nu="_tools_911zv_20",Iu="_confirm_911zv_37 quickprint-text-btn",$u="_preview_911zv_44",Au="_previewColor_911zv_59",qu={panel:Su,sv:Cu,hua:Ru,sliders:Lu,tools:Nu,confirm:Iu,preview:$u,previewColor:Au},Ou={classes:wu,pacls:qu},Ke=D(uu,[["__cssModules",Ou]]);class Mu{constructor(e){P(this,"__v_skip",!0);P(this,"observer");P(this,"callbacks",[]);P(this,"handler");this.handler=yi((t,l)=>{for(const s of this.callbacks)s(t,l)},500),this.observer=new MutationObserver((t,l)=>this.handler(t,l)),this.observer.observe(e,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}addListener(e){return typeof e!="function"||this.callbacks.findIndex(l=>l===e)>=0?!1:(this.callbacks.push(e),!0)}removeListener(e){const t=this.callbacks.findIndex(l=>l===e);return t<0?!1:(this.callbacks.splice(t,1),!0)}cleanup(){this.observer.disconnect(),this.callbacks=[]}}function Du(n,e){switch(n){case"fontSize":return e===me.DEFAULT?void 0:e;case"fontFamily":return e===Q.DEFAULT?void 0:e;case"lineHeight":return e===pt.DEFAULT?void 0:e;default:return e}}const Ll="texteditor-const-node",xu=Object.freeze({CONST:0});class Pu{constructor(e,t={}){P(this,"__v_skip",!0);P(this,"emitter",new _n);P(this,"container");P(this,"options");P(this,"observer");P(this,"handleClick");this.container=e,this.container.contentEditable="plaintext-only",this.container.classList.add("quickprint-text-editor"),this.options=t,this.observer=new Mu(e),this.handleClick=this.onClick.bind(this),Reflect.defineProperty(this,"emitter",{configurable:!1,enumerable:!1,writable:!1,value:new _n}),e.addEventListener("click",this.handleClick)}on(e,t){return this.emitter.on(e,t)}once(e,t){return this.emitter.once(e,t)}off(e,t){return this.emitter.off(e,t)}dispatch(e){return this.emitter.dispatch(e)}createEvent(e,t){return new Xs(e,t)}watch(e){return this.observer.addListener(e),()=>{this.observer!=null&&this.observer.removeListener(e)}}cleanup(){this.container.removeEventListener("click",this.handleClick),this.observer.cleanup(),this.emitter.cleanup()}getHTML(){return this.container.innerHTML}setHTML(e){return console.log("TODO: 光标"),this.container.innerHTML=e,!0}clear(){return this.container.innerHTML="",!0}focus(){this.container.focus()}blur(){this.container.blur()}getSelection(){const e=this.container,t=window.getSelection();if(t==null||!e.contains(t.anchorNode)||!e.contains(t.focusNode))return null;const l=t.getRangeAt(0);return l==null?null:{selection:t,range:l}}hasSelection(){const e=this.getSelection();return e==null?!1:!e.selection.isCollapsed}normalize(){const e=this.container;for(let t=e.childNodes.length-1;t>=0;t--){const l=e.childNodes[t];if(se(l.textContent)){e.removeChild(l);continue}if(l instanceof HTMLElement){if(l.contentEditable==="false")continue;l.style.length===0&&l.replaceWith(l.textContent)}}return e.normalize(),e}updateHeight(){const e=this.container.scrollHeight;return this.dispatch(this.createEvent("resize",{height:e})),e}async autosize(){this.container.style.height="auto";const e=this.updateHeight();return await kn(),this.container.style.removeProperty("height"),e}checkHeight(){const e=this.container;e.scrollHeight>e.clientHeight&&this.updateHeight()}createConstNode(e){const t=document.createElement("span");return t.contentEditable="false",t.innerText=`${e.label??e.value}`,t.className=Ll,t.dataset.value=e.value,t.dataset.type=e.type+"",t}focusAfterNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),t.collapseToEnd(),!0}focusNode(e){if(!this.container.contains(e))return!1;const t=window.getSelection();if(t==null)return!1;const l=new Range;return l.selectNode(e),t.removeAllRanges(),t.addRange(l),!0}focusNodes(e){if(e.length==0)return!1;if(e.length==1)return this.focusNode(e[0]);const t=window.getSelection();if(t==null)return!1;const l=new Range,s=e[0],o=e[e.length-1];return!this.container.contains(s)||!this.container.contains(o)?!1:(t.removeAllRanges(),l.setStartBefore(s),l.setEndAfter(o),t.addRange(l),!0)}insertNode(e,t){var h;const l=this.getSelection();if(l==null)return!1;const{selection:s,range:o}=l;if(s.isCollapsed!=!0&&s.deleteFromDocument(),s.isCollapsed!=!0)return!1;const a=s.anchorNode;if(a==null)return!1;const r=this.container,i=this.createConstNode(e);if(typeof(t==null?void 0:t.onCreateNode)=="function"&&t.onCreateNode(i),a.parentNode===r||(h=a.parentNode)!=null&&h.contains(r))return o.insertNode(i),this.normalize(),this.focusAfterNode(i),!0;const u=a.parentNode;if(u==null)return!1;const m=u.textContent;if(m==null)return!1;if(s.anchorOffset==m.length)return r.insertBefore(i,u.nextSibling),this.normalize(),this.focusAfterNode(i),!0;const d=document.createElement("span");return d.textContent=m.slice(0,s.anchorOffset),u instanceof HTMLElement&&(d.style.cssText=u.style.cssText),u.textContent=m.slice(s.anchorOffset),r.insertBefore(i,u),r.insertBefore(d,i),this.normalize(),this.focusAfterNode(i),!0}insertText(e){const t=this.getSelection();if(t==null)return!1;const{selection:l,range:s}=t;return l.isCollapsed||l.deleteFromDocument(),s.insertNode(document.createTextNode(e)),l.collapseToEnd(),this.normalize(),!0}normalizeRange(e){const t=this.container,l=e.startContainer,s=e.endContainer,o={};return l===t?(o.startNode=t.childNodes[e.startOffset],o.startOffset=-1):(o.startNode=l.parentNode==t?l:l.parentNode,o.startOffset=e.startOffset),s===t?(o.endNode=t.childNodes[e.endOffset],o.endOffset=-1):(o.endNode=s.parentNode==t?s:s.parentNode,o.endOffset=e.endOffset),o}findNodesBetween(e,t){const l=[];let s=e.nextSibling;for(;s!=null&&s!==t;)l.push(s),s=s.nextSibling;return l}inheritStyle(e,t){if(!(t instanceof HTMLElement))return!1;const l=t.style.cssText;return se(l)?!1:(e.style.cssText=l,!0)}extractNodesFromRange(){var m;const e=this.container,t=this.getSelection();if(t==null||t.selection.isCollapsed)return null;const s=t.range,{startNode:o,startOffset:a,endNode:r,endOffset:i}=this.normalizeRange(s);if(o===r){const d=o.textContent??"";if(o instanceof CharacterData){const y=document.createElement("span");return y.textContent=d.slice(a,i),s.deleteContents(),s.insertNode(y),[y]}const h=document.createElement("span");h.textContent=d.slice(0,a),this.inheritStyle(h,r);const v=document.createElement("span");return v.textContent=d.slice(a,i),this.inheritStyle(v,r),r.textContent=d.slice(i),e.insertBefore(v,r),e.insertBefore(h,v),[v]}const u=this.findNodesBetween(o,r);if(a>0){const d=o.textContent??"",h=document.createElement("span");h.textContent=d.slice(0,a),this.inheritStyle(h,o),o.textContent=d.slice(a),e.insertBefore(h,o)}if(i>=0&&i<=(((m=r.textContent)==null?void 0:m.length)??0)){const d=r.textContent??"";if(r instanceof HTMLElement){r.textContent=d.slice(0,i);const h=document.createElement("span");h.textContent=d.slice(i),this.inheritStyle(h,r),e.insertBefore(h,r.nextSibling),u.push(r)}else{const h=document.createElement("span");h.textContent=d.slice(0,i),e.replaceChild(h,r);const v=document.createTextNode(d.slice(i));e.insertBefore(v,r.nextSibling),u.push(h)}}return u.unshift(o),u}setStyle(e,t){const l=this.extractNodesFromRange();if(l==null||l.length==0)return!1;let s=!0;const o=Fl(e),a=Du(e,t);for(let r=0;r<l.length;r++){const i=l[r];if(i instanceof HTMLElement){this.matchElementStyle(i,o,a)||(s=!1);continue}const u=document.createElement("span");u.textContent=i.textContent,this.container.replaceChild(u,i),l[r]=u,s=!1}for(const r of l){if(s||a==null){this.removeElementStyle(r,o,a);continue}this.setElementStyle(r,o,a)}return this.focusNodes(l),!0}matchElementStyle(e,t,l){const s=e.style.getPropertyValue(t);return t==="text-decoration-line"?s.includes(l):s==l}setElementStyle(e,t,l){if(t==="text-decoration-line"){const s=e.style.getPropertyValue("text-decoration-line"),o=ht.push(s,l);e.style.setProperty("text-decoration-line",o);return}e.style.setProperty(t,l)}removeElementStyle(e,t,l){if(t==="text-decoration-line"){const s=e.style.getPropertyValue("text-decoration-line"),o=ht.remove(s,l);se(o)?e.style.removeProperty("text-decoration-line"):e.style.setProperty("text-decoration-line",o);return}e.style.removeProperty(t)}onClick(e){const t=e.target;if(t instanceof HTMLElement&&t.matches("."+Ll)){e.preventDefault(),e.stopPropagation(),this.focusNode(t);return}}}const Vu=[{label:"微软雅黑",value:"Microsoft YaHei"},{label:"宋体",value:Q.SONG},{label:"黑体",value:"黑体"},{label:"仿宋",value:"仿宋"},{label:"楷体",value:"楷体"}],bs=[{label:"Arial",value:"Arial"},{label:"Consolas",value:"Consolas"},{label:"Times",value:"Times"},{label:"Times New Roman",value:"Times New Roman"}],ys=[{label:"默认",value:Q.DEFAULT},...bs],qn=[{label:"默认",value:Q.DEFAULT},...Vu,...bs],ml=[{label:"默认",value:me.DEFAULT},{label:"初号",value:me.SIZE_0+"pt",short:"56px"},{label:"小初",value:me.SIZE_0_S+"pt",short:"≈49.33px"},{label:"一号",value:me.SIZE_1+"pt",short:"≈34.67px"},{label:"小一",value:me.SIZE_1_S+"pt",short:"32px"},{label:"二号",value:me.SIZE_2+"pt",short:"≈29.33px"},{label:"小二",value:me.SIZE_2_S+"pt",short:"24px"},{label:"三号",value:me.SIZE_3+"pt",short:"≈21.33px"},{label:"小三",value:me.SIZE_3_S+"pt",short:"20px"},{label:"四号",value:me.SIZE_4+"pt",short:"≈18.67px"},{label:"小四",value:me.SIZE_4_S+"pt",short:"16px"},{label:"五号",value:me.SIZE_5+"pt",short:"14px"},{label:"小五",value:me.SIZE_5_S+"pt",short:"12px"},{label:"12px",value:"12px"},{label:"13px",value:"13px"},{label:"14px",value:"14px"},{label:"15px",value:"15px"},{label:"16px",value:"16px"},{label:"18px",value:"18px"},{label:"20px",value:"20px"},{label:"22px",value:"22px"},{label:"24px",value:"24px"},{label:"28px",value:"28px"},{label:"32px",value:"32px"},{label:"36px",value:"36px"},{label:"42px",value:"42px"},{label:"48px",value:"48px"},{label:"56px",value:"56px"},{label:"72px",value:"72px"}],_s=[{label:"默认",value:pt.DEFAULT},{label:"1.0",value:pt.TIMES_1,short:"单倍行距"},{label:"1.1",value:pt.TIMES_1_1},{label:"1.5",value:pt.TIMES_1_5},{label:"2.0",value:pt.TIMES_2,short:"两倍行距"}],zu=[{label:"无",value:cn.NONE},{label:"实线",value:St.SOLID},{label:"虚线",value:St.DASHED},{label:"点划线",value:St.DOTTED},{label:"双实线",value:St.DOUBLE},{label:"波浪线",value:St.WAVY}],Bu=[{label:"默认",value:mt.AUTO},{label:"左对齐",value:mt.LEFT},{label:"居中对齐",value:mt.CENTER},{label:"右对齐",value:mt.RIGHT},{label:"两端对齐",value:mt.JUSTIFY}],jn=[{label:"顶部对齐",value:Fe.TOP,icon:"icon-vertical-align-top"},{label:"垂直居中",value:Fe.MIDDLE,icon:"icon-vertical-align-middl"},{label:"底部对齐",value:Fe.BOTTOM,icon:"icon-vertical-align-bottom"}],Zn=[{label:"左对齐",value:je.LEFT,icon:"icon-align-left"},{label:"居中对齐",value:je.CENTER,icon:"icon-align-center"},{label:"右对齐",value:je.RIGHT,icon:"icon-align-right"},{label:"两端对齐",value:je.JUSTIFY,icon:"icon-menu"}],Fu=q({__name:"ParagraphEditor",props:{element:{type:js,required:!0}},setup(n){const e=n,t=be(),l=re(),s=N(()=>e.element.isSelected!==!0?!1:t.state.selectMode===et.SINGLE);let o=null;const a=N(()=>qn.map(_=>(_.style={fontFamily:_.value==Q.DEFAULT?Q.SONG:_.value},_)));function r(){}async function i(){if(o==null)return;const _=await $t({doc:t.doc}).catch(Xe);if(_==null)return;const T=tt(_.value,t.doc.ds)??_.value,w={type:xu.CONST,value:_.value,label:T};o.insertNode(w)}function u(){o==null||o.blur()}function m(){o==null||o.autosize()}function d(_){const T=e.element.ds.value,w=new Pu(_);return w.on("resize",R=>{var G;const $=(G=R.detail)==null?void 0:G.height;$!=null&&e.element.setHeight($+2)}),w.watch(()=>{const R=w.getHTML(),$=e.element.ds.value;R!==$&&(e.element.ds.value=R,w.checkHeight())}),se(T)||w.setHTML(T),w}function h(_){o==null||o.setStyle("fontFamily",_.value)}function v(_){o==null||o.setStyle("fontSize",_.value)}function y(_){o==null||o.setStyle("lineHeight",_.value)}function f(_){o==null||o.setStyle("backgroundColor",_)}function S(_){o==null||o.setStyle("color",_)}function I(){o==null||o.setStyle("fontWeight","700")}function M(){o==null||o.setStyle("fontStyle","italic")}function E(){o==null||o.setStyle("textDecorationLine","underline")}function k(){o==null||o.setStyle("textDecorationLine","line-through")}return rl(()=>e.element.ds.value,_=>{o==null||o.getHTML()==_||o.setHTML(_)}),tn(()=>{e.element.on("blur",u),o=d(l.value)}),il(()=>{e.element.off("blur",u),o&&o.cleanup()}),(_,T)=>(C(),L("div",{class:p(_.classes.paragraph),onPointerdown:T[2]||(T[2]=ee(()=>{},["stop"])),onContextmenu:ee(r,["stop","prevent"])},[c("div",{class:p(_.classes.indicator),onPointerdown:T[0]||(T[0]=(...w)=>b(t).onDragStart&&b(t).onDragStart(...w)),title:"选中/拖动段落"},null,34),s.value?(C(),L("div",{key:0,class:p(_.classes.toolbar),onMousedown:T[1]||(T[1]=ee(()=>{},["prevent"]))},[g(b(X),{onSelect:h,title:"字体",width:"60px",options:a.value,class:p(_.classes.tool),button:""},null,8,["options","class"]),g(b(X),{onSelect:v,title:"字号",width:"60px",options:b(ml),class:p(_.classes.tool),button:""},null,8,["options","class"]),g(b(X),{onSelect:y,title:"行高",width:"60px",options:b(_s),class:p(_.classes.tool),popoverWidth:120,button:""},null,8,["options","class"]),c("div",{class:p(_.classes.divider)},null,2),g(Ke,{class:p(_.classes.tool),onSelect:f},{default:ie(()=>[c("div",{class:p(_.classes.colorIcon),title:"突出显示"},[g(b(O),{icon:"icon-bg-color-b",size:"15px"}),c("div",{class:p(_.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),g(Ke,{class:p(_.classes.tool),onSelect:S},{default:ie(()=>[c("div",{class:p(_.classes.colorIcon),title:"字体颜色"},[g(b(O),{icon:"icon-font",size:"15px"}),c("div",{class:p(_.classes.colorIndicator)},null,2)],2)]),_:1},8,["class"]),c("button",{onClick:I,type:"button",title:"加粗",class:p(["quickprint-text-btn",_.classes.tool])},[g(b(O),{icon:"icon-font-bold",size:"16px"})],2),c("button",{onClick:M,type:"button",title:"斜体",class:p(["quickprint-text-btn",_.classes.tool])},[g(b(O),{icon:"icon-italic",size:"16px"})],2),c("button",{onClick:E,type:"button",title:"下划线",class:p(["quickprint-text-btn",_.classes.tool])},[g(b(O),{icon:"icon-underline",size:"16px"})],2),c("button",{onClick:k,type:"button",title:"删除线",class:p(["quickprint-text-btn",_.classes.tool])},[g(b(O),{icon:"icon-through-line",size:"16px"})],2),c("div",{class:p(_.classes.divider)},null,2),c("button",{class:"quickprint-text-btn",type:"button",onClick:i},[g(b(O),{icon:"icon-insert-var",size:"16px"}),T[3]||(T[3]=c("span",null,"插入变量",-1))]),c("button",{class:"quickprint-text-btn",type:"button",onClick:m},[g(b(O),{icon:"icon-colum-height",size:"16px"}),T[4]||(T[4]=c("span",null,"调整高度",-1))])],34)):H("",!0),c("div",{ref_key:"editorRef",ref:l,class:p(_.classes.editor)},null,2)],34))}}),Uu="_paragraph_1v2pj_2",Hu="_indicator_1v2pj_6",Gu="_editor_1v2pj_18",Wu="_toolbar_1v2pj_44",Yu="_tool_1v2pj_44",Xu="_colorIcon_1v2pj_66",ju="_colorIndicator_1v2pj_86",Zu="_divider_1v2pj_95",Ku={paragraph:Uu,indicator:Hu,editor:Gu,toolbar:Wu,tool:Yu,colorIcon:Xu,colorIndicator:ju,divider:Zu},Ju={classes:Ku},Qu=D(Fu,[["__cssModules",Ju]]),On=Object.freeze({title:"段落",type:W.PARAGRAPH,features:{draggable:!1,contextMenu:!1},editor:Qu,config:{exclude:[le.DATASOURCE,le.BASIC,le.OVERFLOW]},onCreate(){return pe.create({type:W.PARAGRAPH,width:bt*4,height:Sn*6})}}),Es=[Ln,Nn,In,$n,pl,gs,On],ed=[Ln,Nn,In,$n,On],td={[W.TEXT]:Ln.editor,[W.NUMBER]:Nn.editor,[W.DATE]:In.editor,[W.TABLE]:$n.editor,[W.TABLE_CELL]:pl.editor,[W.PARAGRAPH]:On.editor},nd={[W.TEXT]:Ln.config,[W.NUMBER]:Nn.config,[W.DATE]:In.config,[W.TABLE]:$n.config,[W.TABLE_CELL]:pl.config,[W.TABLE_ROW]:gs.config,[W.PARAGRAPH]:On.config},zt=Es.reduce((n,e)=>(n[e.type]=e,n),{});function ld(n){const e=Es.find(t=>t.type===n);if(e==null||typeof e.onCreate!="function")throw new Error("未知的打印元素");return e.onCreate()}function sd(n){return Reflect.get(td,n)}function Rt(n){return Reflect.get(nd,n)}function Jt(n){var e;return((e=zt[n])==null?void 0:e.title)??n}function od(n){var e;return(e=zt[n])==null?void 0:e.icon}function id(n){var e,t;return((t=(e=zt[n])==null?void 0:e.features)==null?void 0:t.selection)!==!1}function rd(n){var e,t;return((t=(e=zt[n])==null?void 0:e.features)==null?void 0:t.contextMenu)!==!1}function ad(n){var e,t;return((t=(e=zt[n])==null?void 0:e.features)==null?void 0:t.resizable)!==!1}function cd(n){var e,t;return((t=(e=zt[n])==null?void 0:e.features)==null?void 0:t.draggable)!==!1}function Nl(n,e,t,l){const[s,o]=e.top>t.top?[t,e]:[e,t],a=s.top-l.top,r=o.bottom-s.top;return{top:a,left:n,height:r}}function Il(n,e,t,l){const[s,o]=e.left>t.left?[t,e]:[e,t],a=s.left-l.left,r=o.right-s.left;return{top:n,left:a,width:r}}function $l(n,e){const t=n.find(i=>i.left===e.left);if(t==null||t.height==null)return n.push(e);const l=e.top+e.height,s=t.top+t.height,o=Math.min(t.top,e.top),r=Math.max(l,s)-o;t.top=o,t.height=r}function Al(n,e){const t=n.find(i=>i.top===e.top);if(t==null||t.width==null)return n.push(e);const l=e.left+e.width,s=t.left+t.width,o=Math.min(t.left,e.left),r=Math.max(l,s)-o;t.left=o,t.width=r}function ud(n){const e=document.createElement("div");return n.appendChild(e),e}function dd(n,e){const t=[...e.querySelectorAll(":scope ."+F.GUIDE_LINE)];for(const l of n){const s=t.shift()??ud(e);s.className=F.GUIDE_LINE,s.style.top=l.top+"px",s.style.left=l.left+"px",s.style.height=(l.height??1)+"px",s.style.width=(l.width??1)+"px"}for(const l of t)l.remove()}function fd(n,e){const l=e.querySelectorAll(":scope ."+F.ELEMENT),s=e.getBoundingClientRect(),o=n.getBoundingClientRect(),a=[];for(const r of l){if(n==r)continue;const i=r.getBoundingClientRect();if(Math.abs(o.left-i.left)<=1||Math.abs(o.right-i.left)<=1){const u=i.left-s.left;$l(a,Nl(u,o,i,s))}if(Math.abs(o.left-i.right)<=1||Math.abs(o.right-i.right)<=1){const u=i.right-s.left;$l(a,Nl(u,o,i,s))}if(Math.abs(o.top-i.top)<=1||Math.abs(o.bottom-i.top)<=1){const u=i.top-s.top;Al(a,Il(u,o,i,s))}if(Math.abs(o.bottom-i.bottom)<=1||Math.abs(o.top-i.bottom)<=1){const u=i.bottom-s.top;Al(a,Il(u,o,i,s))}}dd(a,e)}function pd(){const n=document.querySelectorAll("."+F.GUIDE_LINE);for(const e of n)e.remove()}const Tn={create:_i(fd,50),clean:pd};async function md(n){await kn(),n&&Reflect.deleteProperty(n,wn)}async function hd(n,e){if(await Promise.resolve(),e.dropTarget==null){e.indicatorElement&&(e.indicatorElement.style.display="none");return}if(e.indicatorElement==null){const o=document.createElement("div");o.className="quickprint-is-indicator",e.indicatorElement=o,document.body.appendChild(o)}const t=gd(n,e);if(t==null){e.indicatorElement.style.display="none";return}const l=e.indicatorElement,s=e.ghost.getBoundingClientRect();l.style.display="block",l.style.left=s.left+"px",l.style.top=s.top-ls(e.element)+"px",l.textContent=`x:${t.x},y:${t.y},w:${t.w},h:${t.h}`}function gd(n,e){const t=e.dropTarget;if(t==null)return null;const l=n.doc.useGrid;if(e.mode===we.INSERT){const s=t.closest("."+F.PAGE);if(s==null)return null;const o=s.getBoundingClientRect();return{x:l?Lt(e.left-o.left):Math.round(e.left-o.left),y:l?Lt(e.top-o.top):Math.round(e.top-o.top),w:e.element.width,h:e.element.height}}return{x:l?Lt(e.left):Math.round(e.left),y:l?Lt(e.top):Math.round(e.top),w:e.element.width,h:e.element.height}}function vd(n){return!(n.style.rotate&&!n.isSelected)}function bd(n){const e=new Yn({selector:{container:F.DROPPABLE},scale(t){return t.mode===we.INSERT?100:n.state.scale}});return e.on("before-dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const s=Reflect.get(l.target,Zl),o=Reflect.get(l.target,al);s===we.INSERT&&(l.container=n.component.getRootElement(),l.ghost=n.component.getGhostElement()),l.mode=s===we.INSERT?s:we.MOVE,l.elementType=o,l.initDragElement=!1}),e.on("dragstart",t=>{const l=t.detail;if(l==null)return t.preventDefault();if(l.mode===we.INSERT){const o=ld(l.elementType);l.element=o,l.ghost.style.width=o.width+"px",l.ghost.style.height=o.height+"px";return}const s=Reflect.get(l.target,Qe);if(s==null||!vd(s))return t.preventDefault();l.element=s}),e.on("dragging",t=>{const l=t.detail;l!=null&&(l.initDragElement!==!0&&(l.mode===we.INSERT&&(l.ghost.style.display="block"),l.mode===we.MOVE&&Reflect.set(l.target,wn,cl.DRAG_ELEMENT),l.ghost.classList.add(F.DRAGGING),l.initDragElement=!0),hd(n,l),l.dropTarget&&Tn.create(l.ghost,l.dropTarget))}),e.on("dragend",t=>{const l=t.detail;if(l==null||l.initDragElement!==!0)return;Tn.clean(),l.ghost.classList.remove(F.DRAGGING),l.indicatorElement&&document.body.removeChild(l.indicatorElement),l.mode===we.INSERT&&(l.ghost.style.display="none"),l.mode==we.MOVE&&md(l.target);const s=l.element;if(l.mode==we.MOVE){s.setTop(l.top),s.setLeft(l.left),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),n.selectElement(s),n.createSnapshot();return}if(l.dropTarget==null)return;const o=Reflect.get(l.dropTarget,Kl);if(o==null)return;const a=o instanceof _t||o instanceof pe?o:null;if(a==null)return;const r=l.dropTarget.getBoundingClientRect(),i=n.state.scale/100;s.setTop((l.top-r.top)/i),s.setLeft((l.left-r.left)/i),s.setWidth(s.width/i),s.setHeight(s.height/i),a.append(l.element),n.selectElement(s),n.createSnapshot()}),n.onDragStart=e.onDragStart,e}const ql="quickprint-history-0000",yd=1,Ge="snapshot",hn="health",Ol="owner",Ve="INDEX_OWNER",_d=15*60*1e3,Ed=10*60*1e3;function Td(){const n={db:null,timer:null,promise:null};async function e(){const m=await i(hn,"readwrite");if(m==null)return n.timer=o(),!1;const d=[],h=m.openCursor();h.onsuccess=async function(v){const y=v.target.result;if(y==null){t(d),n.timer=o(),Se.debug("History","已检查无效快照");return}const f=y.value;f!=null&&Date.now()-f.timestamp>_d&&d.push(f),y.continue()},h.onerror=function(v){console.error(v),n.timer=o()}}async function t(m){const d=await Promise.allSettled(m.map(h=>l(h.owner)));for(let h=0;h<d.length;h++){const v=d[h];v.status==="rejected"||v.value!==!0||s(m[h].id)}}async function l(m){const d=await i(Ge,"readwrite");return d==null?!1:new Promise(h=>{const v=d.index(Ve).openCursor(IDBKeyRange.only(m));v.onsuccess=function(y){const f=y.target.result;if(f==null)return h(!0);f.delete(),f.continue()},v.onerror=function(y){console.error(y),h(!1)}})}async function s(m){const d=await i(hn,"readwrite");return d==null?!1:Xt(d.delete(m)).then(()=>!0).catch(h=>(console.log(h),!1))}function o(){return n.timer&&clearTimeout(n.timer),setTimeout(()=>e(),Ed)}function a(){return new Promise(m=>{const d=indexedDB.open(ql,yd);d.onupgradeneeded=h=>{const y=h.target.result,f=y.createObjectStore(hn,{keyPath:"id",autoIncrement:!0}),S=y.createObjectStore(Ge,{keyPath:"id",autoIncrement:!0});f.createIndex(Ve,Ol),S.createIndex(Ve,Ol)},d.onsuccess=h=>{const v=h.target;n.db=v.result,Se.debug("History",`已连接数据库【${ql}】`),m(n.db)},d.onerror=function(h){console.error(h),n.db=null,m(null)}})}function r(){return n.promise==null?Promise.resolve(n.db):n.promise}async function i(m,d="readonly"){const h=await r();if(h==null)return null;try{return h.transaction(m,d).objectStore(m)}catch(v){return console.error(v),null}}function u(){n.promise=null,n.db&&(n.db.close(),n.db=null),n.timer&&(clearTimeout(n.timer),n.timer=null)}return n.promise=a(),n.timer=o(),e(),{ready:r,findStore:i,cleanup:u}}function Xt(n){return new Promise((e,t)=>{n.onsuccess=function(l){const s=l.target;e(s.result)},n.onerror=function(l){console.error(l),t()}})}const kd=5*60*1e3,ct=Td();var ze,Ne,gn,Kn,Ts;class wd{constructor(e,t={}){Pe(this,Ne);P(this,"state");P(this,"owner");Pe(this,ze);this.state=e,this.owner=t.owner??Zs(Ks.HISTORY_OWNER),Ee(this,Ne,Kn).call(this)}get index(){return this.state.index}get count(){return this.state.count}async createSnapshot(e,t){const l=await ct.findStore(Ge,"readwrite");if(l==null)return!1;await Ee(this,Ne,Ts).call(this,l);const s=this.state.index+1,o={index:s,data:JSON.stringify(e),timestamp:Date.now(),owner:this.owner,action:t==null?void 0:t.action};return await Xt(l.put(o)).catch(Xe)==null?!1:(this.state.index=s,this.state.count=s+1,!0)}async replaceSnapshot(e,t){const l=await this.getCurrentSnapshot();if(l==null||l.action!==t.action)return this.createSnapshot(e,t);const s=await ct.findStore(Ge,"readwrite");return!(s==null||(l.data=JSON.stringify(e),await Xt(s.put(l)).catch(Xe)==null))}async getCurrentSnapshot(){const e=await ct.findStore(Ge);if(e==null)return null;const t=this.index;if(t<0)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ve).openCursor(IDBKeyRange.only(l),"prev");o.onsuccess=a=>{const r=a.target.result;if(r==null)return s(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return s(i);r.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getPrevSnapshot(){const e=await ct.findStore(Ge);if(e==null)return null;const t=this.state.index-1;if(t<0)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ve).openCursor(IDBKeyRange.only(l),"prev");o.onsuccess=a=>{const r=a.target.result;if(r==null)return s(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return this.state.index=t,s(r.value);r.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getNextSnapshot(){const e=await ct.findStore(Ge);if(e==null)return null;const t=this.state.index+1;if(t>this.state.count-1)return null;const l=this.owner;return new Promise(s=>{const o=e.index(Ve).openCursor(IDBKeyRange.only(l),"next");o.onsuccess=a=>{const r=a.target.result;if(r==null)return s(null);const i=r.value;if(i.owner!=l)return r.continue();if(i.index==t)return this.state.index=t,s(r.value);r.continue()},o.onerror=function(a){console.error(a),s(null)}})}async getUsageSpace(){const e=await navigator.storage.estimate(),t=e.usage;return t==null?null:{usage:t/1024/1024,percent:e.quota?t/e.quota*100:-1}}async list(){const e=await ct.findStore(Ge);if(e==null)return[];const t=this.owner;return new Promise(l=>{const s=e.index(Ve).openCursor(IDBKeyRange.only(t),"prev"),o=[];s.onsuccess=a=>{const r=a.target.result;if(r==null)return l(o);const i=r.value;if(i.owner!=t)return r.continue();o.push(i),r.continue()},s.onerror=function(a){console.error(a),l([])}})}cleanup(){_e(this,ze)&&(clearTimeout(_e(this,ze)),rt(this,ze,null))}}ze=new WeakMap,Ne=new WeakSet,gn=function(){rt(this,ze,setTimeout(()=>Ee(this,Ne,Kn).call(this),kd))},Kn=async function(){_e(this,ze)&&clearTimeout(_e(this,ze));const e=await ct.findStore(hn,"readwrite");if(e==null)return Ee(this,Ne,gn).call(this);const t=await Xt(e.index(Ve).get(this.owner)).catch(Xe);if(t==null){const l={owner:this.owner,timestamp:Date.now()};return e.add(l),Ee(this,Ne,gn).call(this)}t.timestamp=Date.now(),await Xt(e.put(t)).catch(Xe),Ee(this,Ne,gn).call(this)},Ts=function(e){const t=this.state.index,l=this.state.count;if(t<0||t==l-1)return Promise.resolve(!0);const s=this.owner;return new Promise(o=>{const a=e.index(Ve).openCursor(IDBKeyRange.only(s),"prev");a.onsuccess=function(r){const i=r.target.result;if(i==null)return o(!0);const u=i.value;if(u.owner!=s)return i.continue();if(u.index>t){i.delete(),i.continue();return}o(!0)},a.onerror=function(r){console.error(r),o(!1)}})};function Sd(n){const e=new wd(qe({index:-1,count:0}));function t(){return e.index>0}function l(){return e.index>=0&&e.index<e.count-1}function s(m){return e.createSnapshot(n.value,m)}function o(m){return e.replaceSnapshot(n.value,m)}async function a(){const m=await e.getPrevSnapshot();if(m==null)return!1;const d=Gn(m.data);return d==null?!1:(n.value=fe.create(d),!0)}async function r(){const m=await e.getNextSnapshot();if(m==null)return!1;const d=Gn(m.data);return d==null?!1:(n.value=fe.create(d),!0)}function i(){return e.list()}function u(){e.cleanup()}return s(),{allowRedo:l,allowUndo:t,createSnapshot:s,undo:a,redo:r,list:i,cleanup:u,replaceSnapshot:o}}class Cd{constructor(e){P(this,"moved",!1);P(this,"position");P(this,"top",0);P(this,"left",0);P(this,"width",0);P(this,"height",0);P(this,"initX",0);P(this,"initY",0);P(this,"indicator");P(this,"container");P(this,"originalEvent");P(this,"target");this.indicator=e.indicator,this.container=e.container,this.target=e.target,this.originalEvent=e.event,this.position=e.position,this.initX=e.event.clientX,this.initY=e.event.clientY}init(e=1){const t=this.target.getBoundingClientRect(),l=this.container.getBoundingClientRect();this.top=(t.top-l.top)/e,this.left=(t.left-l.left)/e,this.width=t.width/e,this.height=t.height/e,this.indicator.setPointerCapture(this.originalEvent.pointerId)}}var Mt,Dt,lt,ks,ws,Ss;const ye=class ye extends _n{constructor(t={}){var l,s,o;super();Pe(this,lt);P(this,"context",null);P(this,"selector");P(this,"scale");P(this,"onResizeStart");Pe(this,Mt);Pe(this,Dt);this.scale=t.scale,this.selector={container:((l=t.selector)==null?void 0:l.container)??F.PAGE,element:((s=t.selector)==null?void 0:s.element)??F.RESIZEABLE,indicator:((o=t.selector)==null?void 0:o.indicator)??F.RESIZEABLE_INDICATOR},this.onResizeStart=Ee(this,lt,ks).bind(this),rt(this,Mt,Ee(this,lt,ws).bind(this)),rt(this,Dt,Ee(this,lt,Ss).bind(this))}normalizeScale(){if(this.scale==null)return 1;const t=typeof this.scale=="function"?this.scale(this.context):this.scale;return t<=0?1:t/100}reset(){if(this.context==null)return;const t=this.context.indicator;t&&t.releasePointerCapture(this.context.originalEvent.pointerId),window.removeEventListener("pointermove",_e(this,Mt)),window.removeEventListener("pointerup",_e(this,Dt)),this.context=null}};Mt=new WeakMap,Dt=new WeakMap,lt=new WeakSet,ks=function(t){if(t.button!==0)return;const l=t.target.closest("."+this.selector.indicator);if(l==null)return Se.warn(ye.TAG_NAME,"未找到的可调整元素");const s=Reflect.get(l,Jl);if(s==null)return Se.warn(ye.TAG_NAME,"未找到的可调整元素");const o=l.closest("."+this.selector.element);if(o==null)return Se.warn(ye.TAG_NAME,"未找到的可调整元素");const a=ns(o,this.selector.container);this.context=new Cd({event:t,indicator:l,target:o,container:a,position:s});const r=this.createEvent("before-resizestart",this.context);if(this.dispatch(r).defaultPrevented)return Se.warn(ye.TAG_NAME,"已取消调整");if(this.context.container==null)return Se.warn(ye.TAG_NAME,"未找到的调整元素的容器");this.context.init(this.normalizeScale()),t.stopPropagation(),t.preventDefault();const i=this.createEvent("resizestart",this.context);if(this.dispatch(i).defaultPrevented)return Se.warn(ye.TAG_NAME,"已取消调整");window.addEventListener("pointermove",_e(this,Mt)),window.addEventListener("pointerup",_e(this,Dt))},ws=function(t){const l=this.context;if(l==null)return;const s=l.position,o=this.normalizeScale(),a=l.container.getBoundingClientRect(),r=l.target.getBoundingClientRect();if(s&Yt.TOP){const u=Math.max((r.bottom-t.clientY)/o,ye.MIN_LENGTH);l.top=(r.bottom-a.top)/o-u,l.height=u}if(s&Yt.BOTTOM&&(l.height=Math.max((t.clientY-r.top)/o,ye.MIN_LENGTH)),s&Yt.LEFT){const u=Math.max((r.right-t.clientX)/o,ye.MIN_LENGTH);l.left=(r.right-a.left)/o-u,l.width=u}s&Yt.RIGHT&&(l.width=Math.max((t.clientX-r.left)/o,ye.MIN_LENGTH));const i=this.createEvent("resizing",l);this.dispatch(i).defaultPrevented||(l.target.style.top=l.top+"px",l.target.style.left=l.left+"px",l.target.style.width=l.width+"px",l.target.style.height=l.height+"px")},Ss=function(t){const l=this.context;if(l==null)return;t.preventDefault(),l.originalEvent=t;const s=this.createEvent("resizeend",l);this.dispatch(s).defaultPrevented||this.reset()},P(ye,"TAG_NAME","quickprint-resizeable"),P(ye,"MIN_LENGTH",12);let Jn=ye;async function Rd(n,e){if(await Promise.resolve(),e.indicatorElement==null){const r=document.createElement("div");r.className="quickprint-is-indicator",e.indicatorElement=r,document.body.appendChild(r)}const t=n.doc.useGrid,l=t?Lt(e.width):Math.round(e.width),s=t?Lt(e.height):Math.round(e.height),o=e.indicatorElement,a=e.target.getBoundingClientRect();o.style.display="block",o.style.left=a.left+"px",o.style.top=a.top-ls(e.element)+"px",o.textContent=`x:${e.top},y:${e.left},w:${l},h:${s}`}function Ld(n){const e=new Jn({scale:()=>n.state.scale});return e.on("resizestart",t=>{const l=t.detail;if(l==null)return t.preventDefault();const s=Reflect.get(l.target,Qe);if(s==null)return t.preventDefault();l.element=s}),e.on("resizing",t=>{const l=t.detail;l!=null&&(Rd(n,l),Tn.create(l.target,l.container))}),e.on("resizeend",t=>{const l=t.detail;if(l==null)return;l.indicatorElement&&document.body.removeChild(l.indicatorElement);const s=l.element;s.setTop(l.top),s.setLeft(l.left),s.setWidth(l.width),s.setHeight(l.height),l.target.style.removeProperty("top"),l.target.style.removeProperty("left"),l.target.style.removeProperty("width"),l.target.style.removeProperty("height"),n.createSnapshot(),Tn.clean()}),n.onResizeStart=e.onResizeStart,e}function Nd(n){function e(o){const a=document.activeElement,r=o.target;return a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a.isContentEditable===!0||r.closest(".quickprint-text-editor")!=null}function t(o){if(!(e(o)||Js()))switch(o.key){case"Delete":case"Backspace":return o.preventDefault(),n.deleteSelectedElement();case"Y":case"y":if(o.ctrlKey)return o.preventDefault(),n.history.redo();case"Z":case"z":if(o.ctrlKey)return o.preventDefault(),n.history.undo();case"ArrowUp":case"ArrowDown":{const a=n.getSelectedElements();if(a.length==0)return;o.preventDefault(),o.stopPropagation();const r=o.key==="ArrowUp"?-1:1,i=a.map(u=>u.setTop(u.top+r,!0)?u:null).filter(u=>u!=null);i.length>0&&n.replaceSnapshot("top",i);return}case"ArrowLeft":case"ArrowRight":{const a=n.getSelectedElements();if(a.length==0)return;o.preventDefault(),o.stopPropagation();const r=o.key==="ArrowLeft"?-1:1,i=a.map(u=>u.setLeft(u.left+r,!0)?u:null).filter(u=>u!=null);i.length>0&&n.replaceSnapshot("left",i);return}}}function l(){window.addEventListener("keydown",t)}function s(){window.removeEventListener("keydown",t)}return{enable:l,disable:s}}const Cs=Symbol();function Id(){return{panel:{left:!0,right:!0},scale:100,selectedType:de.NONE,selectedPage:void 0,selectMode:et.SINGLE,selected:[]}}function $d(n,e){const t=qe(Id()),l=Sd(n),o={get doc(){return n.value},history:l,document:n,state:t,component:e,setDocument:i,selectPage:d,selectElement:h,resetSelectedElement:v,deleteSelectedElement:y,multiSelectElements:f,zoomIn:I,zoomOut:S,toggleBackground:M,toggleElementPanel:E,toggleConfigPanel:k,getSelectedElements:u,getSelectedPage:m,cleanup:T,replaceSnapshot:_},a=bd(o),r=Ld(o);o.shortcut=Nd(o),o.createSnapshot=l.createSnapshot;function i(w){o.document.value=w,o.history.createSnapshot()}function u(){const w=t.selected;return w.length==0?[]:w.map(R=>o.doc.findElement(R)).filter(R=>R!=null)}function m(){var R;const w=t.selectedPage;if(w!=null)return(R=n.value)==null?void 0:R.findPage(w)}function d(w){return v(),t.selectedPage=w.id,t.selectedType=de.PAGE,!0}function h(w){t.selectMode=et.SINGLE,t.selectedType=de.ELEMENT,t.selectedPage=void 0;const R=u();for(const $ of R)$.id!==w.id&&$.blur();return w.focus(),t.selected=[w.id],!0}function v(){const w=u();for(const R of w)R.blur();return t.selected=[],t.selectedType=de.NONE,!0}function y(){if(t.selectedType!=de.ELEMENT||t.selected.length==0)return!1;let w=!1;const R=u();for(const $ of R)$.remove()&&(w=!0);return w&&o.history.createSnapshot(),!0}function f(w){t.selectMode=et.MULTIPLE,t.selectedType=de.ELEMENT,t.selectedPage=void 0;const R=u();for(const $ of R)$.blur();for(const $ of w)$.focus();return t.selected=w.map($=>$.id),!0}function S(){const w=t.scale??100,R=Gt.indexOf(w);return R<0?(t.scale=100,!1):R>=Gt.length-1?!1:(t.scale=Gt[R+1],!0)}function I(){const w=t.scale??100,R=Gt.indexOf(w);return R<0?(t.scale=100,!1):R==0?!1:(t.scale=Gt[R-1],!0)}function M(){const R=o.doc.attributes.grid==null?!0:void 0;o.doc.attributes.grid=R}function E(){o.state.panel.left=!o.state.panel.left}function k(){o.state.panel.right=!o.state.panel.right}function _(w,R){const $=R??o.doc,G=Array.isArray($)?"element":$ instanceof fe?"document":$ instanceof _t?"page":"element",V=Array.isArray($)?$.map(De=>De.id).join(","):$.id,te=`${G}:${V}:${w}`;return console.log(te),l.replaceSnapshot({action:te})}function T(){a.cleanup(),r.cleanup(),l.cleanup(),o.shortcut.disable(),o.doc.cleanup()}return o.shortcut.enable(),o.selectPage(n.value.firstPage),Xl(Cs,o),il(T),o}function be(){return Yl(Cs)}const Ad=q({__name:"Ruler",props:{direction:{type:String,default:"horizontal"},canvas:{type:Object,required:!0},page:{type:Object,required:!0},scale:{type:Number,default:100}},setup(n){const e=n,t=$e("classes"),l=be(),s=N(()=>({[t.horizontalRuler]:e.direction==="horizontal",[t.verticalRuler]:e.direction==="vertical"})),o=N(()=>{const f=e.page.id,S=l.doc.pages.find(I=>I.id===f);return S==null?0:e.direction=="horizontal"?S.width:S.height}),a=N(()=>{const f=o.value,S=[];for(let I=0;I<=f;I+=10)S.push(I/10);return S}),r=N(()=>{const f=o.value,S=[];for(let I=0;I<=f;I+=2.5)S.push(I);return S}),i=N(()=>{const f=l.getSelectedElements();return f.length==1?f[0]:null}),u=N(()=>e.direction==="horizontal"?{height:"100%",width:o.value*e.scale/100+"mm",left:e.page.left+"px",transform:`translateX(${-e.canvas.scrollLeft}px)`}:{width:"100%",height:o.value*e.scale/100+"mm",top:e.page.top+"px",transform:`translateY(${-e.canvas.scrollTop}px)`}),m=N(()=>{const f=i.value;if(f==null)return 0;if(f.type==="TableCell"){const S=f.parent;if(S==null)return 0;const I=S.parent;return S==null?0:I.top+S.offsetTop}if(f.type==="TableRow"){const S=f.parent;return S==null?0:S.top+f.offsetTop}return f.top}),d=N(()=>{const f=i.value;if(f==null)return 0;if(f.type==="TableCell"){const S=f.parent;if(S==null)return 0;const I=S.parent;return S==null?0:I.left+f.offsetLeft}if(f.type==="TableRow"){const S=f.parent;return S==null?0:S.left}return f.left});function h(f,S){return e.direction==="horizontal"?{left:f*(e.scale/100)+"mm",height:(S-2)%4==0?"8px":"4px"}:{top:f*(e.scale/100)+"mm",width:(S-2)%4==0?"8px":"4px"}}function v(f){return e.direction==="horizontal"?{left:f*(e.scale/100)+"cm"}:{top:f*(e.scale/100)+"cm"}}function y(f){return e.direction==="horizontal"?{left:d.value*(e.scale/100)+"px",width:f.width*(e.scale/100)+"px",height:"100%"}:{top:m.value*(e.scale/100)+"px",height:f.height*(e.scale/100)+"px",width:"100%"}}return(f,S)=>(C(),L("div",{class:p(s.value)},[c("div",{class:p(b(t).ruler),style:Y(u.value)},[i.value?(C(),L("div",{key:0,class:p(b(t).selected),style:Y(y(i.value))},null,6)):H("",!0),(C(!0),L(U,null,j(r.value,(I,M)=>(C(),L("div",{key:I,class:p(b(t).scale),style:Y(h(I,M))},null,6))),128)),(C(!0),L(U,null,j(a.value,I=>(C(),L("div",{class:p(b(t).number),style:Y(v(I))},B(I),7))),256))],6)],2))}}),qd="_horizontalRuler_13w9e_2",Od="_verticalRuler_13w9e_15",Md="_ruler_13w9e_27",Dd="_scale_13w9e_33",xd="_number_13w9e_47",Pd="_selected_13w9e_70",Vd={horizontalRuler:qd,verticalRuler:Od,ruler:Md,scale:Dd,number:xd,selected:Pd},zd={classes:Vd},Ml=D(Ad,[["__cssModules",zd]]),Bd=["title"],Fd=q({__name:"DragLine",props:{top:{type:Number,default:0},zoom:{type:Number,default:1},title:{type:String,default:null},disabled:{type:Boolean,default:!1},min:{type:Number,default:null},max:{type:Number,default:null}},emits:["move"],setup(n,{emit:e}){const t=n,l=e,s=$e("classes"),o={},a=be(),r=N(()=>({top:Math.round(t.top*t.zoom)+"px"}));function i(h){if(h.button!=0||t.disabled===!0)return;const v=h.target.closest("."+s.dragLine);v!=null&&(h.stopPropagation(),o.init=!1,o.target=v,o.parent=v.offsetParent,o.target.setPointerCapture(h.pointerId),window.addEventListener("pointermove",u),window.addEventListener("pointerup",m))}function u(h){h.preventDefault();const v=d(o.parent);let y=h.clientY-v.top;y<0&&(y=0),y>v.height&&(y=v.height),o.target.style.top=y/(a.state.scale/100)+"px",o.top=y,o.init=!0}function m(h){o.init===!0&&l("move",{top:o.top/(a.state.scale/100)}),o.target.releasePointerCapture(h.pointerId),window.removeEventListener("pointermove",u),window.removeEventListener("pointerup",m)}function d(h){return h instanceof HTMLElement?h.getBoundingClientRect():new DOMRect(0,0,window.innerWidth,window.innerHeight)}return(h,v)=>(C(),L("div",{class:p({[b(s).dragLine]:!0,[b(s).disabled]:n.disabled}),style:Y(r.value),onPointerdown:ee(i,["stop"]),title:n.title},null,46,Bd))}}),Ud="_dragLine_1m7rt_2",Hd="_disabled_1m7rt_26",Gd={dragLine:Ud,disabled:Hd},Wd={classes:Gd},Dl=D(Fd,[["__cssModules",Wd]]),Yd=q({__name:"Selection",setup(n,{expose:e}){const t=re(),l=re(),s=Vt("selectionRef"),o=re(),a=be();let r=[];function i(){return{init:!1,initialX:0,initialY:0,top:0,left:0}}function u(){const y=[],f=l.value;if(f==null)return y;const S=m(f);if(S.length==0)return y;const I=s.value;return S.forEach(M=>{if(!Co(M,I)){M.classList.remove(F.SELECTED);return}const E=Reflect.get(M,Qe);E instanceof pe&&(M.classList.add(F.SELECTED),y.push(E))}),y}function m(y){if(y.matches("."+F.ELEMENT)){const f=Reflect.get(y,Qe);if(f&&f.type===W.TABLE)return y.querySelectorAll(":scope td")}return y.querySelectorAll(`:scope .${F.PAGE} > .${F.SELECTABLE}`)}function d(y,f){const S=f.closest("."+F.PAPER);if(S==null)return;y.stopPropagation(),y.preventDefault();const I=i(),M=S.getBoundingClientRect();I.initialX=y.clientX,I.initialY=y.clientY,I.top=y.clientY-M.top,I.left=y.clientX-M.left,l.value=f,o.value=I,t.value=S,r=[],window.addEventListener("pointermove",h),window.addEventListener("pointerup",v)}function h(y){const f=o.value;if(f==null)return;y.stopPropagation(),y.preventDefault();const S=s.value;if(f.init!==!0){if(Math.abs(y.clientX-f.initialX)<4&&Math.abs(y.clientY-f.initialY)<4)return;S.setPointerCapture(y.pointerId),S.style.display="block",f.init=!0}const I=Math.abs(y.clientX-f.initialX),M=Math.abs(y.clientY-f.initialY),E=y.clientX<f.initialX?-I:0,k=y.clientY<f.initialY?-M:0;S.style.top=f.top+k+"px",S.style.left=f.left+E+"px",S.style.width=I+"px",S.style.height=M+"px",r=u()}function v(y){const f=o.value;if(f==null)return;f.init&&(y.stopPropagation(),y.preventDefault()),r.length>0&&a.multiSelectElements(r);const S=s.value;S.releasePointerCapture(y.pointerId),S.style.display="none",o.value=void 0,window.removeEventListener("pointermove",h),window.removeEventListener("pointerup",v)}return e({onSelectStart:d}),(y,f)=>(C(),L("div",{ref_key:"selectionRef",ref:s,class:p(y.classes.selection),onClick:f[0]||(f[0]=ee(()=>{},["stop"]))},null,2))}}),Xd="_selection_10jfe_2",jd={selection:Xd},Zd={classes:jd},Kd=D(Yd,[["__cssModules",Zd]]),Jd={class:"quickprint-is-row"},Qd=["onClick"],ef=q({__name:"FontSize",props:{modelValue:{type:String,default:null},height:{type:String,default:"100%"}},emits:["update:modelValue","update:unit"],setup(n,{emit:e}){const t=[{value:"px",label:"像素"},{value:"pt",label:"磅"}],l=$e("classes"),s=e,o=n,a=re(),r=N(()=>({height:o.height})),i=N({get(){return Be(o.modelValue).num??void 0},set(y){if(y==""||Qs(y)||y<0){d(void 0);return}const f=Be(o.modelValue);d(`${y}${f.unit}`)}}),u=N({get(){return Be(o.modelValue).unit??ke.PX},set(y){const f=Be(o.modelValue);d(`${f.num}${y}`)}});function m(y){const f=y===me.DEFAULT?void 0:y;s("update:modelValue",f)}function d(y){s("update:modelValue",y),v()}function h(y){const f=o.modelValue;return f==null&&y.value===me.DEFAULT?!0:f===y.value}async function v(){await Pt();const y=document.querySelector("."+l.fontSelected);y&&y.scrollIntoView({block:"nearest"})}return(y,f)=>(C(),L("div",{class:p(b(l).fontSize),style:Y(r.value)},[c("div",Jd,[ve(c("input",{type:"number",placeholder:"请输入",class:p(["quickprint-form-control",b(l).input]),min:0,"onUpdate:modelValue":f[0]||(f[0]=S=>i.value=S)},null,2),[[Ce,i.value]]),g(b(X),{width:"54px",options:t,modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=S=>u.value=S)},null,8,["modelValue"])]),c("div",{class:p(["quickprint-is-fill-h quickprint-is-scrollable",b(l).fonts]),ref_key:"scrollRef",ref:a},[(C(!0),L(U,null,j(b(ml),S=>(C(),L("div",{key:S.value,class:p({[b(l).option]:!0,[b(l).fontSelected]:h(S)}),onClick:I=>m(S.value)},[c("span",null,B(S.label),1)],10,Qd))),128))],2)],6))}}),tf="_input_9oh9n_2",nf="_fontSize_9oh9n_8",lf="_fonts_9oh9n_13",sf="_option_9oh9n_25",of="_fontSelected_9oh9n_34",rf={input:tf,fontSize:nf,fonts:lf,option:sf,fontSelected:of},af={classes:rf},Rs=D(ef,[["__cssModules",af]]),cf=["title"],uf={key:0},df="中文字体 AbBbCc",ff=q({__name:"Font",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=N(()=>qn.map(f=>(f.style={fontFamily:f.value==Q.DEFAULT?Q.SONG:f.value},f))),l=N(()=>ys.map(f=>(f.style={fontFamily:f.value==Q.DEFAULT?Q.SONG:f.value},f))),s=N({get(){const f=e.options.style.fontFamily;return se(f)?Q.DEFAULT:f},set(f){e.options.style.fontFamily=f==Q.DEFAULT?void 0:f}}),o=N({get(){const f=e.options.style.enFontFamily;return se(f)?Q.DEFAULT:f},set(f){e.options.style.enFontFamily=f==Q.DEFAULT?void 0:f}}),a=N({get(){const f=e.options.style.color;return se(f)?Te.DEFAULT:f},set(f){e.options.style.color=f==Te.DEFAULT?void 0:f}}),r=N({get(){const f=e.options.style.highlightColor;return se(f)?Te.DEFAULT:f},set(f){e.options.style.highlightColor=f==Te.DEFAULT?void 0:f}}),i=N({get(){return e.options.style.fontSize},set(f){const S=se(f)?void 0:f;e.options.style.fontSize=S}}),u=N({get(){return e.options.style.fontWeight===700},set(f){e.options.style.fontWeight=f?700:void 0}}),m=N({get(){return e.options.style.fontStyle==="italic"},set(f){e.options.style.fontStyle=f?"italic":void 0}}),d=N({get(){return e.options.style.lineThrough===!0},set(f){e.options.style.lineThrough=f?!0:void 0}}),h=N({get(){const f=e.options.style.underline;if(f==null||f===!1)return cn.NONE;const S=e.options.style.underlineStyle;return se(S)?St.SOLID:S},set(f){if(f===cn.NONE){e.options.style.underline=void 0,e.options.style.underlineStyle=void 0;return}e.options.style.underline=!0,e.options.style.underlineStyle=f}}),v=N({get(){const f=e.options.style.underlineColor;return se(f)?Te.DEFAULT:f},set(f){e.options.style.underlineColor=f==Te.DEFAULT?void 0:f}}),y=N(()=>{const f=e.options.style,S={},I=ul(f.fontFamily,f.enFontFamily);I&&(S.fontFamily=I);const M=us(f);return M&&ft(S,M),f.fontSize&&(S.fontSize=f.fontSize),f.fontWeight&&(S.fontWeight=f.fontWeight),f.color&&(S.color=f.color),f.fontStyle&&(S.fontStyle=f.fontStyle),f.highlightColor&&(S["--quickprint-variable-highlight-color"]=f.highlightColor),S});return(f,S)=>(C(),L("div",{class:p(["quickprint-is-scrollable quickprint-is-fill-h",f.classes.font])},[c("div",{class:p(f.classes.fontFamily)},[c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"中文字体",2),c("div",{class:p(f.classes.content)},[g(b(X),{options:t.value,modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=I=>s.value=I)},null,8,["options","modelValue"])],2)],2),c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"颜色",2),g(Ke,{modelValue:a.value,"onUpdate:modelValue":S[1]||(S[1]=I=>a.value=I)},{default:ie(()=>[c("div",{class:p(f.classes.indicator)},[c("div",{class:p({[f.classes.colorBlock]:!0,[f.classes.colorNone]:a.value===b(Te).DEFAULT}),style:Y({backgroundColor:a.value})},null,6),c("div",{class:p(f.classes.colorValue)},B(a.value==b(Te).DEFAULT?"默认":a.value),3)],2)]),_:1},8,["modelValue"])],2),c("div",{class:p([f.classes.config,f.classes.fontSize])},[c("div",{class:p(f.classes.title)},"字号",2),g(Rs,{modelValue:i.value,"onUpdate:modelValue":S[2]||(S[2]=I=>i.value=I),height:"144px"},null,8,["modelValue"])],2),c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"西文字体",2),c("div",{class:p(f.classes.content)},[g(b(X),{options:l.value,modelValue:o.value,"onUpdate:modelValue":S[3]||(S[3]=I=>o.value=I)},null,8,["options","modelValue"])],2)],2),c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"前景色",2),g(Ke,{modelValue:r.value,"onUpdate:modelValue":S[4]||(S[4]=I=>r.value=I)},{default:ie(()=>[c("div",{class:p(f.classes.indicator)},[c("div",{class:p({[f.classes.colorBlock]:!0,[f.classes.colorNone]:r.value===b(Te).DEFAULT}),style:Y({backgroundColor:r.value})},null,6),c("div",{class:p(f.classes.colorValue)},B(r.value==b(Te).DEFAULT?"默认":r.value),3)],2)]),_:1},8,["modelValue"])],2),c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"下划线",2),c("div",{class:p(f.classes.content)},[g(b(X),{modelValue:h.value,"onUpdate:modelValue":S[5]||(S[5]=I=>h.value=I),options:b(zu),width:"138px"},{option:ie(({option:I})=>[c("div",{title:I.label,class:p(f.classes.option)},[I.value==b(cn).NONE?(C(),L("div",uf,B(I.label),1)):(C(),L("div",{key:1,class:p(f.classes.line),style:Y({textDecorationStyle:I.value})},"--",6))],10,cf)]),_:1},8,["modelValue","options"])],2)],2),c("div",{class:p(f.classes.config)},[c("div",{class:p(f.classes.title)},"线条颜色",2),c("div",{class:p(f.classes.content)},[g(Ke,{modelValue:v.value,"onUpdate:modelValue":S[6]||(S[6]=I=>v.value=I),class:"quickprint-w-full"},{default:ie(()=>[c("div",{class:p(f.classes.indicator)},[c("div",{class:p({[f.classes.colorBlock]:!0,[f.classes.colorNone]:v.value===b(Te).DEFAULT}),style:Y({backgroundColor:v.value})},null,6),c("div",{class:p(f.classes.colorValue)},B(v.value==b(Te).DEFAULT?"默认":v.value),3)],2)]),_:1},8,["modelValue"])],2)],2)],2),c("div",{class:p(f.classes.fieldset)},[S[13]||(S[13]=c("header",null,"效果",-1)),c("div",{class:p(f.classes.configs)},[c("label",{class:p(f.classes.checkbox)},[ve(c("input",{type:"checkbox","onUpdate:modelValue":S[7]||(S[7]=I=>u.value=I)},null,512),[[Bn,u.value]]),S[10]||(S[10]=c("span",null,"粗体",-1))],2),c("label",{class:p(f.classes.checkbox)},[ve(c("input",{type:"checkbox","onUpdate:modelValue":S[8]||(S[8]=I=>m.value=I)},null,512),[[Bn,m.value]]),S[11]||(S[11]=c("span",null,"斜体",-1))],2),c("label",{class:p(f.classes.checkbox)},[ve(c("input",{type:"checkbox","onUpdate:modelValue":S[9]||(S[9]=I=>d.value=I)},null,512),[[Bn,d.value]]),S[12]||(S[12]=c("span",null,"删除线",-1))],2)],2)],2),c("div",{class:p(f.classes.fieldset)},[S[14]||(S[14]=c("header",null,"预览",-1)),c("div",{class:p(f.classes.preview)},[c("span",{style:Y(y.value)},[c("span",{class:p({[f.classes.lineThrough]:n.options.style.lineThrough})},B(df),2)],4)],2)],2)],2))}}),pf="_font_d1yo6_2",mf="_fontFamily_d1yo6_7",hf="_config_d1yo6_14",gf="_fontSize_d1yo6_19",vf="_fieldset_d1yo6_23",bf="_title_d1yo6_39",yf="_content_d1yo6_44",_f="_indicator_d1yo6_49",Ef="_colorBlock_d1yo6_69",Tf="_colorValue_d1yo6_80",kf="_colorNone_d1yo6_87",wf="_configs_d1yo6_98",Sf="_checkbox_d1yo6_104",Cf="_option_d1yo6_119",Rf="_line_d1yo6_127",Lf="_preview_d1yo6_138",Nf="_lineThrough_d1yo6_153",If={font:pf,fontFamily:mf,config:hf,fontSize:gf,fieldset:vf,title:bf,content:yf,indicator:_f,colorBlock:Ef,colorValue:Tf,colorNone:kf,configs:wf,checkbox:Sf,option:Cf,line:Rf,preview:Lf,lineThrough:Nf},$f={classes:If},Af=D(ff,[["__cssModules",$f]]),qf=["placeholder","min"],Of=q({__name:"InputWithUnit",props:{modelValue:{type:String,default:void 0},options:{type:Array,required:!0},placeholder:{type:String,default:"请输入"},defaultUnit:{type:String,default:null},min:{type:Number,default:0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=e,l=n,s=N(()=>{const i=l.defaultUnit;return l.options.some(u=>u.value===i)?i:l.options[0].value}),o=N({get(){return Be(l.modelValue).num},set(i){if(nl(i)){const m=Be(l.modelValue).unit??s.value;return r(`${i}${m}`)}r()}}),a=N({get(){return Be(l.modelValue).unit??s.value},set(i){const m=Be(l.modelValue).num??l.min;r(`${m}${i}`)}});function r(i=void 0){t("update:modelValue",i)}return(i,u)=>(C(),L("div",{class:p(i.classes.input)},[ve(c("input",{type:"number","onUpdate:modelValue":u[0]||(u[0]=m=>o.value=m),class:"quickprint-form-control",placeholder:n.placeholder,min:n.min},null,8,qf),[[Ce,o.value]]),g(b(X),{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),class:p(i.classes.unit),options:n.options,width:"auto",border:"none"},null,8,["modelValue","class","options"])],2))}}),Mf="_input_gtdaq_2",Df="_unit_gtdaq_14",xf={input:Mf,unit:Df},Pf={classes:xf},dt=D(Of,[["__cssModules",Pf]]),Vf="中文字体 AbBbCc",zf=q({__name:"Paragraph",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:ke.NONE},{label:"磅",value:ke.PT},{label:"像素",value:ke.PX}],l=[{label:"字符",value:ke.EM},{label:"磅",value:ke.PT},{label:"像素",value:ke.PX}],s=[{label:"毫米",value:ke.MM},{label:"磅",value:ke.PT},{label:"像素",value:ke.PX}],o=N({get(){return e.options.style.textAlign??je.LEFT},set(v){const y=v===je.LEFT?void 0:v;e.options.style.textAlign=y}}),a=N({get(){return e.options.style.textAlignLast??mt.AUTO},set(v){const y=v===mt.AUTO?void 0:v;e.options.style.textAlignLast=y}}),r=N({get(){return e.options.style.verticalAlign??Fe.TOP},set(v){const y=v===Fe.TOP?void 0:v;e.options.style.verticalAlign=y}}),i=h("top"),u=h("bottom"),m=h("left"),d=h("right");function h(v){return N({get(){var y;return(y=e.options.style.padding)==null?void 0:y[v]},set(y){e.options.style.padding==null&&(e.options.style.padding={});const f=se(y)?void 0:y;e.options.style.padding[v]=f}})}return(v,y)=>(C(),L("div",{class:p(["quickprint-is-scrollable quickprint-is-fill-h",v.classes.paragraph])},[c("div",{class:p(v.classes.textAlign)},[c("div",{class:p(v.classes.configItem)},[c("div",{class:p(v.classes.configItemLabel)},"文本对齐",2),g(b(X),{options:b(Zn),modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=f=>o.value=f)},null,8,["options","modelValue"])],2),c("div",{class:p(v.classes.alignLast)},[c("div",{class:p(v.classes.configItemLabel)},"最后一行",2),g(b(X),{options:b(Bu),modelValue:a.value,"onUpdate:modelValue":y[1]||(y[1]=f=>a.value=f)},null,8,["options","modelValue"])],2)],2),c("div",{class:p(v.classes.configItem)},[c("div",{class:p(v.classes.configItemLabel)},"垂直对齐",2),g(b(X),{options:b(jn),modelValue:r.value,"onUpdate:modelValue":y[2]||(y[2]=f=>r.value=f)},null,8,["options","modelValue"])],2),c("div",{class:p(v.classes.configItem)},[c("div",{class:p(v.classes.configItemLabel)},"首行缩进",2),g(dt,{modelValue:n.options.style.textIndent,"onUpdate:modelValue":y[3]||(y[3]=f=>n.options.style.textIndent=f),options:l,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),c("div",{class:p(v.classes.configItem)},[c("div",{class:p(v.classes.configItemLabel)},"行高",2),g(dt,{modelValue:n.options.style.lineHeight,"onUpdate:modelValue":y[4]||(y[4]=f=>n.options.style.lineHeight=f),options:t,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),c("div",{class:p(v.classes.fieldset)},[y[9]||(y[9]=c("header",null,"内边距",-1)),c("div",{class:p(v.classes.padding)},[c("div",{class:p(v.classes.paddingItem)},[c("label",{class:p(v.classes.paddingItemLabel)},"上边距",2),g(dt,{modelValue:b(i),"onUpdate:modelValue":y[5]||(y[5]=f=>he(i)?i.value=f:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),c("div",{class:p(v.classes.paddingItem)},[c("label",{class:p(v.classes.paddingItemLabel)},"下边距",2),g(dt,{modelValue:b(u),"onUpdate:modelValue":y[6]||(y[6]=f=>he(u)?u.value=f:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),c("div",{class:p(v.classes.paddingItem)},[c("label",{class:p(v.classes.paddingItemLabel)},"左边距",2),g(dt,{modelValue:b(m),"onUpdate:modelValue":y[7]||(y[7]=f=>he(m)?m.value=f:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2),c("div",{class:p(v.classes.paddingItem)},[c("label",{class:p(v.classes.paddingItemLabel)},"右边距",2),g(dt,{modelValue:b(d),"onUpdate:modelValue":y[8]||(y[8]=f=>he(d)?d.value=f:null),options:s,class:"quickprint-is-fill-w"},null,8,["modelValue"])],2)],2)],2),c("div",{class:p(v.classes.fieldset)},[y[10]||(y[10]=c("header",null,"预览",-1)),c("div",{class:p(v.classes.preview)},[c("span",null,[c("span",{class:p({[v.classes.lineThrough]:n.options.style.lineThrough})},B(Vf),2)])],2)],2)],2))}}),Bf="_paragraph_13aw5_2",Ff="_fieldset_13aw5_7",Uf="_preview_13aw5_23",Hf="_textAlign_13aw5_38 quickprint-is-row",Gf="_configItem_13aw5_43 quickprint-is-row",Wf="_alignLast_13aw5_48 quickprint-is-row",Yf="_configItemLabel_13aw5_58",Xf="_padding_13aw5_63",jf="_paddingItem_13aw5_70",Zf="_paddingItemLabel_13aw5_76",Kf={paragraph:Bf,fieldset:Ff,preview:Uf,textAlign:Hf,configItem:Gf,alignLast:Wf,configItemLabel:Yf,padding:Xf,paddingItem:jf,paddingItemLabel:Zf},Jf={classes:Kf},Qf=D(zf,[["__cssModules",Jf]]),ep=["onClick"],tp=q({__name:"Tabs",props:{active:{type:String,required:!0},tabs:{type:Array,required:!0}},emits:["switch"],setup(n,{emit:e}){const t=e;function l(s){t("switch",s)}return(s,o)=>(C(),L("div",{class:p(s.classes.tabs)},[(C(!0),L(U,null,j(n.tabs,a=>(C(),L("div",{key:a.value,class:p({[s.classes.tab]:!0,[s.classes.active]:n.active===a.value}),onClick:r=>l(a),onPointerdown:o[0]||(o[0]=ee(()=>{},["stop","prevent"]))},[c("span",null,B(a.label),1)],42,ep))),128))],2))}}),np="_tabs_109u2_2",lp="_tab_109u2_2",sp="_active_109u2_41",op={tabs:np,tab:lp,active:sp},ip={classes:op},Ls=D(tp,[["__cssModules",ip]]),rp=q({__name:"index",props:{options:{type:Object,required:!0}},setup(n){const e=n,t=Oe(),l=Z("font"),s=[{label:"字体",value:"font"},{label:"段落",value:"paragraph"}];function o(){if(t==null)return null;const u=t.useMenus();return((u==null?void 0:u.value)??[]).map(d=>sl.renderMenu(t,d))}function a(u){l.value=u.value}function r(){t==null||t.confirm(e.options)}function i(){t==null||t.cancel()}return(u,m)=>(C(),L("div",{class:p(u.classes.setting)},[c("div",{class:p(u.classes.header)},[c("div",{class:p(u.classes.headerLeft)},[g(b(O),{icon:"icon-setting",size:"14px"}),c("span",{class:p(u.classes.title)},"元素",2),g(Ls,{tabs:s,active:l.value,onSwitch:a},null,8,["active"])],2),g(o)],2),l.value==="font"?(C(),K(Af,{key:0,options:e.options},null,8,["options"])):H("",!0),l.value==="paragraph"?(C(),K(Qf,{key:1,options:e.options},null,8,["options"])):H("",!0),c("div",{class:p(u.classes.footer)},[c("button",{type:"button",class:"quickprint-text-btn",onClick:i},"取消"),c("button",{type:"button",class:"quickprint-text-btn",onClick:r},"确定")],2)],2))}}),ap="_setting_92mem_2",cp="_header_92mem_10",up="_headerLeft_92mem_22",dp="_title_92mem_35",fp="_tabs_92mem_42",pp="_footer_92mem_47",mp={setting:ap,header:cp,headerLeft:up,title:dp,tabs:fp,footer:pp},hp={classes:mp},gp=D(rp,[["__cssModules",hp]]);let sn=null;function vp(n){if(sn)return Promise.resolve(null);const e={pinnable:!1,top:"15vh",width:"420px",height:"520px",resizeMode:Tt.DISABLED};return sn=Qt("元素设置",g(gp,{options:bp(n)},null),e),sn.promisify().then(t=>yp(n,t)).catch(Ie).finally(()=>{sn=null})}function bp(n){return qe({style:Ul(n.style??{})})}function yp(n,e){n.style=Object.assign({},n.style,e.style)}function _p(n,e,t){ol.open(n.clientX,n.clientY,{menus:[{type:"menu",label:"设置",icon:"icon-setting",handler(){vp(e.element)}},{type:"divider"},{type:"menu",label:"复制",icon:"icon-copy",submenu:[{type:"menu",label:"元素",icon:"icon-pintu",detail:"Ctrl+C",handler(){console.log("TODO: 复制元素")}},{type:"menu",label:"数据源",icon:"icon-datasource",handler(){console.log("TODO: 复制数据源")}},{type:"menu",label:"样式",icon:"icon-shuazi",disabled:!0,handler(){console.log("TODO: 复制样式")}}]},{type:"menu",label:"合并",icon:"icon-hebing",submenu:[{type:"menu",label:"数据源",icon:"icon-datasource",handler(){console.log("TODO: 合并数据源")}},{type:"menu",label:"样式",icon:"icon-shuazi",disabled:!0,handler(){console.log("TODO: 合并样式")}}]},{type:"menu",label:"删除",icon:"icon-delete",submenu:[{type:"menu",label:"元素",icon:"icon-pintu",detail:"Delete",handler(){e.element.remove(),t.createSnapshot()}},{type:"menu",label:"数据源",icon:"icon-datasource",handler(){e.element.resetDS(),t.createSnapshot()}}]},{type:"divider"},{type:"menu",label:"层级",icon:"icon-cengji",submenu:[{type:"menu",icon:"icon-vertical-align-top",label:"移至顶层",handler(){const l=e.element.page;if(l==null)return;const s=l.topZIndex;e.element.setZIndex(s+1),t.createSnapshot()}},{type:"menu",label:"上移一层",icon:"icon-arrowup",handler(){const l=e.element.zIndex;e.element.setZIndex(l+1),t.createSnapshot()}},{type:"menu",icon:"icon-arrowdown",label:"下移一层",handler(){const l=e.element.zIndex;l<=0||(e.element.setZIndex(l-1),t.createSnapshot())}},{type:"menu",icon:"icon-vertical-align-bottom",label:"移至底层",handler(){e.element.setZIndex(0),t.createSnapshot()}}]}]})}const Ep=q({props:{element:{type:pe,required:!0}},setup(n){const e=$e("classes"),t=be(),l=N(()=>{const d=n.element;d.state.key;const h={"--quickprint-element-top":d.top+"px","--quickprint-element-left":d.left+"px","--quickprint-element-width":d.width+"px","--quickprint-element-height":d.height+"px","z-index":d.zIndex};return a()&&(h.transform=`rotate(${d.style.rotate}deg)`),h}),s={TOP:[e.resizeTop,Ct.TOP],BOTTOM:[e.resizeBottom,Ct.BOTTOM],LEFT:[e.resizeLeft,Ct.LEFT],RIGHT:[e.resizeRight,Ct.RIGHT],BOTTOM_RIGHT:[e.resizeBottomRight,Ct.BOTTOM_RIGHT]},o=[s.TOP,s.BOTTOM,s.LEFT,s.RIGHT,s.BOTTOM_RIGHT];function a(){const d=n.element;return d.style.rotate==0||d.style.rotate==null?!1:t.state.selectMode===et.SINGLE?!d.isSelected:!0}function r(d){const h=sd(d.type);if(h==null)return g("div",{class:e.unknown},[g("span",null,[oe("未知的打印元素")])]);const v={element:d,key:d.id+"_"+d.state.key};return rd(d.type)?(v.onContextmenu=u,Je(h,v)):Je(h,v)}function i(d,h){h.stopPropagation();const v=h.target.closest("."+F.ELEMENT);v&&Reflect.get(v,wn)===cl.DRAG_ELEMENT||t.selectElement(d)}function u(d){d.stopPropagation(),d.preventDefault(),_p(d,n,t)}function m(){return!ad(n.element.type)||a()?null:o.map(d=>{const h={class:[F.RESIZEABLE_INDICATOR,d[0]],["."+Jl]:d[1]};return g("div",co(h,{onPointerdown:t.onResizeStart}),null)})}return function(){const d=n.element,h={["."+Qe]:d,["."+al]:d.type,key:d.id,class:{[F.ELEMENT]:!0,[F.DRAGGABLE]:!0,[F.RESIZEABLE]:!0,[F.SELECTED]:d.state.selected,[F.SELECTABLE]:id(d.type),["quickprint-is-"+d.type.toLowerCase()]:!0},style:l.value,onClick:i.bind(null,d)};return g("div",h,[r(d),m()])}}}),Tp="_unknown_za8zh_2",kp="_resizeTop_za8zh_12",wp="_resizeBottom_za8zh_20",Sp="_resizeLeft_za8zh_28",Cp="_resizeRight_za8zh_36",Rp="_resizeBottomRight_za8zh_44",Lp={unknown:Tp,resizeTop:kp,resizeBottom:wp,resizeLeft:Sp,resizeRight:Cp,resizeBottomRight:Rp},Np={classes:Lp},Ip=D(Ep,[["__cssModules",Np]]),Ns=zl(()=>Bl(()=>import("./component-PO_-BFKc.js"),__vite__mapDeps([2,3,1,4,5]))),$p=q({__name:"DocJson",props:{doc:{type:fe,required:!0}},setup(n){const e=n,t=Oe(),l=Z(JSON.stringify(e.doc,null,"  "));return t==null||t.useHandle("confirm",()=>l.value),(s,o)=>(C(),K(b(Ns),{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value=a),language:"json",class:p(s.classes.json)},null,8,["modelValue","class"]))}}),Ap="_json_9crpe_2",qp={json:Ap},Op={classes:qp},Mp=D($p,[["__cssModules",Op]]);let on=null;async function Dp(n){if(on)return;on=yt("调试",g(Mp,{doc:n.document.value},null),{width:"1200px",height:"860px",pinnable:!1,menus:[{label:"保存",handler:l=>l.dispatchConfirm()}]});const e=await on.promisify().catch(Xe);if(on=null,e==null)return;const t=fe.create(e);n.setDocument(t)}const xp=q({props:{doc:{type:fe,required:!0},page:{type:_t,required:!0}},emits:["save","preview"],setup(n,{emit:e}){const t=$e("classes"),l=be(),s=Vt("selectionRef"),o=Vt("paperRef"),a=Z(0),r=N(()=>n.page.width),i=N(()=>n.page.height);function u(E){E.stopPropagation();const k=E.target.closest("."+F.PAPER);k&&Reflect.get(k,wn)===cl.SELECTION||(l.resetSelectedElement(),l.selectPage(n.page))}function m(){if(n.page.header.display===!1)return null;const E=n.page.header.height,k="page_header_"+a.value;return g(Dl,{title:"页眉",top:E,onMove:h,key:k},null)}function d(){if(n.page.footer.display===!1)return null;const E=xt(i.value)-n.page.footer.height,k="page_footer_"+a.value;return g(Dl,{title:"页脚",top:E,onMove:v,key:k},null)}function h(E){n.page.setHeaderHeight(E.top),a.value++}function v(E){n.page.setFooterHeight(xt(i.value)-E.top),a.value++}function y(E){E.stopPropagation(),E.preventDefault(),ol.open(E.clientX,E.clientY,{menus:[{type:"menu",label:"重新加载",icon:"icon-reload",detail:"Ctrl+R",handler(){window.location.reload()}},{type:"menu",label:"全部选中",icon:"icon-select-all",detail:"Ctrl+A",handler:()=>{const k=n.page.children??[];l.multiSelectElements(k)}},{type:"menu",label:"粘贴",icon:"icon-paste",detail:"Ctrl+V",disabled:!0,handler(){console.log("TODO: 黏贴")}},{type:"divider"},{type:"menu",label:"调试",icon:"icon-bug",handler(){Dp(l)}},{type:"menu",label:"预览",icon:"icon-run",detail:"Ctrl+P",handler(){e("preview")}},{type:"menu",label:"保存",icon:"icon-save",detail:"Ctrl+S",handler(){e("save")}}]})}function f(){const E=n.doc.margins;if(E==null)return null;const k=[];return E.top&&k.push(g("div",{title:"上边距参考线",class:t.marginHorizontalGuide,style:{top:E.top+"px"}},null)),E.bottom&&k.push(g("div",{title:"下边距参考线",class:t.marginHorizontalGuide,style:{bottom:E.bottom+"px"}},null)),E.left&&k.push(g("div",{title:"左边距参考线",class:t.marginVerticalGuide,style:{left:E.left+"px"}},null)),E.right&&k.push(g("div",{title:"右边距参考线",class:t.marginVerticalGuide,style:{right:E.right+"px"}},null)),k.length>0?k:null}function S(){const E={["."+Kl]:n.page,key:n.page.id,style:{width:r.value+"mm",height:i.value+"mm"},class:{[F.PAGE]:!0,[F.DROPPABLE]:!0,[t.grid]:n.doc.useGrid},onContextmenu:y},k=n.page.children.map(_=>g(Ip,{element:_},null));return g("div",E,[m(),k,d(),f()])}function I(E){if(E.button!==0)return;E.stopPropagation(),E.preventDefault();const _=E.target.closest("."+F.ELEMENT);if(_==null)return M(E,o.value);const T=Reflect.get(_,Qe);return T==null?M(E,o.value):T.type===W.TABLE?M(E,_):cd(T.type)?l.onDragStart(E):M(E,o.value)}function M(E,k){var _;(_=s.value)==null||_.onSelectStart(E,k)}return function(){const E=l.state.scale/100,k={id:"@"+n.page.id,ref:"paperRef",class:{[F.PAPER]:!0,[F.SELECTED]:l.state.selectedPage===n.page.id},style:{width:r.value*E+"mm",height:i.value*E+"mm"},onPointerdown:I,onClick:u};return g("div",k,[S(),g(Kd,{ref:"selectionRef"},null)])}}}),Pp="_paper_fdphx_2",Vp="_grid_fdphx_12",zp="_marginHorizontalGuide_fdphx_21",Bp="_marginVerticalGuide_fdphx_29",Fp={paper:Pp,grid:Vp,marginHorizontalGuide:zp,marginVerticalGuide:Bp},Up={classes:Fp},Hp=D(xp,[["__cssModules",Up]]),Gp=["title","onClick"],Wp=q({__name:"BorderSelect",setup(n){const e=[J.ALL,J.NONE,J.INSIDE,J.OUTSIDE],t=be(),l=N(()=>{if(t.state.selectedType!==de.ELEMENT)return null;const u=t.getSelectedElements();if(u.length!==1)return null;const d=u[0].getStyle("border");if(d==null||d===J.NONE)return null;if(d===J.ALL)return{borderStyle:"solid"};const h={};return d&J.TOP&&(h.borderTopStyle="solid"),d&J.RIGHT&&(h.borderRightStyle="solid"),d&J.BOTTOM&&(h.borderBottomStyle="solid"),d&J.LEFT&&(h.borderLeftStyle="solid"),h}),s=[{label:"上框线",value:J.TOP,icon:"icon-border-top"},{label:"下框线",value:J.BOTTOM,icon:"icon-border-bottom"},{label:"左框线",value:J.LEFT,icon:"icon-border-left"},{label:"右框线",value:J.RIGHT,icon:"icon-border-right"}];function o(i){if(t.state.selectedType!==de.ELEMENT)return!1;const m=t.getSelectedElements();if(m.length!==1)return!1;const h=m[0].getStyle("border");return h==null?!1:e.includes(i)?h==i:h&i}function a(i){if(t.state.selectedType!==de.ELEMENT)return;const m=t.getSelectedElements();if(m.length!=0){for(const d of m){const h=d.getStyle("border");if(h==null){d.setStyle("border",i);continue}if(h===J.ALL){d.setStyle("border",i===J.ALL?J.NONE:i);continue}if(e.includes(i)){d.setStyle("border",i);continue}if(e.includes(h)){d.setStyle("border",i);continue}d.setStyle("border",h^i)}t.createSnapshot()}}function r(){if(t.state.selectedType!==de.ELEMENT)return;const u=t.getSelectedElements();if(u.length!=0){for(const m of u)m.setStyle("border",void 0);t.createSnapshot()}}return(i,u)=>(C(),K(b(rs),null,{popover:ie(()=>[c("div",{class:p(i.classes.popover)},[c("div",null,[(C(),L("button",{type:"button",title:"全部框线",key:b(J).ALL,class:p({"quickprint-text-btn":!0,[i.classes.tool]:!0,"quickprint-is-selected":o(b(J).ALL)}),onClick:u[0]||(u[0]=m=>a(b(J).ALL))},[g(b(O),{icon:"icon-border",size:"16px"})],2)),(C(),L("button",{type:"button",title:"无框线",key:b(J).ALL,class:p({"quickprint-text-btn":!0,[i.classes.tool]:!0}),onClick:r},[g(b(O),{icon:"icon-border-none",size:"16px"})],2))]),c("div",{class:p(i.classes.divider)},[(C(),L(U,null,j(s,m=>c("button",{type:"button",title:m.label,key:m.value,class:p({"quickprint-text-btn":!0,[i.classes.tool]:!0,"quickprint-is-selected":o(m.value)}),onClick:d=>a(m.value)},[g(b(O),{icon:m.icon,size:"16px"},null,8,["icon"])],10,Gp)),64))],2)],2)]),default:ie(()=>[c("div",{class:p(["quickprint-text-btn",i.classes.borderSelect]),title:"边框"},[c("div",{class:p({[i.classes.border]:!0}),style:Y(l.value)},null,6)],2)]),_:1}))}}),Yp="_border_rprfx_2",Xp="_borderSelect_rprfx_10",jp="_popover_rprfx_14",Zp="_divider_rprfx_18",Kp={border:Yp,borderSelect:Xp,popover:jp,divider:Zp},Jp={classes:Kp},Qp=D(Wp,[["__cssModules",Jp]]);function Me(n,e){if(n.state.selectedType!==de.ELEMENT)return;const l=n.getSelectedElements();if(l.length===1)return l[0].getStyle(e)}function Re(n,e,t){if(n.state.selectedType!==de.ELEMENT)return;const s=n.getSelectedElements();if(s.length!=0){for(const o of s)o.setStyle(e,t);n.createSnapshot()}}function Ae(n,e){if(n.state.selectedType!==de.ELEMENT)return;const l=n.getSelectedElements();if(l.length!=0){for(const s of l)s.removeStyle(e);n.createSnapshot()}}function em(n){const e="underline";return N({get(){if(n.state.selectedType!==de.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?Re(n,e,t):Ae(n,e)}})}function tm(n){const e="lineThrough";return N({get(){if(n.state.selectedType!==de.ELEMENT)return!1;const l=n.getSelectedElements();return l.length!==1?!1:l[0].getStyle(e)===!0},set(t){t?Re(n,e,t):Ae(n,e)}})}function nm(n){const e="lineHeight";return N({get(){return Me(n,e)},set(t){t===pt.DEFAULT?Ae(n,e):Re(n,e,t)}})}function lm(n){const e="highlightColor";return N({get(){return Me(n,e)??el.BLACK},set(t){t===""?Ae(n,e):Re(n,e,t)}})}function sm(n){const e="backgroundColor";return N({get(){return Me(n,e)??el.BLACK},set(t){t===""?Ae(n,e):Re(n,e,t)}})}function om(n){const e="fontStyle";return N({get(){return Me(n,e)===bl.ITALIC},set(t){t?Re(n,e,bl.ITALIC):Ae(n,e)}})}function im(n){const e="textAlign";return N({get(){return Me(n,e)??je.LEFT},set(t){t===je.LEFT?Ae(n,e):Re(n,e,t)}})}function rm(n){const e="verticalAlign";return N({get(){return Me(n,e)??Fe.MIDDLE},set(t){t===Fe.MIDDLE?Ae(n,e):Re(n,e,t)}})}function am(n){const e="fontFamily";return N({get(){return Me(n,e)},set(t){t===Q.DEFAULT?Ae(n,e):Re(n,e,t)}})}function cm(n){const e="fontSize";return N({get(){return Me(n,e)},set(t){t===me.DEFAULT?Ae(n,e):Re(n,e,t)}})}function um(n){const e="color";return N({get(){return Me(n,e)??Te.REGULAR},set(t){Re(n,e,t)}})}function dm(n){const e="fontWeight";return N({get(){return Me(n,e)===700},set(t){t?Re(n,e,700):Ae(n,e)}})}const fm=["value","placeholder"],pm=q({__name:"InputUnit",props:{label:{type:String,default:null},modelValue:{type:Number,default:null},standard:{type:String,default:"px"},target:{type:String,default:"px"},placeholder:{type:String,default:"请输入"},min:{type:Number,default:1},defaultValue:{type:Number,default:0},clearable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,l=e,s=Vt("inputRef"),o=N({get(){return t.standard===t.target?t.modelValue:t.standard==="px"&&t.target==="mm"?yl(t.modelValue):t.standard==="mm"&&t.target==="px"?xt(t.modelValue):0},set(m){if(t.standard===t.target)return l("update:modelValue",m);if(t.standard==="px"&&t.target==="mm")return l("update:modelValue",xt(m));if(t.standard==="mm"&&t.target==="px")return l("update:modelValue",yl(m))}}),a=N(()=>t.clearable&&o.value!=null);function r(m){const h=m.target.value;if(o==null||h===""){if(t.clearable)return;const y=t.min?t.min:t.defaultValue;o.value=y;return}const v=Number(h);if(!Number.isNaN(v)){if(t.min!=null&&v<t.min){o.value=t.min;return}if(t.standard==="px"){o.value=Math.round(v);return}o.value=v}}function i(){l("update:modelValue",void 0)}function u(){var m;(m=s.value)==null||m.blur(),setTimeout(()=>{var d;return(d=s.value)==null?void 0:d.focus()},50)}return(m,d)=>(C(),L("label",{class:p({[m.classes.inputUnit]:!0,[m.classes.withClear]:n.clearable})},[c("span",{class:p(m.classes.label)},B(n.label),3),c("input",{ref_key:"inputRef",ref:s,class:"quickprint-form-control",type:"number",value:o.value,placeholder:n.placeholder,onBlur:r,onKeydown:Wl(u,["enter"])},null,40,fm),a.value?(C(),L("span",{key:0,class:p(m.classes.clearBtn),onClick:ee(i,["stop"])},[g(b(O),{icon:"icon-close",size:"11px"})],2)):H("",!0)],2))}}),mm="_inputUnit_2ymft_2",hm="_clearBtn_2ymft_7",gm="_label_2ymft_11",vm="_withClear_2ymft_31",bm={inputUnit:mm,clearBtn:hm,label:gm,withClear:vm},ym={classes:bm},Ze=D(pm,[["__cssModules",ym]]),_m=q({__name:"UnitSelect",props:Et({modelValue:{type:String,default:"px"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=[{label:"像素(px)",value:"px"},{label:"毫米(mm)",value:"mm"}],t=n,l=en(n,"modelValue"),s=N(()=>{var o;return((o=e.find(a=>a.value===t.modelValue))==null?void 0:o.label)??t.modelValue});return(o,a)=>(C(),L("span",{class:p(o.classes.unit),title:"1毫米≈3.778像素，1像素≈0.265毫米"},[g(b(X),{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value=r),options:e,class:p(o.classes.select),appearance:"none",border:"none"},{selected:ie(()=>[c("span",{class:p(o.classes.text)},B(s.value),3)]),_:1},8,["modelValue","class"])],2))}}),Em="_unit_135mn_2",Tm="_text_135mn_8",km="_select_135mn_25",wm={unit:Em,text:Tm,select:km},Sm={classes:wm},Is=D(_m,[["__cssModules",Sm]]),Cm=["min","readonly","placeholder"],Rm=q({__name:"LabelNumber",props:Et({modelValue:{type:Number,default:null},label:{type:String,default:null},min:{type:Number,default:null},defaultValue:{type:Number,default:0},precision:{type:Number,default:null},readonly:{type:Boolean,default:!1},placeholder:{type:String,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=n,t=en(n,"modelValue");function l(s){const a=s.target.value;if(t==null||a===""){const i=e.min?e.min:e.defaultValue;t.value=i;return}const r=Number(a);if(!Number.isNaN(r)&&(e.min!=null&&r<e.min&&(t.value=e.min),e.precision!=null)){const i=Math.pow(10,e.precision);t.value=Math.round(r*i)/i}}return(s,o)=>(C(),L("label",{class:p({[s.classes.labelNumber]:!0,[s.classes.readonly]:n.readonly})},[ve(c("input",{class:"quickprint-form-control",type:"number","onUpdate:modelValue":o[0]||(o[0]=a=>t.value=a),min:n.min,readonly:n.readonly,placeholder:n.placeholder,onBlur:l},null,40,Cm),[[Ce,t.value]]),c("span",{class:p(s.classes.label)},B(n.label),3)],2))}}),Lm="_labelNumber_1aifb_2",Nm="_label_1aifb_2",Im="_readonly_1aifb_25",$m={labelNumber:Lm,label:Nm,readonly:Im},Am={classes:$m},It=D(Rm,[["__cssModules",Am]]),qm={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},Om={class:"quickprint-config-section"},Mm={class:"quickprint-form-inline"},Dm={class:"quickprint-config-section quickprint-config-inline"},xm={class:"quickprint-config-section"},Pm={class:"quickprint-config-header quickprint-is-row"},Vm={class:"quickprint-is-fill-w"},zm={class:"quickprint-config-content quickprint-form-inline quickprint-form-bottom-gap"},Bm={class:"quickprint-config-content quickprint-form-inline"},Fm=q({__name:"Paper",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=Z("px"),l=h("top"),s=h("bottom"),o=h("left"),a=h("right"),r=N(()=>Vn.map(v=>({label:v.size===zn.CUSTOM?"自定义":`${v.size}(${v.width}mm ✕ ${v.height}mm)`,value:v.size})));function i(v){e.config.width=v,d()}function u(v){e.config.height=v,d()}function m(v){const y=Vn.find(f=>f.size===v);y!=null&&(e.config.width=y.width,e.config.height=y.height,e.config.orientation=y.orientation,e.config.margins=y.margins,e.config.size=y.size)}function d(){const v=e.config,y=Vn.find(f=>f.size===zn.CUSTOM?!1:f.orientation===v.orientation&&f.width===v.width&&f.height===v.height);if(y==null){v.size=zn.CUSTOM;return}v.size=y.size}function h(v){return N({get(){var y;return(y=e.config.margins)==null?void 0:y[v]},set(y){e.config.margins==null&&(e.config.margins={}),e.config.margins[v]=y}})}return(v,y)=>(C(),L("div",qm,[c("section",Om,[y[6]||(y[6]=c("header",{class:"quickprint-config-header"},[c("span",null,"尺寸")],-1)),g(b(X),{options:r.value,modelValue:n.config.size,"onUpdate:modelValue":m,class:"quickprint-form-control-block quickprint-form-bottom-gap"},null,8,["options","modelValue"]),c("div",Mm,[g(It,{class:"quickprint-form-inline-item",label:"宽",modelValue:n.config.width,min:1,"onUpdate:modelValue":i},null,8,["modelValue"]),g(It,{class:"quickprint-form-inline-item",label:"高",modelValue:n.config.height,min:1,"onUpdate:modelValue":u},null,8,["modelValue"])])]),c("section",Dm,[y[7]||(y[7]=c("header",{class:"quickprint-config-header"},"方向",-1)),g(Nt,{modelValue:n.config.orientation,"onUpdate:modelValue":y[0]||(y[0]=f=>n.config.orientation=f),options:b(ts)},null,8,["modelValue","options"])]),c("section",xm,[c("header",Pm,[c("span",Vm,[g(b(Oo),{title:"纸张的打印边距，可用于标记可打印区域。请确保设打印元素在可打印区域内，避免内容被裁剪。"},{default:ie(()=>y[8]||(y[8]=[oe("参考边距")])),_:1})]),y[9]||(y[9]=c("span",null,"单位：",-1)),g(Is,{modelValue:t.value,"onUpdate:modelValue":y[1]||(y[1]=f=>t.value=f)},null,8,["modelValue"])]),c("div",zm,[g(Ze,{class:"quickprint-form-inline-item",label:"上",modelValue:b(l),"onUpdate:modelValue":y[2]||(y[2]=f=>he(l)?l.value=f:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),g(Ze,{class:"quickprint-form-inline-item",label:"下",modelValue:b(s),"onUpdate:modelValue":y[3]||(y[3]=f=>he(s)?s.value=f:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])]),c("div",Bm,[g(Ze,{class:"quickprint-form-inline-item",label:"左",modelValue:b(o),"onUpdate:modelValue":y[4]||(y[4]=f=>he(o)?o.value=f:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"]),g(Ze,{class:"quickprint-form-inline-item",label:"右",modelValue:b(a),"onUpdate:modelValue":y[5]||(y[5]=f=>he(a)?a.value=f:null),min:0,target:t.value,clearable:""},null,8,["modelValue","target"])])])]))}}),Um={class:"quickprint-is-fill-h quickprint-is-scrollable quickprint-p-4"},Hm={class:"quickprint-is-fill-h"},Gm={class:"quickprint-is-fill-h"},Wm=q({__name:"Font",props:{config:{type:Object,required:!0}},setup(n){const e=n,t=[{label:"倍",value:ke.NONE},{label:"磅",value:ke.PT},{label:"像素",value:ke.PX}],l=N(()=>qn.map(u=>(u.style={fontFamily:u.value==Q.DEFAULT?Q.SONG:u.value},u))),s=N(()=>ys.map(u=>(u.style={fontFamily:u.value==Q.DEFAULT?Q.SONG:u.value},u))),o=N({get(){return e.config.style.fontFamily??Q.DEFAULT},set(u){const m=u===Q.DEFAULT?void 0:u;e.config.style.fontFamily=m}}),a=N({get(){return e.config.style.enFontFamily??Q.DEFAULT},set(u){const m=u===Q.DEFAULT?void 0:u;e.config.style.enFontFamily=m}}),r=N({get(){return e.config.style.fontSize},set(u){const m=se(u)?void 0:u;e.config.style.fontSize=m}}),i=N({get(){return e.config.style.lineHeight},set(u){e.config.style.lineHeight=u}});return(u,m)=>(C(),L("div",Um,[c("section",{class:p(u.classes.font)},[c("div",{class:p(u.classes.zhFont)},[c("div",{class:p(u.classes.title)},"中文字体",2),c("div",Hm,[g(b(X),{options:l.value,modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=d=>o.value=d)},null,8,["options","modelValue"])])],2),c("div",{class:p(u.classes.enFont)},[c("div",{class:p(u.classes.title)},"西文字体",2),c("div",Gm,[g(b(X),{options:s.value,modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=d=>a.value=d)},null,8,["options","modelValue"])])],2),c("div",{class:p(u.classes.lineHeight)},[c("div",{class:p(u.classes.title)},"行高",2),g(dt,{modelValue:i.value,"onUpdate:modelValue":m[2]||(m[2]=d=>i.value=d),options:t},null,8,["modelValue"])],2),c("div",{class:p(u.classes.fontSize)},[c("div",{class:p(u.classes.title)},"字号",2),g(Rs,{modelValue:r.value,"onUpdate:modelValue":m[3]||(m[3]=d=>r.value=d),height:"144px"},null,8,["modelValue"])],2)],2)]))}}),Ym="_font_145qf_2",Xm="_zhFont_145qf_9",jm="_enFont_145qf_16",Zm="_lineHeight_145qf_23",Km="_fontSize_145qf_30",Jm="_title_145qf_45",Qm={font:Ym,zhFont:Xm,enFont:jm,lineHeight:Zm,fontSize:Km,title:Jm},eh={classes:Qm},th=D(Wm,[["__cssModules",eh]]),nh=q({__name:"index",props:{doc:{type:fe,required:!0}},setup(n){const e=n,t=Oe(),l=qe(a()),s=Z("paper"),o=[{label:"纸张",value:"paper"},{label:"字体",value:"font"}];function a(){const d=e.doc;return{size:d.paper.size,width:d.paper.width,height:d.paper.height,orientation:d.paper.orientation,margins:d.margins?{...d.margins}:void 0,style:{...d.style}}}function r(d){s.value=d.value}function i(){if(t==null)return null;const d=t.useMenus();return((d==null?void 0:d.value)??[]).map(v=>sl.renderMenu(t,v))}function u(){t==null||t.confirm(l)}function m(){t==null||t.cancel()}return(d,h)=>(C(),L("div",{class:p(d.classes.setting)},[c("div",{class:p(d.classes.header)},[c("div",{class:p(d.classes.headerLeft)},[g(b(O),{icon:"icon-setting",size:"14px"}),c("span",{class:p(d.classes.title)},"文档",2),g(Ls,{tabs:o,active:s.value,onSwitch:r},null,8,["active"])],2),g(i)],2),s.value=="paper"?(C(),K(Fm,{key:0,config:l},null,8,["config"])):H("",!0),s.value=="font"?(C(),K(th,{key:1,config:l},null,8,["config"])):H("",!0),c("div",{class:p(d.classes.footer)},[c("button",{type:"button",class:"quickprint-text-btn",onClick:m},"取消"),c("button",{type:"button",class:"quickprint-text-btn",onClick:u},"确定")],2)],2))}}),lh="_setting_i01g8_2",sh="_header_i01g8_11",oh="_headerLeft_i01g8_23",ih="_title_i01g8_36",rh="_tabs_i01g8_43",ah="_footer_i01g8_48",ch={setting:lh,header:sh,headerLeft:oh,title:ih,tabs:rh,footer:ah},uh={classes:ch},dh=D(nh,[["__cssModules",uh]]);let rn=null;function fh(n){if(rn)return Promise.resolve(null);const e={pinnable:!1,top:"15vh",width:"420px",height:"520px",resizeMode:Tt.DISABLED};return rn=Qt("文档设置",g(dh,{doc:n},null),e),rn.promisify().then(t=>(n.paper.size=t.size,n.paper.width=t.width,n.paper.height=t.height,n.paper.orientation=t.orientation,n.margins=t.margins,n.style=t.style,t)).catch(Ie).finally(()=>{rn=null})}const ph=["disabled"],mh=["disabled"],hh=q({__name:"index",setup(n){const e=be(),t=N(()=>e.history.allowUndo()),l=N(()=>e.history.allowRedo()),s=am(e),o=cm(e),a=nm(e),r=sm(e),i=lm(e),u=um(e),m=dm(e),d=om(e),h=em(e),v=tm(e),y=im(e),f=N(()=>{var w;return((w=Zn.find(R=>R.value===y.value))==null?void 0:w.label)??"水平对齐"}),S=rm(e),I=N(()=>{var w;return((w=jn.find(R=>R.value===S.value))==null?void 0:w.label)??"垂直对齐"}),M=N(()=>qn.map(w=>(w.style={fontFamily:w.value==Q.DEFAULT?Q.SONG:w.value},w)));async function E(){const w=await un(e.doc);w!=null&&(e.doc.ds=e.doc.createDS(w))}function k(){const w=e.getSelectedElements();if(w.length==0)return;const R=Math.min(...w.map($=>$.left));for(const $ of w)$.setLeft(R,!0);e.createSnapshot()}function _(){const w=e.getSelectedElements();if(w.length==0)return;const R=w[0].page;if(R==null)return;const $=xt(R.width);for(const G of w)G.setLeft(($-G.width)/2);e.createSnapshot()}function T(){const w=e.getSelectedElements();if(w.length==0)return;const R=Math.max(...w.map($=>$.left+$.width));for(const $ of w)$.setLeft(R-$.width,!0);e.createSnapshot()}return(w,R)=>(C(),L("div",{class:p(w.classes.toolbar),onMousedown:R[20]||(R[20]=ee(()=>{},["prevent"]))},[c("button",{type:"button",title:"撤销 Ctrl + Z",class:"quickprint-text-btn",disabled:!t.value,onClick:R[0]||(R[0]=(...$)=>b(e).history.undo&&b(e).history.undo(...$))},[g(b(O),{icon:"icon-undo"})],8,ph),c("button",{type:"button",title:"重做 Ctrl + Y",class:"quickprint-text-btn",disabled:!l.value,onClick:R[1]||(R[1]=(...$)=>b(e).history.redo&&b(e).history.redo(...$))},[g(b(O),{icon:"icon-redo"})],8,mh),c("button",{type:"button",class:p(["quickprint-text-btn",w.classes.tool]),title:"删除",onClick:R[2]||(R[2]=$=>b(e).deleteSelectedElement())},[g(b(O),{icon:"icon-delete",size:"16px"})],2),c("div",{class:p(w.classes.divider)},null,2),g(b(X),{title:"字体",width:"80px",modelValue:b(s),"onUpdate:modelValue":R[3]||(R[3]=$=>he(s)?s.value=$:null),options:M.value,class:p(w.classes.tool),button:""},null,8,["modelValue","options","class"]),g(b(X),{title:"字号",width:"60px",modelValue:b(o),"onUpdate:modelValue":R[4]||(R[4]=$=>he(o)?o.value=$:null),options:b(ml),class:p(w.classes.tool),button:""},null,8,["modelValue","options","class"]),g(b(X),{title:"行高",width:"60px",modelValue:b(a),"onUpdate:modelValue":R[5]||(R[5]=$=>he(a)?a.value=$:null),options:b(_s),class:p(w.classes.tool),popoverWidth:120,button:""},null,8,["modelValue","options","class"]),c("div",{class:p(w.classes.divider)},null,2),g(Ke,{modelValue:b(r),"onUpdate:modelValue":R[6]||(R[6]=$=>he(r)?r.value=$:null),class:p(w.classes.tool)},{default:ie(()=>[c("div",{class:p(w.classes.colorIcon),title:"背景色"},[g(b(O),{icon:"icon-bg-color-a",size:"15px"}),c("div",{class:p(w.classes.colorIndicator),style:Y({backgroundColor:b(r)})},null,6)],2)]),_:1},8,["modelValue","class"]),g(Ke,{modelValue:b(i),"onUpdate:modelValue":R[7]||(R[7]=$=>he(i)?i.value=$:null),class:p(w.classes.tool)},{default:ie(()=>[c("div",{class:p(w.classes.colorIcon),title:"突出显示"},[g(b(O),{icon:"icon-bg-color-b",size:"15px"}),c("div",{class:p(w.classes.colorIndicator),style:Y({backgroundColor:b(i)})},null,6)],2)]),_:1},8,["modelValue","class"]),g(Ke,{modelValue:b(u),"onUpdate:modelValue":R[8]||(R[8]=$=>he(u)?u.value=$:null),class:p(w.classes.tool)},{default:ie(()=>[c("div",{class:p(w.classes.colorIcon),title:"字体颜色"},[g(b(O),{icon:"icon-font",size:"15px"}),c("div",{class:p(w.classes.colorIndicator),style:Y({backgroundColor:b(u)})},null,6)],2)]),_:1},8,["modelValue","class"]),c("button",{type:"button",title:"加粗",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0,"quickprint-is-selected":b(m)}),onClick:R[9]||(R[9]=$=>m.value=!b(m))},[g(b(O),{icon:"icon-font-bold",size:"16px"})],2),c("button",{type:"button",title:"斜体",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0,"quickprint-is-selected":b(d)}),onClick:R[10]||(R[10]=$=>d.value=!b(d))},[g(b(O),{icon:"icon-italic",size:"16px"})],2),c("button",{type:"button",title:"下划线",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0,"quickprint-is-selected":b(h)}),onClick:R[11]||(R[11]=$=>h.value=!b(h))},[g(b(O),{icon:"icon-underline",size:"16px"})],2),c("button",{type:"button",title:"删除线",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0,"quickprint-is-selected":b(v)}),onClick:R[12]||(R[12]=$=>v.value=!b(v))},[g(b(O),{icon:"icon-through-line",size:"16px"})],2),c("div",{class:p(w.classes.divider)},null,2),g(Qp),g(b(X),{options:b(Zn),modelValue:b(y),"onUpdate:modelValue":R[13]||(R[13]=$=>he(y)?y.value=$:null),title:f.value,class:p(w.classes.tool),width:"36px",size:"mini",button:""},{selected:ie(({option:$})=>[g(b(O),{icon:$==null?void 0:$.icon,class:"quickprint-is-self-center"},null,8,["icon"])]),_:1},8,["options","modelValue","title","class"]),g(b(X),{modelValue:b(S),"onUpdate:modelValue":R[14]||(R[14]=$=>he(S)?S.value=$:null),options:b(jn),title:I.value,class:p(w.classes.tool),width:"36px",size:"mini",button:""},{selected:ie(({option:$})=>[g(b(O),{icon:$==null?void 0:$.icon,class:"quickprint-is-self-center"},null,8,["icon"])]),_:1},8,["modelValue","options","title","class"]),c("div",{class:p(w.classes.divider)},null,2),c("button",{type:"button",title:"左侧对齐",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0}),onClick:k},[g(b(O),{icon:"icon-layout-align-left",size:"16px"})],2),c("button",{type:"button",title:"水平居中",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0}),onClick:_},[g(b(O),{icon:"icon-layout-align-center",size:"16px"})],2),c("button",{type:"button",title:"右侧对齐",class:p({"quickprint-text-btn":!0,[w.classes.tool]:!0}),onClick:T},[g(b(O),{icon:"icon-layout-align-right",size:"16px"})],2),c("div",{class:p(w.classes.divider)},null,2),c("button",{type:"button",title:"网格",class:p({"quickprint-text-btn":!0,"quickprint-is-selected":b(e).doc.useGrid}),onClick:R[15]||(R[15]=$=>b(e).toggleBackground())},[g(b(O),{icon:"icon-beijing",size:"16px"})],2),c("button",{type:"button",title:"元素面板",class:p({"quickprint-text-btn":!0,"quickprint-is-selected":b(e).state.panel.left}),onClick:R[16]||(R[16]=$=>b(e).toggleElementPanel())},[g(b(O),{icon:"icon-pintu",size:"16px"})],2),c("button",{type:"button",title:"配置面板",class:p({"quickprint-text-btn":!0,"quickprint-is-selected":b(e).state.panel.right}),onClick:R[17]||(R[17]=$=>b(e).toggleConfigPanel())},[g(b(O),{icon:"icon-config",size:"16px"})],2),R[23]||(R[23]=c("div",{class:"quickprint-is-fill-w"},null,-1)),c("button",{type:"button",class:p({"quickprint-text-btn":!0}),onClick:R[18]||(R[18]=$=>E())},[g(b(O),{icon:"icon-datasource"}),R[21]||(R[21]=c("span",null,"数据源",-1))]),c("button",{type:"button",class:p({"quickprint-text-btn":!0}),onClick:R[19]||(R[19]=$=>b(fh)(b(e).doc))},[g(b(O),{icon:"icon-file-text"}),R[22]||(R[22]=c("span",null,"文档配置",-1))])],34))}}),gh="_toolbar_1bhq2_2",vh="_divider_1bhq2_8",bh="_tool_1bhq2_2",yh="_colorIcon_1bhq2_18",_h="_colorIndicator_1bhq2_38",Eh={toolbar:gh,divider:vh,tool:bh,colorIcon:yh,colorIndicator:_h},Th={classes:Eh},kh=D(hh,[["__cssModules",Th]]),wh={class:"quickprint-is-fill-h quickprint-is-scrollable"},Sh="icon-zhanweifu",Ch=q({__name:"Element",setup(n){const e=be();return(t,l)=>(C(),L("div",{class:p(t.classes.panel)},[c("div",{class:p(t.classes.header)},"可打印元素",2),c("div",wh,[c("div",{class:p(t.classes.grid)},[(C(!0),L(U,null,j(b(ed),s=>(C(),L("div",jl({key:s.type,class:[b(F).DRAGGABLE,t.classes.element],[`.${b(Zl)||""}`]:b(we).INSERT,[`.${b(al)||""}`]:s.type,onPointerdown:l[0]||(l[0]=(...o)=>b(e).onDragStart&&b(e).onDragStart(...o))}),[g(b(O),{icon:s.icon??Sh,size:"16px",class:p(t.classes.icon)},null,8,["icon","class"]),c("span",null,B(s.title),1)],48))),128))],2)])],2))}}),Rh="_panel_1p36j_2",Lh="_header_1p36j_8",Nh="_grid_1p36j_18",Ih="_element_1p36j_30",$h="_icon_1p36j_45",Ah={panel:Rh,header:Lh,grid:Nh,element:Ih,icon:$h},qh={classes:Ah},Oh=D(Ch,[["__cssModules",qh]]),Mh=["onClick"],Dh=q({__name:"SelectPath",setup(n){const e=be(),t=N(()=>{const o=e.state,a=[{id:e.doc.id,title:"文档",type:"document"}];if(o.selectedType===de.PAGE){const r=e.getSelectedPage();if(r!=null){const i="页面"+(r.index+1);a.push({id:r.id,title:i,type:"page",data:r})}return a}if(o.selectedType===de.ELEMENT){if(o.selectMode===et.MULTIPLE){const u=e.getSelectedElements();if(u.length===0)return a;let m=u[0];for(;m.parent;){const d=m.parent;if(d instanceof _t){const h="页面"+(d.index+1);return a.push({id:d.id,title:h,type:"page",data:d}),a}m=d}return a}let r=e.getSelectedElements()[0];if(r==null)return a;const i=[{id:r.id,title:Jt(r.type),type:"element",data:r}];for(;r.parent;){const u=r.parent;if(u instanceof _t){const m="页面"+(u.index+1);return i.unshift({id:u.id,title:m,type:"page",data:u}),a.concat(i)}i.unshift({id:u.id,title:Jt(u.type),type:"element",data:u}),r=u}}return a}),l=N(()=>{if(e.state.selectedType!=de.ELEMENT)return;const a=e.getSelectedElements();if(a.length!=1)return;const r=a[0],i=dl(r,e.doc.ds);if(!(i==null||!i.content))return i.type===ge.VARIABLE||i.type===ge.FORMULA?`[${i.content}]`:i.content});function s(o){if(o.type==="element")return e.selectElement(o.data);if(o.type==="page")return e.selectPage(o.data)}return(o,a)=>(C(),L("div",{class:p(o.classes.paths)},[(C(!0),L(U,null,j(t.value,(r,i)=>(C(),L(U,{key:r.id},[i>0?(C(),K(b(O),{key:0,class:p(o.classes.icon),icon:"icon-right",size:"12px"},null,8,["class"])):H("",!0),c("div",{class:p(o.classes.path),onClick:u=>s(r)},B(r.title),11,Mh)],64))),128)),l.value?(C(),L(U,{key:0},[g(b(O),{class:p(o.classes.ion),icon:"icon-right",size:"12px"},null,8,["class"]),c("div",{class:p(o.classes.content)},B(l.value),3)],64)):H("",!0)],2))}}),xh="_paths_fuk62_2",Ph="_path_fuk62_2",Vh="_icon_fuk62_28",zh="_content_fuk62_33",Bh={paths:xh,path:Ph,icon:Vh,content:zh},Fh={classes:Bh},Uh=D(Dh,[["__cssModules",Fh]]),Hh={class:"quickprint-config"},Gh={class:"quickprint-config-body quickprint-is-scrollable quickprint-is-fill-h"},Wh={class:"quickprint-config-group"},Yh={class:"quickprint-config-section quickprint-config-inline"},Xh={class:"quickprint-config-content quickprint-config-inline"},jh={class:"quickprint-config-section quickprint-config-inline"},Zh={class:"quickprint-config-content quickprint-config-inline"},Kh={class:"quickprint-config-section quickprint-config-inline"},Jh={class:"quickprint-config-content quickprint-form-inline"},Qh={key:0,class:"quickprint-config-section quickprint-config-inline"},eg={class:"quickprint-config-content quickprint-form-inline"},tg={class:"quickprint-config-section quickprint-config-inline"},ng={class:"quickprint-config-content quickprint-form-inline"},lg=q({__name:"PageConfig",props:{page:{type:_t,required:!0}},setup(n){const e=n,t=[{label:"显示",value:!0},{label:"隐藏",value:!1}],l=N({get(){return e.page.size.type},set(r){e.page.size.type=r,r===jt.CONTENT&&(e.page.size.orientation=void 0)}}),s=N({get(){return e.page.orientation},set(r){e.page.size.orientation=r}}),o=N(()=>e.page.width),a=N({get(){return e.page.height},set(r){const i=Number(r);!nl(i)||i<0||(e.page.size.height=i)}});return(r,i)=>(C(),L("div",Hh,[i[11]||(i[11]=c("div",{class:"quickprint-config-title"},"页面配置",-1)),c("div",Gh,[c("div",Wh,[i[10]||(i[10]=c("div",{class:"quickprint-config-group-title"},"布局",-1)),c("section",Yh,[i[5]||(i[5]=c("header",{class:"quickprint-config-header"},"页眉",-1)),c("div",Xh,[g(It,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.header.height,readonly:""},null,8,["modelValue"]),g(Nt,{modelValue:n.page.header.display,"onUpdate:modelValue":i[0]||(i[0]=u=>n.page.header.display=u),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])]),c("section",jh,[i[6]||(i[6]=c("header",{class:"quickprint-config-header"},"页脚",-1)),c("div",Zh,[g(It,{class:"quickprint-form-inline-item",label:"高",modelValue:n.page.footer.height,readonly:""},null,8,["modelValue"]),g(Nt,{modelValue:n.page.footer.display,"onUpdate:modelValue":i[1]||(i[1]=u=>n.page.footer.display=u),options:t,class:"quickprint-form-left-gap"},null,8,["modelValue"])])]),c("section",Kh,[i[7]||(i[7]=c("header",{class:"quickprint-config-header"},"尺寸",-1)),c("div",Jh,[g(Nt,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=u=>l.value=u),options:b(Eo),class:"quickprint-w-full"},null,8,["modelValue","options"])])]),n.page.size.type===b(jt).CONTENT?(C(),L("section",Qh,[i[8]||(i[8]=c("header",{class:"quickprint-config-header"},"内容",-1)),c("div",eg,[g(It,{class:"quickprint-form-inline-item",label:"宽",modelValue:o.value,readonly:""},null,8,["modelValue"]),g(It,{class:"quickprint-form-inline-item",label:"高",modelValue:a.value,"onUpdate:modelValue":i[3]||(i[3]=u=>a.value=u)},null,8,["modelValue"])])])):H("",!0),c("section",tg,[i[9]||(i[9]=c("header",{class:"quickprint-config-header"},"方向",-1)),c("div",ng,[g(Nt,{modelValue:s.value,"onUpdate:modelValue":i[4]||(i[4]=u=>s.value=u),options:b(ts),class:"quickprint-w-full",disabled:n.page.size.type===b(jt).CONTENT},null,8,["modelValue","options","disabled"])])])])])]))}}),sg={},og={class:"quickprint-config"};function ig(n,e){return C(),L("div",og,e[0]||(e[0]=[c("div",{class:"quickprint-config-title"},"多选配置",-1),c("div",{class:"quickprint-config-body quickprint-is-scrollable quickprint-is-fill-h"},"TODO:",-1)]))}const rg=D(sg,[["render",ig]]),ag=q({__name:"CopyBtn",emits:["copy"],setup(n,{emit:e}){const t=e,l=Z(!1);function s(){t("copy",async function(a){await navigator.clipboard.writeText(a).catch(eo)!==!1&&(l.value=!0,setTimeout(()=>l.value=!1,500))})}return(o,a)=>(C(),L("button",{type:"button",class:p(["quickprint-text-btn",o.classes.btn]),title:"复制",onClick:s},[g(b(O),{icon:"icon-copy"}),g(uo,{name:"quickprint-fade"},{default:ie(()=>[l.value?(C(),L("span",{key:0,class:p(o.classes.message)},"已复制",2)):H("",!0)]),_:1})],2))}}),cg="_btn_v9scw_2",ug="_message_v9scw_6",dg={btn:cg,message:ug},fg={classes:dg},pg=D(ag,[["__cssModules",fg]]),mg=q({__name:"window",props:{code:{type:String,default:""},doc:{type:fe,default:null},mode:{type:String,default:"code"}},setup(n){const e=n,t=Oe(),l=Z(e.code),s=re();function o(){return l.value}function a(){e.doc!=null&&dn({doc:e.doc}).then(d=>{var v;if(d==null)return;const h=d.type=="reference"?`[=${d.value}]`:`[${d.value}]`;(v=s.value)==null||v.insert(h)})}function r(d){var h;return tt(d,(h=e.doc)==null?void 0:h.ds)}function i(){var d;(d=s.value)==null||d.insert(`[2.6.${Qn.ELEMENT_VALUR}]`)}function u(){fn().then(d=>{var h;d!=null&&((h=s.value)==null||h.insert(d.value))})}function m(){pn({doc:e.doc}).then(d=>{var h;d!=null&&((h=s.value)==null||h.insert(d.value))})}return t==null||t.useHandle("confirm",o),(d,h)=>(C(),L("div",{class:p(d.classes.window)},[n.mode!=="code"?(C(),L("div",{key:0,class:p(d.classes.toolbar)},[n.mode=="condition"?(C(),L("button",{key:0,type:"button",class:"quickprint-text-btn",onClick:i},"插入元素值")):H("",!0),c("button",{type:"button",onClick:a,class:"quickprint-text-btn"},[g(b(O),{icon:"icon-insert-var"}),h[1]||(h[1]=c("span",null,"插入变量",-1))]),c("button",{type:"button",class:"quickprint-text-btn",onClick:u},[g(b(O),{icon:"icon-function"}),h[2]||(h[2]=c("span",null,"插入函数",-1))]),c("button",{type:"button",class:"quickprint-text-btn",onClick:m},"插入公式")],2)):H("",!0),g(b(Ns),{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=v=>l.value=v),language:"javascript",class:p(d.classes.code),formatVariable:r,autofocus:"",ref_key:"codeRef",ref:s},null,8,["modelValue","class"])],2))}}),hg="_window_14zxh_2",gg="_toolbar_14zxh_11",vg="_code_14zxh_22",bg={window:hg,toolbar:gg,code:vg},yg={classes:bg},$s=D(mg,[["__cssModules",yg]]);function As(n={}){return{pinnable:!1,mask:!0,top:"15vh",width:"720px",height:"540px",resizeMode:Tt.DISABLED,menus:[{label:"确定",handler:e=>e.dispatchConfirm().catch(Ie)}],...n}}function Kt(n){const e=ce.get(Kt);if(e)return e;const t=As({resizeMode:Tt.RESIZE_ONLY}),l=yt("公式",g($s,{code:n==null?void 0:n.code,doc:n==null?void 0:n.doc,mode:n==null?void 0:n.mode},null),t).promisify().catch(Ie).finally(()=>ce.set(Kt,void 0));return ce.set(Kt,l),l}function vn(n,e){const t=ce.get(vn);if(t)return t;const l=As({resizeMode:Tt.RESIZE_ONLY}),s=yt(n,g($s,{code:e},null),l).promisify().catch(Ie).finally(()=>ce.set(vn,void 0));return ce.set(vn,s),s}const _g={class:"quickprint-config-section quickprint-config-inline"},Eg={class:"quickprint-config-content"},Tg=["value"],kg=q({__name:"Visibility",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=N({get(){var r;return((r=e.element.visibility)==null?void 0:r.type)??vt.VISIBLE},set(r){e.element.visibility==null&&(e.element.visibility={}),r!==vt.CONDITION&&(e.element.visibility.condition=void 0),e.element.visibility.type=r}}),l=N({get(){var r;return((r=e.element.visibility)==null?void 0:r.condition)??""},set(r){e.element.visibility==null&&(e.element.visibility={}),e.element.visibility.condition=r}}),s=N(()=>{var r;return fl((r=e.element.visibility)==null?void 0:r.condition,e.element.doc)}),o=N(()=>{var r;return t.value!==vt.CONDITION?!1:!((r=e.element.visibility)!=null&&r.condition)});function a(){const r=l.value||`[2.6.${Qn.ELEMENT_VALUR}]`;Kt({code:r,doc:e.element.doc,mode:"condition"}).then(i=>{i!=null&&(l.value=i)})}return(r,i)=>(C(),L(U,null,[c("section",_g,[i[1]||(i[1]=c("header",{class:"quickprint-config-header"},"可见性",-1)),c("div",Eg,[g(b(X),{class:"quickprint-w-full",options:b(ho),modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=u=>t.value=u)},null,8,["options","modelValue"])])]),t.value===b(vt).CONDITION?(C(),L("div",{key:0,class:p([r.classes.condition,"quickprint-config-section"]),onClick:a},[c("textarea",{value:s.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,Tg),o.value?(C(),K(b(O),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2)):H("",!0)],64))}}),wg="_condition_siopf_2",Sg={condition:wg},Cg={classes:Sg},Rg=D(kg,[["__cssModules",Cg]]);function Lg(n){return N({get(){return n.element.attributes.position??bn.DEFAULT},set(e){const t=e===bn.DEFAULT?void 0:e;n.element.attributes.position=t}})}function Ng(n){return N({get(){return n.element.attributes.printMode??yn.ONCE},set(e){const t=e===yn.ONCE?void 0:e;n.element.attributes.printMode=t}})}function Ig(n){return N({get(){return n.element.attributes.overflow??Zt.HIDDEN},set(e){const t=e===Zt.HIDDEN?void 0:e;n.element.attributes.overflow=t}})}function $g(n){return N({get(){return n.element.width},set(e){n.element.setWidth(e,!0)}})}function Ag(n){return N({get(){return n.element.height},set(e){n.element.setHeight(e,!0)}})}function qg(n){return N({get(){return n.element.attributes.display},set(e){if(e==null){n.element.attributes.display=void 0;return}n.element.attributes.display=e}})}function Og(n){return N({get(){return n.element.ds.type},set(e){const t=n.element.ds.type;n.element.ds.type=e,t!=e&&(n.element.ds.value=void 0)}})}const Mg=q({__name:"Const",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=N({get(){return e.element.ds.value},set(l){e.element.ds.value=l}});return(l,s)=>ve((C(),L("textarea",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),class:"quickprint-form-control quickprint-form-control-block quickprint-config-space",rows:"3",placeholder:"请输入"},null,512)),[[Ce,t.value]])}}),Dg={class:"quickprint-config-ds-var-type"},xg=["title"],Pg=q({__name:"Variable",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=be(),l=N(()=>se(e.element.ds.value)),s=N(()=>tt(e.element.ds.value,t.doc.ds));function o(r){r.stopPropagation(),e.element.ds.value=void 0}async function a(){var m;const r=await $t({doc:t.doc,value:e.element.ds.value}).catch(Xe);if(r==null||(e.element.setDataSource(ge.VARIABLE,r.value),e.element.type!=W.TABLE_CELL||r.type!=="ds"))return;const i=e.element.parent;if(i==null||i.isBindVariable||((m=r.parent)==null?void 0:m.type)!==ne.ARRAY)return;const u=r.parent;i.setDataSource(ge.VARIABLE,`${Ye.DS}.${u.type}.${u.name}`)}return(r,i)=>(C(),L("div",{class:"quickprint-config-ds-variable",onClick:a},[l.value?(C(),L(U,{key:0},[i[0]||(i[0]=c("span",{class:"quickprint-config-ds-placeholder"},"请选择",-1)),g(b(O),{icon:"icon-open-new",size:"14px"})],64)):(C(),L(U,{key:1},[c("span",Dg,"<"+B(b(Ci)(e.element.ds.value))+">",1),c("span",{class:"quickprint-is-fill-w quickprint-is-truncate",title:s.value},B(s.value),9,xg),c("button",{type:"button",class:"quickprint-text-btn quickprint-config-ds-remove-var",onClick:o},[g(b(O),{icon:"icon-close",size:"12px"})])],64))]))}}),Vg=["value"],zg=q({__name:"Code",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=N(()=>se(e.element.ds.value));function l(){return tl(e.element.ds.value)?e.element.ds.value:`function data(element){
  // 在此处自定义返回值
  // 支持返回Promise
  return
}`}function s(){vn("自定义",l()).then(o=>{o!=null&&(e.element.ds.value=o)})}return(o,a)=>(C(),L("div",{onClick:s,class:p(o.classes.code)},[c("textarea",{value:e.element.ds.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,Vg),t.value?(C(),K(b(O),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2))}}),Bg="_code_1az68_2",Fg={code:Bg},Ug={classes:Fg},Hg=D(zg,[["__cssModules",Ug]]),Gg=["value"],Wg=q({__name:"Formula",props:{element:{type:pe,required:!0}},setup(n){const e=n,t=be(),l=N(()=>se(e.element.ds.value)),s=N(()=>fl(e.element.ds.value,e.element.doc));function o(){const a=e.element.ds.value;Kt({code:a,doc:t.doc,mode:"formula"}).then(r=>{r!=null&&(e.element.ds.value=r)})}return(a,r)=>(C(),L("div",{onClick:o,class:p(a.classes.code)},[c("textarea",{value:s.value,class:"quickprint-form-control quickprint-form-control-block quickprint-config-space quickprint-is-scrollable",rows:"3",readonly:"",placeholder:"请输入"},null,8,Gg),l.value?(C(),K(b(O),{key:0,icon:"icon-open-new",size:"14px"})):H("",!0)],2))}}),Yg="_code_ipm2q_2",Xg={code:Yg},jg={classes:Xg},Zg=D(Wg,[["__cssModules",jg]]);function Kg(n){switch(n.ds.type){case ge.CONST:return g(Mg,{element:n},null);case ge.VARIABLE:return g(Pg,{element:n},null);case ge.CODE:return g(Hg,{element:n},null);case ge.FORMULA:return g(Zg,{element:n},null);default:return null}}const xl=q({props:{element:{type:pe,required:!0}},setup(n){const e=N(()=>Jt(n.element.type)),t=N(()=>yo.filter(E=>E.value!=n.element.type)),l=Z("px"),s=$g(n),o=Ag(n),a=Ig(n),r=Lg(n),i=Ng(n),u=qg(n),m=Og(n),d=N(()=>{const E=n.element,k=E.parent;if(k===null||!(k instanceof _t))return!1;const _=k.header;if(_.display&&E.bottom<=(_.height??0))return!1;const T=k.parent;if(T==null)return!1;const w=k.footer;return!(w.display&&E.top>=Math.floor(xt(T.paper.height))-(w.height??0))});function h(E,k){return k==null?!1:!!k.includes(E)}function v(){const E=Rt(n.element.type);if(h(le.LAYOUT,E==null?void 0:E.exclude))return null;const k=n.element,_=h(le.COORD,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("位置")]),g("div",{class:"quickprint-config-content quickprint-form-inline"},[g(Ze,{class:"quickprint-form-inline-item",label:"左",modelValue:k.left,"onUpdate:modelValue":V=>k.left=V,target:l.value},null),g(Ze,{class:"quickprint-form-inline-item",label:"上",modelValue:k.top,"onUpdate:modelValue":V=>k.top=V,target:l.value},null)])]),T=h(le.SIZE)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[g("span",null,[oe("尺寸")])]),g("div",{class:"quickprint-config-content quickprint-form-inline"},[g(Ze,{class:"quickprint-form-inline-item",label:"宽",modelValue:s.value,"onUpdate:modelValue":V=>s.value=V,target:l.value},null),g(Ze,{class:"quickprint-form-inline-item",label:"高",modelValue:o.value,"onUpdate:modelValue":V=>o.value=V,target:l.value},null)])]),w=h(le.VISIBILITY,E==null?void 0:E.exclude)?null:g(Rg,{element:k},null),R=h(le.OVERFLOW,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("溢出时")]),g("div",{class:"quickprint-config-content"},[g(X,{modelValue:a.value,"onUpdate:modelValue":V=>a.value=V,options:wo,class:"quickprint-w-full"},null)])]),$=h(le.PRINT_MODE,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header "},[oe("打印模式")]),g("div",{class:"quickprint-config-content"},[g(X,{modelValue:i.value,"onUpdate:modelValue":V=>i.value=V,options:ko,class:"quickprint-w-full"},null)])]),G=h(le.POSITION,E==null?void 0:E.exclude)||!d.value?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("定位模式")]),g("div",{class:"quickprint-config-content"},[g(X,{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,options:To,class:"quickprint-w-full"},null)])]);return g("div",{class:"quickprint-config-group"},[g("div",{class:"quickprint-config-group-title quickprint-is-row"},[g("span",{class:"quickprint-is-fill-w"},[oe("布局")]),g("span",null,[oe("单位：")]),g(Is,{modelValue:l.value,"onUpdate:modelValue":V=>l.value=V},null)]),_,T,w,R,$,G])}function y(){const E=Rt(n.element.type);if(h(le.BASIC,E==null?void 0:E.exclude))return null;const k=n.element,_=h(le.PREFIX,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("前缀")]),g("div",{class:"quickprint-config-content"},[ve(g("input",{"onUpdate:modelValue":R=>k.attributes.prefix=R,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ce,k.attributes.prefix]])])]),T=h(le.SUFFIX,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("后缀")]),g("div",{class:"quickprint-config-content"},[ve(g("input",{"onUpdate:modelValue":R=>k.attributes.suffix=R,type:"text",class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ce,k.attributes.suffix]])])]),w=h(le.DISPLAY,E==null?void 0:E.exclude)?null:g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("数据类型")]),g("div",{class:"quickprint-config-content"},[g(X,{options:t.value,modelValue:u.value,"onUpdate:modelValue":R=>u.value=R,class:"quickprint-w-full"},null)])]);return g("div",{class:"quickprint-config-group"},[g("div",{class:"quickprint-config-group-title"},[oe("基础")]),_,T,w])}function f(){const E=Rt(n.element.display);return(E==null?void 0:E.display)==null?null:Je(E.display,{element:n.element})}function S(){const E=Rt(n.element.type);if(h(le.ATTRIBUTES,E==null?void 0:E.exclude))return null;const k=E!=null&&E.attributes?Je(E.attributes,{element:n.element}):null,_=f();if(k==null&&_==null)return null;const T=_!=null&&k!=null?g("div",{class:"quickprint-config-divider"},null):null;return g("div",{class:"quickprint-config-group"},[g("div",{class:"quickprint-config-group-title"},[oe("属性")]),_,T,k])}function I(){const E=Rt(n.element.type);return h(le.DATASOURCE,E==null?void 0:E.exclude)?null:g("div",{class:"quickprint-config-group"},[g("div",{class:"quickprint-config-group-title"},[oe("数据")]),g(X,{options:Ql,modelValue:m.value,"onUpdate:modelValue":k=>m.value=k},null),Kg(n.element)])}function M(E){E(n.element.id)}return function(){const k=n.element;return g("div",{class:"quickprint-config"},[g("div",{class:"quickprint-config-title"},[g("span",null,[e.value,oe("配置")]),null]),g("div",{class:"quickprint-config-body quickprint-is-fill-h quickprint-is-scrollable"},[g("div",{class:"quickprint-config-group"},[g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("标识")]),g("div",{class:"quickprint-config-content"},[g("span",{class:"quickprint-config-id"},[k.id]),g(pg,{onCopy:M},null)])]),g("section",{class:"quickprint-config-section quickprint-config-inline"},[g("header",{class:"quickprint-config-header"},[oe("标题")]),g("div",{class:"quickprint-config-content"},[ve(g("input",{type:"text","onUpdate:modelValue":_=>k.title=_,class:"quickprint-form-control quickprint-w-full",placeholder:"请输入"},null),[[Ce,k.title]])])])]),v(),y(),S(),I()])])}}}),Jg=q({setup(){const n=be();function e(){return g("div",null,[oe("未知的打印元素")])}function t(){return g("div",null,[oe("请先选择元素")])}function l(){return g("div",null,[oe("请先选择页面")])}return function(){const s=n.state;if(s.selectedType===de.PAGE){const o=n.getSelectedPage();return o==null?l():g(lg,{page:o},null)}if(s.selectMode===et.SINGLE){const o=n.getSelectedElements()[0];return o==null?t():Je(xl,{element:o,key:o.id})}if(s.selected.length==1){const o=n.getSelectedElements()[0];return Rt(o.type)==null?e():Je(xl,{element:o,key:o.id})}return g(rg,null,null)}}});function Qg(n){let e=null;const t=re(),l=qe({width:0,height:0,scrollTop:0,scrollLeft:0}),s=re(),o=qe({id:"",top:0,left:0,width:0,height:0});async function a(){await Pt();const v=t.value;v!=null&&(l.width=v.offsetWidth,l.height=v.offsetHeight)}function r(v){const y=v.target;l.scrollLeft=y.scrollLeft,l.scrollTop=y.scrollTop}function i(v){const f=v.target.closest("."+F.PAPER);f!=null&&(s.value=f,m(f),u())}async function u(){await Pt();const v=s.value;v!=null&&(o.id=v.id.slice(1),o.width=v.offsetWidth,o.height=v.offsetHeight,o.top=v.offsetTop,o.left=v.offsetLeft)}function m(v){v!=null&&(s.value&&(e==null||e.unobserve(s.value)),e==null||e.observe(v))}function d(){const v=n.doc.firstPage;if(v==null)return;const y=document.querySelector("#\\@"+v.id);s.value=y,e&&y&&e.observe(y),u()}function h(v){v.some(y=>y.target.matches("."+F.CANVAS))&&(a(),u()),v.some(y=>y.target.matches("."+F.PAPER))&&(a(),u())}return rl(()=>n.state.scale,()=>u()),tn(()=>{e=new ResizeObserver(h),e.observe(t.value),d(),a()}),fo(()=>{e==null||e.disconnect(),e=null}),{canvasRef:t,canvasRect:l,pageRect:o,onScroll:r,onSelectPage:i}}const ev=q({__name:"index",props:Et({modelValue:{type:fe,required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:Et(["save","preview"],["update:modelValue"]),setup(n,{emit:e}){const t=e,l=re(),s=re(),o=Ro(),a=en(n,"modelValue"),r=$d(a,{getGhostElement:I,getRootElement:M}),{canvasRef:i,canvasRect:u,pageRect:m,onScroll:d,onSelectPage:h}=Qg(r),v=N(()=>({"--quickprint-page-scale":r.state.scale/100,"--quickprint-dpr":o.value})),y=N(()=>{const T=r.doc.style;return{fontFamily:ul(T==null?void 0:T.fontFamily,T==null?void 0:T.enFontFamily),fontSize:T==null?void 0:T.fontSize,lineHeight:T==null?void 0:T.lineHeight}});function f(){r.state.panel.left=!1}function S(){r.state.panel.right=!1}function I(){return s.value}function M(){return l.value}function E(T){T.deltaY>0?r.zoomIn():r.zoomOut()}function k(){t("preview",a.value)}function _(){t("save",a.value)}return(T,w)=>{const R=po("WindowManager");return C(),L("div",{class:p(T.classes.designer),ref_key:"rootRef",ref:l,style:Y(v.value)},[c("div",{class:p(T.classes.header)},[c("div",{class:p(T.classes.headerLeft)},[Ue(T.$slots,"headerLeft")],2),g(kh,{class:p(T.classes.toolbar)},null,8,["class"]),c("div",{class:p(T.classes.headerRight)},[c("button",{type:"button",class:"quickprint-text-btn",title:"预览",onClick:k},[g(b(O),{icon:"icon-run"}),w[2]||(w[2]=c("span",null,"预览",-1))]),c("button",{type:"button",onClick:_,class:"quickprint-text-btn",title:"保存"},[g(b(O),{icon:"icon-save"}),w[3]||(w[3]=c("span",null,"保存",-1))])],2)],2),c("div",{class:p(T.classes.main)},[b(r).state.panel.left?(C(),L("div",{key:0,class:p(T.classes.left)},[c("button",{type:"button",onClick:f,class:p(["quickprint-text-btn",T.classes.closePanelBtn])},[g(b(O),{icon:"icon-close",size:"12px"})],2),g(Oh)],2)):H("",!0),c("div",{class:p([T.classes.center,b(F).CANVAS]),onWheelPassive:ee(E,["ctrl","stop","prevent"]),ref_key:"canvasRef",ref:i},[g(Ml,{canvas:b(u),page:b(m),scale:b(r).state.scale,direction:"horizontal"},null,8,["canvas","page","scale"]),g(Ml,{canvas:b(u),page:b(m),scale:b(r).state.scale,direction:"vertical"},null,8,["canvas","page","scale"]),c("div",{class:p([b(F).SCROLLABLE,T.classes.canvas]),style:Y(y.value),onScroll:w[0]||(w[0]=(...$)=>b(d)&&b(d)(...$)),onClickCapture:w[1]||(w[1]=(...$)=>b(h)&&b(h)(...$))},[(C(!0),L(U,null,j(a.value.pages,$=>(C(),K(Hp,{key:$.id,doc:a.value,page:$,onSave:_,onPreview:k},null,8,["doc","page"]))),128))],38),c("div",{class:p(T.classes.footer)},[g(Uh),g(b(to),{scale:b(r).state.scale,onZoomIn:b(r).zoomIn,onZoomOut:b(r).zoomOut},null,8,["scale","onZoomIn","onZoomOut"])],2)],34),b(r).state.panel.right?(C(),L("div",{key:1,class:p(T.classes.right)},[c("button",{type:"button",onClick:S,class:p(["quickprint-text-btn",T.classes.closePanelBtn])},[g(b(O),{icon:"icon-close",size:"12px"})],2),g(b(Jg))],2)):H("",!0)],2),c("div",{ref_key:"ghostRef",ref:s,class:p(T.classes.ghost)},null,2),g(R)],6)}}}),tv="_designer_1du88_2",nv="_header_1du88_17",lv="_headerLeft_1du88_25",sv="_headerRight_1du88_36",ov="_toolbar_1du88_43",iv="_footer_1du88_49",rv="_main_1du88_65",av="_left_1du88_73",cv="_center_1du88_81",uv="_right_1du88_93",dv="_canvas_1du88_101",fv="_closePanelBtn_1du88_114",pv="_ghost_1du88_121",mv={designer:tv,header:nv,headerLeft:lv,headerRight:sv,toolbar:ov,footer:iv,main:rv,left:av,center:cv,right:uv,canvas:dv,closePanelBtn:fv,ghost:pv},hv={classes:mv},gv=D(ev,[["__cssModules",hv]]);function vv(n,e={}){const t=no(e.zIndexManager);n.use(lo,{zIndex:t}),so(n._context)}const bv="0.0.0",yv={version:bv,install:vv},_v=["onClick"],Ev=q({__name:"SwitchCase",emits:["switch"],setup(n,{emit:e}){const t=Oe();function l(s){t==null||t.confirm(s)}return(s,o)=>(C(),L("div",{class:p(s.classes.panel)},[(C(!0),L(U,null,j(b(oo),(a,r)=>(C(),L("div",{key:a.id,class:p(s.classes.item),onClick:i=>l(a)},[c("div",null,[c("span",null,B(r+1)+". ",1),c("span",null,B(a.name),1)])],10,_v))),128))],2))}}),Tv="_panel_1he7q_2",kv="_item_1he7q_9",wv={panel:Tv,item:kv},Sv={classes:wv},Cv=D(Ev,[["__cssModules",Sv]]),Rv="local",Pl="quickprint-local-define",Lv=q({__name:"index",setup(n){const e=$e("classes"),t=d();function l(){const h=JSON.stringify(t.value);localStorage.setItem(Pl,h)}function s(){l()}function o(){const h=t.value.id,v=h.startsWith("case_")?h:Rv,y=`${window.location.origin}/preview.html?id=${v}`;l(),yt("文档预览",Je("iframe",{src:y,className:e.iframe}),{pinnable:!1,mask:!0,closeOnPressEsc:!0,width:Math.min(Math.max(1600,t.value.paperWidth+240),window.innerWidth-20)+"px",height:"calc(100vh - 100px)",menus:[{label:"从外部打开链接",handler(f){window.open(y,"_blank"),f.close()}}]})}function a(){const h={mask:!0,top:"15vh",width:"800px",height:"600px",resizeMode:Tt.DISABLED};yt("选择示例",Je(Cv),h).promisify().then(v=>r(v.id)).catch(Ie)}async function r(h){const v=await _l(h,!1);v!=null&&(io(h),t.value=fe.create(v.define),u())}function i(){const h=fe.createNormalDocument();t.value=h,u()}function u(){document.title=t.value.name+" - QuickPrint"}async function m(){const h=localStorage.getItem(Pl);if(h!=null)return fe.create(h);const v=ro(),y=await _l(v.id,!1);return y==null?fe.createNormalDocument():fe.create(y.define)}function d(){const h=Z();return m().then(v=>{h.value=v,u()}),h}return(h,v)=>b(t)?(C(),K(b(gv),{modelValue:b(t),"onUpdate:modelValue":v[0]||(v[0]=y=>he(t)?t.value=y:null),class:p(b(e).main),key:b(t).id,onSave:s,onPreview:o},{headerLeft:ie(()=>[c("button",{type:"button",class:"quickprint-text-btn",onClick:i},[g(b(O),{icon:"icon-file-text"}),v[1]||(v[1]=c("span",null,"新建",-1))]),c("button",{type:"button",class:"quickprint-text-btn",onClick:a},[g(b(O),{icon:"icon-import"}),v[2]||(v[2]=c("span",null,"加载示例",-1))])]),_:1},8,["modelValue","class"])):H("",!0)}}),Nv="_main_248bt_2",Iv="_iframe_248bt_6",$v={main:Nv,iframe:Iv},Av={classes:$v},qv=D(Lv,[["__cssModules",Av]]),qs=mo(qv);qs.use(yv);qs.mount("#app");
